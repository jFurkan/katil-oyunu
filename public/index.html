<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katil Kim? - YÃ¶netici Paneli</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/router.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Modular CSS Files -->
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/game.css">
    <link rel="stylesheet" href="/css/animations.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <link rel="stylesheet" href="/css/enhancements.css">

    <style>
        /* Any page-specific overrides can go here */
    </style>
</head>
<body>
    <!-- Arka Plan MÃ¼ziÄŸi -->
    <audio id="bgMusic" loop>
        <source src="/audio/background.mp3" type="audio/mpeg">
    </audio>

    <!-- Bildirim Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <!-- Ana GiriÅŸ SayfasÄ± -->
        <div class="page active" id="pgNickname">
            <header>
                <h1>Katil <span>Kim?</span></h1>
                <p class="subtitle">"ÅÃ¼phe, gerÃ§eÄŸin gÃ¶lgesidir..."</p>
            </header>

            <div style="max-width: 420px; margin: 40px auto;">
                <!-- Oyuncu GiriÅŸi -->
                <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 30px; margin-bottom: 20px;">
                    <h2 style="color: var(--gold); margin-bottom: 10px; font-size: 20px; text-align: center;">ğŸ­ Oyuncu GiriÅŸi</h2>
                    <p style="color: #999; margin-bottom: 25px; text-align: center; font-size: 14px;">Oyuna katÄ±lmak iÃ§in bir nick seÃ§in</p>

                    <input
                        type="text"
                        id="inpNickname"
                        placeholder="Nick giriniz..."
                        maxlength="20"
                        style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid var(--border-color); background: #000; color: white; border-radius: 8px; margin-bottom: 15px; transition: border-color 0.2s;"
                        onkeypress="if(event.key==='Enter') USER.registerNickname()"
                        onfocus="this.style.borderColor='var(--gold)'"
                        onblur="this.style.borderColor='var(--border-color)'"
                    />

                    <!-- Profil FotoÄŸrafÄ± YÃ¼kleme (Opsiyonel) -->
                    <div style="margin-bottom: 20px; padding: 15px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #ccc; font-size: 14px;">ğŸ“¸ Profil FotoÄŸrafÄ± (opsiyonel)</span>
                            <span id="photoOptionalLabel" style="color: #666; font-size: 12px;">Atlayabilirsiniz</span>
                        </div>

                        <!-- FotoÄŸraf Ã–nizleme -->
                        <div id="photoPreview" style="display: none; margin-bottom: 15px; text-align: center;">
                            <img id="photoPreviewImg" src="" alt="Ã–nizleme" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--gold);">
                            <div style="margin-top: 8px;">
                                <button class="btn" style="padding: 5px 15px; font-size: 12px; background: #ff4444;" onclick="USER.removeProfilePhoto()">âŒ KaldÄ±r</button>
                            </div>
                        </div>

                        <!-- YÃ¼kleme ButonlarÄ± -->
                        <div id="photoUploadButtons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn" style="padding: 10px; font-size: 13px; background: linear-gradient(135deg, #4a5568, #2d3748);" onclick="USER.openCamera()">
                                ğŸ“· Kamera
                            </button>
                            <label style="margin: 0;">
                                <input type="file" id="photoFileInput" accept="image/*" style="display: none;" onchange="USER.handleFileSelect(event)">
                                <button type="button" class="btn" style="width: 100%; padding: 10px; font-size: 13px; background: linear-gradient(135deg, #4a5568, #2d3748);" onclick="document.getElementById('photoFileInput').click()">
                                    ğŸ–¼ï¸ Galeri
                                </button>
                            </label>
                        </div>

                        <!-- Kamera Video (gizli, kamera aÃ§Ä±ldÄ±ÄŸÄ±nda gÃ¶sterilir) -->
                        <div id="cameraContainer" style="display: none; margin-top: 15px;">
                            <video id="cameraVideo" autoplay playsinline style="width: 100%; border-radius: 8px; background: #000;"></video>
                            <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button class="btn" style="padding: 10px; font-size: 13px; background: linear-gradient(135deg, #059669, #047857);" onclick="USER.capturePhoto()">
                                    âœ… Ã‡ek
                                </button>
                                <button class="btn" style="padding: 10px; font-size: 13px; background: #ff4444;" onclick="USER.closeCamera()">
                                    âŒ Ä°ptal
                                </button>
                            </div>
                        </div>

                        <!-- Canvas for photo capture (gizli) -->
                        <canvas id="photoCanvas" style="display: none;"></canvas>
                    </div>

                    <button class="btn btn-primary" style="margin-bottom: 0;" onclick="USER.registerNickname()">ğŸ® Oyuna GiriÅŸ Yap</button>
                </div>

                <!-- YÃ¶netici GiriÅŸi -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 25px; text-align: center;">
                    <h3 style="color: #888; margin-bottom: 15px; font-size: 16px;">ğŸ”’ YÃ¶netici GiriÅŸi</h3>
                    <button class="btn" style="margin-bottom: 0; background: #222; border-color: #444; color: #aaa;" onclick="GAME.showAdminLoginForm()">YÃ¶netici Paneline Git</button>
                </div>
            </div>

            <!-- EmeÄŸi GeÃ§enler -->
            <div class="credits">
                <h3>EmeÄŸi GeÃ§enler</h3>
                <div class="credits-list" id="nicknameCreditsList"></div>
                <div class="credits-note">Bu oyun Katil Kim? dedektiflik oyunu iÃ§in geliÅŸtirilmiÅŸtir.</div>
            </div>
        </div>

        <div class="page" id="pgLobby">
            <header>
                <h1>Katil <span>Kim?</span></h1>
                <p class="subtitle">"ÅÃ¼phe, gerÃ§eÄŸin gÃ¶lgesidir..."</p>
                <!-- Mevcut kullanÄ±cÄ± bilgisi -->
                <div id="currentUserInfo" style="margin-top: 15px;">
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; display: inline-flex; align-items: center; gap: 10px;">
                        <span style="color: var(--text-muted); font-size: 13px;">GiriÅŸ yapÄ±ldÄ±:</span>
                        <span id="currentUserNick" style="color: var(--gold); font-weight: 600;"></span>
                        <button onclick="USER.logout()" style="background: transparent; border: 1px solid #444; color: #888; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                            Ã‡Ä±kÄ±ÅŸ Yap
                        </button>
                    </div>
                </div>
            </header>

            <!-- Oyuncu MenÃ¼sÃ¼ -->
            <div id="lobbyMenu" style="max-width: 400px; margin: 0 auto;">
                <button class="btn" onclick="GAME.showCreateForm()">ğŸ­ Yeni TakÄ±m OluÅŸtur</button>
                <button class="btn" onclick="GAME.showJoinForm()">ğŸ”‘ TakÄ±ma GiriÅŸ Yap</button>
                <button class="btn" onclick="GAME.showScoreboard()">ğŸ† Skor Tablosu</button>
                <button class="btn" onclick="GAME.showNotifications()">
                    ğŸ”” Bildirimler
                    <span id="notifBadgeLobby" style="display:none; background:var(--accent); color:white; border-radius:50%; width:20px; height:20px; font-size:11px; margin-left:auto;"></span>
                </button>
                <button class="btn" style="margin-top: 30px; color: #888; border-color: #333; font-size: 13px;" onclick="GAME.backToMain()">â† Ana Sayfaya DÃ¶n</button>
            </div>

            <!-- EmeÄŸi GeÃ§enler -->
            <div id="lobbyCredits" class="credits">
                <h3>EmeÄŸi GeÃ§enler</h3>
                <div class="credits-list" id="lobbyCreditsList"></div>
                <div class="credits-note">Bu oyun Katil Kim? dedektiflik oyunu iÃ§in geliÅŸtirilmiÅŸtir.</div>
            </div>

            <div class="form-box" id="createForm" style="display:none;">
                <h3 style="margin-bottom:15px; color:white;">Yeni TakÄ±m</h3>
                <input type="text" id="inpNewTeam" placeholder="TakÄ±m adÄ±..." maxlength="20">
                <input type="password" id="inpNewTeamPassword" placeholder="TakÄ±m ÅŸifresi..." maxlength="20">

                <!-- Renk SeÃ§imi -->
                <div style="margin: 15px 0;">
                    <label style="color: #888; font-size: 12px; margin-bottom: 8px; display: block;">TakÄ±m Rengi</label>
                    <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px;">
                        <div class="color-option" data-color="#3b82f6" style="background: #3b82f6;" onclick="CUSTOMIZE.selectColor('#3b82f6')"></div>
                        <div class="color-option" data-color="#ef4444" style="background: #ef4444;" onclick="CUSTOMIZE.selectColor('#ef4444')"></div>
                        <div class="color-option" data-color="#10b981" style="background: #10b981;" onclick="CUSTOMIZE.selectColor('#10b981')"></div>
                        <div class="color-option" data-color="#f59e0b" style="background: #f59e0b;" onclick="CUSTOMIZE.selectColor('#f59e0b')"></div>
                        <div class="color-option" data-color="#8b5cf6" style="background: #8b5cf6;" onclick="CUSTOMIZE.selectColor('#8b5cf6')"></div>
                        <div class="color-option" data-color="#ec4899" style="background: #ec4899;" onclick="CUSTOMIZE.selectColor('#ec4899')"></div>
                        <div class="color-option" data-color="#06b6d4" style="background: #06b6d4;" onclick="CUSTOMIZE.selectColor('#06b6d4')"></div>
                        <div class="color-option" data-color="#84cc16" style="background: #84cc16;" onclick="CUSTOMIZE.selectColor('#84cc16')"></div>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="GAME.hideCreateForm()">Ä°ptal</button>
                    <button class="btn btn-primary" onclick="GAME.createTeam()">OluÅŸtur</button>
                </div>
            </div>

            <div class="form-box" id="joinForm" style="display:none;">
                <h3 style="margin-bottom:15px; color:white;">TakÄ±m SeÃ§</h3>
                <div id="joinTeamList" style="display:block;">
                    <div class="team-list" id="joinList" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div>
                    <button class="btn" onclick="GAME.hideJoinForm()">Ä°ptal</button>
                </div>
                <div id="joinPasswordSection" style="display:none;">
                    <div style="margin-bottom:15px; color:#888; font-size:14px;">
                        SeÃ§ilen takÄ±m: <span id="selectedTeamName" style="color:var(--gold); font-weight:600;"></span>
                    </div>
                    <input type="password" id="inpJoinPassword" placeholder="TakÄ±m ÅŸifresi..." maxlength="20">
                    <div style="display:flex; gap:10px;">
                        <button class="btn" onclick="GAME.backToTeamList()">â† Geri</button>
                        <button class="btn btn-primary" onclick="GAME.joinTeam()">GiriÅŸ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="pgTeam">
            <header style="padding: 20px 0;">
                <div style="color:#666; font-size:12px; letter-spacing: 2px; text-transform: uppercase;">Dedektif Paneli</div>
                <h1 id="dispTeamName" style="font-size:32px; margin-top:5px;">-</h1>
            </header>

            <div style="max-width:500px; margin: 0 auto;">
                <!-- TakÄ±m Bilgileri KartÄ± -->
                <div style="background: linear-gradient(135deg, #1a1a1a, #111); border: 2px solid var(--gold); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(212,175,55,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">TakÄ±m AdÄ±</div>
                            <div id="teamInfoName" style="color: #fff; font-size: 20px; font-weight: 600;">-</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Puan</div>
                            <div id="teamInfoScore" style="color: var(--gold); font-size: 32px; font-weight: 700; font-family: 'Courier New', monospace;">0</div>
                        </div>
                    </div>
                </div>

                <!-- Countdown GÃ¶rÃ¼nÃ¼mÃ¼ -->
                <div id="teamCountdownSection"></div>

                <!-- YÃ¶netici Ä°puÃ§larÄ± - YENÄ° TASARIM -->
                <div id="adminCluesSection" style="display:none; margin-bottom:20px;">
                    <div style="background: linear-gradient(135deg, #1a0a0a, #0d0404); border: 2px solid var(--accent); border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(139,0,0,0.3); position: relative; overflow: hidden;">
                        <!-- BaÅŸlÄ±k -->
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--accent); padding-bottom: 10px;">
                            <div style="font-size: 24px;">ğŸ¯</div>
                            <div>
                                <h3 style="margin: 0; color: var(--accent); font-size: 18px; font-weight: 700;">YÃ¶netici Ä°puÃ§larÄ±</h3>
                                <div style="color: #888; font-size: 11px; margin-top: 2px;">Oyun yÃ¶neticisinden gelen ipuÃ§larÄ±</div>
                            </div>
                            <div id="adminCluesCount" style="margin-left: auto; background: var(--accent); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0</div>
                        </div>

                        <!-- Ä°puÃ§larÄ± Listesi -->
                        <div id="adminCluesList" style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;"></div>

                        <!-- BoÅŸ Durum -->
                        <div id="adminCluesEmpty" style="text-align: center; padding: 30px; color: #666;">
                            <div style="font-size: 32px; margin-bottom: 10px;">ğŸ”</div>
                            <div style="font-size: 13px;">HenÃ¼z yÃ¶netici ipucu yok</div>
                        </div>
                    </div>
                </div>

                <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #222; margin-bottom:20px;">
                    <h3 style="margin-bottom:12px; color:var(--gold);">ğŸ” Yeni Ä°pucu</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="inpClue" placeholder="BulduÄŸunuz ipucunu yazÄ±n..." maxlength="300" style="margin:0;">
                        <button class="btn btn-primary" style="width:auto; margin:0;" onclick="GAME.addClue()">GÃ¶nder</button>
                    </div>
                </div>

                <!-- TakÄ±mlar ArasÄ± Chat -->
                <div id="interTeamChatContainer" style="background: linear-gradient(135deg, #0a1a1a, #050d0d); border: 2px solid #1a4d4d; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(26,77,77,0.3);">
                    <!-- BaÅŸlÄ±k (TÄ±klanabilir) -->
                    <div id="interTeamChatHeader" onclick="toggleInterTeamChat()" style="display: flex; align-items: center; justify-content: space-between; padding-bottom: 10px; cursor: pointer; user-select: none; border-bottom: 1px solid #1a4d4d; margin-bottom: 15px;" onmouseover="this.style.borderBottomColor='#4dd4d4'" onmouseout="this.style.borderBottomColor='#1a4d4d'">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 24px;">ğŸ’¬</div>
                            <div>
                                <h3 style="margin: 0; color: #4dd4d4; font-size: 18px; font-weight: 700;">TakÄ±mlar ArasÄ± Sohbet</h3>
                                <div style="color: #666; font-size: 11px; margin-top: 2px;">TÃ¼m takÄ±mlar gÃ¶rebilir</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button onclick="event.stopPropagation(); POKE.showPokeModal();" style="background: linear-gradient(135deg, #4d1a4d, #331033); border: 2px solid #d44dd4; color: #d44dd4; padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(212,77,212,0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                <span>ğŸ‘‹</span>
                                <span>DÃ¼rt</span>
                            </button>
                            <div id="teamChatCount" style="background: #1a4d4d; color: #4dd4d4; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0</div>
                            <div id="interTeamChatToggleIcon" style="color: #4dd4d4; font-size: 20px; transition: transform 0.3s ease;">â–¼</div>
                        </div>
                    </div>

                    <!-- Ä°Ã§erik (AÃ§Ä±lÄ±r/KapanÄ±r) -->
                    <div id="interTeamChatContent" style="max-height: 2000px; overflow: hidden; transition: max-height 0.4s ease-in-out, opacity 0.3s ease; opacity: 1;">

                    <!-- Mesajlar AlanÄ± -->
                    <div id="teamChatMessages" style="background: #000; border: 1px solid #1a4d4d; border-radius: 8px; padding: 15px; max-height: 400px; overflow-y: auto; margin-bottom: 15px; min-height: 300px;">
                        <div style="text-align: center; padding: 60px 20px; color: #555;">
                            <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ğŸ’¬</div>
                            <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            <div style="font-size: 12px; color: #444; margin-top: 5px;">Ä°lk mesajÄ± sen gÃ¶nder!</div>
                        </div>
                    </div>

                    <!-- Pagination Kontrolleri -->
                    <div id="teamChatPagination" style="display: none; text-align: center; margin-bottom: 15px; padding: 10px; background: #0a0a0a; border-radius: 8px; border: 1px solid #1a4d4d;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <button id="btnChatPrevPage" class="btn" style="padding: 8px 16px; margin: 0; font-size: 12px; opacity: 0.5;" onclick="CHAT.loadPreviousPage()" disabled>â† Ã–nceki</button>
                            <div style="color: #666; font-size: 12px;">
                                <span id="chatCurrentPage">1</span> / <span id="chatTotalPages">1</span>
                                <span style="margin-left: 10px;">(<span id="chatTotalMessages">0</span> mesaj)</span>
                            </div>
                            <button id="btnChatNextPage" class="btn" style="padding: 8px 16px; margin: 0; font-size: 12px; opacity: 0.5;" onclick="CHAT.loadNextPage()" disabled>Sonraki â†’</button>
                        </div>
                    </div>

                    <!-- Mesaj GÃ¶nderme AlanÄ± -->
                    <div style="margin-bottom: 10px;">
                        <div style="position: relative; display: inline-block;">
                            <button id="btnTeamSelector" onclick="CHAT.toggleTeamDropdown()" style="background: #0a0a0a; border: 1px solid #1a4d4d; color: #4dd4d4; padding: 10px 40px 10px 16px; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 600; position: relative;">
                                <span id="selectedTeamText">ğŸ“¢ TÃ¼m TakÄ±mlar</span>
                                <span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%);">â–¼</span>
                            </button>
                            <div id="teamDropdown" style="display: none; position: fixed; background: #0a0a0a; border: 1px solid #1a4d4d; border-radius: 6px; min-width: 200px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 10001; max-height: 300px; overflow-y: auto;">
                                <!-- Dropdown iÃ§eriÄŸi JavaScript ile doldurulacak -->
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="inpTeamChat" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." maxlength="500" style="margin: 0; background: #000; border: 1px solid #1a4d4d; color: #fff; flex: 1;" onkeypress="if(event.key==='Enter') CHAT.sendMessage()">
                        <button class="btn btn-primary" style="width: auto; margin: 0; padding: 12px 24px; background: linear-gradient(135deg, #1a4d4d, #0d3333); border-color: #4dd4d4;" onclick="CHAT.sendMessage()">GÃ¶nder</button>
                    </div>

                    </div><!-- Ä°Ã§erik sonu -->
                </div><!-- Container sonu -->

                <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #222;">
                    <h3 style="margin-bottom:12px; display:flex; justify-content:space-between;">
                        ğŸ“‹ KayÄ±tlar <span id="clueCnt" style="color:#666; font-size:14px;">(0)</span>
                    </h3>
                    <div id="myClueList" style="max-height:300px; overflow-y:auto;"></div>
                </div>

                <!-- Murder Board Butonu -->
                <button class="btn btn-primary" style="margin-top:20px; background: linear-gradient(135deg, #4d1a1a, #331010); border: 2px solid #d44d4d; color: #d44d4d;" onclick="MURDERBOARD.openMurderBoard()">
                    ğŸ” Murder Board
                </button>

                <button class="btn" style="margin-top:20px; border-color:#333;" onclick="GAME.exitTeam()">ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
        </div>

        <!-- Murder Board SayfasÄ± -->
        <div class="page" id="pgMurderBoard">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #1a0a0a, #0d0505); border-bottom: 2px solid #4d1a1a; padding: 20px; margin-bottom: 20px; position: sticky; top: 0; z-index: 100;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="margin: 0; color: #d44d4d; font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                            ğŸ” Murder Board
                        </h2>
                        <div style="color: #888; font-size: 12px; margin-top: 4px;">
                            <span id="mbTeamName">-</span> â€¢ <span id="mbItemCount">0</span> Ã¶ÄŸe
                        </div>
                    </div>
                    <button class="back-btn" onclick="MURDERBOARD.closeMurderBoard()">â† Geri</button>
                </div>
            </div>

            <!-- Toolbar -->
            <div style="background: #111; border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 20px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                <button id="btnAddCharacter" class="btn btn-primary" style="background: linear-gradient(135deg, #1a4d1a, #0d3310); border-color: #4dd44d; color: #4dd44d;" onclick="MURDERBOARD.showCharacterSelector()">
                    â• Karakter Ekle
                </button>
                <button id="btnAddConnection" class="btn" style="background: linear-gradient(135deg, #4d4d1a, #333310); border-color: #d4d44d; color: #d4d44d;" onclick="MURDERBOARD.toggleConnectionMode()">
                    ğŸ”— BaÄŸlantÄ± Ekle
                </button>
                <button class="btn" style="background: linear-gradient(135deg, #4d1a4d, #331033); border-color: #d44dd4; color: #d44dd4;" onclick="MURDERBOARD.clearBoard()">
                    ğŸ—‘ï¸ Temizle
                </button>

                <!-- Zoom Kontrolleri -->
                <div style="margin-left: auto; display: flex; gap: 8px; align-items: center; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 4px;">
                    <button class="btn" style="margin: 0; padding: 6px 12px; font-size: 16px; background: #222; border-color: #444;" onclick="MURDERBOARD.zoomOut()">âˆ’</button>
                    <span id="zoomLevel" style="color: #888; font-size: 12px; min-width: 50px; text-align: center;">100%</span>
                    <button class="btn" style="margin: 0; padding: 6px 12px; font-size: 16px; background: #222; border-color: #444;" onclick="MURDERBOARD.zoomIn()">+</button>
                    <button class="btn" style="margin: 0; padding: 6px 12px; font-size: 12px; background: #222; border-color: #444;" onclick="MURDERBOARD.resetZoom()">Reset</button>
                </div>
            </div>

            <!-- Karakter SeÃ§ici Modal -->
            <div id="characterSelectorModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: #1a1a1a; border: 2px solid #4d1a1a; border-radius: 12px; padding: 25px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin: 0 0 15px 0; color: #d44d4d; font-size: 18px;">Karakter SeÃ§</h3>

                    <select id="characterDropdown" style="width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; margin-bottom: 15px; font-size: 14px;">
                        <option value="">Karakter seÃ§in...</option>
                    </select>

                    <textarea id="characterNote" placeholder="Not ekle (opsiyonel)" maxlength="500" style="width: 100%; min-height: 80px; margin: 0 0 15px 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; resize: vertical;"></textarea>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" style="flex: 1; margin: 0;" onclick="MURDERBOARD.addCharacterToBoard()">âœ… Ekle</button>
                        <button class="btn" style="flex: 1; margin: 0;" onclick="MURDERBOARD.hideCharacterSelector()">âŒ Ä°ptal</button>
                    </div>
                </div>
            </div>

            <!-- Not DÃ¼zenleme Modal -->
            <div id="editNoteModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: #1a1a1a; border: 2px solid #4d1a1a; border-radius: 12px; padding: 25px; max-width: 500px; width: 90%;">
                    <h3 style="margin: 0 0 15px 0; color: #d44d4d; font-size: 18px;">Not DÃ¼zenle</h3>

                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; color: #4dd4d4; margin-bottom: 8px;">Karakter: <span id="editCharacterName"></span></div>
                    </div>

                    <textarea id="editNoteTextarea" placeholder="Not (opsiyonel)" maxlength="500" style="width: 100%; min-height: 120px; margin: 0 0 15px 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; resize: vertical;"></textarea>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" style="flex: 1; margin: 0;" onclick="MURDERBOARD.saveEditedNote()">âœ… Kaydet</button>
                        <button class="btn" style="flex: 1; margin: 0;" onclick="MURDERBOARD.hideEditNoteModal()">âŒ Ä°ptal</button>
                    </div>
                </div>
            </div>

            <!-- Cork Board Canvas -->
            <div id="murderBoardWrapper" style="background: rgba(139, 90, 43, 0.3); border: 3px solid #6b4423; border-radius: 8px; padding: 20px; position: relative; overflow: auto; max-height: 700px;">
                <!-- Cork Board Texture Overlay -->
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><filter id=%22noise%22><feTurbulence type=%22fractalNoise%22 baseFrequency=%220.9%22 numOctaves=%224%22 stitchTiles=%22stitch%22/></filter><rect width=%22100%22 height=%22100%22 filter=%22url(%23noise)%22 opacity=%220.15%22/></svg>'); pointer-events: none; z-index: 0;"></div>

                <!-- Board Container (zoom olacak) -->
                <div id="murderBoardCanvas" style="position: relative; min-height: 600px; min-width: 800px; background: transparent; transform-origin: top left; transition: transform 0.2s ease; z-index: 2; border: 2px solid rgba(107, 68, 35, 0.5); border-radius: 8px;">
                    <!-- Karakterler ve baÄŸlantÄ±lar buraya dinamik eklenecek -->
                    <svg id="connectionsLayer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
                        <!-- BaÄŸlantÄ± Ã§izgileri buraya eklenecek -->
                    </svg>

                    <!-- Empty state -->
                    <div id="boardEmptyState" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666; pointer-events: none;">
                        <div style="font-size: 64px; margin-bottom: 10px; opacity: 0.3;">ğŸ“Œ</div>
                        <div style="font-size: 16px;">Murder board boÅŸ</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.7;">Karakter eklemek iÃ§in yukarÄ±daki butonu kullanÄ±n</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="pgAdmin">
            <div class="admin-head">
                <div>
                    <h2 style="font-size:24px;">ğŸ‘ï¸ YÃ¶netici Paneli</h2>
                    <div style="color:#666; font-size:12px; margin-top:4px;">
                        <span id="statTeams">0</span> TakÄ±m â€¢ <span id="statClues">0</span> Ä°pucu
                    </div>
                </div>
                <button class="back-btn" onclick="GAME.exitAdmin()">Ã‡Ä±kÄ±ÅŸ</button>
            </div>

            <!-- Admin MenÃ¼ ButonlarÄ± - RESPONSIVE -->
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-bottom:30px;">
                <button class="btn btn-primary" onclick="ADMIN.showSection('game')">â±ï¸ Oyun KontrolÃ¼</button>
                <button class="btn" onclick="ADMIN.showSection('characters')">ğŸ‘¥ Karakterler</button>
                <button class="btn" onclick="ADMIN.showSection('users')">ğŸ‘¤ KullanÄ±cÄ±lar</button>
                <button class="btn" onclick="ADMIN.showSection('scoring')">ğŸ¯ Puanlama</button>
                <button class="btn" onclick="ADMIN.showSection('notifications')">ğŸ“¢ Bildirimler</button>
                <button class="btn" onclick="ADMIN.showSection('chat')">ğŸ’¬ Chat Ä°zleme</button>
                <button class="btn" onclick="ADMIN.showSection('adminmessages')">ğŸ‘‘ Admin MesajlarÄ±</button>
                <button class="btn" onclick="ADMIN.showSection('murderboard')">ğŸ” Murder Board Ä°zleme</button>
                <button class="btn" onclick="ADMIN.showSection('stats')">ğŸ“Š Ä°statistikler</button>
                <button class="btn" onclick="ADMIN.showSection('credits')">ğŸ‘¥ EmeÄŸi GeÃ§enler</button>
                <button class="btn" onclick="ADMIN.showSection('iplogs')">ğŸ” IP LoglarÄ±</button>
                <button class="btn" onclick="ADMIN.showSection('profilephotos')">ğŸ“¸ Profil FotoÄŸraflarÄ±</button>
                <button class="btn" style="background: linear-gradient(135deg, #8b0000, #450000); border-color: #ff4444;" onclick="ADMIN.showSection('reset')">ğŸ”„ Oyunu SÄ±fÄ±rla</button>
            </div>

            <!-- Oyun Kontrol BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionGame" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">â±ï¸ Oyun KontrolÃ¼</h3>
                <div class="game-control">
                    <!-- Oyun BaÅŸlatma -->
                    <div id="gameStartSection">
                        <input type="text" id="gameTitle" placeholder="Faz BaÅŸlÄ±ÄŸÄ± (Ã¶rn: Faz 1, Ä°lk Tur)" maxlength="30" style="width:100%; margin:0 0 10px 0; padding:12px;">
                        <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px;">
                            <input type="number" id="gameMinutes" placeholder="SÃ¼re (dakika)" min="1" max="180" style="flex:1; margin:0; padding:12px;">
                            <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.startGame()">ğŸ® Oyunu BaÅŸlat</button>
                        </div>
                    </div>

                    <!-- Countdown GÃ¶rÃ¼nÃ¼mÃ¼ -->
                    <div id="gameRunningSection" style="display:none;">
                        <div class="admin-phase-title" id="adminPhaseTitle"></div>
                        <div class="countdown-display" id="adminCountdown">00:00</div>
                        <div class="time-controls">
                            <button class="time-btn add" onclick="ADMIN.addTime(300)">+5 Dakika</button>
                            <button class="time-btn add" onclick="ADMIN.addTime(600)">+10 Dakika</button>
                            <button class="time-btn add" onclick="ADMIN.addTime(60)">+1 Dakika</button>
                        </div>
                        <button class="btn" style="width:100%; margin-top:15px; background:#500; color:#faa; border:1px solid var(--accent);" onclick="ADMIN.endGame()">â¹ï¸ Oyunu Bitir</button>
                    </div>

                    <!-- Karakter GÃ¶rÃ¼nÃ¼rlÃ¼k KontrolÃ¼ -->
                    <div style="margin-top: 30px; background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #4dd4d4; margin: 0 0 15px 0; font-size: 16px;">ğŸ‘ï¸ Karakter GÃ¶rÃ¼nÃ¼rlÃ¼k KontrolÃ¼</h4>
                        <p style="color: #888; font-size: 12px; margin: 0 0 15px 0;">AÃ§tÄ±ÄŸÄ±nÄ±z karakterler takÄ±mlarÄ±n Murder Board'larÄ±nda gÃ¶rÃ¼nÃ¼r olur.</p>

                        <div id="gameCharactersList">
                            <div style="text-align: center; padding: 40px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ğŸ‘¤</div>
                                <div style="font-size: 14px;">HenÃ¼z karakter eklenmemiÅŸ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Faz GeÃ§miÅŸi -->
                    <div style="margin-top: 30px; background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #4dd4d4; margin: 0 0 15px 0; font-size: 16px;">ğŸ“‹ Faz GeÃ§miÅŸi</h4>
                        <p style="color: #888; font-size: 12px; margin: 0 0 15px 0;">Her faz iÃ§in baÅŸlangÄ±Ã§, bitiÅŸ ve istatistik bilgileri.</p>

                        <div id="phasesList" style="display: flex; flex-direction: column; gap: 10px;">
                            <div style="text-align: center; padding: 40px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">â±ï¸</div>
                                <div style="font-size: 14px;">HenÃ¼z faz baÅŸlatÄ±lmamÄ±ÅŸ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karakterler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionCharacters" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ‘¥ Karakter YÃ¶netimi</h3>

                <!-- Karakter Ekleme Formu -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #4dd4d4; margin-bottom: 15px; font-size: 16px;">â• Yeni Karakter Ekle</h4>

                    <div style="display: grid; gap: 12px;">
                        <input type="text" id="charName" placeholder="Ä°sim *" maxlength="100" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">

                        <!-- FotoÄŸraf URL / Dosyadan SeÃ§ -->
                        <div style="display: flex; gap: 8px; align-items: stretch;">
                            <input type="text" id="charPhotoUrl" placeholder="FotoÄŸraf URL'si" maxlength="500" style="flex: 1; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">
                            <button class="btn" style="margin: 0; padding: 12px 16px; white-space: nowrap; background: #222; border-color: #4dd4d4; color: #4dd4d4;" onclick="CHARACTER.openPhotoSelector()">ğŸ“‚ Dosyadan SeÃ§</button>
                        </div>

                        <textarea id="charDescription" placeholder="AÃ§Ä±klama / Karakter Bilgisi" maxlength="1000" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; min-height: 100px; resize: vertical;"></textarea>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <input type="number" id="charAge" placeholder="YaÅŸ (opsiyonel)" min="0" max="150" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">

                            <input type="text" id="charOccupation" placeholder="Meslek (opsiyonel)" maxlength="100" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">
                        </div>

                        <textarea id="charAdditionalInfo" placeholder="Ek Bilgiler (opsiyonel)" maxlength="1000" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; min-height: 80px; resize: vertical;"></textarea>

                        <div style="padding: 10px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #888; font-size: 12px;">
                            ğŸ’¡ <strong>Not:</strong> Karakter gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ "Oyun KontrolÃ¼" bÃ¶lÃ¼mÃ¼nden yÃ¶netebilirsiniz.
                        </div>

                        <button class="btn btn-primary" style="width: 100%; margin: 0; padding: 12px;" onclick="CHARACTER.addCharacter()">âœ… Karakter Ekle</button>
                    </div>
                </div>

                <!-- Karakter Listesi -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: #4dd4d4; font-size: 16px; margin: 0;">ğŸ“‹ KayÄ±tlÄ± Karakterler</h4>
                        <span id="characterCount" style="color: #666; font-size: 12px;">0 karakter</span>
                    </div>

                    <div id="charactersList" style="max-height: 600px; overflow-y: auto;">
                        <div style="text-align: center; padding: 40px 20px; color: #555;">
                            <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ğŸ‘¤</div>
                            <div style="font-size: 14px;">HenÃ¼z karakter eklenmemiÅŸ</div>
                        </div>
                    </div>
                </div>

                <!-- FotoÄŸraf SeÃ§ici Modal -->
                <div id="photoSelectorModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center;">
                    <div style="background: #1a1a1a; border: 2px solid #4d1a1a; border-radius: 12px; padding: 25px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <h3 style="margin: 0 0 15px 0; color: #4dd4d4; font-size: 18px;">ğŸ“‚ YÃ¼klenmiÅŸ FotoÄŸraflar</h3>

                        <div style="color: #888; font-size: 12px; margin-bottom: 15px; padding: 10px; background: #0a0a0a; border: 1px solid #333; border-radius: 6px;">
                            ğŸ’¡ <strong>Bilgi:</strong> Bu listede hem karakter fotoÄŸraflarÄ± (<code style="background: #222; padding: 2px 6px; border-radius: 3px;">public/uploads/characters/</code>) hem de kullanÄ±cÄ± profil fotoÄŸraflarÄ± (<code style="background: #222; padding: 2px 6px; border-radius: 3px;">public/uploads/profiles/</code>) gÃ¶sterilir.<br>
                            Desteklenen formatlar: JPG, JPEG, PNG, GIF, WEBP
                        </div>

                        <div id="photoGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <!-- FotoÄŸraflar buraya yÃ¼klenecek -->
                        </div>

                        <button class="btn" style="width: 100%; margin: 0;" onclick="CHARACTER.closePhotoSelector()">âŒ Kapat</button>
                    </div>
                </div>
            </div>

            <!-- KullanÄ±cÄ±lar BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionUsers" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ‘¤ KullanÄ±cÄ±lar</h3>
                <div id="usersList"></div>
            </div>

            <!-- Bildirimler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionNotifications" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ“¢ Bildirimler</h3>

                <!-- Ä°pucu GÃ¶nderme -->
                <div class="announcement-form" style="margin-bottom:20px;">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">ğŸ’¡ Genel Ä°pucu GÃ¶nder</h3>
                    <textarea id="generalClueText" placeholder="TÃ¼m takÄ±mlara gÃ¶nderilecek ipucunu yazÄ±n..." maxlength="500"></textarea>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button class="btn btn-primary" style="width:auto; padding:10px 24px; margin:0;" onclick="ADMIN.sendGeneralClue()">Ä°pucu GÃ¶nder</button>
                        <button class="btn" style="width:auto; padding:10px 24px; margin:0; background:#300; color:#faa; border:1px solid #500;" onclick="ADMIN.clearAllClues()">ğŸ—‘ï¸ TÃ¼m Ä°puÃ§larÄ±nÄ± Sil</button>
                    </div>

                    <!-- GÃ¶nderilen Ä°puÃ§larÄ± Listesi -->
                    <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">GÃ¶nderilen Ä°puÃ§larÄ±</h3>
                            <span id="adminClueCount" style="color:#666; font-size:12px;">0 ipucu</span>
                        </div>
                        <div id="adminClueList" style="max-height:300px; overflow-y:auto;"></div>
                    </div>
                </div>

                <!-- Duyuru GÃ¶nderme -->
                <div class="announcement-form">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">ğŸ“¢ Genel Duyuru GÃ¶nder</h3>
                    <textarea id="announcementText" placeholder="TÃ¼m takÄ±mlara gÃ¶nderilecek duyuruyu yazÄ±n..." maxlength="500"></textarea>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button class="btn btn-primary" style="width:auto; padding:10px 24px; margin:0;" onclick="ADMIN.sendAnnouncement()">Duyuruyu GÃ¶nder</button>
                        <button class="btn" style="width:auto; padding:10px 24px; margin:0; background:#300; color:#faa; border:1px solid #500;" onclick="ADMIN.clearAllNotifications()">ğŸ—‘ï¸ TÃ¼m Bildirimleri Sil</button>
                    </div>

                    <!-- GÃ¶nderilen Bildirimler Listesi -->
                    <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">GÃ¶nderilen Bildirimler</h3>
                            <span id="adminNotifCount" style="color:#666; font-size:12px;">0 bildirim</span>
                        </div>
                        <div id="adminNotifList" style="max-height:300px; overflow-y:auto;"></div>
                    </div>
                </div>
            </div>

            <!-- Puanlama BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionScoring" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ¯ Puanlama</h3>
                <div class="stats-chart" id="statsChart">
                    <h3 style="color:#666; font-size:12px; text-transform:uppercase; margin-bottom:15px;">ğŸ“Š CanlÄ± Puan Durumu</h3>
                    <div id="chartContent"></div>
                </div>

                <div id="adminList" class="admin-list"></div>

                <button class="btn" style="background:#300; color:#faa; border:1px solid #500; margin-top:30px;" onclick="GAME.resetGame()">âš ï¸ OYUNU SIFIRLA (TÃ¼m TakÄ±mlarÄ± Sil)</button>
            </div>

            <!-- Chat Ä°zleme BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionChat" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ’¬ Chat Ä°zleme</h3>

                <!-- TakÄ±m SeÃ§ici -->
                <div style="margin-bottom:20px;">
                    <label style="display:block; color:#888; font-size:13px; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px;">TakÄ±m SeÃ§</label>
                    <select id="adminChatTeamSelector" onchange="ADMIN.selectTeamForChat(this.value)" style="width:100%; max-width:400px; background:#0a0a0a; border:1px solid #1a4d4d; color:#4dd4d4; padding:12px 16px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">
                        <option value="">TakÄ±m seÃ§in...</option>
                    </select>
                </div>

                <!-- Chat GÃ¶rÃ¼ntÃ¼leme AlanÄ± -->
                <div id="adminChatViewerContainer" style="display:none;">
                    <div style="background: linear-gradient(135deg, #0a1a1a, #050d0d); border: 2px solid #1a4d4d; border-radius: 12px; padding: 20px; box-shadow: 0 5px 20px rgba(26,77,77,0.3);">
                        <!-- BaÅŸlÄ±k -->
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #1a4d4d; padding-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 24px;">ğŸ’¬</div>
                                <div>
                                    <h3 id="adminChatTeamName" style="margin: 0; color: #4dd4d4; font-size: 18px; font-weight: 700;">-</h3>
                                    <div style="color: #666; font-size: 11px; margin-top: 2px;">TakÄ±mlar arasÄ± mesajlar (Admin mesajlarÄ± hariÃ§)</div>
                                </div>
                            </div>
                            <div id="adminChatMessageCount" style="background: #1a4d4d; color: #4dd4d4; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0 mesaj</div>
                        </div>

                        <!-- Mesajlar AlanÄ± -->
                        <div id="adminChatMessages" style="background: #000; border: 1px solid #1a4d4d; border-radius: 8px; padding: 15px; max-height: 500px; overflow-y: auto; min-height: 400px;">
                            <div style="text-align: center; padding: 60px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ğŸ’¬</div>
                                <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            </div>
                        </div>

                        <!-- Bilgi Metni -->
                        <div style="margin-top: 15px; padding: 12px; background: rgba(26,77,77,0.2); border: 1px solid #1a4d4d; border-radius: 6px; color: #888; font-size: 12px; text-align: center;">
                            â„¹ï¸ Bu gÃ¶rÃ¼nÃ¼m sadece takÄ±mlar arasÄ± mesajlarÄ± gÃ¶sterir. Admin'e gÃ¶nderilen Ã¶zel mesajlar burada gÃ¶rÃ¼nmez. Admin mesajlarÄ± iÃ§in "ğŸ‘‘ Admin MesajlarÄ±" bÃ¶lÃ¼mÃ¼nÃ¼ kullanÄ±n.
                        </div>
                    </div>
                </div>

                <!-- BoÅŸ Durum -->
                <div id="adminChatEmptyState" style="text-align:center; padding:60px 20px; color:#555;">
                    <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ğŸ”</div>
                    <div style="font-size:16px; margin-bottom:8px;">Bir takÄ±m seÃ§in</div>
                    <div style="font-size:13px; color:#444;">SeÃ§tiÄŸiniz takÄ±mÄ±n chat geÃ§miÅŸini gÃ¶rÃ¼ntÃ¼leyebilirsiniz</div>
                </div>
            </div>

            <!-- Admin MesajlarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionAdminmessages" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>ğŸ‘‘ Admin MesajlarÄ±</span>
                    <button class="btn btn-primary" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN.loadAdminMessages()">ğŸ”„ Yenile</button>
                </h3>

                <!-- TakÄ±m SeÃ§ici -->
                <div style="margin-bottom:20px;">
                    <label style="display:block; color:#888; font-size:13px; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px;">TakÄ±m SeÃ§</label>
                    <select id="adminMessagesTeamSelector" onchange="ADMIN.selectTeamForAdminMessages(this.value)" style="width:100%; max-width:400px; background:#0a0a0a; border:1px solid #1a4d4d; color:#fbbf24; padding:12px 16px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">
                        <option value="">TakÄ±m seÃ§in...</option>
                    </select>
                </div>

                <!-- Mesajlar GÃ¶rÃ¼ntÃ¼leme AlanÄ± -->
                <div id="adminMessagesViewerContainer" style="display:none;">
                    <div style="background: linear-gradient(135deg, #0a1a1a, #050d0d); border: 2px solid #1a4d4d; border-radius: 12px; padding: 20px; box-shadow: 0 5px 20px rgba(26,77,77,0.3);">
                        <!-- BaÅŸlÄ±k -->
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #1a4d4d; padding-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 24px;">ğŸ’¬</div>
                                <div>
                                    <h3 id="adminSelectedTeamName" style="margin: 0; color: #fbbf24; font-size: 18px; font-weight: 700;">-</h3>
                                    <div style="color: #666; font-size: 11px; margin-top: 2px;">Admin ile takÄ±m arasÄ±ndaki mesajlar</div>
                                </div>
                            </div>
                            <div id="adminSelectedTeamMessageCount" style="background: rgba(251,191,36,0.2); color: #fbbf24; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; border: 1px solid rgba(251,191,36,0.3);">0 mesaj</div>
                        </div>

                        <!-- Mesajlar AlanÄ± -->
                        <div id="adminMessagesContainer" style="background: #000; border: 1px solid #1a4d4d; border-radius: 8px; padding: 15px; max-height: 500px; overflow-y: auto; margin-bottom: 15px; min-height: 400px;">
                            <div style="text-align: center; padding: 80px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ğŸ“­</div>
                                <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            </div>
                        </div>

                        <!-- Cevap GÃ¶nderme AlanÄ± -->
                        <div style="background: rgba(251,191,36,0.05); border: 1px solid rgba(251,191,36,0.2); border-radius: 8px; padding: 15px;">
                            <div style="color: #fbbf24; font-size: 13px; font-weight: 700; margin-bottom: 10px;">âœ‰ï¸ TakÄ±ma Mesaj GÃ¶nder</div>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="adminReplyMessage" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." maxlength="500" style="margin: 0; background: #000; border: 1px solid #1a4d4d; color: #fff; flex: 1; padding: 12px 16px; border-radius: 6px;" onkeypress="if(event.key==='Enter') ADMIN.sendReplyMessage()">
                                <button class="btn btn-primary" style="width: auto; margin: 0; padding: 12px 24px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-color: #fbbf24; color: #000; font-weight: 700;" onclick="ADMIN.sendReplyMessage()">GÃ¶nder</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BoÅŸ Durum -->
                <div id="adminMessagesEmptyState" style="text-align:center; padding:60px 20px; color:#555;">
                    <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ğŸ”</div>
                    <div style="font-size:16px; margin-bottom:8px;">Bir takÄ±m seÃ§in</div>
                    <div style="font-size:13px; color:#444;">SeÃ§tiÄŸiniz takÄ±ma mesaj gÃ¶nderebilir ve gelen mesajlarÄ± gÃ¶rÃ¼ntÃ¼leyebilirsiniz</div>
                </div>
            </div>

            <!-- Murder Board Ä°zleme BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionMurderboard" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>ğŸ” Murder Board Ä°zleme</span>
                    <button class="btn btn-primary" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.refreshBoard()">ğŸ”„ Yenile</button>
                </h3>

                <!-- TakÄ±m SeÃ§imi -->
                <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:20px; margin-bottom:20px;">
                    <label style="display:block; color:#888; font-size:13px; margin-bottom:10px;">ğŸ“‹ TakÄ±m SeÃ§in</label>
                    <select id="adminBoardTeamSelect" onchange="ADMIN_BOARD.selectTeam(this.value)" style="width:100%; padding:12px; background:#000; border:1px solid #333; color:#fff; border-radius:8px; cursor:pointer;">
                        <option value="">-- TakÄ±m SeÃ§in --</option>
                    </select>
                </div>

                <!-- Murder Board GÃ¶rÃ¼nÃ¼mÃ¼ -->
                <div id="adminBoardViewContainer" style="display:none;">
                    <!-- Bilgi KartÄ± -->
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:15px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px;">
                        <div>
                            <div style="color:#4dd4d4; font-weight:600; font-size:16px; margin-bottom:5px;" id="adminBoardTeamName">-</div>
                            <div style="color:#888; font-size:13px;">
                                <span id="adminBoardItemCount">0</span> karakter â€¢ <span id="adminBoardConnectionCount">0</span> baÄŸlantÄ±
                            </div>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.zoomOut()">ğŸ”âˆ’ UzaklaÅŸ</button>
                            <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.resetZoom()">âŠ¡ Normal</button>
                            <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.zoomIn()">ğŸ”+ YakÄ±nlaÅŸ</button>
                        </div>
                    </div>

                    <!-- Murder Board Canvas -->
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:20px; position:relative; overflow:hidden;">
                        <!-- Zoom KontrollÃ¼ Wrapper -->
                        <div style="overflow:auto; max-height:600px; border-radius:8px; position:relative;">
                            <!-- Sabit Arka Plan -->
                            <div style="position:absolute; top:0; left:0; right:0; bottom:0; background:url('https://www.transparenttextures.com/patterns/cork-board.png') repeat; opacity:0.15; z-index:0; pointer-events:none;"></div>

                            <!-- Arka Plan Rengi -->
                            <div style="position:absolute; top:0; left:0; right:0; bottom:0; background:#2d1f1a; z-index:1; pointer-events:none;"></div>

                            <!-- Board Container -->
                            <div id="adminBoardCanvas" style="position:relative; min-height:600px; min-width:800px; background:transparent; transform-origin:top left; transition:transform 0.2s ease; z-index:2;">
                                <!-- SVG BaÄŸlantÄ± KatmanÄ± -->
                                <svg id="adminConnectionsLayer" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1;">
                                    <!-- BaÄŸlantÄ± Ã§izgileri -->
                                </svg>

                                <!-- BoÅŸ Durum -->
                                <div id="adminBoardEmptyState" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; color:#555; z-index:5;">
                                    <div style="font-size:64px; margin-bottom:15px; opacity:0.3;">ğŸ•µï¸</div>
                                    <div style="font-size:18px; margin-bottom:8px;">Bu takÄ±mÄ±n henÃ¼z murder board'u boÅŸ</div>
                                    <div style="font-size:13px; color:#444;">TakÄ±m karakterleri eklediÄŸinde buradan izleyebilirsiniz</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CanlÄ± GÃ¼ncelleme Bildirimi -->
                    <div style="margin-top:15px; padding:12px; background:#0a0a0a; border:1px solid #333; border-radius:8px; color:#888; font-size:12px; text-align:center;">
                        âš¡ CanlÄ± izleme aktif - TakÄ±mÄ±n yaptÄ±ÄŸÄ± deÄŸiÅŸiklikler otomatik olarak burada gÃ¶rÃ¼nÃ¼r
                    </div>
                </div>

                <!-- BoÅŸ Durum (TakÄ±m SeÃ§ilmemiÅŸ) -->
                <div id="adminBoardEmptyStateMain" style="text-align:center; padding:60px 20px; color:#555;">
                    <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ğŸ”</div>
                    <div style="font-size:16px; margin-bottom:8px;">Bir takÄ±m seÃ§in</div>
                    <div style="font-size:13px; color:#444;">SeÃ§tiÄŸiniz takÄ±mÄ±n murder board'unu canlÄ± olarak izleyebilirsiniz</div>
                </div>
            </div>

            <!-- Ä°statistikler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionStats" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>ğŸ“Š Oyun Ä°statistikleri</span>
                    <button class="btn btn-primary" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN.loadStatistics()">ğŸ”„ Yenile</button>
                </h3>

                <!-- Genel Ä°statistikler -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ğŸ“ˆ Genel Ã–zet</h4>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:15px;">
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam TakÄ±m</div>
                            <div id="statTotalTeams" style="color:var(--gold); font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam KullanÄ±cÄ±</div>
                            <div id="statTotalUsers" style="color:#4dd4d4; font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam Mesaj</div>
                            <div id="statTotalMessages" style="color:#ffa500; font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam Ä°pucu</div>
                            <div id="statTotalClues" style="color:#d4af37; font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                    </div>
                </div>

                <!-- MesajlaÅŸma Analizi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ğŸ’¬ MesajlaÅŸma Analizi</h4>
                    <div id="statsMessaging" style="font-size:13px;"></div>
                </div>

                <!-- Ä°pucu Analizi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ğŸ” Ä°pucu Analizi</h4>
                    <div id="statsClues" style="font-size:13px;"></div>
                </div>

                <!-- KullanÄ±cÄ± Aktivitesi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ğŸ‘¥ KullanÄ±cÄ± Aktivitesi</h4>
                    <div id="statsUsers" style="font-size:13px;"></div>
                </div>

                <!-- Puanlama Tablosu -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ğŸ¯ Puan SÄ±ralamasÄ±</h4>
                    <div id="statsScoring" style="font-size:13px;"></div>
                </div>

                <!-- Export ButonlarÄ± -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ğŸ“¥ DÄ±ÅŸa Aktar</h4>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.exportStats('json')">ğŸ“„ JSON Ä°ndir</button>
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.exportStats('csv')">ğŸ“Š CSV Ä°ndir</button>
                    </div>
                    <div style="margin-top:10px; color:#666; font-size:12px;">TÃ¼m istatistikler ve veri dÄ±ÅŸa aktarÄ±lacaktÄ±r.</div>
                </div>
            </div>

            <!-- EmeÄŸi GeÃ§enler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionCredits" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ‘¥ EmeÄŸi GeÃ§enler</h3>

                <!-- Ä°sim Ekleme Formu -->
                <div class="announcement-form" style="margin-bottom:20px;">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">â• Yeni KiÅŸi Ekle</h3>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="creditNameInput" placeholder="Ä°sim girin..." maxlength="30" style="margin:0; flex:1;" onkeypress="if(event.key==='Enter') ADMIN.addCredit()">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.addCredit()">Ekle</button>
                    </div>
                </div>

                <!-- Ä°simler ve Ä°Ã§erik YÃ¶netimi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">KiÅŸiler ve Ä°Ã§erikleri</h3>
                        <span id="creditsCount" style="color:#666; font-size:12px;">0 kiÅŸi</span>
                    </div>
                    <div id="creditsList" style="display:flex; flex-direction:column; gap:15px; min-height:100px;"></div>
                </div>
            </div>

            <!-- IP LoglarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionIplogs" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ” IP YÃ¶netimi</h3>

                <!-- Tab ButonlarÄ± -->
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button id="ipTabLogs" class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_SECTION.showTab('logs')">ğŸ“Š Aktivite LoglarÄ±</button>
                    <button id="ipTabUsers" class="btn" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_SECTION.showTab('users')">ğŸ‘¥ KullanÄ±cÄ± KayÄ±tlarÄ±</button>
                </div>

                <!-- TAB 1: Aktivite LoglarÄ± -->
                <div id="ipTabContentLogs" style="display:block;">
                    <!-- Bilgilendirme -->
                    <div style="background:#1a1a1a; border-left:4px solid var(--gold); padding:15px; margin-bottom:20px; border-radius:8px;">
                        <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                            Son 24 saat iÃ§inde IP bazlÄ± aktiviteler. Bir IP'den Ã§ok fazla kullanÄ±cÄ±/takÄ±m oluÅŸturulmasÄ±nÄ± engellemek iÃ§in bu limitler vardÄ±r.
                            <br><strong style="color:var(--gold);">KullanÄ±cÄ± KaydÄ±:</strong> AynÄ± IP'den 24 saatte maksimum 3 kayÄ±t
                            <br><strong style="color:var(--gold);">TakÄ±m OluÅŸturma:</strong> AynÄ± IP'den 24 saatte maksimum 2 takÄ±m
                            <br><br><strong style="color:#ff9800;">ğŸ’¡ Not:</strong> Bir IP limiti dolduÄŸunda (Ã¶rn: 3/3), "Limiti SÄ±fÄ±rla" butonuyla o IP'nin hakkÄ±nÄ± yenileyebilirsin.
                        </p>
                    </div>

                    <!-- Yenile ve TÃ¼mÃ¼nÃ¼ SÄ±fÄ±rla ButonlarÄ± -->
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_LOGS.loadLogs()">ğŸ”„ Yenile</button>
                        <button class="btn" style="width:auto; padding:12px 24px; margin:0; background:#500; color:#faa; border:1px solid #700;" onclick="IP_LOGS.clearAll()">ğŸ—‘ï¸ TÃ¼m LoglarÄ± SÄ±fÄ±rla</button>
                    </div>

                    <!-- Loglar Tablosu -->
                    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">Aktivite LoglarÄ±</h3>
                            <span id="ipLogsCount" style="color:#666; font-size:12px;">0 kayÄ±t</span>
                        </div>
                        <div id="ipLogsList" style="display:flex; flex-direction:column; gap:12px; min-height:100px;"></div>
                    </div>
                </div>

                <!-- TAB 2: KullanÄ±cÄ± KayÄ±tlarÄ± -->
                <div id="ipTabContentUsers" style="display:none;">
                    <!-- Bilgilendirme -->
                    <div style="background:#1a1a1a; border-left:4px solid #3b82f6; padding:15px; margin-bottom:20px; border-radius:8px;">
                        <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                            TÃ¼m kayÄ±tlÄ± kullanÄ±cÄ±larÄ± gÃ¶rebilir ve silebilirsiniz.
                            <br><strong style="color:#3b82f6;">KullanÄ±cÄ± Silme:</strong> Bir kullanÄ±cÄ±yÄ± sildiÄŸinizde, baÅŸka biri o nickname ile kaydolabilir.
                            <br><br><strong style="color:#ff9800;">ğŸ’¡ Not:</strong> EÄŸer birisi "furkan1" nickname'ini almak istiyorsa ama kullanÄ±mda ise, eski "furkan1" kullanÄ±cÄ±sÄ±nÄ± buradan silebilirsiniz.
                        </p>
                    </div>

                    <!-- Yenile ve Hepsini Sil ButonlarÄ± -->
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_USERS.loadAllUsers()">ğŸ”„ KullanÄ±cÄ±larÄ± Yenile</button>
                        <button class="btn" style="width:auto; padding:12px 24px; margin:0; background:#dc2626; border-color:#dc2626; color:#fff;" onclick="IP_USERS.deleteAll()">ğŸ—‘ï¸ Hepsini Sil</button>
                    </div>

                    <!-- KullanÄ±cÄ±lar Listesi -->
                    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">TÃ¼m KullanÄ±cÄ± KayÄ±tlarÄ±</h3>
                            <span id="ipUsersCount" style="color:#666; font-size:12px;">0 kullanÄ±cÄ±</span>
                        </div>
                        <div id="ipUsersList" style="display:flex; flex-direction:column; gap:12px; min-height:100px;">
                            <div style="color:#666; text-align:center; padding:30px;">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profil FotoÄŸraflarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionProfilephotos" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ğŸ“¸ Profil FotoÄŸraflarÄ± YÃ¶netimi</h3>

                <!-- Bilgilendirme -->
                <div style="background:#1a1a1a; border-left:4px solid var(--gold); padding:15px; margin-bottom:20px; border-radius:8px;">
                    <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                        KullanÄ±cÄ±larÄ±n profil fotoÄŸraflarÄ±nÄ± buradan gÃ¶rÃ¼ntÃ¼leyebilir, silebilir veya deÄŸiÅŸtirebilirsiniz.
                        <br><strong style="color:var(--gold);">FotoÄŸraf Sil:</strong> KullanÄ±cÄ±nÄ±n profil fotoÄŸrafÄ± kaldÄ±rÄ±lÄ±r (varsayÄ±lan avatar gÃ¶sterilir)
                        <br><strong style="color:var(--gold);">FotoÄŸraf DeÄŸiÅŸtir:</strong> KullanÄ±cÄ± iÃ§in yeni bir fotoÄŸraf yÃ¼kleyebilirsiniz
                    </p>
                </div>

                <!-- Yenile Butonu -->
                <div style="margin-bottom:20px;">
                    <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="PHOTO_ADMIN.loadUsers()">ğŸ”„ KullanÄ±cÄ±larÄ± Yenile</button>
                </div>

                <!-- KullanÄ±cÄ±lar Listesi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">KullanÄ±cÄ±lar ve Profil FotoÄŸraflarÄ±</h3>
                        <span id="photoUsersCount" style="color:#666; font-size:12px;">0 kullanÄ±cÄ±</span>
                    </div>
                    <div id="photoUsersList" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:15px; min-height:100px;">
                        <div style="color:#666; text-align:center; padding:30px; grid-column: 1/-1;">YÃ¼kleniyor...</div>
                    </div>
                </div>

                <!-- FotoÄŸraf DeÄŸiÅŸtirme Modal (gizli) -->
                <input type="file" id="adminPhotoInput" accept="image/*" style="display:none;" onchange="PHOTO_ADMIN.handlePhotoSelect(event)">
            </div>

            <!-- Oyunu SÄ±fÄ±rla BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionReset" class="admin-section" style="display:none;">
                <h3 style="color:#ff4444; font-size:18px; margin-bottom:20px; border-bottom:1px solid #ff4444; padding-bottom:10px;">ğŸ”„ Oyunu Tamamen SÄ±fÄ±rla</h3>

                <!-- UyarÄ± MesajÄ± -->
                <div style="background:#3d0000; border:2px solid #ff4444; padding:20px; margin-bottom:30px; border-radius:12px;">
                    <h3 style="color:#ff4444; font-size:16px; margin-bottom:15px;">âš ï¸ TEHLÄ°KELÄ° Ä°ÅLEM - DÄ°KKATLE OKUYUN!</h3>
                    <p style="color:#ffaaaa; font-size:14px; line-height:1.8; margin:0;">
                        Bu iÅŸlem GERÄ° ALINAMAZ ve aÅŸaÄŸÄ±daki <strong>TÃœM VERÄ°LERÄ° SÄ°LER:</strong>
                    </p>
                    <ul style="color:#ffaaaa; font-size:14px; line-height:2; margin:15px 0 0 20px;">
                        <li><strong>TÃ¼m KullanÄ±cÄ±lar</strong> - KayÄ±tlÄ± tÃ¼m oyuncular silinecek</li>
                        <li><strong>TÃ¼m TakÄ±mlar</strong> - OluÅŸturulan tÃ¼m takÄ±mlar silinecek</li>
                        <li><strong>TÃ¼m Karakterler</strong> - Eklenen tÃ¼m karakterler silinecek</li>
                        <li><strong>TÃ¼m Ä°puÃ§larÄ±</strong> - Genel ve takÄ±m ipuÃ§larÄ± silinecek</li>
                        <li><strong>TÃ¼m Murder Board Verileri</strong> - Karakter kartlarÄ± ve baÄŸlantÄ±lar silinecek</li>
                        <li><strong>TÃ¼m Chat MesajlarÄ±</strong> - TakÄ±m mesajlarÄ± silinecek</li>
                        <li><strong>TÃ¼m IP LoglarÄ±</strong> - IP aktivite kayÄ±tlarÄ± silinecek</li>
                        <li><strong>TÃ¼m Rozetler</strong> - OluÅŸturulan rozetler silinecek</li>
                        <li><strong>EmeÄŸi GeÃ§enler</strong> - Credits kayÄ±tlarÄ± silinecek</li>
                    </ul>
                    <p style="color:#ff8888; font-size:15px; font-weight:600; margin:20px 0 0 0;">
                        ğŸ’¡ Bu iÅŸlem sadece yeni bir oyuna baÅŸlamadan Ã¶nce kullanÄ±lmalÄ±dÄ±r.
                    </p>
                </div>

                <!-- SÄ±fÄ±rlama Ä°ÅŸlemi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:30px;">
                    <h3 style="color:#888; font-size:15px; margin-bottom:20px;">SÄ±fÄ±rlama Ä°ÅŸlemi</h3>

                    <p style="color:#aaa; font-size:14px; margin-bottom:20px;">
                        Ä°ÅŸlemi onaylamak iÃ§in aÅŸaÄŸÄ±daki butona basÄ±n. Ä°kinci bir onay ekranÄ± gÃ¶receksiniz.
                    </p>

                    <button class="btn" style="background:linear-gradient(135deg, #8b0000, #450000); border-color:#ff4444; color:#ff4444; font-weight:600; width:100%; padding:16px;" onclick="GAME_RESET.showConfirmModal()">
                        ğŸ”„ Oyunu SÄ±fÄ±rlamak Ä°stiyorum
                    </button>
                </div>
            </div>
        </div>

        <div class="page" id="pgScoreboard">
            <div class="admin-head">
                <h2>ğŸ† Liderlik Tablosu</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div id="scoreboardList" style="max-width:600px; margin:0 auto;"></div>
        </div>

        <div class="page" id="pgNotifications">
            <div class="admin-head">
                <h2>ğŸ”” Bildirimler</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div style="max-width:700px; margin:0 auto;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div style="color:#888; font-size:13px;">
                        Toplam <span id="notifCount">0</span> bildirim
                    </div>
                    <button class="btn" style="width:auto; padding:8px 16px; font-size:12px; margin:0;" onclick="NOTIF.markAllRead()">TÃ¼mÃ¼nÃ¼ Okundu Ä°ÅŸaretle</button>
                </div>
                <div class="notif-list" id="notifList"></div>
            </div>
        </div>

        <div class="page" id="pgCreditDetail">
            <div class="admin-head">
                <h2 id="creditDetailName">-</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div style="max-width:800px; margin:0 auto;">
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:30px; min-height:300px;">
                    <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">KatkÄ±larÄ±</h3>
                    <div id="creditDetailContent" style="color:#ccc; font-size:15px; line-height:1.8; white-space:pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="passModal">
        <div class="modal-box">
            <h3 style="margin-bottom:10px; color:white;">YÃ¶netici GiriÅŸi</h3>
            <p style="margin:0 0 15px 0; color:#999; font-size:13px; text-align:center;">Minimum 12 karakter gerekli</p>
            <input type="password" id="inpPass" maxlength="50" placeholder="Admin ÅŸifrenizi girin..." style="text-align:center; font-size:16px; padding:12px;" onkeypress="if(event.key==='Enter') GAME.checkPass()">
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="GAME.hidePassModal()">Ä°ptal</button>
                <button class="btn btn-primary" onclick="GAME.checkPass()">GiriÅŸ</button>
            </div>
        </div>
    </div>

    <!-- Final Raporu Modal -->
    <div class="modal" id="finalReportModal" style="display:none;">
        <div class="modal-box" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <h2 style="text-align:center; color:var(--gold); margin-bottom:20px; font-size:28px;">
                ğŸ† OYUN BÄ°TTÄ°! ğŸ†
            </h2>

            <div id="finalReportContent">
                <!-- Ä°Ã§erik JavaScript ile doldurulacak -->
            </div>

            <div style="text-align:center; margin-top:30px;">
                <button class="btn btn-primary" onclick="GAME.closeFinalReport()">Kapat</button>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <!-- Notification Center -->
    <div class="notification-center-btn" id="notificationCenterBtn" onclick="NOTIFICATIONS.toggle()" style="display: none;">
        <i data-feather="bell" class="icon-md"></i>
        <span class="badge-count" id="notificationBadge" style="display: none;">0</span>
    </div>

    <div class="notification-center-dropdown" id="notificationCenterDropdown">
        <div class="notification-center-header">
            <h3><i data-feather="inbox" class="icon-sm"></i> Bildirimler</h3>
            <button class="notification-center-clear" onclick="NOTIFICATIONS.clearAll()">
                <i data-feather="trash-2" class="icon-xs"></i> TÃ¼mÃ¼nÃ¼ Temizle
            </button>
        </div>
        <div class="notification-center-list" id="notificationCenterList">
            <div class="notification-center-empty">
                <div class="notification-center-empty-icon">
                    <i data-feather="bell-off" class="icon-xl" style="opacity: 0.3;"></i>
                </div>
                <div>HenÃ¼z bildirim yok</div>
            </div>
        </div>
    </div>

    <!-- CanlÄ± Lider Tablosu -->
    <div class="live-leaderboard hidden" id="liveLeaderboard">
        <div class="live-leaderboard-header">
            <h3><i data-feather="award" class="icon-sm"></i><span> Liderlik</span></h3>
            <button class="live-leaderboard-toggle" onclick="LEADERBOARD.toggle()">
                <i data-feather="x" class="icon-sm"></i>
            </button>
        </div>
        <div class="live-leaderboard-list" id="liveLeaderboardList">
            <!-- TakÄ±mlar buraya gelecek -->
        </div>
    </div>

    <!-- MÃ¼zik AyarlarÄ± Butonu -->
    <button onclick="openMusicSettings()" class="music-settings-btn" title="MÃ¼zik AyarlarÄ±">
        ğŸµ
    </button>

    <!-- Tema SeÃ§ici -->
    <div class="theme-switcher">
        <div class="theme-menu" id="themeMenu">
            <div class="theme-option active" onclick="THEME.setTheme('classic')" data-theme="classic">
                <div class="theme-preview classic"></div>
                <span>Classic Dark</span>
            </div>
            <div class="theme-option" onclick="THEME.setTheme('midnight')" data-theme="midnight">
                <div class="theme-preview midnight"></div>
                <span>Midnight Detective</span>
            </div>
            <div class="theme-option" onclick="THEME.setTheme('blood')" data-theme="blood">
                <div class="theme-preview blood"></div>
                <span>Blood Moon</span>
            </div>
        </div>
        <button class="theme-btn" onclick="THEME.toggleMenu()">ğŸ¨</button>
    </div>

    <!-- Bildirim Popup -->
    <div id="notificationPopup" class="notification-popup">
        <div class="notif-header">
            <div class="notif-title" id="popupTitle">Bildirim</div>
            <button class="notif-close" onclick="NOTIF.closePopup()">Ã—</button>
        </div>
        <div class="notif-body" id="popupBody"></div>
        <div class="notif-time" id="popupTime"></div>
    </div>

    <!-- DÃ¼rtme SeÃ§ici ModalÄ± -->
    <div id="pokeSelectOverlay" class="poke-overlay" onclick="if(event.target===this) POKE.hidePokeModal()">
        <div class="poke-modal">
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="font-size: 48px; margin-bottom: 10px;">ğŸ‘‹</div>
                <h2 style="margin: 0; color: #d44dd4; font-size: 24px; font-weight: 700;">Hangi TakÄ±mÄ± DÃ¼rtmek Ä°stersiniz?</h2>
                <p style="color: #888; font-size: 13px; margin-top: 8px;">Bir takÄ±mÄ± 1 dakikada en fazla 1 kere dÃ¼rtebilirsiniz</p>
            </div>
            <div id="pokeTeamList" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                <!-- TakÄ±mlar buraya eklenecek -->
            </div>
            <button class="btn" style="width: 100%; margin: 0; border-color: #555;" onclick="POKE.hidePokeModal()">Ä°ptal</button>
        </div>
    </div>

    <!-- DÃ¼rtme Bildirimi OverlayÄ± -->
    <div id="pokeNotificationOverlay" class="poke-overlay">
        <div class="poke-notification">
            <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 1s infinite;">ğŸ‘‹</div>
            <h2 id="pokeNotificationText" style="margin: 0; color: #fff; font-size: 32px; font-weight: 700; text-shadow: 0 0 20px rgba(212,77,212,0.8);">
                <!-- DÃ¼rtme mesajÄ± buraya gelecek -->
            </h2>
            <p style="color: #d44dd4; font-size: 18px; margin-top: 15px; font-weight: 600;">sizi dÃ¼rttÃ¼!</p>
        </div>
    </div>

    <!-- Bildirim Sesi -->

    <script>
        // ========================================
        // CRITICAL: Socket & safeSocketEmit MUST be defined FIRST
        // ========================================

        // Socket.IO baÄŸlantÄ±sÄ± - Cookie gÃ¶ndermesi iÃ§in withCredentials gerekli
        console.log('ğŸ”Œ Attempting to connect socket.io...');

        if (typeof io === 'undefined') {
            console.error('âŒ FATAL: io is not defined! Socket.io library failed to load.');
            console.error('   Check if /socket.io/socket.io.js is accessible');
            alert('HATA: Socket.io kÃ¼tÃ¼phanesi yÃ¼klenemedi! SayfayÄ± yenileyin.');
        } else {
            console.log('âœ… io() function is available');
        }

        window.socket = io({
            withCredentials: true,  // Cookie gÃ¶nder (session iÃ§in kritik!)
            transports: ['websocket', 'polling'],  // Try websocket first, fallback to polling
            path: '/socket.io',  // Default path
            reconnection: true,
            reconnectionDelay: 1000,
            reconnectionAttempts: 5
        });
        var socket = window.socket;
        var socketConnected = false; // BaÄŸlantÄ± durumu
        window.socketConnected = socketConnected;

        // Log connection attempts and errors
        socket.on('connect_error', (error) => {
            console.error('âŒ Socket connection error:', error.message);
            console.error('   Error details:', error);
        });

        socket.on('connect_timeout', () => {
            console.error('âŒ Socket connection timeout');
        });

        socket.on('error', (error) => {
            console.error('âŒ Socket error:', error);
        });

        socket.on('reconnect_attempt', (attemptNumber) => {
            console.log(`ğŸ”„ Socket reconnection attempt ${attemptNumber}...`);
        });

        socket.on('reconnect_failed', () => {
            console.error('âŒ Socket reconnection failed after all attempts');
            alert('Sunucuya baÄŸlanÄ±lamadÄ±! LÃ¼tfen internet baÄŸlantÄ±nÄ±zÄ± kontrol edin.');
        });

        // ========================================
        // SAFE SOCKET EMIT - Timeout & Error Handling
        // ========================================
        window.safeSocketEmit = function(eventName, data, callback, timeout = 10000) {
            if (!socket.connected) {
                window.toast('BaÄŸlantÄ± yok! LÃ¼tfen bekleyin...', true);
                if (callback) callback({ success: false, error: 'No connection' });
                return;
            }

            let callbackCalled = false;
            const wrappedCallback = (response) => {
                if (!callbackCalled) {
                    callbackCalled = true;
                    clearTimeout(timeoutId);
                    if (callback) callback(response);
                }
            };

            const timeoutId = setTimeout(() => {
                if (!callbackCalled) {
                    callbackCalled = true;
                    window.toast('Ä°stek zaman aÅŸÄ±mÄ±na uÄŸradÄ±!', true);
                    if (callback) callback({ success: false, error: 'Timeout' });
                }
            }, timeout);

            socket.emit(eventName, data, wrappedCallback);
        };

        console.log('âœ… Socket and safeSocketEmit initialized');
        console.log('ğŸ” Socket connected:', socket.connected);
        console.log('ğŸ” Socket ID:', socket.id);

        // Import modular components
        // (THEME, NOTIFICATIONS, LEADERBOARD, NOTIFICATION now loaded from modules)

        // The following code will be gradually modularized
        // For now, critical modules are already extracted:
        // - theme.js, utils.js, navigation.js
        // - notification-center.js, leaderboard.js, notification-display.js

        // Tema YÃ¶netimi (REMOVED - now in theme.js module)
        // NOTIFICATIONS (REMOVED - now in notification-center.js module)
        // LEADERBOARD (REMOVED - now in leaderboard.js module)
        // NOTIFICATION (REMOVED - now in notification-display.js module)

        // Skip old THEME object definition as it's now in module

        // Sayfa yÃ¼klendiÄŸinde temayÄ± uygula (now handled in app.js module)
        // THEME.init();

        // ===== NOTIFICATION CENTER ===== (REMOVED - now in notification-center.js module)

        // ===== CANLI LÄ°DER TABLOSU ===== (REMOVED - now in leaderboard.js module)

        // Sayfa yÃ¼klendiÄŸinde init et (now handled in app.js module)
        // document.addEventListener('DOMContentLoaded', function() {
        //     NOTIFICATIONS.init();
        //     LEADERBOARD.init();
        //     if (typeof feather !== 'undefined') {
        //         feather.replace();
        //     }
        // });

        // Bildirim Sistemi (REMOVED - now in notification-display.js module)

        // NOTIFICATION.init(); (now handled in app.js module)

        // Renk Ã–zelleÅŸtirme Sistemi (REMOVED - now in customize.js module)

        // MenÃ¼ dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat - wait for DOMContentLoaded to ensure modules loaded
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('click', function(e) {
                // Only call THEME if it's loaded
                if (window.THEME && !e.target.closest('.theme-switcher')) {
                    window.THEME.closeMenu();
                }

                // Team dropdown dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat
                var teamDropdown = document.getElementById('teamDropdown');
                var btnTeamSelector = document.getElementById('btnTeamSelector');
                if (teamDropdown && !e.target.closest('#btnTeamSelector') && !e.target.closest('#teamDropdown')) {
                    teamDropdown.style.display = 'none';
                }
            });
        });

        (function() {
            console.log('ğŸ”µ IIFE Started - Initializing routes and objects...');

            // Socket and safeSocketEmit are now defined globally at the top of script
            var socket = window.socket;
            var safeSocketEmit = window.safeSocketEmit;

            var teams = [];
            var users = [];
            var currentUser = null; // GÃœVENLÄ°K: localStorage yerine sadece memory'de tut
            var credits = [
                { id: 'credit_1', name: 'Furkan', content: 'Oyunun tasarÄ±mÄ± ve geliÅŸtirmesi' },
                { id: 'credit_2', name: 'Claude', content: 'Kodlama ve teknik destek' }
            ];
            var currentTeamId = null; // GÃœVENLÄ°K: localStorage yerine server'dan al
            var selectedJoinId = null;
            var isProcessing = false;
            var isAdmin = false; // Admin panel eriÅŸimi iÃ§in

            // Make global variables accessible to modules
            window.currentUser = currentUser;
            window.currentTeamId = currentTeamId;
            window.isAdmin = isAdmin;
            window.isProcessing = isProcessing;
            window.teams = teams;
            window.users = users;
            window.credits = credits;

            // Navigation history - geri butonlarÄ± iÃ§in
            var pageHistory = [];

            // ========================================
            // CLIENT-SIDE ROUTING
            // ========================================

            // Route 1: Login/Nickname page
            router.register('/', () => {
                showPage('pgNickname');

                return {
                    cleanup: () => {
                        // Cleanup: Form inputlarÄ±nÄ± temizle
                        var nicknameInput = document.getElementById('inpNickname');
                        if (nicknameInput) {
                            nicknameInput.value = '';
                        }
                    }
                };
            });

            // Route 2: Lobby - requires authentication
            router.register('/lobby', () => {
                if (!window.currentUser) {
                    router.navigate('/');
                    return;
                }
                showPage('pgLobby');

                return {
                    cleanup: () => {
                        // Cleanup: Modal'larÄ± kapat
                        GAME.hideCreateForm();
                        GAME.hideJoinForm();
                    }
                };
            });

            // Route 3: Team page - requires authentication and team ID
            router.register('/team/:teamId', ({ teamId }) => {
                if (!window.currentUser) {
                    router.navigate('/');
                    return;
                }
                window.currentTeamId = teamId;

                // TakÄ±m bilgilerini al ve sayfayÄ± render et
                safeSocketEmit('get-team', teamId, (response) => {
                    if (response && response.success && response.team) {
                        showPage('pgTeam');
                        renderTeamPage(response.team);
                    } else {
                        // TakÄ±m bulunamadÄ±, lobby'ye dÃ¶n
                        toast('TakÄ±m bilgileri alÄ±namadÄ±!', true);
                        router.navigate('/lobby');
                    }
                });

                return {
                    cleanup: () => {
                        // Cleanup: TakÄ±m ID'sini temizle (sadece baÅŸka bir route'a gidiyorsa)
                        // window.currentTeamId = null; // exitTeam fonksiyonu bunu yapÄ±yor
                    }
                };
            });

            // Route 4: Admin panel main page
            router.register('/admin', () => {
                if (!window.isAdmin) {
                    router.navigate('/');
                    toast('Admin yetkisi gereklidir', true);
                    return;
                }
                showPage('pgAdmin');
                renderAdminList();
                ADMIN.showSection('game'); // Default section

                return {
                    cleanup: () => {
                        // Cleanup: Admin panel form'larÄ±nÄ± temizle
                        var generalClueInput = document.getElementById('inpGeneralClue');
                        if (generalClueInput) {
                            generalClueInput.value = '';
                        }
                    }
                };
            });

            // Route 5: Admin panel sections
            router.register('/admin/:section', ({ section }) => {
                if (!window.isAdmin) {
                    router.navigate('/');
                    toast('Admin yetkisi gereklidir', true);
                    return;
                }
                showPage('pgAdmin');
                renderAdminList();
                ADMIN.showSection(section);

                return {
                    cleanup: () => {
                        // Cleanup: Admin panel form'larÄ±nÄ± temizle
                        var generalClueInput = document.getElementById('inpGeneralClue');
                        if (generalClueInput) {
                            generalClueInput.value = '';
                        }
                    }
                };
            });

            // Route 6: Public scoreboard
            router.register('/scoreboard', () => {
                showPage('pgScoreboard');
                renderScoreboard();

                return {
                    cleanup: () => {
                        // Cleanup: Scoreboard sayfasÄ±nda Ã¶zel temizlik yok
                    }
                };
            });

            // Route 7: Notifications - requires authentication
            router.register('/notifications', () => {
                if (!window.currentUser) {
                    router.navigate('/');
                    return;
                }
                showPage('pgNotifications');
                NOTIF.render();

                return {
                    cleanup: () => {
                        // Cleanup: Notification sayfasÄ±nda Ã¶zel temizlik yok
                    }
                };
            });

            // Socket baÄŸlantÄ± event'leri
            socket.on('connect', function() {
                socketConnected = true;
                window.socketConnected = true;
                console.log('Socket baÄŸlantÄ±sÄ± kuruldu');
                console.log('ğŸª Browser cookies (JavaScript\'ten gÃ¶rÃ¼nenler):', document.cookie || 'yok');
                console.log('â„¹ï¸  NOT: httpOnly cookie\'ler (session) JavaScript\'ten gÃ¶rÃ¼lmez - bu normal ve gÃ¼venlik iÃ§in iyidir.');
                console.log('   Session cookie\'leri gÃ¶rmek iÃ§in: Browser DevTools â†’ Application â†’ Cookies');

                // SESSION RESTORE: Server'dan session kontrolÃ¼ yap
                safeSocketEmit('reconnect-user', null, function(response) {
                    console.log('ğŸ”„ Session restore yanÄ±tÄ±:', response);

                    if (response && response.success) {
                        // Admin yetkisini Ã¶nce set et (routing iÃ§in gerekli)
                        window.isAdmin = response.isAdmin || false;

                        if (response.userId) {
                            // Normal kullanÄ±cÄ± restore et
                            window.currentUser = {
                                userId: response.userId,
                                nickname: response.nickname,
                                teamId: response.teamId || null
                            };
                            updateCurrentUserDisplay();

                            // TakÄ±m ID'sini restore et
                            if (response.teamId) {
                                window.currentTeamId = response.teamId;
                            }

                            console.log('âœ… Session restore edildi:', response.nickname, '- Admin:', window.isAdmin, '- SessionID mevcut');
                        } else if (response.isAdmin) {
                            // Admin-only session (userId yok)
                            window.currentUser = null;
                            window.currentTeamId = null;
                            updateCurrentUserDisplay();

                            console.log('âœ… Admin session restore edildi - SessionID mevcut');
                        }
                    } else {
                        // Session yok veya sÃ¼resi dolmuÅŸ
                        window.currentUser = null;
                        window.currentTeamId = null;
                        window.isAdmin = false;
                        updateCurrentUserDisplay();
                        console.log('âš ï¸  Session bulunamadÄ± veya sÃ¼resi dolmuÅŸ - GiriÅŸ yapmanÄ±z gerekebilir');
                    }

                    // ROUTING: Session restore sonrasÄ±, mevcut URL'e gÃ¶re sayfa gÃ¶ster
                    var currentPath = window.location.pathname;

                    // Ana sayfadaysa ve session varsa, uygun sayfaya yÃ¶nlendir
                    if ((currentPath === '/' || currentPath === '') && window.currentUser) {
                        if (window.currentTeamId) {
                            router.navigate('/team/' + window.currentTeamId, false);
                        } else {
                            router.navigate('/lobby', false);
                        }
                    } else {
                        // Mevcut URL'i handle et (route handler'lar auth check yapacak)
                        // Ã–NEMLÄ°: window.isAdmin zaten yukarÄ±da set edildi, router artÄ±k bunu gÃ¶recek
                        router.handleRoute(currentPath);
                    }
                });
            });

            socket.on('disconnect', function() {
                socketConnected = false;
                window.socketConnected = false;
                console.log('Socket baÄŸlantÄ±sÄ± koptu');
                toast('BaÄŸlantÄ± koptu. Yeniden baÄŸlanÄ±yor...', true);
            });

            socket.on('connect_error', function(err) {
                console.error('Socket baÄŸlantÄ± hatasÄ±:', err);
                toast('BaÄŸlantÄ± hatasÄ±!', true);
            });

            // safeSocketEmit is now defined globally at the top of script (removed duplicate)

            // GÃœVENLÄ°K: sessionStorage kullan (localStorage yerine) - tarayÄ±cÄ± kapatÄ±lÄ±nca temizlensin
            var notifications = JSON.parse(sessionStorage.getItem('notifications') || '[]');
            var generalClues = [];
            var popupTimeout = null;

            // Global timeout tracking - Memory leak Ã¶nleme
            var activeTimeouts = [];
            function trackTimeout(timeoutId) {
                activeTimeouts.push(timeoutId);
                return timeoutId;
            }
            function clearAllTimeouts() {
                activeTimeouts.forEach(function(id) {
                    clearTimeout(id);
                });
                activeTimeouts = [];
                if (popupTimeout) {
                    clearTimeout(popupTimeout);
                    popupTimeout = null;
                }
            }

            // Oyun durumu
            var gameState = {
                started: false,
                countdown: 0,
                phaseTitle: ''
            };
            window.gameState = gameState;

            // Zaman formatlayÄ±cÄ± (saniye -> MM:SS)
            // Utility functions (REMOVED - now in utils.js and navigation.js modules)
            // formatTime, htmlEscape, toast, showPage, goBack, updateCurrentUserDisplay
            // escapeHtml, formatDate
            // All utility functions are now loaded from modules and available globally

            window.adminScore = function(teamId, amount, teamName) {
                if (isProcessing) return;

                // GÃœVENLÄ°K: BÃ¼yÃ¼k puan deÄŸiÅŸiklikleri iÃ§in onay iste (Â±50 ve Ã¼stÃ¼)
                if (Math.abs(amount) >= 50) {
                    var message = teamName + ' takÄ±mÄ±na ' + (amount > 0 ? '+' : '') + amount + ' puan vermek istiyor musunuz?';
                    if (!confirm(message)) {
                        return;
                    }
                }

                isProcessing = true;
                safeSocketEmit('change-score', { teamId: teamId, amount: amount }, function(res) {
                    isProcessing = false;
                    if (!res.success) toast(res.error, true);
                });
            };

            window.adminDel = function(teamId, teamName) {
                if (isProcessing) return;
                if (confirm(teamName + ' takÄ±mÄ±nÄ± silmek istiyor musunuz?')) {
                    isProcessing = true;
                    safeSocketEmit('delete-team', teamId, function(res) {
                        isProcessing = false;
                        if (res.success) toast('TakÄ±m silindi.');
                        else toast(res.error, true);
                    });
                }
            };

            window.adminDeleteUser = function(userId, nickname) {
                if (isProcessing) return;
                if (confirm(nickname + ' kullanÄ±cÄ±sÄ±nÄ± silmek istiyor musunuz? Bu iÅŸlem geri alÄ±namaz.')) {
                    isProcessing = true;
                    safeSocketEmit('delete-user', userId, function(res) {
                        isProcessing = false;
                        if (res.success) toast('KullanÄ±cÄ± silindi.');
                        else toast(res.error, true);
                    });
                }
            };

            // BÄ°LDÄ°RÄ°M SÄ°STEMÄ°
            window.NOTIF = {
                add: function(title, message, type) {
                    var notif = {
                        id: Date.now() + Math.random(),
                        title: title,
                        message: message,
                        type: type || 'info', // 'score', 'announcement', 'info'
                        time: new Date().toLocaleString('tr-TR'),
                        unread: true
                    };
                    notifications.unshift(notif);
                    if (notifications.length > 50) notifications = notifications.slice(0, 50); // Max 50 bildirim
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.showPopup(notif, type);
                },

                showPopup: function(notif, type) {
                    document.getElementById('popupTitle').textContent = notif.title;
                    document.getElementById('popupBody').textContent = notif.message;
                    document.getElementById('popupTime').textContent = notif.time;

                    var popup = document.getElementById('notificationPopup');

                    // Ã–nceki tip class'larÄ±nÄ± temizle
                    popup.classList.remove('announcement', 'clue', 'score');

                    // Yeni tip class'Ä±nÄ± ekle
                    if (type) {
                        popup.classList.add(type);
                    }

                    popup.classList.add('show');

                    if (popupTimeout) clearTimeout(popupTimeout);
                    popupTimeout = setTimeout(function() {
                        popup.classList.remove('show');
                    }, 6000);
                },

                closePopup: function() {
                    document.getElementById('notificationPopup').classList.remove('show');
                    if (popupTimeout) clearTimeout(popupTimeout);
                },

                updateBadge: function() {
                    var unreadCount = notifications.filter(n => n.unread).length;
                    var badge = document.getElementById('notifBadgeLobby');
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                },

                markAllRead: function() {
                    notifications.forEach(n => n.unread = false);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                },

                clearAll: function() {
                    notifications = [];
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                    this.renderAdminList();
                },

                deleteById: function(notifId) {
                    notifications = notifications.filter(n => n.id !== notifId);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                    this.renderAdminList();
                },

                render: function() {
                    var container = document.getElementById('notifList');
                    document.getElementById('notifCount').textContent = notifications.length;

                    if (notifications.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:60px; color:#666;">HenÃ¼z bildirim yok</div>';
                        return;
                    }

                    // Bildirimleri okundu iÅŸaretle (sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda)
                    notifications.forEach(n => n.unread = false);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();

                    var html = '';
                    notifications.forEach(n => {
                        var icon = 'ğŸ“¢';
                        if (n.type === 'score') icon = 'ğŸ¯';
                        else if (n.type === 'announcement') icon = 'ğŸ“¢';

                        html += `
                        <div class="notif-item ${n.unread ? 'unread' : ''}">
                            <div class="notif-item-header">
                                <div class="notif-item-title">${icon} ${htmlEscape(n.title)}</div>
                                <div class="notif-item-time">${n.time}</div>
                            </div>
                            <div class="notif-item-body">${htmlEscape(n.message)}</div>
                        </div>`;
                    });
                    container.innerHTML = html;
                },

                renderAdminList: function() {
                    var container = document.getElementById('adminNotifList');
                    var countEl = document.getElementById('adminNotifCount');

                    if (!container) return; // YÃ¶netici panelinde deÄŸilsek Ã§Ä±k

                    countEl.textContent = notifications.length + ' bildirim';

                    if (notifications.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:40px; color:#555; font-size:13px;">HenÃ¼z bildirim yok</div>';
                        return;
                    }

                    var html = '';
                    notifications.forEach(function(n) {
                        var typeClass = n.type === 'announcement' ? 'announcement' : 'score';
                        var typeText = n.type === 'announcement' ? 'Duyuru' : 'Puan';

                        // GÃœVENLÄ°K: XSS korumasÄ± - n.message escape et
                        html += `
                        <div class="admin-notif-item">
                            <div class="admin-notif-content">
                                <span class="admin-notif-type ${typeClass}">${typeText}</span>
                                <div class="admin-notif-message">${htmlEscape(n.message)}</div>
                                <div class="admin-notif-time">${htmlEscape(n.time)}</div>
                            </div>
                            <button class="admin-notif-delete" onclick="ADMIN.deleteNotification(${n.id})">ğŸ—‘ï¸ Sil</button>
                        </div>`;
                    });
                    container.innerHTML = html;
                }
            };

            // CHAT FONKSÄ°YONLARI (REMOVED - now in chat.js module)

            // YÃ–NETÄ°CÄ° FONKSÄ°YONLARI (REMOVED - now in admin.js module)

            // IP SECTION FONKSÄ°YONLARI (Tab YÃ¶netimi)
            // RENDER FONKSÄ°YONLARI

            window.renderJoinList = function renderJoinList() {
                var c = document.getElementById('joinList');
                var teams = window.teams || [];
                if (teams.length === 0) { c.innerHTML = '<div style="text-align:center;color:#666;padding:20px;">Aktif takÄ±m yok</div>'; return; }
                var html = '';
                teams.forEach(t => {
                    var safeName = htmlEscape(t.name);
                    html += `<div class="team-opt" data-id="${t.id}" data-name="${safeName}" onclick="GAME.selectJoin(this)">
                        <div style="font-weight:bold;color:#fff;">${safeName}</div>
                        <div style="font-size:12px;color:#666;">Puan: ${t.score}</div>
                    </div>`;
                });
                c.innerHTML = html;
            }

            function renderTeamPage(team) {
                document.getElementById('dispTeamName').textContent = team.name;

                // TakÄ±m bilgileri kartÄ±nÄ± gÃ¼ncelle
                document.getElementById('teamInfoName').textContent = team.name;
                document.getElementById('teamInfoScore').textContent = team.score;

                document.getElementById('clueCnt').textContent = '(' + team.clues.length + ')';
                var list = document.getElementById('myClueList');
                if (team.clues.length === 0) {
                    list.innerHTML = '<div style="color:#444;text-align:center;padding:20px;">HenÃ¼z ipucu girilmedi.</div>';
                } else {
                    var html = '';
                    // Tersten sÄ±rala (en yeni en Ã¼stte)
                    for (var i = team.clues.length - 1; i >= 0; i--) {
                        html += `<div style="padding:10px; border-bottom:1px solid #222; color:#ccc;">${htmlEscape(team.clues[i].text)}</div>`;
                    }
                    list.innerHTML = html;
                }

                // Countdown'u render et
                renderTeamCountdown();

                // Genel ipuÃ§larÄ±nÄ± render et
                renderGeneralClues();

                // Chat mesajlarÄ±nÄ± yÃ¼kle
                CHAT.loadMessages(1);
            }

            function renderGeneralClues() {
                var container = document.getElementById('adminCluesSection');
                var list = document.getElementById('adminCluesList');
                var emptyEl = document.getElementById('adminCluesEmpty');
                var countEl = document.getElementById('adminCluesCount');

                if (!container || !list) return;

                // SayÄ±yÄ± gÃ¼ncelle
                if (countEl) countEl.textContent = generalClues.length;

                if (generalClues.length === 0) {
                    container.style.display = 'none';
                    if (list) list.style.display = 'none';
                    if (emptyEl) emptyEl.style.display = 'block';
                } else {
                    container.style.display = 'block';
                    if (list) list.style.display = 'flex';
                    if (emptyEl) emptyEl.style.display = 'none';

                    var html = '';
                    // Tersten sÄ±rala (en yeni en Ã¼stte)
                    for (var i = generalClues.length - 1; i >= 0; i--) {
                        var clue = generalClues[i];
                        html += `
                            <div style="
                                background: rgba(139,0,0,0.15);
                                border: 1px solid rgba(139,0,0,0.3);
                                border-left: 4px solid var(--accent);
                                border-radius: 8px;
                                padding: 14px;
                                animation: slideIn 0.3s ease;
                            ">
                                <div style="color: var(--text-main); font-size: 14px; line-height: 1.5; margin-bottom: 6px;">
                                    ${htmlEscape(clue.text)}
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; color: #666; font-size: 11px;">
                                    <span>â°</span>
                                    <span>${clue.time}</span>
                                </div>
                            </div>
                        `;
                    }
                    list.innerHTML = html;
                }
            }

            window.renderTeamCountdown = function renderTeamCountdown() {
                var container = document.getElementById('teamCountdownSection');
                if (!container) return;

                if (!gameState.started) {
                    container.innerHTML = '<div class="game-not-started">â¸ï¸ Oyun henÃ¼z baÅŸlamadÄ±. LÃ¼tfen bekleyiniz...</div>';
                } else {
                    var timeClass = gameState.countdown < 60 ? 'warning' : '';
                    var phaseHtml = gameState.phaseTitle ? `<div class="team-countdown-phase">${gameState.phaseTitle}</div>` : '';
                    container.innerHTML = `
                    <div class="team-countdown">
                        ${phaseHtml}
                        <div class="team-countdown-label">Kalan SÃ¼re</div>
                        <div class="team-countdown-time ${timeClass}" id="teamCountdown">${formatTime(gameState.countdown)}</div>
                    </div>`;
                }
            }

            // --- YENÄ°LENMÄ°Å ADMIN KART RENDER ---
            function renderAdminList() {
                // Ä°statistikleri gÃ¼ncelle
                document.getElementById('statTeams').textContent = teams.length;
                var totalClues = teams.reduce((acc, t) => acc + t.clues.length, 0);
                document.getElementById('statClues').textContent = totalClues;

                // Bildirim listesini de render et
                NOTIF.renderAdminList();

                var container = document.getElementById('adminList');
                if (teams.length === 0) {
                    container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; color:#444;">HenÃ¼z takÄ±m yok.</div>';
                    document.getElementById('chartContent').innerHTML = '';
                    return;
                }

                // SÄ±ralama YAPMA - created_at sÄ±rasÄ±nda kalsÄ±n
                var sorted = teams.slice(); // Orijinal sÄ±rayÄ± koru

                // Grafik iÃ§in puana gÃ¶re sÄ±ralÄ± versiyonu oluÅŸtur
                var sortedForChart = teams.slice().sort((a, b) => b.score - a.score);
                renderScoreChart(sortedForChart);

                var html = '';
                sorted.forEach((t, index) => {
                    var safeName = t.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    var safeNameHTML = htmlEscape(t.name);
                    var rankClass = '';
                    // Rank iÃ§in gerÃ§ek sÄ±rayÄ± hesapla
                    var realRank = sortedForChart.findIndex(st => st.id === t.id) + 1;
                    if (realRank === 1 && t.score > 0) rankClass = 'g';
                    else if (realRank === 2 && t.score > 0) rankClass = 's';
                    else if (realRank === 3 && t.score > 0) rankClass = 'b';

                    // Kart HTML YapÄ±sÄ± - TakÄ±m rengi ile
                    html += `
                    <div class="admin-card" id="card_${t.id}" style="border-left: 4px solid ${t.color || '#3b82f6'}">
                        <div class="card-header" style="background: linear-gradient(135deg, ${t.color || '#3b82f6'}15, transparent)">
                            <div class="team-identity">
                                <div class="rank-badge ${rankClass}">${realRank}</div>
                                <div class="team-name" style="color: ${t.color || '#3b82f6'}">${safeNameHTML}</div>
                            </div>
                            <div class="team-score" id="score_${t.id}">${t.score}</div>
                        </div>
                        <div class="card-body">
                            <div class="controls-section">
                                <button class="ctrl-btn btn-p10" onclick="adminScore('${t.id}', 10, '${safeName}')">+10</button>
                                <button class="ctrl-btn btn-p5" onclick="adminScore('${t.id}', 5, '${safeName}')">+5</button>
                                <button class="ctrl-btn btn-m5" onclick="adminScore('${t.id}', -5, '${safeName}')">-5</button>
                                <button class="ctrl-btn btn-m10" onclick="adminScore('${t.id}', -10, '${safeName}')">-10</button>
                            </div>

                            <div class="clues-section" id="clues_${t.id}">
                                <div class="clues-title">Ä°PUÃ‡LARI (${t.clues.length})</div>
                                ${ t.clues.length === 0
                                    ? '<div class="no-clues">Ä°pucu yok</div>'
                                    : t.clues.map(c =>
                                        `<div class="clue-item">${htmlEscape(c.text)}<div class="clue-time">${c.time}</div><div style="clear:both"></div></div>`
                                      ).join('')
                                }
                            </div>

                            <button class="delete-btn" onclick="adminDel('${t.id}', '${safeName}')">TakÄ±mÄ± Sil</button>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
            }

            function renderScoreChart(sortedTeams) {
                var maxScore = Math.max(...sortedTeams.map(t => t.score));
                if (maxScore <= 0) maxScore = 1;

                var html = '';
                sortedTeams.forEach(t => {
                    var pct = Math.max(0, (t.score / maxScore) * 100);
                    var teamColor = t.color || '#3b82f6';
                    html += `
                    <div class="chart-bar">
                        <div class="chart-label" style="color: ${teamColor}">${htmlEscape(t.name)}</div>
                        <div class="chart-track">
                            <div class="chart-fill" style="width: ${pct}%; background: ${teamColor}"></div>
                        </div>
                        <div class="chart-val">${t.score}</div>
                    </div>`;
                });
                document.getElementById('chartContent').innerHTML = html;
            }

            window.renderUsersList = function renderUsersList() {
                var container = document.getElementById('usersList');
                if (users.length === 0) {
                    container.innerHTML = '<div style="text-align:center; padding:40px; color:#666;">HenÃ¼z kullanÄ±cÄ± yok.</div>';
                    return;
                }

                // TakÄ±mlara gÃ¶re grupla
                var usersWithTeam = users.filter(u => u.team_id);
                var usersWithoutTeam = users.filter(u => !u.team_id);

                // TakÄ±mlara gÃ¶re grupla
                var teamGroups = {};
                usersWithTeam.forEach(u => {
                    if (!teamGroups[u.team_id]) {
                        teamGroups[u.team_id] = {
                            teamName: u.team_name,
                            teamColor: u.team_color || '#3b82f6',
                            users: []
                        };
                    }
                    teamGroups[u.team_id].users.push(u);
                });

                var html = '';

                // TakÄ±mlÄ± kullanÄ±cÄ±lar
                Object.keys(teamGroups).forEach(teamId => {
                    var group = teamGroups[teamId];
                    html += `
                        <div style="background: #1a1a1a; border-left: 4px solid ${group.teamColor}; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: ${group.teamColor}; margin: 0 0 15px 0; font-size: 18px;">
                                ${htmlEscape(group.teamName)}
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${group.users.map(u => {
                                    // GÃœVENLÄ°K: onclick iÃ§in JavaScript string escape (htmlEscape yetersiz)
                                    var safeNick = u.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');
                                    var onlineStatus = u.online ? 'online' : 'offline';
                                    var statusText = u.online ? 'Ã‡evrimiÃ§i' : 'Ã‡evrimdÄ±ÅŸÄ±';
                                    return `
                                    <div style="background: #222; padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                        <span class="status-indicator ${onlineStatus}" data-status="${statusText}"></span>
                                        ${u.is_captain ? '<span style="font-size: 20px;">ğŸ‘‘</span>' : '<span style="font-size: 20px;">ğŸ‘¤</span>'}
                                        <span style="color: white; font-weight: ${u.is_captain ? 'bold' : 'normal'}; flex: 1;">
                                            ${htmlEscape(u.nickname)}
                                        </span>
                                        ${u.is_captain ? '<span style="color: #fbbf24; font-size: 12px;">(Kaptan)</span>' : ''}
                                        <button onclick="adminDeleteUser('${u.id}', '${safeNick}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-left: 10px;">
                                            ğŸ—‘ï¸ Sil
                                        </button>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    `;
                });

                // TakÄ±msÄ±z kullanÄ±cÄ±lar
                if (usersWithoutTeam.length > 0) {
                    html += `
                        <div style="background: #1a1a1a; border-left: 4px solid #666; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #999; margin: 0 0 15px 0; font-size: 18px;">
                                TakÄ±msÄ±z KullanÄ±cÄ±lar
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${usersWithoutTeam.map(u => {
                                    // GÃœVENLÄ°K: onclick iÃ§in JavaScript string escape (htmlEscape yetersiz)
                                    var safeNick = u.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');
                                    var onlineStatus = u.online ? 'online' : 'offline';
                                    var statusText = u.online ? 'Ã‡evrimiÃ§i' : 'Ã‡evrimdÄ±ÅŸÄ±';
                                    return `
                                    <div style="background: #222; padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                        <span class="status-indicator ${onlineStatus}" data-status="${statusText}"></span>
                                        <span style="font-size: 20px;">ğŸ‘¤</span>
                                        <span style="color: white; flex: 1;">${htmlEscape(u.nickname)}</span>
                                        <button onclick="adminDeleteUser('${u.id}', '${safeNick}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                            ğŸ—‘ï¸ Sil
                                        </button>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    `;
                }

                container.innerHTML = html;
            }

            function renderScoreboard() {
                var c = document.getElementById('scoreboardList');
                if (teams.length === 0) {
                    c.innerHTML = '<div style="text-align:center; color:#666; padding:40px;">HenÃ¼z takÄ±m yok</div>';
                    return;
                }

                var sorted = teams.slice().sort((a, b) => b.score - a.score);
                var html = '';

                sorted.forEach((t, i) => {
                    var rankClass = i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : i === 2 ? 'rank-3' : '';
                    var medal = i === 0 ? 'ğŸ¥‡' : i === 1 ? 'ğŸ¥ˆ' : i === 2 ? 'ğŸ¥‰' : (i + 1);
                    var clueCount = Array.isArray(t.clues) ? t.clues.length : 0;

                    html += `
                    <div class="leaderboard-item ${rankClass}" style="animation-delay: ${i * 0.1}s">
                        <div class="leaderboard-left">
                            <div class="leaderboard-rank">${medal}</div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${htmlEscape(t.name)}</div>
                                <div class="leaderboard-stats">${clueCount} ipucu gÃ¶nderildi</div>
                            </div>
                        </div>
                        <div class="leaderboard-score">${t.score}</div>
                    </div>`;
                });

                c.innerHTML = html;
            }

            // Sadece skor deÄŸiÅŸtiÄŸinde (performans iÃ§in)
            function updateScoresOnly() {
                // GrafiÄŸi yeniden Ã§iz
                var sorted = teams.slice().sort((a, b) => b.score - a.score);
                renderScoreChart(sorted);

                // Kartlardaki sayÄ±larÄ± gÃ¼ncelle
                teams.forEach(t => {
                    var el = document.getElementById('score_' + t.id);
                    if (el) el.textContent = t.score;
                });
            }

            // EmeÄŸi geÃ§enler listesini render et (Admin Paneli)
            window.renderCreditsList = function renderCreditsList() {
                var container = document.getElementById('creditsList');
                var countEl = document.getElementById('creditsCount');

                if (!container || !countEl) return;

                countEl.textContent = credits.length + ' kiÅŸi';

                if (credits.length === 0) {
                    container.innerHTML = '<div style="color:#666; text-align:center; padding:40px; width:100%;">HenÃ¼z kimse eklenmemiÅŸ</div>';
                    return;
                }

                var html = '';
                credits.forEach(function(credit) {
                    var safeName = credit.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    var safeNameHTML = htmlEscape(credit.name);
                    html += `
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:15px; transition:0.2s;">
                        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                            <span style="color:var(--gold); font-size:15px; font-weight:600;">${safeNameHTML}</span>
                            <button onclick="ADMIN.removeCredit('${credit.id}', '${safeName}')" style="background:transparent; border:1px solid #500; color:#faa; padding:4px 10px; border-radius:4px; font-size:11px; cursor:pointer; transition:0.2s;" onmouseover="this.style.background='rgba(139,0,0,0.2)'" onmouseout="this.style.background='transparent'">ğŸ—‘ï¸ Sil</button>
                        </div>
                        <div style="margin-bottom:8px;">
                            <label style="color:#888; font-size:11px; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; display:block;">KatkÄ±larÄ±</label>
                            <textarea id="creditContent_${credit.id}" placeholder="Bu kiÅŸinin katkÄ±larÄ±nÄ± yazÄ±n..." maxlength="1000" style="width:100%; min-height:80px; background:#0a0a0a; border:1px solid #333; border-radius:6px; color:#fff; padding:10px; font-family:inherit; resize:vertical; font-size:13px; line-height:1.6;">${credit.content || ''}</textarea>
                        </div>
                        <button onclick="ADMIN.updateCreditContent('${credit.id}')" class="btn btn-primary" style="width:100%; padding:8px; margin:0; font-size:12px;">ğŸ’¾ Ä°Ã§eriÄŸi Kaydet</button>
                    </div>`;
                });
                container.innerHTML = html;
            }

            // Ana sayfa emeÄŸi geÃ§enler listesini render et
            function renderMainCredits() {
                var nicknameContainer = document.getElementById('nicknameCreditsList');
                var lobbyContainer = document.getElementById('lobbyCreditsList');

                var html = '';
                if (credits.length === 0) {
                    html = '<div class="credit-item">-</div>';
                } else {
                    credits.forEach(function(credit) {
                        html += `<div class="credit-item" onclick="GAME.showCreditDetail('${credit.id}')">${htmlEscape(credit.name)}</div>`;
                    });
                }

                // Her iki listeyi de gÃ¼ncelle
                if (nicknameContainer) nicknameContainer.innerHTML = html;
                if (lobbyContainer) lobbyContainer.innerHTML = html;
            }

            // Socket Listeners
            socket.on('credits-update', function(newCredits) {
                credits = newCredits;
                renderMainCredits();
                renderCreditsList();
            });

            socket.on('teams-update', function(newTeams) {
                var oldLen = teams.length;
                teams = newTeams;

                // Chat dropdown iÃ§in takÄ±m listesini gÃ¼ncelle
                CHAT.updateAvailableTeams(teams);

                // CanlÄ± lider tablosunu gÃ¼ncelle
                LEADERBOARD.update(newTeams);
                LEADERBOARD.checkRankChange(newTeams);

                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    // TakÄ±m sayÄ±sÄ± deÄŸiÅŸtiyse full render, deÄŸiÅŸmediyse sadece skor gÃ¼ncelle (titremeyi Ã¶nlemek iÃ§in)
                    if (oldLen !== teams.length) renderAdminList();
                    else {
                        // Ä°pucu sayÄ±sÄ± deÄŸiÅŸmiÅŸ mi kontrol et
                        // Basitlik iÃ§in full render yapabiliriz ama UX iÃ§in ayrÄ±ÅŸtÄ±rmak iyidir.
                        // Åimdilik temiz olmasÄ± iÃ§in full render yapalÄ±m, grid yapÄ±sÄ± stabil zaten.
                        renderAdminList();
                    }

                    // Chat Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse team selector'Ä± gÃ¼ncelle
                    ADMIN.updateChatTeamSelector();
                }

                if (document.getElementById('pgScoreboard').classList.contains('active')) renderScoreboard();
                if (document.getElementById('joinForm').style.display === 'block') renderJoinList();

                if (window.currentTeamId) {
                    var myTeam = teams.find(t => t.id === window.currentTeamId);
                    if (myTeam) renderTeamPage(myTeam);
                }
            });

            socket.on('users-update', function(newUsers) {
                users = newUsers;

                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    // Admin panelinde users section aÃ§Ä±ksa render et
                    if (document.getElementById('adminSectionUsers').style.display !== 'none') {
                        renderUsersList();
                    }
                }
            });

            socket.on('team-deleted', function(id) {
                if (window.currentTeamId === id) {
                    window.currentTeamId = null;
                    router.navigate('/lobby');
                    toast('TakÄ±m silindi', true);
                }
            });

            socket.on('game-reset', function() {
                // Admin panelindeyse atma
                var isInAdminPanel = document.getElementById('pgAdmin').classList.contains('active');
                if (!isInAdminPanel) {
                    window.currentTeamId = null;
                    router.navigate('/lobby');
                }
            });

            // NOTE: game-ended handler moved to line ~5584 to avoid duplicate registration

            // Bildirim Eventi
            socket.on('notification', function(data) {
                NOTIF.add(data.title, data.message, data.type);
                // KalÄ±cÄ± bildirim olarak da ekle
                NOTIFICATIONS.add(data.title, data.message, data.type);
            });

            // Puan deÄŸiÅŸikliÄŸi bildirimi
            socket.on('score-changed', function(data) {
                var msg = data.teamName + ' takÄ±mÄ± ' + (data.amount > 0 ? '+' : '') + data.amount + ' puan aldÄ±. Yeni puan: ' + data.newScore;
                NOTIF.add('Puan DeÄŸiÅŸikliÄŸi', msg, 'score');
                // KalÄ±cÄ± bildirim olarak da ekle
                NOTIFICATIONS.add('ğŸ† Puan DeÄŸiÅŸikliÄŸi', msg, 'score');
            });

            // YÃ¶netici ipuÃ§larÄ± listesi gÃ¼ncellendi
            socket.on('general-clues-update', function(clues) {
                generalClues = clues;

                // TakÄ±m sayfasÄ±ndaysa render et
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    renderGeneralClues();
                }

                // Admin paneldeyse ipuÃ§larÄ± listesini render et
                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    ADMIN.renderAdminClues();
                }
            });

            // Yeni yÃ¶netici ipucu bildirimi
            socket.on('general-clue-notification', function(data) {
                // Bildirim gÃ¶ster
                NOTIFICATION.show('YÃ¶netici Ä°pucu', data.clue, data.time);

                // TakÄ±m sayfasÄ±ndaysa render et (biraz gecikme ile, veritabanÄ±ndan gelmesini bekle)
                setTimeout(function() {
                    if (document.getElementById('pgTeam').classList.contains('active')) {
                        renderGeneralClues();
                    }
                }, 100);
            });

            // Yeni takÄ±m mesajÄ±
            socket.on('new-team-message', function(message) {
                CHAT.onNewMessage(message);

                // Admin panelde Chat Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve seÃ§ili takÄ±m mesajÄ± gÃ¶rebiliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionChat').style.display !== 'none' &&
                    ADMIN.selectedChatTeamId) {

                    // TakÄ±mlara Ã¶zel admin mesajlarÄ±nÄ± hariÃ§ tut (herkese olanlarÄ±)
                    if (message.target_team_id === 'admin') {
                        return;
                    }

                    // MesajÄ±n seÃ§ili takÄ±m tarafÄ±ndan gÃ¶rÃ¼lebilir olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                    var canSeeMessage = false;

                    // Admin'in bu takÄ±ma gÃ¶nderdiÄŸi mesaj
                    if (message.team_id === null && message.target_team_id === ADMIN.selectedChatTeamId) {
                        canSeeMessage = true;
                    }
                    // 1. Genel mesaj (herkese)
                    else if (!message.target_team_id) {
                        canSeeMessage = true;
                    }
                    // 2. SeÃ§ili takÄ±ma gÃ¶nderilen Ã¶zel mesaj
                    else if (message.target_team_id === ADMIN.selectedChatTeamId) {
                        canSeeMessage = true;
                    }
                    // 3. SeÃ§ili takÄ±mÄ±n gÃ¶nderdiÄŸi Ã¶zel mesaj
                    else if (message.team_id === ADMIN.selectedChatTeamId) {
                        canSeeMessage = true;
                    }

                    if (canSeeMessage) {
                        // MesajÄ± ekle
                        var container = document.getElementById('adminChatMessages');
                        if (container) {
                            // BoÅŸ mesaj varsa temizle
                            if (container.querySelector('[style*="HenÃ¼z mesaj yok"]')) {
                                container.innerHTML = '';
                            }

                            var time = new Date(message.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                            var isFromSelectedTeam = message.team_id === ADMIN.selectedChatTeamId;
                            var isFromAdmin = message.team_id === null; // Admin mesajÄ±

                            // TakÄ±m rengi badge
                            var teamColor = message.team_color || '#3b82f6';
                            var teamBadge = `<span style="background: ${teamColor}; color: #fff; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">${htmlEscape(message.team_name)}</span>`;

                            // Hedef takÄ±m etiketi
                            var targetLabel = '';
                            if (message.target_team_name) {
                                targetLabel = `<span style="color: #d4af37; font-size: 10px; background: rgba(212,175,55,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(212,175,55,0.3);">ğŸ”’ â†’ ${htmlEscape(message.target_team_name)}</span>`;
                            } else {
                                targetLabel = `<span style="color: #4dd4d4; font-size: 10px; background: rgba(77,212,212,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(77,212,212,0.3);">ğŸ“¢ TÃ¼m TakÄ±mlar</span>`;
                            }

                            // WhatsApp tarzÄ± gÃ¶rÃ¼nÃ¼m
                            var html = '';
                            if (isFromAdmin) {
                                // Admin mesajÄ± - SAÄDA (Ã¶zel altÄ±n rengi)
                                html = `
                                <div style="display: flex; justify-content: flex-end; margin-bottom: 12px;">
                                    <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-end;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; justify-content: flex-end;">
                                            <span style="color: #444; font-size: 10px;">${time}</span>
                                            ${targetLabel}
                                            ${teamBadge}
                                            <span style="color: #fbbf24; font-weight: 700; font-size: 13px;">ğŸ‘‘ ${htmlEscape(message.nickname)}</span>
                                        </div>
                                        <div style="background: linear-gradient(135deg, #4a3800, #2d2200); border: 2px solid #fbbf24; border-radius: 12px 12px 2px 12px; padding: 10px 14px; color: #fbbf24; font-size: 14px; font-weight: 600; word-wrap: break-word; box-shadow: 0 2px 8px rgba(251,191,36,0.3);">
                                            ${htmlEscape(message.message)}
                                        </div>
                                    </div>
                                </div>`;
                            } else if (isFromSelectedTeam) {
                                // SeÃ§ili takÄ±mÄ±n mesajÄ± - SOLDA
                                html = `
                                <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                    <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                            <span style="color: #4dd4d4; font-weight: 700; font-size: 13px;">${htmlEscape(message.nickname)}</span>
                                            ${teamBadge}
                                            ${targetLabel}
                                            <span style="color: #444; font-size: 10px;">${time}</span>
                                        </div>
                                        <div style="background: linear-gradient(135deg, #0d5858, #0a4040); border: 1px solid #1a7070; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                            ${htmlEscape(message.message)}
                                        </div>
                                    </div>
                                </div>`;
                            } else {
                                // DiÄŸer takÄ±mÄ±n mesajÄ± - SOLDA
                                html = `
                                <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                    <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                            <span style="color: #ffa500; font-weight: 700; font-size: 13px;">${htmlEscape(message.nickname)}</span>
                                            ${teamBadge}
                                            ${targetLabel}
                                            <span style="color: #444; font-size: 10px;">${time}</span>
                                        </div>
                                        <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                            ${htmlEscape(message.message)}
                                        </div>
                                    </div>
                                </div>`;
                            }

                            container.insertAdjacentHTML('beforeend', html);
                            container.scrollTop = container.scrollHeight;

                            // SayacÄ± gÃ¼ncelle
                            var countEl = document.getElementById('adminChatMessageCount');
                            if (countEl) {
                                var currentCount = parseInt(countEl.textContent.split(' ')[0]) || 0;
                                countEl.textContent = (currentCount + 1) + ' mesaj';
                            }
                        }
                    }
                }
            });

            // Yeni admin mesajÄ± (admin'e gÃ¶nderilen Ã¶zel mesaj)
            socket.on('new-admin-message', function(message) {
                // Bildirim gÃ¶ster
                if (window.currentUser && window.currentUser.window.isAdmin) {
                    toast(`ğŸ“© ${message.team_name} takÄ±mÄ±ndan yeni mesaj!`);
                }

                // Admin panelde Admin MesajlarÄ± bÃ¶lÃ¼mÃ¼ndeyse ve seÃ§ili takÄ±mÄ±n mesajÄ±ysa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionAdminmessages').style.display !== 'none' &&
                    ADMIN.selectedAdminTeamId === message.team_id) {

                    // SeÃ§ili takÄ±mÄ±n mesajlarÄ±nÄ± yeniden yÃ¼kle
                    ADMIN.selectTeamForAdminMessages(ADMIN.selectedAdminTeamId);
                }
            });

            // Oyun durumu gÃ¼ncellemesi
            socket.on('game-state-update', function(state) {
                gameState.started = state.started;
                gameState.countdown = state.countdown;
                gameState.phaseTitle = state.phaseTitle || '';

                // Admin panelindeyse gÃ¶rÃ¼nÃ¼mÃ¼ gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    if (gameState.started) {
                        document.getElementById('gameStartSection').style.display = 'none';
                        document.getElementById('gameRunningSection').style.display = 'block';
                        ADMIN.updateCountdownDisplay();
                    } else {
                        document.getElementById('gameStartSection').style.display = 'block';
                        document.getElementById('gameRunningSection').style.display = 'none';
                    }
                }

                // TakÄ±m sayfasÄ±ndaysa countdown'u gÃ¼ncelle
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    renderTeamCountdown();
                }
            });

            // Oyun baÅŸlatÄ±ldÄ±
            socket.on('game-started', function(data) {
                gameState.started = true;
                gameState.countdown = data.countdown;
                gameState.phaseTitle = data.phaseTitle || '';

                // Admin paneli gÃ¼ncelle
                document.getElementById('gameStartSection').style.display = 'none';
                document.getElementById('gameRunningSection').style.display = 'block';
                ADMIN.updateCountdownDisplay();

                // TakÄ±m sayfasÄ± gÃ¼ncelle
                renderTeamCountdown();

                toast('Oyun baÅŸladÄ±!');

                // KalÄ±cÄ± bildirim ekle
                NOTIFICATIONS.add('ğŸ® Oyun BaÅŸladÄ±', 'Dedektiflik macerasÄ± baÅŸlÄ±yor! Ä°yi ÅŸanslar.', 'game');
            });

            // Countdown gÃ¼ncellendi
            socket.on('countdown-update', function(countdown) {
                gameState.countdown = countdown;

                // Admin countdown gÃ¼ncelle
                ADMIN.updateCountdownDisplay();

                // TakÄ±m countdown gÃ¼ncelle
                var teamDisplay = document.getElementById('teamCountdown');
                if (teamDisplay) {
                    teamDisplay.textContent = formatTime(countdown);
                    if (countdown < 60) {
                        teamDisplay.classList.add('warning');
                    } else {
                        teamDisplay.classList.remove('warning');
                    }
                }
            });

            // Oyun bitti (parametresiz - countdown dolduÄŸunda veya manuel bitirme)
            socket.on('game-ended', function(report) {
                gameState.started = false;
                gameState.countdown = 0;
                gameState.phaseTitle = '';

                // Admin paneli gÃ¼ncelle
                var startSection = document.getElementById('gameStartSection');
                var runningSection = document.getElementById('gameRunningSection');
                if (startSection) startSection.style.display = 'block';
                if (runningSection) runningSection.style.display = 'none';

                // Admin countdown display'i temizle
                var adminCountdown = document.getElementById('adminCountdown');
                if (adminCountdown) {
                    adminCountdown.textContent = '--:--';
                    adminCountdown.classList.remove('warning');
                }

                // TakÄ±m sayfasÄ± gÃ¼ncelle
                renderTeamCountdown();

                // EÄŸer report varsa (otomatik bitiÅŸte), gÃ¶ster
                if (report && report.teams) {
                    console.log('Oyun bitti, final raporu alÄ±ndÄ±:', report);
                    toast('ğŸ Oyun bitti! Rapor gÃ¶steriliyor...');
                    GAME.showFinalReport(report);

                    // Kazanan takÄ±mÄ± bildirimde gÃ¶ster
                    if (report.winner) {
                        NOTIFICATIONS.add('ğŸ† Oyun Bitti', report.winner.name + ' takÄ±mÄ± kazandÄ±! (' + report.winner.score + ' puan)', 'winner');
                    } else {
                        NOTIFICATIONS.add('ğŸ Oyun Bitti', 'Oyun sona erdi. Raporu gÃ¶rÃ¼ntÃ¼leyin.', 'game');
                    }
                } else {
                    toast('Oyun bitti!');
                    NOTIFICATIONS.add('ğŸ Oyun Bitti', 'Oyun sona erdi.', 'game');
                }
            });

            // Faz listesi gÃ¼ncellendi (admin iÃ§in)
            socket.on('phases-update', function(phases) {
                console.log('Faz listesi gÃ¼ncellendi:', phases);
                // EÄŸer admin ve oyun kontrolÃ¼ bÃ¶lÃ¼mÃ¼ndeyse listeyi gÃ¼ncelle
                if (window.isAdmin &&
                    document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionGame').style.display !== 'none') {
                    ADMIN.renderPhases(phases);
                }
            });

            // KullanÄ±cÄ± silindi (admin tarafÄ±ndan)
            socket.on('user-deleted', function() {
                // Cleanup: TÃ¼m timeout'larÄ± temizle
                clearAllTimeouts();

                // GÃœVENLÄ°K: Session temizliÄŸi
                window.currentUser = null;
                window.currentTeamId = null;
                window.isAdmin = false;

                // Nick giriÅŸ sayfasÄ±na yÃ¶nlendir
                router.navigate('/');
                updateCurrentUserDisplay();
                toast('HesabÄ±nÄ±z yÃ¶netici tarafÄ±ndan silindi.', true);
            });

            // Server kapatÄ±lÄ±yor (deployment/gÃ¼ncelleme)
            socket.on('server-shutdown', function(data) {
                toast('Sunucu gÃ¼ncelleniyor... Sayfa 3 saniye sonra yenilenecek.', false);
                setTimeout(function() {
                    window.location.reload();
                }, 3000);
            });

            // DÃ¼rtme (Poke) sistemi
            socket.on('team-poke', function(data) {
                // BÃ¼yÃ¼k bildirim gÃ¶ster
                document.getElementById('pokeNotificationText').textContent = data.fromTeamName;
                var overlay = document.getElementById('pokeNotificationOverlay');
                overlay.classList.add('active');

                // 3 saniye sonra kapat
                setTimeout(function() {
                    overlay.classList.remove('active');
                }, 3000);

                // Toast bildirimi de gÃ¶ster
                toast('ğŸ‘‹ ' + data.fromTeamName + ' sizi dÃ¼rttÃ¼!', false);
            });

            // Murder Board GÃ¼ncellemeleri (Admin iÃ§in canlÄ± izleme)
            socket.on('board-item-added', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-item-deleted', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-item-position-updated', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {

                    // Sadece pozisyonu gÃ¼ncelle (performance iÃ§in tam yenileme yapmÄ±yoruz)
                    const item = ADMIN_BOARD.boardItems.find(function(i) { return i.id === data.itemId; });
                    if (item) {
                        item.x = data.x;
                        item.y = data.y;

                        // Sadece baÄŸlantÄ±larÄ± yeniden Ã§iz
                        ADMIN_BOARD.renderConnections();

                        // Item'Ä±n pozisyonunu DOM'da gÃ¼ncelle
                        const itemEl = document.querySelector('#adminBoardCanvas [style*="left: ' + item.x + 'px"]');
                        if (itemEl) {
                            itemEl.style.left = data.x + 'px';
                            itemEl.style.top = data.y + 'px';
                        }
                    }
                }
            });

            socket.on('board-connection-added', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-connection-deleted', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-cleared', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            // Karakter gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ deÄŸiÅŸti
            socket.on('character-visibility-changed', function(data) {
                console.log('Karakter gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ deÄŸiÅŸti:', data);

                // TakÄ±m sayfasÄ±nda Murder Board karakterlerini yeniden yÃ¼kle
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    MURDERBOARD.loadAvailableCharacters();
                }
            });

            // POKE (DÃ¼rtme) YÃ¶netimi (REMOVED - now in poke.js module)

            // KARAKTER YÃ–NETÄ°MÄ° FONKSÄ°YONLARI (REMOVED - now in character.js module)

            // MURDER BOARD FONKSÄ°YONLARI (REMOVED - now in murderboard.js module)

            // ADMIN MURDER BOARD Ä°ZLEME FONKSÄ°YONLARI (REMOVED - now in admin-board.js module)

            // Init
            window.onload = function() {
                // UX Ä°YÄ°LEÅTÄ°RME: Her zaman temiz bir baÅŸlangÄ±Ã§
                window.currentUser = null;
                window.currentTeamId = null;
                pageHistory = [];

                NOTIF.updateBadge(); // Bildirim badge'ini gÃ¼ncelle
                renderMainCredits(); // Ana sayfa emeÄŸi geÃ§enler listesini render et
                updateCurrentUserDisplay(); // KullanÄ±cÄ± bilgisi display'ini gÃ¼ncelle

                // ROUTING: Socket connect'ten sonra router.handleRoute() Ã§alÄ±ÅŸacak
                // O zamana kadar nickname sayfasÄ± gÃ¶sterilsin (HTML'de zaten default aktif)
                // showPage('pgNickname', false); - KALDIRILDI: Router zaten doÄŸru sayfayÄ± gÃ¶sterecek
            };

            // ========================================
            // DEBUG: Verify all objects are initialized
            // ========================================
            console.log('ğŸ” IIFE Objects initialized:');
            console.log('  - window.USER:', typeof window.USER);
            console.log('  - window.GAME:', typeof window.GAME);
            console.log('  - window.NOTIF:', typeof window.NOTIF);
            console.log('  - window.currentUser:', window.currentUser);
            console.log('  - window.isAdmin:', window.isAdmin);
            console.log('  - window.teams:', window.teams?.length, 'teams');
            console.log('  - window.users:', window.users?.length, 'users');
        })();

        // ARKA PLAN MÃœZÄ°ÄÄ° KONTROLÃœ
        var bgMusic = document.getElementById('bgMusic');

        // Sayfa yÃ¼klendiÄŸinde mÃ¼zik ayarlarÄ±nÄ± uygula
        document.addEventListener('DOMContentLoaded', function() {
            var musicEnabled = localStorage.getItem('musicEnabled');
            var musicVolume = localStorage.getItem('musicVolume');

            // Ses seviyesini ayarla
            if (musicVolume) {
                bgMusic.volume = parseInt(musicVolume) / 100;
            } else {
                bgMusic.volume = 0.5; // VarsayÄ±lan %50
            }

            // MÃ¼ziÄŸi sadece aÃ§Ä±ksa baÅŸlat
            if (musicEnabled === 'true') {
                // KullanÄ±cÄ± etkileÅŸimi sonrasÄ± mÃ¼ziÄŸi baÅŸlat (tarayÄ±cÄ± politikasÄ±)
                document.body.addEventListener('click', function startMusic() {
                    bgMusic.play().catch(function(err) {
                        console.log('MÃ¼zik baÅŸlatÄ±lamadÄ±:', err);
                    });
                }, { once: true });
            }
        });

        // MÃ¼zik AyarlarÄ± SayfasÄ±nÄ± AÃ§ (GLOBAL)
        window.openMusicSettings = function openMusicSettings() {
            // Mevcut sayfayÄ± URL parametresi olarak gÃ¶nder (en gÃ¼venilir yÃ¶ntem)
            var currentPath = window.location.pathname + window.location.search + window.location.hash;
            var returnUrl = encodeURIComponent(currentPath);
            console.log('MÃ¼zik ayarlarÄ± aÃ§Ä±lÄ±yor, return path:', currentPath);
            // MÃ¼zik ayarlarÄ± sayfasÄ±na git (return parametresi ile)
            window.location.href = '/music-settings.html?return=' + returnUrl;
        }

        // TakÄ±mlar arasÄ± sohbet aÃ§Ä±lÄ±r/kapanÄ±r toggle
        let interTeamChatOpen = true; // BaÅŸlangÄ±Ã§ta aÃ§Ä±k
        window.toggleInterTeamChat = function toggleInterTeamChat() {
            const content = document.getElementById('interTeamChatContent');
            const icon = document.getElementById('interTeamChatToggleIcon');

            if (!content || !icon) return;

            interTeamChatOpen = !interTeamChatOpen;

            if (interTeamChatOpen) {
                // AÃ§
                content.style.maxHeight = '2000px';
                content.style.opacity = '1';
                icon.textContent = 'â–¼';
                icon.style.transform = 'rotate(0deg)';
            } else {
                // Kapat
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                icon.textContent = 'â–²';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // ============================================
        // GAME RESET SYSTEM (REMOVED - now in game-reset.js module)
        // ============================================
    </script>

    <!-- Load Modular JavaScript - AFTER inline script to ensure globals are defined -->
    <script type="module" src="/js/app.js"></script>

    <!-- Reset Confirmation Modal -->
    <div id="resetConfirmModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10000; display:none; align-items:center; justify-content:center;">
        <div style="background:linear-gradient(135deg, #1a0a0a, #0a0000); border:3px solid #ff4444; border-radius:16px; padding:40px; max-width:600px; width:90%; box-shadow:0 0 50px rgba(255,68,68,0.5);">
            <h2 style="color:#ff4444; font-size:24px; margin-bottom:20px; text-align:center;">âš ï¸ SON ONAY</h2>

            <p style="color:#ffaaaa; font-size:16px; line-height:1.8; margin-bottom:30px; text-align:center;">
                Bu iÅŸlem <strong style="color:#ff4444;">GERÄ° ALINAMAZ</strong>.<br>
                TÃ¼m oyun verileri <strong>KALICI OLARAK SÄ°LÄ°NECEK</strong>.<br><br>
                Devam etmek istediÄŸinizden emin misiniz?
            </p>

            <div style="background:#3d0000; border:1px solid #8b0000; border-radius:8px; padding:15px; margin-bottom:30px;">
                <p style="color:#ffcccc; font-size:14px; margin:0; text-align:center;">
                    <strong>Onaylamak iÃ§in aÅŸaÄŸÄ±ya "SIFIRLA" yazÄ±n:</strong>
                </p>
                <input type="text" id="resetConfirmInput" placeholder="SIFIRLA yazÄ±n..." style="width:100%; margin-top:15px; padding:12px; background:#000; border:2px solid #ff4444; color:#fff; text-align:center; font-size:16px; text-transform:uppercase;" maxlength="8">
            </div>

            <div style="display:flex; gap:15px;">
                <button class="btn" style="flex:1; background:#333; border-color:#666; color:#aaa; padding:14px; font-size:16px;" onclick="GAME_RESET.hideConfirmModal()">âŒ Ä°ptal</button>
                <button class="btn" style="flex:1; background:linear-gradient(135deg, #8b0000, #450000); border-color:#ff4444; color:#ff4444; padding:14px; font-size:16px; font-weight:600;" onclick="GAME_RESET.confirmReset()">ğŸ”„ SIFIRLA</button>
            </div>
        </div>
    </div>
</body>
</html>