<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katil Kim? - Y√∂netici Paneli</title>
    <script src="/socket.io/socket.io.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Tema 1: Classic Dark (Default) */
        :root {
            --bg-color: #050505;
            --card-bg: #111111;
            --border-color: #222;
            --accent: #8B0000; /* Kan Kƒ±rmƒ±zƒ±sƒ± */
            --gold: #D4AF37;
            --text-main: #e0e0e0;
            --text-muted: #888;
            --success: #2d5a27;
        }

        /* Tema 2: Midnight Detective */
        [data-theme="midnight"] {
            --bg-color: #0a0e1a;
            --card-bg: #141b2d;
            --border-color: #1e2a45;
            --accent: #5b7c99;
            --gold: #ffd700;
            --text-main: #e8eef7;
            --text-muted: #7a8ba3;
            --success: #2d5a27;
        }

        /* Tema 3: Blood Moon */
        [data-theme="blood"] {
            --bg-color: #0d0404;
            --card-bg: #1a0a0a;
            --border-color: #2d0f0f;
            --accent: #b91c1c;
            --gold: #ff6b6b;
            --text-main: #f5e6e6;
            --text-muted: #9a6b6b;
            --success: #2d5a27;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); min-height: 100vh; font-size: 14px; }
        
        /* Genel Yapƒ± */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header & Ba≈ülƒ±klar */
        header { text-align: center; padding: 40px 0; }
        h1 { font-size: 42px; letter-spacing: -1px; margin-bottom: 10px; }
        h1 span { color: var(--accent); }
        .subtitle { color: var(--text-muted); font-style: italic; }

        /* Sayfa Ge√ßi≈üleri */
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Butonlar (Global) */
        .btn { width: 100%; padding: 16px; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-main); font-size: 15px; cursor: pointer; margin-bottom: 12px; transition: all 0.2s; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:hover { border-color: var(--accent); background: #1a1a1a; transform: translateY(-2px); }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: white; }
        .btn-primary:hover { background: #a00000; }
        
        /* Form Alanlarƒ± */
        .form-box { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 25px; margin-top: 20px; max-width: 400px; margin-left: auto; margin-right: auto; }
        input { width: 100%; padding: 14px; background: #000; border: 1px solid var(--border-color); border-radius: 6px; color: white; font-size: 16px; margin-bottom: 15px; outline: none; transition: border 0.2s; }
        input:focus { border-color: var(--gold); }

        /* --- YENƒ∞LENEN ADMIN PANEL TASARIMI --- */
        
        /* Admin Header */
        .admin-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .back-btn { padding: 8px 16px; background: #222; border: none; border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; }
        .back-btn:hover { background: #333; }

        /* Admin Grid - YANYANA KUTULAR ƒ∞√áƒ∞N KRƒ∞Tƒ∞K KISIM */
        .admin-list { 
            display: grid; 
            /* En az 320px geni≈üliƒüinde, ekrana sƒ±ƒüdƒ±ƒüƒ± kadar yan yana dizersin */
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); 
            gap: 20px; 
            margin-bottom: 40px;
        }

        /* Admin Kartƒ± (Yenilenmi≈ü UX) */
        .admin-card { 
            background: var(--card-bg); 
            border: 1px solid var(--border-color); 
            border-radius: 12px; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .admin-card:hover { border-color: #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); transform: translateY(-3px); }

        /* Kart √úst Kƒ±sƒ±m */
        .card-header { 
            padding: 15px; 
            background: linear-gradient(to bottom, #1a1a1a, #111); 
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .team-identity { display: flex; align-items: center; gap: 10px; }
        .rank-badge { 
            width: 28px; height: 28px; border-radius: 50%; 
            background: #222; color: #888; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px;
        }
        .rank-badge.g { background: var(--gold); color: black; box-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
        .rank-badge.s { background: #C0C0C0; color: black; }
        .rank-badge.b { background: #cd7f32; color: black; }
        
        .team-name { font-weight: 600; font-size: 16px; color: #fff; }
        .team-score { font-size: 24px; font-weight: 700; color: var(--gold); letter-spacing: -1px; }

        /* Kart ƒ∞√ßerik */
        .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 15px; }

        /* ƒ∞pu√ßlarƒ± Alanƒ± */
        .clues-section { flex: 1; min-height: 100px; max-height: 150px; overflow-y: auto; background: #080808; border-radius: 6px; padding: 8px; border: 1px solid #222; }
        .clues-title { font-size: 11px; text-transform: uppercase; color: #666; margin-bottom: 6px; letter-spacing: 1px; font-weight: 600; }
        .clue-item { font-size: 13px; padding: 6px 8px; border-left: 2px solid var(--gold); background: #111; margin-bottom: 4px; border-radius: 0 4px 4px 0; color: #ccc; }
        .clue-time { float: right; font-size: 10px; color: #555; margin-top: 2px; }
        .no-clues { color: #444; font-style: italic; text-align: center; padding-top: 30px; font-size: 12px; }

        /* Kontrol Butonlarƒ± (Grid Layout) */
        .controls-section { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px; }
        .ctrl-btn { 
            padding: 8px 0; border: none; border-radius: 4px; 
            font-weight: bold; font-size: 13px; cursor: pointer; color: white; transition: opacity 0.2s;
        }
        .ctrl-btn:hover { opacity: 0.8; }
        .btn-p10 { background: #2d5a27; }
        .btn-p5 { background: #3d6b36; }
        .btn-m5 { background: #964B00; }
        .btn-m10 { background: var(--accent); }
        
        .delete-btn { 
            margin-top: 10px; width: 100%; background: transparent; border: 1px dashed #444; color: #666; 
            padding: 8px; font-size: 11px; border-radius: 4px; cursor: pointer; 
        }
        .delete-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* ƒ∞statistikler Grafiƒüi */
        .stats-chart { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 25px; }
        .chart-bar { display: flex; align-items: center; gap: 15px; margin-bottom: 12px; }
        .chart-label { width: 100px; font-size: 13px; text-align: right; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #aaa; }
        .chart-track { flex: 1; height: 12px; background: #222; border-radius: 6px; overflow: hidden; }
        .chart-fill { height: 100%; background: linear-gradient(90deg, #c9a227, #f0e6d3); border-radius: 6px; width: 0%; transition: width 0.5s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
        .chart-val { width: 30px; font-weight: bold; color: var(--gold); font-size: 13px; }

        /* Diƒüer Sayfalar i√ßin Ufak D√ºzeltmeler */
        .team-list { display: flex; flex-direction: column; gap: 8px; }
        .team-opt { padding: 15px; background: #161616; border: 1px solid #333; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .team-opt:hover, .team-opt.sel { border-color: var(--accent); background: #1f1f1f; }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal.show { display: flex; }
        .modal-box { background: #111; border: 1px solid #333; padding: 30px; border-radius: 16px; width: 90%; max-width: 350px; text-align: center; }

        #toast { position: fixed; bottom: 30px; left: 50%; transform: translate(-50%, 50px); background: #333; color: #fff; padding: 12px 24px; border-radius: 50px; opacity: 0; transition: 0.3s; z-index: 9999; box-shadow: 0 5px 20px rgba(0,0,0,0.5); font-weight: 500; }
        #toast.show { transform: translate(-50%, 0); opacity: 1; }
        #toast.err { background: var(--accent); }

        /* Bildirim Sistemi - Genel Popup */
        .notification-popup { position: fixed; top: 20px; right: 20px; border-radius: 12px; padding: 20px; min-width: 320px; max-width: 400px; z-index: 10000; transform: translateX(500px); opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .notification-popup.show { transform: translateX(0); opacity: 1; }

        /* Duyuru Popup (Kƒ±rmƒ±zƒ±msƒ±) */
        .notification-popup.announcement { background: linear-gradient(135deg, #1a0a0a, #0f0505); border: 2px solid var(--accent); box-shadow: 0 10px 40px rgba(139,0,0,0.5); }
        .notification-popup.announcement .notif-header { border-bottom: 1px solid #300; }
        .notification-popup.announcement .notif-title { color: #ff6666; }
        .notification-popup.announcement .notif-body { color: #ffcccc; }

        /* ƒ∞pucu Popup (Ye≈üilimsi/Altƒ±n) */
        .notification-popup.clue { background: linear-gradient(135deg, #0a1a0a, #050f05); border: 2px solid var(--gold); box-shadow: 0 10px 40px rgba(212,175,55,0.5); }
        .notification-popup.clue .notif-header { border-bottom: 1px solid #2a4a2a; }
        .notification-popup.clue .notif-title { color: var(--gold); }
        .notification-popup.clue .notif-body { color: #d4e6cc; }

        /* Puan Deƒüi≈üikliƒüi Popup (Mavi tonlarƒ±) */
        .notification-popup.score { background: linear-gradient(135deg, #0a0a1a, #05050f); border: 2px solid #4a90e2; box-shadow: 0 10px 40px rgba(74,144,226,0.4); }
        .notification-popup.score .notif-header { border-bottom: 1px solid #1a2a4a; }
        .notification-popup.score .notif-title { color: #6ab0ff; }
        .notification-popup.score .notif-body { color: #cce0ff; }

        .notif-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 10px; }
        .notif-title { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .notif-close { background: transparent; border: none; color: #666; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px; }
        .notif-close:hover { color: #fff; }
        .notif-body { font-size: 14px; line-height: 1.6; }
        .notif-time { font-size: 11px; color: #555; margin-top: 10px; text-align: right; }
        .notif-badge { position: fixed; top: 20px; right: 30px; background: var(--accent); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; z-index: 9998; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Bildirimler Sayfasƒ± */
        .notif-list { display: flex; flex-direction: column; gap: 12px; }
        .notif-item { background: var(--card-bg); border: 1px solid var(--border-color); border-left: 4px solid var(--gold); border-radius: 8px; padding: 15px; transition: 0.2s; }
        .notif-item:hover { border-color: var(--gold); background: #161616; }
        .notif-item.unread { background: rgba(212,175,55,0.05); }
        .notif-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .notif-item-title { font-weight: 600; color: var(--gold); font-size: 13px; }
        .notif-item-time { font-size: 11px; color: #666; }
        .notif-item-body { color: #aaa; font-size: 13px; line-height: 1.5; }

        /* Duyuru Formu */
        .announcement-form { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .announcement-form textarea { width: 100%; min-height: 80px; background: #000; border: 1px solid var(--border-color); border-radius: 6px; color: white; padding: 12px; font-family: inherit; resize: vertical; margin-bottom: 10px; }
        .announcement-form textarea:focus { outline: none; border-color: var(--gold); }

        /* Admin Bildirim Listesi */
        .admin-notif-item { background: #0a0a0a; border: 1px solid #222; border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; transition: 0.2s; }
        .admin-notif-item:hover { border-color: #333; background: #111; }
        .admin-notif-content { flex: 1; }
        .admin-notif-type { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; margin-bottom: 6px; }
        .admin-notif-type.announcement { background: rgba(212,175,55,0.2); color: var(--gold); }
        .admin-notif-type.score { background: rgba(139,0,0,0.2); color: #ff6666; }
        .admin-notif-message { color: #ccc; font-size: 13px; line-height: 1.4; margin-bottom: 4px; }
        .admin-notif-time { color: #555; font-size: 11px; }
        .admin-notif-delete { background: transparent; border: 1px solid #333; color: #666; padding: 6px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        .admin-notif-delete:hover { border-color: var(--accent); color: var(--accent); background: rgba(139,0,0,0.1); }

        /* Oyun Kontrol Paneli */
        .game-control { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .countdown-display { font-size: 48px; font-weight: 700; text-align: center; color: var(--gold); margin: 20px 0; font-family: 'Courier New', monospace; letter-spacing: 3px; }
        .countdown-display.warning { color: #ff6666; animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .time-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .time-btn { padding: 10px; font-size: 13px; font-weight: 600; border-radius: 6px; border: 1px solid; cursor: pointer; transition: 0.2s; }
        .time-btn.add { background: rgba(45,90,39,0.3); border-color: #2d5a27; color: #6fb566; }
        .time-btn.add:hover { background: #2d5a27; }
        .time-btn.end { background: rgba(139,0,0,0.3); border-color: var(--accent); color: #ff6666; }
        .time-btn.end:hover { background: var(--accent); color: white; }

        /* Takƒ±m Sayfasƒ± Countdown */
        .team-countdown { background: linear-gradient(135deg, #1a1a1a, #0a0a0a); border: 2px solid var(--gold); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center; }
        .team-countdown-phase { font-size: 18px; color: var(--gold); text-transform: uppercase; letter-spacing: 3px; margin-bottom: 15px; font-weight: 600; }
        .team-countdown-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; }
        .team-countdown-time { font-size: 56px; font-weight: 700; color: var(--gold); font-family: 'Courier New', monospace; letter-spacing: 5px; }
        .team-countdown-time.warning { color: #ff6666; }
        .game-not-started { color: #666; font-size: 14px; padding: 30px; text-align: center; font-style: italic; }

        /* Admin Countdown Phase */
        .admin-phase-title { text-align: center; color: var(--gold); font-size: 16px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; font-weight: 600; }

        /* Emeƒüi Ge√ßenler B√∂l√ºm√º */
        .credits { margin-top: 60px; padding: 30px 20px; border-top: 1px solid var(--border-color); text-align: center; }
        .credits h3 { font-size: 14px; text-transform: uppercase; letter-spacing: 2px; color: var(--gold); margin-bottom: 15px; font-weight: 600; }
        .credits-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 15px; }
        .credit-item { background: var(--card-bg); border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 8px; font-size: 13px; color: var(--text-main); transition: all 0.2s; cursor: pointer; }
        .credit-item:hover { border-color: var(--gold); transform: translateY(-2px); background: #1a1a1a; }
        .credit-item:active { transform: translateY(0); }
        .credits-note { margin-top: 20px; font-size: 11px; color: var(--text-muted); font-style: italic; }

        /* Liderlik Tablosu Stilleri */
        .leaderboard-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .leaderboard-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--border-color);
            transition: all 0.3s;
        }
        .leaderboard-item:hover { transform: translateX(8px); border-color: #444; box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .leaderboard-item:hover::before { background: var(--gold); }
        .leaderboard-item.rank-1 { border-color: var(--gold); background: linear-gradient(135deg, #1a1410, #111); }
        .leaderboard-item.rank-1::before { background: var(--gold); width: 6px; }
        .leaderboard-item.rank-2 { border-color: #C0C0C0; }
        .leaderboard-item.rank-2::before { background: #C0C0C0; }
        .leaderboard-item.rank-3 { border-color: #cd7f32; }
        .leaderboard-item.rank-3::before { background: #cd7f32; }

        .leaderboard-left { display: flex; align-items: center; gap: 15px; }
        .leaderboard-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1a1a1a;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }
        .leaderboard-item.rank-1 .leaderboard-rank {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            animation: pulse-gold 2s infinite;
        }
        .leaderboard-item.rank-2 .leaderboard-rank { background: #C0C0C0; color: #000; border-color: #C0C0C0; }
        .leaderboard-item.rank-3 .leaderboard-rank { background: #cd7f32; color: #000; border-color: #cd7f32; }

        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.7); }
        }

        .leaderboard-info { display: flex; flex-direction: column; gap: 4px; }
        .leaderboard-name { font-size: 18px; font-weight: 600; color: #fff; }
        .leaderboard-item.rank-1 .leaderboard-name { color: var(--gold); }
        .leaderboard-stats { font-size: 12px; color: #888; }

        .leaderboard-score {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }
        .leaderboard-item.rank-1 .leaderboard-score { color: var(--gold); }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Tema Se√ßici */
        .theme-switcher {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .theme-btn:hover {
            transform: scale(1.1) rotate(15deg);
            border-color: var(--gold);
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        }
        .theme-menu {
            position: absolute;
            bottom: 65px;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease;
        }
        .theme-menu.active { display: flex; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .theme-option {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        .theme-option:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--gold);
            transform: translateX(-5px);
        }
        .theme-option.active {
            background: var(--accent);
            border-color: var(--accent);
        }
        .theme-preview {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #fff;
        }
        .theme-preview.classic { background: linear-gradient(135deg, #050505, #8B0000); }
        .theme-preview.midnight { background: linear-gradient(135deg, #0a0e1a, #5b7c99); }
        .theme-preview.blood { background: linear-gradient(135deg, #0d0404, #b91c1c); }

        /* ===== RESPONSIVE DESIGN ===== */

        /* Tablet - Orta Ekranlar (768px - 1024px) */
        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
                padding: 15px;
            }

            h1 {
                font-size: 36px;
            }

            .admin-list {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 15px;
            }

            .form-box {
                max-width: 100%;
                padding: 20px;
            }
        }

        /* Mobile - K√º√ß√ºk Ekranlar (<768px) */
        @media (max-width: 768px) {
            /* Genel Yapƒ± */
            body {
                font-size: 14px;
            }

            .container {
                padding: 10px;
            }

            /* Header */
            header {
                padding: 20px 0;
            }

            h1 {
                font-size: 28px;
                letter-spacing: -0.5px;
            }

            .subtitle {
                font-size: 13px;
            }

            /* Butonlar - Daha b√ºy√ºk dokunma alanƒ± */
            .btn {
                padding: 14px;
                font-size: 14px;
                margin-bottom: 10px;
            }

            /* Form Alanlarƒ± */
            .form-box {
                padding: 18px;
                margin-top: 15px;
            }

            input {
                padding: 12px;
                font-size: 16px; /* iOS zoom'u √∂nlemek i√ßin minimum 16px */
                margin-bottom: 12px;
            }

            /* Admin Grid - Tek s√ºtun */
            .admin-list {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 30px;
            }

            /* Admin Kartƒ± */
            .admin-card {
                padding: 15px;
            }

            .card-head h3 {
                font-size: 16px;
            }

            .card-meta {
                font-size: 11px;
            }

            .team-score {
                font-size: 22px;
            }

            .clues-list {
                gap: 8px;
            }

            .clue-item {
                padding: 10px;
                font-size: 13px;
            }

            /* Admin Header */
            .admin-head {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .back-btn {
                width: 100%;
                padding: 12px;
            }

            /* Liderlik Tablosu */
            .leaderboard-item {
                padding: 15px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .leaderboard-left {
                width: 100%;
            }

            .leaderboard-rank {
                font-size: 20px;
                width: 35px;
                height: 35px;
            }

            .leaderboard-name {
                font-size: 15px;
            }

            .leaderboard-stats {
                font-size: 11px;
            }

            .leaderboard-score {
                font-size: 24px;
                align-self: flex-end;
                width: 100%;
                text-align: right;
            }

            /* Tema Se√ßici - Mobil i√ßin optimize */
            .theme-switcher {
                bottom: 15px;
                right: 15px;
            }

            .theme-btn {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }

            .theme-menu {
                bottom: 60px;
                right: 0;
                min-width: 200px;
            }

            .theme-option {
                padding: 10px 15px;
                font-size: 13px;
            }

            .theme-preview {
                width: 18px;
                height: 18px;
            }

            /* Modal & Popups */
            .error-modal,
            .success-modal {
                max-width: 90%;
                padding: 20px;
            }
        }

        /* √áok K√º√ß√ºk Mobil Cihazlar (<480px) */
        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }

            .btn {
                padding: 12px;
                font-size: 13px;
            }

            .admin-card {
                padding: 12px;
            }

            .card-head h3 {
                font-size: 15px;
            }

            .team-score {
                font-size: 20px;
            }

            .leaderboard-rank {
                font-size: 18px;
                width: 32px;
                height: 32px;
            }

            .leaderboard-name {
                font-size: 14px;
            }

            .leaderboard-score {
                font-size: 22px;
            }

            .theme-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }

            .theme-menu {
                min-width: 180px;
            }
        }

        /* Yatay Mod (Landscape) i√ßin optimizasyonlar */
        @media (max-height: 600px) and (orientation: landscape) {
            header {
                padding: 15px 0;
            }

            h1 {
                font-size: 24px;
                margin-bottom: 5px;
            }

            .form-box {
                margin-top: 10px;
                padding: 15px;
            }

            input {
                padding: 10px;
                margin-bottom: 10px;
            }

            .btn {
                padding: 10px;
                margin-bottom: 8px;
            }
        }

        /* Dokunmatik ekranlar i√ßin hover devre dƒ±≈üƒ± */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover,
            .admin-card:hover,
            .theme-option:hover,
            .leaderboard-item:hover {
                transform: none;
            }

            /* Dokunma i√ßin aktif efekt */
            .btn:active {
                transform: scale(0.98);
                opacity: 0.8;
            }

            .admin-card:active {
                transform: scale(0.99);
            }
        }

        /* ===== Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞ ===== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
            pointer-events: none;
        }

        .notification {
            background: linear-gradient(135deg, #1a1a1a, #111);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.8), 0 0 20px rgba(139,0,0,0.4);
            animation: slideInNotification 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: all;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
            animation: notificationGlow 2s ease-in-out infinite;
        }

        .notification.closing {
            animation: slideOutNotification 0.3s ease forwards;
        }

        @keyframes slideInNotification {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutNotification {
            to {
                transform: translateX(120%);
                opacity: 0;
            }
        }

        @keyframes notificationGlow {
            0%, 100% { box-shadow: 0 0 5px var(--accent); }
            50% { box-shadow: 0 0 15px var(--accent); }
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .notification-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            color: var(--accent);
            font-size: 14px;
        }

        .notification-close {
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .notification-close:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .notification-body {
            color: var(--text-main);
            font-size: 13px;
            line-height: 1.5;
            padding-left: 8px;
        }

        .notification-time {
            color: #666;
            font-size: 11px;
            margin-top: 6px;
            padding-left: 8px;
        }

        /* Mobil i√ßin bildirimler */
        @media (max-width: 768px) {
            .notification-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .notification {
                padding: 14px;
            }

            .notification-title {
                font-size: 13px;
            }

            .notification-body {
                font-size: 12px;
            }
        }

        /* ===== RENK SE√áƒ∞Cƒ∞ ===== */
        .color-option {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px currentColor;
        }

        .color-option.selected {
            border-color: var(--gold);
            transform: scale(1.05);
            box-shadow: 0 0 20px currentColor;
        }

        /* Rozet CSS */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid;
            margin: 2px;
        }
    </style>
</head>
<body>
    <!-- Bildirim Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <!-- Ana Giri≈ü Sayfasƒ± -->
        <div class="page active" id="pgNickname">
            <header>
                <h1>Katil <span>Kim?</span></h1>
                <p class="subtitle">"≈û√ºphe, ger√ßeƒüin g√∂lgesidir..."</p>
            </header>

            <div style="max-width: 420px; margin: 40px auto;">
                <!-- Oyuncu Giri≈üi -->
                <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 30px; margin-bottom: 20px;">
                    <h2 style="color: var(--gold); margin-bottom: 10px; font-size: 20px; text-align: center;">üé≠ Oyuncu Giri≈üi</h2>
                    <p style="color: #999; margin-bottom: 25px; text-align: center; font-size: 14px;">Oyuna katƒ±lmak i√ßin bir nick se√ßin</p>

                    <input
                        type="text"
                        id="inpNickname"
                        placeholder="Nick giriniz..."
                        maxlength="20"
                        style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid var(--border-color); background: #000; color: white; border-radius: 8px; margin-bottom: 15px; transition: border-color 0.2s;"
                        onkeypress="if(event.key==='Enter') USER.registerNickname()"
                        onfocus="this.style.borderColor='var(--gold)'"
                        onblur="this.style.borderColor='var(--border-color)'"
                    />

                    <button class="btn btn-primary" style="margin-bottom: 0;" onclick="USER.registerNickname()">üéÆ Oyuna Giri≈ü Yap</button>
                </div>

                <!-- Y√∂netici Giri≈üi -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 25px; text-align: center;">
                    <h3 style="color: #888; margin-bottom: 15px; font-size: 16px;">üîí Y√∂netici Giri≈üi</h3>
                    <button class="btn" style="margin-bottom: 0; background: #222; border-color: #444; color: #aaa;" onclick="GAME.showAdminLoginForm()">Y√∂netici Paneline Git</button>
                </div>
            </div>

            <!-- Emeƒüi Ge√ßenler -->
            <div class="credits">
                <h3>Emeƒüi Ge√ßenler</h3>
                <div class="credits-list" id="nicknameCreditsList"></div>
                <div class="credits-note">Bu oyun Katil Kim? dedektiflik oyunu i√ßin geli≈ütirilmi≈ütir.</div>
            </div>
        </div>

        <div class="page" id="pgLobby">
            <header>
                <h1>Katil <span>Kim?</span></h1>
                <p class="subtitle">"≈û√ºphe, ger√ßeƒüin g√∂lgesidir..."</p>
                <!-- Mevcut kullanƒ±cƒ± bilgisi -->
                <div id="currentUserInfo" style="margin-top: 15px;">
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; display: inline-flex; align-items: center; gap: 10px;">
                        <span style="color: var(--text-muted); font-size: 13px;">Giri≈ü yapƒ±ldƒ±:</span>
                        <span id="currentUserNick" style="color: var(--gold); font-weight: 600;"></span>
                        <button onclick="USER.logout()" style="background: transparent; border: 1px solid #444; color: #888; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                            √áƒ±kƒ±≈ü Yap
                        </button>
                    </div>
                </div>
            </header>

            <!-- Oyuncu Men√ºs√º -->
            <div id="lobbyMenu" style="max-width: 400px; margin: 0 auto;">
                <button class="btn" onclick="GAME.showCreateForm()">üé≠ Yeni Takƒ±m Olu≈ütur</button>
                <button class="btn" onclick="GAME.showJoinForm()">üîë Takƒ±ma Giri≈ü Yap</button>
                <button class="btn" onclick="GAME.showScoreboard()">üèÜ Skor Tablosu</button>
                <button class="btn" onclick="GAME.showNotifications()">
                    üîî Bildirimler
                    <span id="notifBadgeLobby" style="display:none; background:var(--accent); color:white; border-radius:50%; width:20px; height:20px; font-size:11px; margin-left:auto;"></span>
                </button>
                <button class="btn" style="margin-top: 30px; color: #888; border-color: #333; font-size: 13px;" onclick="GAME.backToMain()">‚Üê Ana Sayfaya D√∂n</button>
            </div>

            <!-- Emeƒüi Ge√ßenler -->
            <div id="lobbyCredits" class="credits">
                <h3>Emeƒüi Ge√ßenler</h3>
                <div class="credits-list" id="lobbyCreditsList"></div>
                <div class="credits-note">Bu oyun Katil Kim? dedektiflik oyunu i√ßin geli≈ütirilmi≈ütir.</div>
            </div>

            <div class="form-box" id="createForm" style="display:none;">
                <h3 style="margin-bottom:15px; color:white;">Yeni Takƒ±m</h3>
                <input type="text" id="inpNewTeam" placeholder="Takƒ±m adƒ±..." maxlength="20">
                <input type="password" id="inpNewTeamPassword" placeholder="Takƒ±m ≈üifresi..." maxlength="20">

                <!-- Renk Se√ßimi -->
                <div style="margin: 15px 0;">
                    <label style="color: #888; font-size: 12px; margin-bottom: 8px; display: block;">Takƒ±m Rengi</label>
                    <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px;">
                        <div class="color-option" data-color="#3b82f6" style="background: #3b82f6;" onclick="CUSTOMIZE.selectColor('#3b82f6')"></div>
                        <div class="color-option" data-color="#ef4444" style="background: #ef4444;" onclick="CUSTOMIZE.selectColor('#ef4444')"></div>
                        <div class="color-option" data-color="#10b981" style="background: #10b981;" onclick="CUSTOMIZE.selectColor('#10b981')"></div>
                        <div class="color-option" data-color="#f59e0b" style="background: #f59e0b;" onclick="CUSTOMIZE.selectColor('#f59e0b')"></div>
                        <div class="color-option" data-color="#8b5cf6" style="background: #8b5cf6;" onclick="CUSTOMIZE.selectColor('#8b5cf6')"></div>
                        <div class="color-option" data-color="#ec4899" style="background: #ec4899;" onclick="CUSTOMIZE.selectColor('#ec4899')"></div>
                        <div class="color-option" data-color="#06b6d4" style="background: #06b6d4;" onclick="CUSTOMIZE.selectColor('#06b6d4')"></div>
                        <div class="color-option" data-color="#84cc16" style="background: #84cc16;" onclick="CUSTOMIZE.selectColor('#84cc16')"></div>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="GAME.hideCreateForm()">ƒ∞ptal</button>
                    <button class="btn btn-primary" onclick="GAME.createTeam()">Olu≈ütur</button>
                </div>
            </div>

            <div class="form-box" id="joinForm" style="display:none;">
                <h3 style="margin-bottom:15px; color:white;">Takƒ±m Se√ß</h3>
                <div id="joinTeamList" style="display:block;">
                    <div class="team-list" id="joinList" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div>
                    <button class="btn" onclick="GAME.hideJoinForm()">ƒ∞ptal</button>
                </div>
                <div id="joinPasswordSection" style="display:none;">
                    <div style="margin-bottom:15px; color:#888; font-size:14px;">
                        Se√ßilen takƒ±m: <span id="selectedTeamName" style="color:var(--gold); font-weight:600;"></span>
                    </div>
                    <input type="password" id="inpJoinPassword" placeholder="Takƒ±m ≈üifresi..." maxlength="20">
                    <div style="display:flex; gap:10px;">
                        <button class="btn" onclick="GAME.backToTeamList()">‚Üê Geri</button>
                        <button class="btn btn-primary" onclick="GAME.joinTeam()">Giri≈ü</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="pgTeam">
            <header style="padding: 20px 0;">
                <div style="color:#666; font-size:12px; letter-spacing: 2px; text-transform: uppercase;">Dedektif Paneli</div>
                <h1 id="dispTeamName" style="font-size:32px; margin-top:5px;">-</h1>
            </header>

            <div style="max-width:500px; margin: 0 auto;">
                <!-- Takƒ±m Bilgileri Kartƒ± -->
                <div style="background: linear-gradient(135deg, #1a1a1a, #111); border: 2px solid var(--gold); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(212,175,55,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Takƒ±m Adƒ±</div>
                            <div id="teamInfoName" style="color: #fff; font-size: 20px; font-weight: 600;">-</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Puan</div>
                            <div id="teamInfoScore" style="color: var(--gold); font-size: 32px; font-weight: 700; font-family: 'Courier New', monospace;">0</div>
                        </div>
                    </div>
                </div>

                <!-- Countdown G√∂r√ºn√ºm√º -->
                <div id="teamCountdownSection"></div>

                <!-- Y√∂netici ƒ∞pu√ßlarƒ± - YENƒ∞ TASARIM -->
                <div id="adminCluesSection" style="display:none; margin-bottom:20px;">
                    <div style="background: linear-gradient(135deg, #1a0a0a, #0d0404); border: 2px solid var(--accent); border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(139,0,0,0.3); position: relative; overflow: hidden;">
                        <!-- Ba≈ülƒ±k -->
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--accent); padding-bottom: 10px;">
                            <div style="font-size: 24px;">üéØ</div>
                            <div>
                                <h3 style="margin: 0; color: var(--accent); font-size: 18px; font-weight: 700;">Y√∂netici ƒ∞pu√ßlarƒ±</h3>
                                <div style="color: #888; font-size: 11px; margin-top: 2px;">Oyun y√∂neticisinden gelen ipu√ßlarƒ±</div>
                            </div>
                            <div id="adminCluesCount" style="margin-left: auto; background: var(--accent); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0</div>
                        </div>

                        <!-- ƒ∞pu√ßlarƒ± Listesi -->
                        <div id="adminCluesList" style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;"></div>

                        <!-- Bo≈ü Durum -->
                        <div id="adminCluesEmpty" style="text-align: center; padding: 30px; color: #666;">
                            <div style="font-size: 32px; margin-bottom: 10px;">üîç</div>
                            <div style="font-size: 13px;">Hen√ºz y√∂netici ipucu yok</div>
                        </div>
                    </div>
                </div>

                <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #222; margin-bottom:20px;">
                    <h3 style="margin-bottom:12px; color:var(--gold);">üîé Yeni ƒ∞pucu</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="inpClue" placeholder="Bulduƒüunuz ipucunu yazƒ±n..." maxlength="300" style="margin:0;">
                        <button class="btn btn-primary" style="width:auto; margin:0;" onclick="GAME.addClue()">G√∂nder</button>
                    </div>
                </div>

                <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #222;">
                    <h3 style="margin-bottom:12px; display:flex; justify-content:space-between;">
                        üìã Kayƒ±tlar <span id="clueCnt" style="color:#666; font-size:14px;">(0)</span>
                    </h3>
                    <div id="myClueList" style="max-height:300px; overflow-y:auto;"></div>
                </div>
                <button class="btn" style="margin-top:20px; border-color:#333;" onclick="GAME.exitTeam()">üö™ √áƒ±kƒ±≈ü Yap</button>
            </div>
        </div>

        <div class="page" id="pgAdmin">
            <div class="admin-head">
                <div>
                    <h2 style="font-size:24px;">üëÅÔ∏è Y√∂netici Paneli</h2>
                    <div style="color:#666; font-size:12px; margin-top:4px;">
                        <span id="statTeams">0</span> Takƒ±m ‚Ä¢ <span id="statClues">0</span> ƒ∞pucu
                    </div>
                </div>
                <button class="back-btn" onclick="GAME.exitAdmin()">√áƒ±kƒ±≈ü</button>
            </div>

            <!-- Admin Men√º Butonlarƒ± - RESPONSIVE -->
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-bottom:30px;">
                <button class="btn btn-primary" onclick="ADMIN.showSection('game')">‚è±Ô∏è Oyun Kontrol√º</button>
                <button class="btn" onclick="ADMIN.showSection('users')">üë§ Kullanƒ±cƒ±lar</button>
                <button class="btn" onclick="ADMIN.showSection('scoring')">üéØ Puanlama</button>
                <button class="btn" onclick="ADMIN.showSection('notifications')">üì¢ Bildirimler</button>
                <button class="btn" onclick="ADMIN.showSection('credits')">üë• Emeƒüi Ge√ßenler</button>
                <button class="btn" onclick="ADMIN.showSection('iplogs')">üîç IP Loglarƒ±</button>
            </div>

            <!-- Oyun Kontrol B√∂l√ºm√º -->
            <div id="adminSectionGame" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">‚è±Ô∏è Oyun Kontrol√º</h3>
                <div class="game-control">
                    <!-- Oyun Ba≈ülatma -->
                    <div id="gameStartSection">
                        <input type="text" id="gameTitle" placeholder="Faz Ba≈ülƒ±ƒüƒ± (√∂rn: Faz 1, ƒ∞lk Tur)" maxlength="30" style="width:100%; margin:0 0 10px 0; padding:12px;">
                        <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px;">
                            <input type="number" id="gameMinutes" placeholder="S√ºre (dakika)" min="1" max="180" style="flex:1; margin:0; padding:12px;">
                            <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.startGame()">üéÆ Oyunu Ba≈ülat</button>
                        </div>
                    </div>

                    <!-- Countdown G√∂r√ºn√ºm√º -->
                    <div id="gameRunningSection" style="display:none;">
                        <div class="admin-phase-title" id="adminPhaseTitle"></div>
                        <div class="countdown-display" id="adminCountdown">00:00</div>
                        <div class="time-controls">
                            <button class="time-btn add" onclick="ADMIN.addTime(300)">+5 Dakika</button>
                            <button class="time-btn add" onclick="ADMIN.addTime(600)">+10 Dakika</button>
                            <button class="time-btn add" onclick="ADMIN.addTime(60)">+1 Dakika</button>
                        </div>
                        <button class="btn" style="width:100%; margin-top:15px; background:#500; color:#faa; border:1px solid var(--accent);" onclick="ADMIN.endGame()">‚èπÔ∏è Oyunu Bitir</button>
                    </div>
                </div>
            </div>

            <!-- Kullanƒ±cƒ±lar B√∂l√ºm√º -->
            <div id="adminSectionUsers" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">üë§ Kullanƒ±cƒ±lar</h3>
                <div id="usersList"></div>
            </div>

            <!-- Bildirimler B√∂l√ºm√º -->
            <div id="adminSectionNotifications" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">üì¢ Bildirimler</h3>

                <!-- ƒ∞pucu G√∂nderme -->
                <div class="announcement-form" style="margin-bottom:20px;">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">üí° Genel ƒ∞pucu G√∂nder</h3>
                    <textarea id="generalClueText" placeholder="T√ºm takƒ±mlara g√∂nderilecek ipucunu yazƒ±n..." maxlength="500"></textarea>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button class="btn btn-primary" style="width:auto; padding:10px 24px; margin:0;" onclick="ADMIN.sendGeneralClue()">ƒ∞pucu G√∂nder</button>
                    </div>
                </div>

                <!-- Duyuru G√∂nderme -->
                <div class="announcement-form">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">üì¢ Genel Duyuru G√∂nder</h3>
                    <textarea id="announcementText" placeholder="T√ºm takƒ±mlara g√∂nderilecek duyuruyu yazƒ±n..." maxlength="500"></textarea>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button class="btn btn-primary" style="width:auto; padding:10px 24px; margin:0;" onclick="ADMIN.sendAnnouncement()">Duyuruyu G√∂nder</button>
                        <button class="btn" style="width:auto; padding:10px 24px; margin:0; background:#300; color:#faa; border:1px solid #500;" onclick="ADMIN.clearAllNotifications()">üóëÔ∏è T√ºm Bildirimleri Sil</button>
                    </div>

                    <!-- G√∂nderilen Bildirimler Listesi -->
                    <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">G√∂nderilen Bildirimler</h3>
                            <span id="adminNotifCount" style="color:#666; font-size:12px;">0 bildirim</span>
                        </div>
                        <div id="adminNotifList" style="max-height:300px; overflow-y:auto;"></div>
                    </div>
                </div>
            </div>

            <!-- Puanlama B√∂l√ºm√º -->
            <div id="adminSectionScoring" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">üéØ Puanlama</h3>
                <div class="stats-chart" id="statsChart">
                    <h3 style="color:#666; font-size:12px; text-transform:uppercase; margin-bottom:15px;">üìä Canlƒ± Puan Durumu</h3>
                    <div id="chartContent"></div>
                </div>

                <div id="adminList" class="admin-list"></div>

                <button class="btn" style="background:#300; color:#faa; border:1px solid #500; margin-top:30px;" onclick="GAME.resetGame()">‚ö†Ô∏è OYUNU SIFIRLA (T√ºm Takƒ±mlarƒ± Sil)</button>
            </div>

            <!-- Emeƒüi Ge√ßenler B√∂l√ºm√º -->
            <div id="adminSectionCredits" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">üë• Emeƒüi Ge√ßenler</h3>

                <!-- ƒ∞sim Ekleme Formu -->
                <div class="announcement-form" style="margin-bottom:20px;">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">‚ûï Yeni Ki≈üi Ekle</h3>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="creditNameInput" placeholder="ƒ∞sim girin..." maxlength="30" style="margin:0; flex:1;" onkeypress="if(event.key==='Enter') ADMIN.addCredit()">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.addCredit()">Ekle</button>
                    </div>
                </div>

                <!-- ƒ∞simler ve ƒ∞√ßerik Y√∂netimi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">Ki≈üiler ve ƒ∞√ßerikleri</h3>
                        <span id="creditsCount" style="color:#666; font-size:12px;">0 ki≈üi</span>
                    </div>
                    <div id="creditsList" style="display:flex; flex-direction:column; gap:15px; min-height:100px;"></div>
                </div>
            </div>

            <!-- IP Loglarƒ± B√∂l√ºm√º -->
            <div id="adminSectionIplogs" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">üîç IP Y√∂netimi</h3>

                <!-- Tab Butonlarƒ± -->
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button id="ipTabLogs" class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_SECTION.showTab('logs')">üìä Aktivite Loglarƒ±</button>
                    <button id="ipTabUsers" class="btn" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_SECTION.showTab('users')">üë• Kullanƒ±cƒ± Kayƒ±tlarƒ±</button>
                </div>

                <!-- TAB 1: Aktivite Loglarƒ± -->
                <div id="ipTabContentLogs" style="display:block;">
                    <!-- Bilgilendirme -->
                    <div style="background:#1a1a1a; border-left:4px solid var(--gold); padding:15px; margin-bottom:20px; border-radius:8px;">
                        <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                            Son 24 saat i√ßinde IP bazlƒ± aktiviteler. Bir IP'den √ßok fazla kullanƒ±cƒ±/takƒ±m olu≈üturulmasƒ±nƒ± engellemek i√ßin bu limitler vardƒ±r.
                            <br><strong style="color:var(--gold);">Kullanƒ±cƒ± Kaydƒ±:</strong> Aynƒ± IP'den 24 saatte maksimum 3 kayƒ±t
                            <br><strong style="color:var(--gold);">Takƒ±m Olu≈üturma:</strong> Aynƒ± IP'den 24 saatte maksimum 2 takƒ±m
                            <br><br><strong style="color:#ff9800;">üí° Not:</strong> Bir IP limiti dolduƒüunda (√∂rn: 3/3), "Limiti Sƒ±fƒ±rla" butonuyla o IP'nin hakkƒ±nƒ± yenileyebilirsin.
                        </p>
                    </div>

                    <!-- Yenile ve T√ºm√ºn√º Sƒ±fƒ±rla Butonlarƒ± -->
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_LOGS.loadLogs()">üîÑ Yenile</button>
                        <button class="btn" style="width:auto; padding:12px 24px; margin:0; background:#500; color:#faa; border:1px solid #700;" onclick="IP_LOGS.clearAll()">üóëÔ∏è T√ºm Loglarƒ± Sƒ±fƒ±rla</button>
                    </div>

                    <!-- Loglar Tablosu -->
                    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">Aktivite Loglarƒ±</h3>
                            <span id="ipLogsCount" style="color:#666; font-size:12px;">0 kayƒ±t</span>
                        </div>
                        <div id="ipLogsList" style="display:flex; flex-direction:column; gap:12px; min-height:100px;"></div>
                    </div>
                </div>

                <!-- TAB 2: Kullanƒ±cƒ± Kayƒ±tlarƒ± -->
                <div id="ipTabContentUsers" style="display:none;">
                    <!-- Bilgilendirme -->
                    <div style="background:#1a1a1a; border-left:4px solid #3b82f6; padding:15px; margin-bottom:20px; border-radius:8px;">
                        <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                            T√ºm kayƒ±tlƒ± kullanƒ±cƒ±larƒ± g√∂rebilir ve silebilirsiniz.
                            <br><strong style="color:#3b82f6;">Kullanƒ±cƒ± Silme:</strong> Bir kullanƒ±cƒ±yƒ± sildiƒüinizde, ba≈üka biri o nickname ile kaydolabilir.
                            <br><br><strong style="color:#ff9800;">üí° Not:</strong> Eƒüer birisi "furkan1" nickname'ini almak istiyorsa ama kullanƒ±mda ise, eski "furkan1" kullanƒ±cƒ±sƒ±nƒ± buradan silebilirsiniz.
                        </p>
                    </div>

                    <!-- Yenile ve Hepsini Sil Butonlarƒ± -->
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_USERS.loadAllUsers()">üîÑ Kullanƒ±cƒ±larƒ± Yenile</button>
                        <button class="btn" style="width:auto; padding:12px 24px; margin:0; background:#dc2626; border-color:#dc2626; color:#fff;" onclick="IP_USERS.deleteAll()">üóëÔ∏è Hepsini Sil</button>
                    </div>

                    <!-- Kullanƒ±cƒ±lar Listesi -->
                    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">T√ºm Kullanƒ±cƒ± Kayƒ±tlarƒ±</h3>
                            <span id="ipUsersCount" style="color:#666; font-size:12px;">0 kullanƒ±cƒ±</span>
                        </div>
                        <div id="ipUsersList" style="display:flex; flex-direction:column; gap:12px; min-height:100px;">
                            <div style="color:#666; text-align:center; padding:30px;">Y√ºkleniyor...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="pgScoreboard">
            <div class="admin-head">
                <h2>üèÜ Liderlik Tablosu</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div id="scoreboardList" style="max-width:600px; margin:0 auto;"></div>
        </div>

        <div class="page" id="pgNotifications">
            <div class="admin-head">
                <h2>üîî Bildirimler</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div style="max-width:700px; margin:0 auto;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div style="color:#888; font-size:13px;">
                        Toplam <span id="notifCount">0</span> bildirim
                    </div>
                    <button class="btn" style="width:auto; padding:8px 16px; font-size:12px; margin:0;" onclick="NOTIF.markAllRead()">T√ºm√ºn√º Okundu ƒ∞≈üaretle</button>
                </div>
                <div class="notif-list" id="notifList"></div>
            </div>
        </div>

        <div class="page" id="pgCreditDetail">
            <div class="admin-head">
                <h2 id="creditDetailName">-</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div style="max-width:800px; margin:0 auto;">
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:30px; min-height:300px;">
                    <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">Katkƒ±larƒ±</h3>
                    <div id="creditDetailContent" style="color:#ccc; font-size:15px; line-height:1.8; white-space:pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="passModal">
        <div class="modal-box">
            <h3 style="margin-bottom:10px; color:white;">Y√∂netici Giri≈üi</h3>
            <input type="password" id="inpPass" maxlength="6" placeholder="******" style="text-align:center; letter-spacing:5px; font-size:20px;">
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="GAME.hidePassModal()">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="GAME.checkPass()">Giri≈ü</button>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <!-- Tema Se√ßici -->
    <div class="theme-switcher">
        <div class="theme-menu" id="themeMenu">
            <div class="theme-option active" onclick="THEME.setTheme('classic')" data-theme="classic">
                <div class="theme-preview classic"></div>
                <span>Classic Dark</span>
            </div>
            <div class="theme-option" onclick="THEME.setTheme('midnight')" data-theme="midnight">
                <div class="theme-preview midnight"></div>
                <span>Midnight Detective</span>
            </div>
            <div class="theme-option" onclick="THEME.setTheme('blood')" data-theme="blood">
                <div class="theme-preview blood"></div>
                <span>Blood Moon</span>
            </div>
        </div>
        <button class="theme-btn" onclick="THEME.toggleMenu()">üé®</button>
    </div>

    <!-- Bildirim Popup -->
    <div id="notificationPopup" class="notification-popup">
        <div class="notif-header">
            <div class="notif-title" id="popupTitle">Bildirim</div>
            <button class="notif-close" onclick="NOTIF.closePopup()">√ó</button>
        </div>
        <div class="notif-body" id="popupBody"></div>
        <div class="notif-time" id="popupTime"></div>
    </div>

    <!-- Bildirim Sesi -->
    <script>
        // Tema Y√∂netimi
        var THEME = {
            // G√úVENLƒ∞K: sessionStorage kullan (localStorage yerine) - oturum sonu temizlensin
            current: sessionStorage.getItem('theme') || 'classic',

            init: function() {
                this.applyTheme(this.current);
            },

            setTheme: function(theme) {
                this.current = theme;
                sessionStorage.setItem('theme', theme);
                this.applyTheme(theme);
                this.updateActiveOption(theme);
                this.closeMenu();
            },

            applyTheme: function(theme) {
                if (theme === 'classic') {
                    document.documentElement.removeAttribute('data-theme');
                } else {
                    document.documentElement.setAttribute('data-theme', theme);
                }
            },

            updateActiveOption: function(theme) {
                document.querySelectorAll('.theme-option').forEach(function(opt) {
                    opt.classList.remove('active');
                });
                document.querySelector('.theme-option[data-theme="' + theme + '"]').classList.add('active');
            },

            toggleMenu: function() {
                var menu = document.getElementById('themeMenu');
                menu.classList.toggle('active');
            },

            closeMenu: function() {
                document.getElementById('themeMenu').classList.remove('active');
            }
        };

        // Sayfa y√ºklendiƒüinde temayƒ± uygula
        THEME.init();

        // Bildirim Sistemi
        var NOTIFICATION = {
            container: null,
            nextId: 1,

            init: function() {
                this.container = document.getElementById('notificationContainer');
            },

            show: function(title, message, time) {
                if (!this.container) this.init();

                var id = 'notif-' + this.nextId++;
                var notif = document.createElement('div');
                notif.className = 'notification';
                notif.id = id;

                // G√úVENLƒ∞K: XSS korumasƒ± - innerHTML yerine DOM API kullan
                var header = document.createElement('div');
                header.className = 'notification-header';

                var titleDiv = document.createElement('div');
                titleDiv.className = 'notification-title';

                var icon = document.createElement('span');
                icon.textContent = 'üéØ';
                titleDiv.appendChild(icon);

                var titleSpan = document.createElement('span');
                titleSpan.textContent = title;
                titleDiv.appendChild(titleSpan);

                var closeBtn = document.createElement('button');
                closeBtn.className = 'notification-close';
                closeBtn.textContent = '√ó';
                closeBtn.addEventListener('click', () => this.close(id));

                header.appendChild(titleDiv);
                header.appendChild(closeBtn);
                notif.appendChild(header);

                var body = document.createElement('div');
                body.className = 'notification-body';
                body.textContent = message;
                notif.appendChild(body);

                if (time) {
                    var timeDiv = document.createElement('div');
                    timeDiv.className = 'notification-time';
                    timeDiv.textContent = time;
                    notif.appendChild(timeDiv);
                }

                this.container.appendChild(notif);

                // 8 saniye sonra otomatik kapat
                setTimeout(() => {
                    this.close(id);
                }, 8000);

                return id;
            },

            close: function(id) {
                var notif = document.getElementById(id);
                if (notif) {
                    notif.classList.add('closing');
                    setTimeout(() => {
                        notif.remove();
                    }, 300);
                }
            }
        };

        NOTIFICATION.init();

        // Renk √ñzelle≈ütirme Sistemi
        var CUSTOMIZE = {
            selectedColor: '#3b82f6',

            init: function() {
                this.selectColor(this.selectedColor);
            },

            selectColor: function(color) {
                this.selectedColor = color;

                // T√ºm renk se√ßeneklerini g√ºncelle
                var options = document.querySelectorAll('.color-option');
                options.forEach(function(opt) {
                    opt.classList.remove('selected');
                    if (opt.getAttribute('data-color') === color) {
                        opt.classList.add('selected');
                    }
                });
            }
        };

        // Men√º dƒ±≈üƒ±na tƒ±klandƒ±ƒüƒ±nda kapat
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.theme-switcher')) {
                THEME.closeMenu();
            }
        });

        (function() {
            // Socket.IO baƒülantƒ±sƒ± - Cookie g√∂ndermesi i√ßin withCredentials gerekli
            window.socket = io({
                withCredentials: true,  // Cookie g√∂nder (session i√ßin kritik!)
                transports: ['polling'],  // GE√áICI: Sadece polling (websocket cookie kaybƒ± test)
                upgrade: false  // GE√áICI: WebSocket upgrade'i devre dƒ±≈üƒ±
            });
            var socket = window.socket;
            var socketConnected = false; // Baƒülantƒ± durumu
            var teams = [];
            var users = [];
            var currentUser = null; // G√úVENLƒ∞K: localStorage yerine sadece memory'de tut
            var credits = [
                { id: 'credit_1', name: 'Furkan', content: 'Oyunun tasarƒ±mƒ± ve geli≈ütirmesi' },
                { id: 'credit_2', name: 'Claude', content: 'Kodlama ve teknik destek' }
            ];
            var currentTeamId = null; // G√úVENLƒ∞K: localStorage yerine server'dan al
            var selectedJoinId = null;
            var isProcessing = false;

            // Navigation history - geri butonlarƒ± i√ßin
            var pageHistory = [];

            // Socket baƒülantƒ± event'leri
            socket.on('connect', function() {
                socketConnected = true;
                console.log('Socket baƒülantƒ±sƒ± kuruldu');

                // SESSION RESTORE: Server'dan session kontrol√º yap
                socket.emit('reconnect-user', function(response) {
                    if (response && response.userId) {
                        // Session var, kullanƒ±cƒ±yƒ± restore et
                        currentUser = {
                            userId: response.userId,
                            nickname: response.nickname
                        };
                        updateCurrentUserDisplay();

                        // Eƒüer takƒ±mƒ± varsa takƒ±m sayfasƒ±na y√∂nlendir
                        if (response.teamId) {
                            currentTeamId = response.teamId;
                            var team = teams.find(t => t.id === response.teamId);
                            if (team) {
                                showPage('pgTeam');
                            } else {
                                showPage('pgLobby');
                            }
                        } else {
                            // Takƒ±mƒ± yoksa lobby'ye git
                            showPage('pgLobby');
                        }

                        console.log('‚úì Session restore edildi:', response.nickname);
                    } else {
                        // Session yok, nickname sayfasƒ±na git
                        currentUser = null;
                        currentTeamId = null;
                        updateCurrentUserDisplay();
                        showPage('pgNickname', false);
                        console.log('Session yok, giri≈ü sayfasƒ±na y√∂nlendirildi');
                    }
                });
            });

            socket.on('disconnect', function() {
                socketConnected = false;
                console.log('Socket baƒülantƒ±sƒ± koptu');
                toast('Baƒülantƒ± koptu. Yeniden baƒülanƒ±yor...', true);
            });

            socket.on('connect_error', function(err) {
                console.error('Socket baƒülantƒ± hatasƒ±:', err);
                toast('Baƒülantƒ± hatasƒ±!', true);
            });
            // G√úVENLƒ∞K: sessionStorage kullan (localStorage yerine) - tarayƒ±cƒ± kapatƒ±lƒ±nca temizlensin
            var notifications = JSON.parse(sessionStorage.getItem('notifications') || '[]');
            var generalClues = [];
            var popupTimeout = null;

            // Oyun durumu
            var gameState = {
                started: false,
                countdown: 0,
                phaseTitle: ''
            };

            // Zaman formatlayƒ±cƒ± (saniye -> MM:SS)
            function formatTime(seconds) {
                var mins = Math.floor(seconds / 60);
                var secs = seconds % 60;
                return (mins < 10 ? '0' : '') + mins + ':' + (secs < 10 ? '0' : '') + secs;
            }

            // HTML Escape - XSS korumasƒ±
            function htmlEscape(text) {
                if (!text) return '';
                var div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // UI Yardƒ±mcƒ±larƒ±
            function toast(msg, err) {
                var t = document.getElementById('toast');
                t.textContent = msg;
                t.className = err ? 'show err' : 'show';
                setTimeout(function() { t.className = ''; }, 2500);
            }

            function showPage(id, addToHistory = true) {
                // Mevcut aktif sayfayƒ± bul
                var currentPage = document.querySelector('.page.active');
                var currentPageId = currentPage ? currentPage.id : null;

                // Eƒüer aynƒ± sayfaya ge√ßi≈ü yapƒ±lƒ±yorsa, history'ye ekleme
                if (currentPageId === id) {
                    return;
                }

                // History'ye ekle (geri butonlarƒ± i√ßin)
                if (addToHistory && currentPageId) {
                    pageHistory.push(currentPageId);
                    // Max 10 sayfa tutulur (memory overflow √∂nleme)
                    if (pageHistory.length > 10) {
                        pageHistory.shift();
                    }
                }

                // Sayfalarƒ± deƒüi≈ütir
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            }

            // Geri git fonksiyonu
            function goBack() {
                if (pageHistory.length > 0) {
                    var previousPage = pageHistory.pop();
                    showPage(previousPage, false); // History'ye ekleme
                } else {
                    // History yoksa lobby'ye git
                    if (currentUser) {
                        showPage('pgLobby', false);
                    } else {
                        showPage('pgNickname', false);
                    }
                }
            }

            function updateCurrentUserDisplay() {
                var userInfo = document.getElementById('currentUserInfo');
                var userNick = document.getElementById('currentUserNick');

                if (currentUser && currentUser.nickname) {
                    userNick.textContent = currentUser.nickname;
                    userInfo.style.display = 'block';
                } else {
                    userInfo.style.display = 'none';
                }
            }

            // Global Fonksiyonlar (HTML onclick i√ßin)
            window.adminScore = function(teamId, amount, teamName) {
                if (isProcessing) return;

                // G√úVENLƒ∞K: B√ºy√ºk puan deƒüi≈üiklikleri i√ßin onay iste (¬±50 ve √ºst√º)
                if (Math.abs(amount) >= 50) {
                    var message = teamName + ' takƒ±mƒ±na ' + (amount > 0 ? '+' : '') + amount + ' puan vermek istiyor musunuz?';
                    if (!confirm(message)) {
                        return;
                    }
                }

                isProcessing = true;
                socket.emit('change-score', { teamId: teamId, amount: amount }, function(res) {
                    isProcessing = false;
                    if (!res.success) toast(res.error, true);
                });
            };

            window.adminDel = function(teamId, teamName) {
                if (isProcessing) return;
                if (confirm(teamName + ' takƒ±mƒ±nƒ± silmek istiyor musunuz?')) {
                    isProcessing = true;
                    socket.emit('delete-team', teamId, function(res) {
                        isProcessing = false;
                        if (res.success) toast('Takƒ±m silindi.');
                        else toast(res.error, true);
                    });
                }
            };

            window.adminDeleteUser = function(userId, nickname) {
                if (isProcessing) return;
                if (confirm(nickname + ' kullanƒ±cƒ±sƒ±nƒ± silmek istiyor musunuz? Bu i≈ülem geri alƒ±namaz.')) {
                    isProcessing = true;
                    socket.emit('delete-user', userId, function(res) {
                        isProcessing = false;
                        if (res.success) toast('Kullanƒ±cƒ± silindi.');
                        else toast(res.error, true);
                    });
                }
            };

            // USER objesi - Kullanƒ±cƒ± i≈ülemleri
            window.USER = {
                registerNickname: function() {
                    var nickname = document.getElementById('inpNickname').value.trim();
                    if (!nickname) {
                        toast('L√ºtfen bir nick girin!', true);
                        return;
                    }

                    // Socket baƒülantƒ±sƒ± kontrol√º
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('register-user', nickname, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            // G√úVENLƒ∞K: localStorage'a kaydetme, sadece memory'de tut
                            currentUser = { userId: res.userId, nickname: res.nickname };
                            updateCurrentUserDisplay();
                            showPage('pgLobby');
                            toast('Ho≈ügeldin, ' + res.nickname + '!');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                logout: function() {
                    if (confirm('√áƒ±kƒ±≈ü yapmak istediƒüinize emin misiniz?')) {
                        // G√úVENLƒ∞K: Session'ƒ± temizle
                        currentUser = null;
                        currentTeamId = null;

                        // Server'a logout isteƒüi g√∂nder (session'ƒ± temizle)
                        socket.emit('logout-user', function() {
                            // Nick giri≈ü sayfasƒ±na y√∂nlendir
                            showPage('pgNickname');
                            updateCurrentUserDisplay();
                            toast('√áƒ±kƒ±≈ü yapƒ±ldƒ±.');
                        });
                    }
                }
            };

            window.GAME = {
                backToMain: function() {
                    // UX ƒ∞Yƒ∞LE≈ûTƒ∞RME: Ana sayfaya d√∂n - logout yap
                    if (confirm('Ana sayfaya d√∂nmek i√ßin √ßƒ±kƒ±≈ü yapƒ±lacak. Emin misiniz?')) {
                        currentUser = null;
                        currentTeamId = null;

                        // Server'a logout isteƒüi g√∂nder (session'ƒ± temizle)
                        socket.emit('logout-user', function() {
                            // Ana sayfaya y√∂nlendir (nickname giri≈ü ekranƒ±)
                            showPage('pgNickname');
                            updateCurrentUserDisplay();
                            toast('√áƒ±kƒ±≈ü yapƒ±ldƒ±.');
                        });
                    }
                },
                showAdminLoginForm: function() {
                    // Admin ≈üifre modalƒ±nƒ± g√∂ster
                    document.getElementById('passModal').classList.add('show');
                    document.getElementById('inpPass').value = '';
                    document.getElementById('inpPass').focus();
                },
                showCreateForm: function() {
                    // UX ƒ∞Yƒ∞LE≈ûTƒ∞RME: Lobby men√ºs√ºn√º gizle, sadece formu g√∂ster
                    document.getElementById('lobbyMenu').style.display = 'none';
                    document.getElementById('lobbyCredits').style.display = 'none';
                    document.getElementById('createForm').style.display = 'block';
                    document.getElementById('joinForm').style.display = 'none';
                    CUSTOMIZE.init(); // Avatar ve renk se√ßiciyi ba≈ülat
                    document.getElementById('inpNewTeam').focus();
                },
                hideCreateForm: function() {
                    document.getElementById('createForm').style.display = 'none';
                    // Lobby men√ºs√ºn√º geri g√∂ster
                    document.getElementById('lobbyMenu').style.display = 'block';
                    document.getElementById('lobbyCredits').style.display = 'block';
                },
                showJoinForm: function() {
                    // UX ƒ∞Yƒ∞LE≈ûTƒ∞RME: Lobby men√ºs√ºn√º gizle, sadece takƒ±m listesini g√∂ster
                    document.getElementById('lobbyMenu').style.display = 'none';
                    document.getElementById('lobbyCredits').style.display = 'none';
                    document.getElementById('joinForm').style.display = 'block';
                    document.getElementById('createForm').style.display = 'none';
                    // Takƒ±m listesini g√∂ster, ≈üifre kƒ±smƒ±nƒ± gizle
                    document.getElementById('joinTeamList').style.display = 'block';
                    document.getElementById('joinPasswordSection').style.display = 'none';
                    renderJoinList();
                },
                hideJoinForm: function() {
                    document.getElementById('joinForm').style.display = 'none';
                    // Formu sƒ±fƒ±rla
                    document.getElementById('joinTeamList').style.display = 'block';
                    document.getElementById('joinPasswordSection').style.display = 'none';
                    document.getElementById('inpJoinPassword').value = '';
                    selectedJoinId = null;
                    // Lobby men√ºs√ºn√º geri g√∂ster
                    document.getElementById('lobbyMenu').style.display = 'block';
                    document.getElementById('lobbyCredits').style.display = 'block';
                },
                backToTeamList: function() {
                    document.getElementById('joinTeamList').style.display = 'block';
                    document.getElementById('joinPasswordSection').style.display = 'none';
                    document.getElementById('inpJoinPassword').value = '';
                    selectedJoinId = null;
                },
                
                createTeam: function() {
                    if (!currentUser) {
                        toast('√ñnce nick girmeniz gerekiyor!', true);
                        return;
                    }

                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    var name = document.getElementById('inpNewTeam').value.trim();
                    var password = document.getElementById('inpNewTeamPassword').value.trim();
                    if (!name) { toast('ƒ∞sim giriniz', true); return; }
                    if (!password) { toast('≈ûifre giriniz', true); return; }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('create-team', {
                        name: name,
                        password: password,
                        color: CUSTOMIZE.selectedColor,
                        userId: currentUser.userId
                    }, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            // G√úVENLƒ∞K: localStorage yerine sadece memory'de tut
                            currentTeamId = res.team.id;
                            GAME.hideCreateForm();
                            document.getElementById('inpNewTeam').value = '';
                            document.getElementById('inpNewTeamPassword').value = '';
                            showPage('pgTeam');
                            renderTeamPage(res.team);
                        } else { toast(res.error, true); }
                    });
                },
                selectJoin: function(el) {
                    selectedJoinId = el.getAttribute('data-id');
                    var teamName = el.getAttribute('data-name');

                    // Takƒ±m listesini gizle, ≈üifre kƒ±smƒ±nƒ± g√∂ster
                    document.getElementById('joinTeamList').style.display = 'none';
                    document.getElementById('joinPasswordSection').style.display = 'block';
                    document.getElementById('selectedTeamName').textContent = teamName;
                    document.getElementById('inpJoinPassword').focus();
                },
                joinTeam: function() {
                    if (!currentUser) {
                        toast('√ñnce nick girmeniz gerekiyor!', true);
                        return;
                    }

                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    if (!selectedJoinId) { toast('Takƒ±m se√ßiniz', true); return; }
                    var password = document.getElementById('inpJoinPassword').value.trim();
                    if (!password) { toast('≈ûifre giriniz', true); return; }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('join-team', { teamId: selectedJoinId, password: password, userId: currentUser.userId }, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            // G√úVENLƒ∞K: localStorage yerine sadece memory'de tut
                            currentTeamId = selectedJoinId;
                            GAME.hideJoinForm();
                            document.getElementById('inpJoinPassword').value = '';
                            showPage('pgTeam');
                            renderTeamPage(res.team);
                        } else { toast(res.error, true); }
                    });
                },
                addClue: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    var inp = document.getElementById('inpClue');
                    var txt = inp.value.trim();
                    if (!txt) { toast('Bo≈ü ipucu g√∂nderilemez', true); return; }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('add-clue', { teamId: currentTeamId, clue: txt }, function(res) {
                        isProcessing = false;
                        if (res.success) { inp.value = ''; toast('ƒ∞pucu iletildi'); }
                        else { toast(res.error, true); }
                    });
                },
                exitTeam: function() {
                    currentTeamId = null;
                    showPage('pgLobby');
                },
                exitAdmin: function() {
                    // Admin panelinden √ßƒ±kƒ±≈ü - kullanƒ±cƒ± varsa takƒ±m se√ßim ekranƒ±na, yoksa nickname ekranƒ±na
                    if (currentUser) {
                        showPage('pgLobby');
                    } else {
                        showPage('pgNickname');
                    }
                },
                hidePassModal: function() { document.getElementById('passModal').classList.remove('show'); },
                checkPass: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    var pass = document.getElementById('inpPass').value;

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('admin-login', pass, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            GAME.hidePassModal();
                            showPage('pgAdmin');
                            renderAdminList();
                            // Varsayƒ±lan olarak oyun kontrol√º b√∂l√ºm√ºn√º g√∂ster
                            ADMIN.showSection('game');
                        } else { toast('Hatalƒ± ≈üifre', true); }
                    });
                },
                goLobby: function() {
                    // UX ƒ∞Yƒ∞LE≈ûTƒ∞RME: Geri d√∂n - kullanƒ±cƒ± varsa takƒ±m se√ßim ekranƒ±na, yoksa nickname ekranƒ±na
                    if (currentUser) {
                        // Kullanƒ±cƒ± giri≈ü yapmƒ±≈ü - takƒ±m se√ßim ekranƒ±na git (logout yapma)
                        showPage('pgLobby');
                        updateCurrentUserDisplay();
                    } else {
                        // Kullanƒ±cƒ± giri≈ü yapmamƒ±≈ü - nickname ekranƒ±na git
                        showPage('pgNickname');
                        updateCurrentUserDisplay();
                    }
                },
                exitGame: function() {
                    // Oyundan √ßƒ±kƒ±≈ü - logout yap
                    if (confirm('Oyundan √ßƒ±kmak istediƒüinize emin misiniz?')) {
                        currentUser = null;
                        currentTeamId = null;

                        // Server'a logout isteƒüi g√∂nder (session'ƒ± temizle)
                        socket.emit('logout-user', function() {
                            // Nick giri≈ü sayfasƒ±na y√∂nlendir
                            showPage('pgNickname');
                            updateCurrentUserDisplay();
                            toast('√áƒ±kƒ±≈ü yapƒ±ldƒ±.');
                        });
                    }
                },
                showScoreboard: function() { showPage('pgScoreboard'); renderScoreboard(); },
                showNotifications: function() { showPage('pgNotifications'); NOTIF.render(); },
                showCreditDetail: function(creditId) {
                    var credit = credits.find(c => c.id === creditId);
                    if (!credit) {
                        toast('Ki≈üi bulunamadƒ±', true);
                        return;
                    }

                    document.getElementById('creditDetailName').textContent = credit.name;
                    var contentEl = document.getElementById('creditDetailContent');

                    if (credit.content && credit.content.trim() !== '') {
                        contentEl.textContent = credit.content;
                    } else {
                        contentEl.innerHTML = '<div style="color:#666; text-align:center; padding:40px; font-style:italic;">Bu ki≈üi hakkƒ±nda hen√ºz bilgi eklenmemi≈ü.</div>';
                    }

                    showPage('pgCreditDetail');
                },
                resetGame: function() {
                    if (confirm('T√úM veriler silinecek. Emin misiniz?')) {
                        socket.emit('reset-game', function(res) { toast('Oyun sƒ±fƒ±rlandƒ±'); });
                    }
                }
            };

            // Bƒ∞LDƒ∞Rƒ∞M Sƒ∞STEMƒ∞
            window.NOTIF = {
                add: function(title, message, type) {
                    var notif = {
                        id: Date.now() + Math.random(),
                        title: title,
                        message: message,
                        type: type || 'info', // 'score', 'announcement', 'info'
                        time: new Date().toLocaleString('tr-TR'),
                        unread: true
                    };
                    notifications.unshift(notif);
                    if (notifications.length > 50) notifications = notifications.slice(0, 50); // Max 50 bildirim
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.showPopup(notif, type);
                },

                showPopup: function(notif, type) {
                    document.getElementById('popupTitle').textContent = notif.title;
                    document.getElementById('popupBody').textContent = notif.message;
                    document.getElementById('popupTime').textContent = notif.time;

                    var popup = document.getElementById('notificationPopup');

                    // √ñnceki tip class'larƒ±nƒ± temizle
                    popup.classList.remove('announcement', 'clue', 'score');

                    // Yeni tip class'ƒ±nƒ± ekle
                    if (type) {
                        popup.classList.add(type);
                    }

                    popup.classList.add('show');

                    if (popupTimeout) clearTimeout(popupTimeout);
                    popupTimeout = setTimeout(function() {
                        popup.classList.remove('show');
                    }, 6000);
                },

                closePopup: function() {
                    document.getElementById('notificationPopup').classList.remove('show');
                    if (popupTimeout) clearTimeout(popupTimeout);
                },

                updateBadge: function() {
                    var unreadCount = notifications.filter(n => n.unread).length;
                    var badge = document.getElementById('notifBadgeLobby');
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                },

                markAllRead: function() {
                    notifications.forEach(n => n.unread = false);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                },

                clearAll: function() {
                    notifications = [];
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                    this.renderAdminList();
                },

                deleteById: function(notifId) {
                    notifications = notifications.filter(n => n.id !== notifId);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                    this.renderAdminList();
                },

                render: function() {
                    var container = document.getElementById('notifList');
                    document.getElementById('notifCount').textContent = notifications.length;

                    if (notifications.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:60px; color:#666;">Hen√ºz bildirim yok</div>';
                        return;
                    }

                    // Bildirimleri okundu i≈üaretle (sayfa a√ßƒ±ldƒ±ƒüƒ±nda)
                    notifications.forEach(n => n.unread = false);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();

                    var html = '';
                    notifications.forEach(n => {
                        var icon = 'üì¢';
                        if (n.type === 'score') icon = 'üéØ';
                        else if (n.type === 'announcement') icon = 'üì¢';

                        html += `
                        <div class="notif-item ${n.unread ? 'unread' : ''}">
                            <div class="notif-item-header">
                                <div class="notif-item-title">${icon} ${htmlEscape(n.title)}</div>
                                <div class="notif-item-time">${n.time}</div>
                            </div>
                            <div class="notif-item-body">${htmlEscape(n.message)}</div>
                        </div>`;
                    });
                    container.innerHTML = html;
                },

                renderAdminList: function() {
                    var container = document.getElementById('adminNotifList');
                    var countEl = document.getElementById('adminNotifCount');

                    if (!container) return; // Y√∂netici panelinde deƒüilsek √ßƒ±k

                    countEl.textContent = notifications.length + ' bildirim';

                    if (notifications.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:40px; color:#555; font-size:13px;">Hen√ºz bildirim yok</div>';
                        return;
                    }

                    var html = '';
                    notifications.forEach(function(n) {
                        var typeClass = n.type === 'announcement' ? 'announcement' : 'score';
                        var typeText = n.type === 'announcement' ? 'Duyuru' : 'Puan';

                        // G√úVENLƒ∞K: XSS korumasƒ± - n.message escape et
                        html += `
                        <div class="admin-notif-item">
                            <div class="admin-notif-content">
                                <span class="admin-notif-type ${typeClass}">${typeText}</span>
                                <div class="admin-notif-message">${htmlEscape(n.message)}</div>
                                <div class="admin-notif-time">${htmlEscape(n.time)}</div>
                            </div>
                            <button class="admin-notif-delete" onclick="ADMIN.deleteNotification(${n.id})">üóëÔ∏è Sil</button>
                        </div>`;
                    });
                    container.innerHTML = html;
                }
            };

            // Y√ñNETƒ∞Cƒ∞ FONKSƒ∞YONLARI
            window.ADMIN = {
                currentSection: 'game',

                showSection: function(section) {
                    // T√ºm b√∂l√ºmleri gizle
                    document.querySelectorAll('.admin-section').forEach(function(el) {
                        el.style.display = 'none';
                    });

                    // Se√ßili b√∂l√ºm√º g√∂ster
                    document.getElementById('adminSection' + section.charAt(0).toUpperCase() + section.slice(1)).style.display = 'block';

                    // Men√º butonlarƒ±nƒ± g√ºncelle
                    var buttons = document.querySelectorAll('#pgAdmin > div:nth-child(2) button');
                    buttons.forEach(function(btn) {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn');
                    });

                    // Se√ßili butonu vurgula
                    if (section === 'game') buttons[0].classList.add('btn-primary');
                    else if (section === 'users') buttons[1].classList.add('btn-primary');
                    else if (section === 'scoring') buttons[2].classList.add('btn-primary');
                    else if (section === 'notifications') buttons[3].classList.add('btn-primary');
                    else if (section === 'credits') buttons[4].classList.add('btn-primary');
                    else if (section === 'iplogs') buttons[5].classList.add('btn-primary');

                    this.currentSection = section;

                    // Kullanƒ±cƒ±lar b√∂l√ºm√º a√ßƒ±ldƒ±ysa listeyi render et
                    if (section === 'users') {
                        // Manuel olarak kullanƒ±cƒ±larƒ± server'dan √ßek
                        if (socketConnected) {
                            socket.emit('get-users-by-team', function(fetchedUsers) {
                                users = fetchedUsers;
                                renderUsersList();
                            });
                        } else {
                            renderUsersList();
                        }
                    }

                    // Emeƒüi ge√ßenler b√∂l√ºm√º a√ßƒ±ldƒ±ysa listeyi render et
                    if (section === 'credits') {
                        renderCreditsList();
                    }

                    // IP Loglarƒ± b√∂l√ºm√º a√ßƒ±ldƒ±ysa varsayƒ±lan tab'ƒ± g√∂ster
                    if (section === 'iplogs') {
                        IP_SECTION.showTab('logs');
                    }
                },

                sendGeneralClue: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    var text = document.getElementById('generalClueText').value.trim();
                    if (!text) {
                        toast('ƒ∞pucu metni giriniz', true);
                        return;
                    }
                    if (confirm('Bu ipucu t√ºm takƒ±mlara g√∂nderilecek. Emin misiniz?')) {
                        if (isProcessing) return;
                        isProcessing = true;

                        socket.emit('send-general-clue', text, function(res) {
                            isProcessing = false;
                            if (res.success) {
                                document.getElementById('generalClueText').value = '';
                                toast('ƒ∞pucu g√∂nderildi');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                sendAnnouncement: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    var text = document.getElementById('announcementText').value.trim();
                    if (!text) {
                        toast('Duyuru metni giriniz', true);
                        return;
                    }
                    if (confirm('Bu duyuru t√ºm takƒ±mlara g√∂nderilecek. Emin misiniz?')) {
                        if (isProcessing) return;
                        isProcessing = true;

                        socket.emit('send-announcement', text, function(res) {
                            isProcessing = false;
                            if (res.success) {
                                document.getElementById('announcementText').value = '';
                                toast('Duyuru g√∂nderildi');
                                // Bildirim listesini g√ºncelle
                                setTimeout(function() {
                                    NOTIF.renderAdminList();
                                }, 500);
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                clearAllNotifications: function() {
                    if (confirm('T√úM bildirimleri silmek istediƒüinize emin misiniz? Bu i≈ülem geri alƒ±namaz.')) {
                        NOTIF.clearAll();
                        toast('T√ºm bildirimler silindi');
                    }
                },

                deleteNotification: function(notifId) {
                    if (confirm('Bu bildirimi silmek istediƒüinize emin misiniz?')) {
                        NOTIF.deleteById(notifId);
                        toast('Bildirim silindi');
                    }
                },

                startGame: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    var minutes = parseInt(document.getElementById('gameMinutes').value);
                    var title = document.getElementById('gameTitle').value.trim();

                    if (!minutes || minutes <= 0) {
                        toast('Ge√ßerli bir s√ºre giriniz!', true);
                        return;
                    }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('start-game', { minutes: minutes, title: title }, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            toast('Oyun ba≈ülatƒ±ldƒ±!');
                            document.getElementById('gameMinutes').value = '';
                            document.getElementById('gameTitle').value = '';
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                addTime: function(seconds) {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('add-time', seconds, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            var mins = Math.floor(seconds / 60);
                            toast(mins + ' dakika eklendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                endGame: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    if (confirm('Oyunu bitirmek istediƒüinize emin misiniz?')) {
                        if (isProcessing) return;
                        isProcessing = true;

                        socket.emit('end-game', function(res) {
                            isProcessing = false;
                            if (res.success) {
                                toast('Oyun bitirildi!');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                updateCountdownDisplay: function() {
                    var display = document.getElementById('adminCountdown');
                    if (display) {
                        display.textContent = formatTime(gameState.countdown);
                        if (gameState.countdown < 60) {
                            display.classList.add('warning');
                        } else {
                            display.classList.remove('warning');
                        }
                    }

                    var titleDisplay = document.getElementById('adminPhaseTitle');
                    if (titleDisplay && gameState.phaseTitle) {
                        titleDisplay.textContent = gameState.phaseTitle;
                    }
                },

                addCredit: function() {
                    var input = document.getElementById('creditNameInput');
                    var name = input.value.trim();

                    if (!name) {
                        toast('ƒ∞sim giriniz', true);
                        return;
                    }

                    socket.emit('add-credit', name, function(res) {
                        if (res.success) {
                            input.value = '';
                            toast('ƒ∞sim eklendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                removeCredit: function(creditId, name) {
                    if (confirm('"' + name + '" isimli ki≈üiyi listeden silmek istediƒüinize emin misiniz?')) {
                        socket.emit('remove-credit', creditId, function(res) {
                            if (res.success) {
                                toast('ƒ∞sim silindi');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                updateCreditContent: function(creditId) {
                    var textarea = document.getElementById('creditContent_' + creditId);
                    if (!textarea) return;

                    var content = textarea.value.trim();

                    socket.emit('update-credit-content', {
                        creditId: creditId,
                        content: content
                    }, function(res) {
                        if (res.success) {
                            toast('ƒ∞√ßerik g√ºncellendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                }
            };

            // IP SECTION FONKSƒ∞YONLARI (Tab Y√∂netimi)
            window.IP_SECTION = {
                currentTab: 'logs',

                showTab: function(tab) {
                    // Tab i√ßeriklerini gizle/g√∂ster
                    document.getElementById('ipTabContentLogs').style.display = tab === 'logs' ? 'block' : 'none';
                    document.getElementById('ipTabContentUsers').style.display = tab === 'users' ? 'block' : 'none';

                    // Tab butonlarƒ±nƒ± g√ºncelle
                    var logsBtn = document.getElementById('ipTabLogs');
                    var usersBtn = document.getElementById('ipTabUsers');

                    logsBtn.classList.remove('btn-primary');
                    logsBtn.classList.add('btn');
                    usersBtn.classList.remove('btn-primary');
                    usersBtn.classList.add('btn');

                    if (tab === 'logs') {
                        logsBtn.classList.remove('btn');
                        logsBtn.classList.add('btn-primary');
                        IP_LOGS.loadLogs();
                    } else if (tab === 'users') {
                        usersBtn.classList.remove('btn');
                        usersBtn.classList.add('btn-primary');
                        IP_USERS.loadAllUsers();
                    }

                    this.currentTab = tab;
                }
            };

            // IP LOGS FONKSƒ∞YONLARI
            window.IP_LOGS = {
                logs: [],

                loadLogs: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    socket.emit('get-ip-logs', function(res) {
                        if (res.success) {
                            IP_LOGS.logs = res.logs;
                            IP_LOGS.render();
                            toast('Loglar y√ºklendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                render: function() {
                    var container = document.getElementById('ipLogsList');
                    var countEl = document.getElementById('ipLogsCount');

                    if (!container) return;

                    countEl.textContent = this.logs.length + ' kayƒ±t';

                    if (this.logs.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:30px;">Son 24 saatte aktivite yok</div>';
                        return;
                    }

                    var html = '';
                    this.logs.forEach(function(log) {
                        var actionText = log.action === 'register-user' ? 'Kullanƒ±cƒ± Kaydƒ±' : 'Takƒ±m Olu≈üturma';
                        var actionColor = log.action === 'register-user' ? '#3b82f6' : '#8b5cf6';
                        var maxCount = log.action === 'register-user' ? 3 : 2;
                        var isNearLimit = parseInt(log.count) >= maxCount;
                        var date = new Date(log.last_activity);
                        var timeStr = date.toLocaleString('tr-TR', {
                            day: '2-digit',
                            month: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });

                        // G√úVENLƒ∞K: onclick i√ßin JavaScript string escape
                        var safeIP = log.ip_address.replace(/'/g, "\\'").replace(/"/g, '\\"');
                        var safeAction = log.action.replace(/'/g, "\\'").replace(/"/g, '\\"');

                        html += `
                        <div style="background:#1a1a1a; border:1px solid ${isNearLimit ? '#ff4444' : '#333'}; border-radius:8px; padding:15px;">
                            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:10px;">
                                <div style="flex:1;">
                                    <div style="color:#fff; font-weight:600; margin-bottom:5px;">
                                        ${htmlEscape(log.ip_address)}
                                    </div>
                                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:5px;">
                                        <span style="background:${actionColor}; color:#fff; padding:4px 8px; border-radius:4px; font-size:11px; font-weight:600;">
                                            ${actionText}
                                        </span>
                                        <span style="color:${isNearLimit ? '#ff4444' : '#888'}; font-size:13px; font-weight:600;">
                                            ${log.count} / ${maxCount} ${isNearLimit ? '‚ö†Ô∏è' : ''}
                                        </span>
                                    </div>
                                    <div style="color:#666; font-size:12px;">
                                        Son: ${timeStr}
                                    </div>
                                </div>
                                <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:12px; ${isNearLimit ? 'background:#ff9800; border-color:#ff9800; color:#000; font-weight:600;' : ''}"
                                    onclick="IP_LOGS.clearSpecific('${safeIP}', '${safeAction}')"
                                    title="Bu IP'nin ${actionText} hakkƒ±nƒ± sƒ±fƒ±rla">
                                    ${isNearLimit ? 'üîÑ Limiti Sƒ±fƒ±rla' : 'üóëÔ∏è Sƒ±fƒ±rla'}
                                </button>
                            </div>
                        </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                clearSpecific: function(ipAddress, action) {
                    var actionText = action === 'register-user' ? 'Kullanƒ±cƒ± Kaydƒ±' : 'Takƒ±m Olu≈üturma';
                    if (!confirm(`${ipAddress} IP'sinin "${actionText}" logunu sƒ±fƒ±rlamak istediƒüinize emin misiniz?`)) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    socket.emit('clear-ip-logs', { ipAddress: ipAddress, action: action }, function(res) {
                        if (res.success) {
                            toast('Log sƒ±fƒ±rlandƒ±: ' + res.deletedCount + ' kayƒ±t silindi');
                            IP_LOGS.loadLogs();
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                clearAll: function() {
                    if (!confirm('T√úM IP loglarƒ±nƒ± sƒ±fƒ±rlamak istediƒüinize emin misiniz? Bu i≈ülem geri alƒ±namaz!')) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    socket.emit('clear-ip-logs', {}, function(res) {
                        if (res.success) {
                            toast('T√ºm loglar sƒ±fƒ±rlandƒ±: ' + res.deletedCount + ' kayƒ±t silindi');
                            IP_LOGS.loadLogs();
                        } else {
                            toast(res.error, true);
                        }
                    });
                }
            };

            // IP USERS FONKSƒ∞YONLARI (Kullanƒ±cƒ± Kayƒ±tlarƒ±)
            window.IP_USERS = {
                users: [],

                loadAllUsers: function() {
                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    socket.emit('get-all-users', function(res) {
                        if (res.success) {
                            IP_USERS.users = res.users;
                            IP_USERS.render();
                            toast('Kullanƒ±cƒ±lar y√ºklendi: ' + res.users.length + ' kayƒ±t');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                render: function() {
                    var container = document.getElementById('ipUsersList');
                    var countEl = document.getElementById('ipUsersCount');

                    if (!container) return;

                    countEl.textContent = this.users.length + ' kullanƒ±cƒ±';

                    if (this.users.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:30px;">Hen√ºz kayƒ±tlƒ± kullanƒ±cƒ± yok</div>';
                        return;
                    }

                    var html = '';
                    this.users.forEach(function(user) {
                        var onlineStatus = user.online ? 'üü¢ Online' : '‚ö´ Offline';
                        var onlineColor = user.online ? '#10b981' : '#666';
                        var date = new Date(user.created_at);
                        var timeStr = date.toLocaleString('tr-TR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });

                        var teamInfo = user.team_name ? `<span style="color:#8b5cf6;">üë• Takƒ±m: ${htmlEscape(user.team_name)}</span>` : '<span style="color:#666;">Takƒ±msƒ±z</span>';

                        // G√úVENLƒ∞K: onclick i√ßin JavaScript string escape
                        var safeNickname = user.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');

                        html += `
                        <div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:15px;">
                            <div style="display:flex; justify-content:space-between; align-items:start;">
                                <div style="flex:1;">
                                    <div style="color:#fff; font-weight:600; font-size:16px; margin-bottom:8px;">
                                        ${htmlEscape(user.nickname)}
                                    </div>
                                    <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:8px;">
                                        <span style="color:${onlineColor}; font-size:12px;">${onlineStatus}</span>
                                        ${teamInfo}
                                    </div>
                                    <div style="color:#666; font-size:12px;">
                                        üìÖ Kayƒ±t: ${timeStr}
                                    </div>
                                    <div style="color:#888; font-size:11px; margin-top:5px;">
                                        üåê IP: ${htmlEscape(user.ip_address)} ‚Ä¢ ID: ${user.id}
                                    </div>
                                </div>
                                <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:12px; background:#dc2626; border-color:#dc2626; color:#fff;"
                                    onclick="IP_USERS.deleteUser('${user.id}', '${safeNickname}')"
                                    title="Bu kullanƒ±cƒ±yƒ± sil">
                                    üóëÔ∏è Sil
                                </button>
                            </div>
                        </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                deleteUser: function(userId, nickname) {
                    if (!confirm(`"${nickname}" kullanƒ±cƒ±sƒ±nƒ± silmek istediƒüinize emin misiniz?\n\nBu i≈ülem geri alƒ±namaz ve ba≈üka biri bu nickname ile kaydolabilir.`)) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    socket.emit('delete-user', userId, function(res) {
                        if (res.success) {
                            toast('Kullanƒ±cƒ± silindi: ' + res.user.nickname + ' - Nickname artƒ±k kullanƒ±ma a√ßƒ±k!');

                            // Listeden √ßƒ±kar
                            IP_USERS.users = IP_USERS.users.filter(u => u.id !== userId);
                            IP_USERS.render();
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                deleteAll: function() {
                    if (this.users.length === 0) {
                        toast('Silinecek kullanƒ±cƒ± yok', true);
                        return;
                    }

                    if (!confirm(`T√úM KULLANICILAR Sƒ∞Lƒ∞NECEK! (${this.users.length} kullanƒ±cƒ±)\n\nBu i≈ülem geri alƒ±namaz ve t√ºm nickname'ler serbest kalacak.\n\nEmin misiniz?`)) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('Baƒülantƒ± kuruluyor, l√ºtfen bekleyin...', true);
                        return;
                    }

                    socket.emit('delete-all-users', function(res) {
                        if (res.success) {
                            toast('T√ºm kullanƒ±cƒ±lar silindi: ' + res.deletedCount + ' kayƒ±t');
                            IP_USERS.users = [];
                            IP_USERS.render();
                        } else {
                            toast(res.error, true);
                        }
                    });
                }
            };

            // RENDER FONKSƒ∞YONLARI

            function renderJoinList() {
                var c = document.getElementById('joinList');
                if (teams.length === 0) { c.innerHTML = '<div style="text-align:center;color:#666;padding:20px;">Aktif takƒ±m yok</div>'; return; }
                var html = '';
                teams.forEach(t => {
                    var safeName = htmlEscape(t.name);
                    html += `<div class="team-opt" data-id="${t.id}" data-name="${safeName}" onclick="GAME.selectJoin(this)">
                        <div style="font-weight:bold;color:#fff;">${safeName}</div>
                        <div style="font-size:12px;color:#666;">Puan: ${t.score}</div>
                    </div>`;
                });
                c.innerHTML = html;
            }

            function renderTeamPage(team) {
                document.getElementById('dispTeamName').textContent = team.name;

                // Takƒ±m bilgileri kartƒ±nƒ± g√ºncelle
                document.getElementById('teamInfoName').textContent = team.name;
                document.getElementById('teamInfoScore').textContent = team.score;

                document.getElementById('clueCnt').textContent = '(' + team.clues.length + ')';
                var list = document.getElementById('myClueList');
                if (team.clues.length === 0) {
                    list.innerHTML = '<div style="color:#444;text-align:center;padding:20px;">Hen√ºz ipucu girilmedi.</div>';
                } else {
                    var html = '';
                    // Tersten sƒ±rala (en yeni en √ºstte)
                    for (var i = team.clues.length - 1; i >= 0; i--) {
                        html += `<div style="padding:10px; border-bottom:1px solid #222; color:#ccc;">${htmlEscape(team.clues[i].text)}</div>`;
                    }
                    list.innerHTML = html;
                }

                // Countdown'u render et
                renderTeamCountdown();

                // Genel ipu√ßlarƒ±nƒ± render et
                renderGeneralClues();
            }

            function renderGeneralClues() {
                var container = document.getElementById('adminCluesSection');
                var list = document.getElementById('adminCluesList');
                var emptyEl = document.getElementById('adminCluesEmpty');
                var countEl = document.getElementById('adminCluesCount');

                if (!container || !list) return;

                // Sayƒ±yƒ± g√ºncelle
                if (countEl) countEl.textContent = generalClues.length;

                if (generalClues.length === 0) {
                    container.style.display = 'none';
                    if (list) list.style.display = 'none';
                    if (emptyEl) emptyEl.style.display = 'block';
                } else {
                    container.style.display = 'block';
                    if (list) list.style.display = 'flex';
                    if (emptyEl) emptyEl.style.display = 'none';

                    var html = '';
                    // Tersten sƒ±rala (en yeni en √ºstte)
                    for (var i = generalClues.length - 1; i >= 0; i--) {
                        var clue = generalClues[i];
                        html += `
                            <div style="
                                background: rgba(139,0,0,0.15);
                                border: 1px solid rgba(139,0,0,0.3);
                                border-left: 4px solid var(--accent);
                                border-radius: 8px;
                                padding: 14px;
                                animation: slideIn 0.3s ease;
                            ">
                                <div style="color: var(--text-main); font-size: 14px; line-height: 1.5; margin-bottom: 6px;">
                                    ${htmlEscape(clue.text)}
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; color: #666; font-size: 11px;">
                                    <span>‚è∞</span>
                                    <span>${clue.time}</span>
                                </div>
                            </div>
                        `;
                    }
                    list.innerHTML = html;
                }
            }

            function renderTeamCountdown() {
                var container = document.getElementById('teamCountdownSection');
                if (!container) return;

                if (!gameState.started) {
                    container.innerHTML = '<div class="game-not-started">‚è∏Ô∏è Oyun hen√ºz ba≈ülamadƒ±. L√ºtfen bekleyiniz...</div>';
                } else {
                    var timeClass = gameState.countdown < 60 ? 'warning' : '';
                    var phaseHtml = gameState.phaseTitle ? `<div class="team-countdown-phase">${gameState.phaseTitle}</div>` : '';
                    container.innerHTML = `
                    <div class="team-countdown">
                        ${phaseHtml}
                        <div class="team-countdown-label">Kalan S√ºre</div>
                        <div class="team-countdown-time ${timeClass}" id="teamCountdown">${formatTime(gameState.countdown)}</div>
                    </div>`;
                }
            }

            // --- YENƒ∞LENMƒ∞≈û ADMIN KART RENDER ---
            function renderAdminList() {
                // ƒ∞statistikleri g√ºncelle
                document.getElementById('statTeams').textContent = teams.length;
                var totalClues = teams.reduce((acc, t) => acc + t.clues.length, 0);
                document.getElementById('statClues').textContent = totalClues;

                // Bildirim listesini de render et
                NOTIF.renderAdminList();

                var container = document.getElementById('adminList');
                if (teams.length === 0) {
                    container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; color:#444;">Hen√ºz takƒ±m yok.</div>';
                    document.getElementById('chartContent').innerHTML = '';
                    return;
                }

                // Sƒ±ralama YAPMA - created_at sƒ±rasƒ±nda kalsƒ±n
                var sorted = teams.slice(); // Orijinal sƒ±rayƒ± koru

                // Grafik i√ßin puana g√∂re sƒ±ralƒ± versiyonu olu≈ütur
                var sortedForChart = teams.slice().sort((a, b) => b.score - a.score);
                renderScoreChart(sortedForChart);

                var html = '';
                sorted.forEach((t, index) => {
                    var safeName = t.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    var safeNameHTML = htmlEscape(t.name);
                    var rankClass = '';
                    // Rank i√ßin ger√ßek sƒ±rayƒ± hesapla
                    var realRank = sortedForChart.findIndex(st => st.id === t.id) + 1;
                    if (realRank === 1 && t.score > 0) rankClass = 'g';
                    else if (realRank === 2 && t.score > 0) rankClass = 's';
                    else if (realRank === 3 && t.score > 0) rankClass = 'b';

                    // Kart HTML Yapƒ±sƒ± - Takƒ±m rengi ile
                    html += `
                    <div class="admin-card" id="card_${t.id}" style="border-left: 4px solid ${t.color || '#3b82f6'}">
                        <div class="card-header" style="background: linear-gradient(135deg, ${t.color || '#3b82f6'}15, transparent)">
                            <div class="team-identity">
                                <div class="rank-badge ${rankClass}">${realRank}</div>
                                <div class="team-name" style="color: ${t.color || '#3b82f6'}">${safeNameHTML}</div>
                            </div>
                            <div class="team-score" id="score_${t.id}">${t.score}</div>
                        </div>
                        <div class="card-body">
                            <div class="controls-section">
                                <button class="ctrl-btn btn-p10" onclick="adminScore('${t.id}', 10, '${safeName}')">+10</button>
                                <button class="ctrl-btn btn-p5" onclick="adminScore('${t.id}', 5, '${safeName}')">+5</button>
                                <button class="ctrl-btn btn-m5" onclick="adminScore('${t.id}', -5, '${safeName}')">-5</button>
                                <button class="ctrl-btn btn-m10" onclick="adminScore('${t.id}', -10, '${safeName}')">-10</button>
                            </div>

                            <div class="clues-section" id="clues_${t.id}">
                                <div class="clues-title">ƒ∞PU√áLARI (${t.clues.length})</div>
                                ${ t.clues.length === 0
                                    ? '<div class="no-clues">ƒ∞pucu yok</div>'
                                    : t.clues.map(c =>
                                        `<div class="clue-item">${htmlEscape(c.text)}<div class="clue-time">${c.time}</div><div style="clear:both"></div></div>`
                                      ).join('')
                                }
                            </div>

                            <button class="delete-btn" onclick="adminDel('${t.id}', '${safeName}')">Takƒ±mƒ± Sil</button>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
            }

            function renderScoreChart(sortedTeams) {
                var maxScore = Math.max(...sortedTeams.map(t => t.score));
                if (maxScore <= 0) maxScore = 1;

                var html = '';
                sortedTeams.forEach(t => {
                    var pct = Math.max(0, (t.score / maxScore) * 100);
                    var teamColor = t.color || '#3b82f6';
                    html += `
                    <div class="chart-bar">
                        <div class="chart-label" style="color: ${teamColor}">${htmlEscape(t.name)}</div>
                        <div class="chart-track">
                            <div class="chart-fill" style="width: ${pct}%; background: ${teamColor}"></div>
                        </div>
                        <div class="chart-val">${t.score}</div>
                    </div>`;
                });
                document.getElementById('chartContent').innerHTML = html;
            }

            function renderUsersList() {
                var container = document.getElementById('usersList');
                if (users.length === 0) {
                    container.innerHTML = '<div style="text-align:center; padding:40px; color:#666;">Hen√ºz kullanƒ±cƒ± yok.</div>';
                    return;
                }

                // Takƒ±mlara g√∂re grupla
                var usersWithTeam = users.filter(u => u.team_id);
                var usersWithoutTeam = users.filter(u => !u.team_id);

                // Takƒ±mlara g√∂re grupla
                var teamGroups = {};
                usersWithTeam.forEach(u => {
                    if (!teamGroups[u.team_id]) {
                        teamGroups[u.team_id] = {
                            teamName: u.team_name,
                            teamColor: u.team_color || '#3b82f6',
                            users: []
                        };
                    }
                    teamGroups[u.team_id].users.push(u);
                });

                var html = '';

                // Takƒ±mlƒ± kullanƒ±cƒ±lar
                Object.keys(teamGroups).forEach(teamId => {
                    var group = teamGroups[teamId];
                    html += `
                        <div style="background: #1a1a1a; border-left: 4px solid ${group.teamColor}; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: ${group.teamColor}; margin: 0 0 15px 0; font-size: 18px;">
                                ${htmlEscape(group.teamName)}
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${group.users.map(u => {
                                    // G√úVENLƒ∞K: onclick i√ßin JavaScript string escape (htmlEscape yetersiz)
                                    var safeNick = u.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');
                                    return `
                                    <div style="background: #222; padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                        ${u.is_captain ? '<span style="font-size: 20px;">üëë</span>' : '<span style="font-size: 20px;">üë§</span>'}
                                        <span style="color: white; font-weight: ${u.is_captain ? 'bold' : 'normal'}; flex: 1;">
                                            ${htmlEscape(u.nickname)}
                                        </span>
                                        ${u.is_captain ? '<span style="color: #fbbf24; font-size: 12px;">(Kaptan)</span>' : ''}
                                        <button onclick="adminDeleteUser('${u.id}', '${safeNick}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-left: 10px;">
                                            üóëÔ∏è Sil
                                        </button>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    `;
                });

                // Takƒ±msƒ±z kullanƒ±cƒ±lar
                if (usersWithoutTeam.length > 0) {
                    html += `
                        <div style="background: #1a1a1a; border-left: 4px solid #666; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #999; margin: 0 0 15px 0; font-size: 18px;">
                                Takƒ±msƒ±z Kullanƒ±cƒ±lar
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${usersWithoutTeam.map(u => {
                                    // G√úVENLƒ∞K: onclick i√ßin JavaScript string escape (htmlEscape yetersiz)
                                    var safeNick = u.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');
                                    return `
                                    <div style="background: #222; padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 20px;">üë§</span>
                                        <span style="color: white; flex: 1;">${htmlEscape(u.nickname)}</span>
                                        <button onclick="adminDeleteUser('${u.id}', '${safeNick}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                            üóëÔ∏è Sil
                                        </button>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    `;
                }

                container.innerHTML = html;
            }

            function renderScoreboard() {
                var c = document.getElementById('scoreboardList');
                if (teams.length === 0) {
                    c.innerHTML = '<div style="text-align:center; color:#666; padding:40px;">Hen√ºz takƒ±m yok</div>';
                    return;
                }

                var sorted = teams.slice().sort((a, b) => b.score - a.score);
                var html = '';

                sorted.forEach((t, i) => {
                    var rankClass = i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : i === 2 ? 'rank-3' : '';
                    var medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : (i + 1);
                    var clueCount = Array.isArray(t.clues) ? t.clues.length : 0;

                    html += `
                    <div class="leaderboard-item ${rankClass}" style="animation-delay: ${i * 0.1}s">
                        <div class="leaderboard-left">
                            <div class="leaderboard-rank">${medal}</div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${htmlEscape(t.name)}</div>
                                <div class="leaderboard-stats">${clueCount} ipucu g√∂nderildi</div>
                            </div>
                        </div>
                        <div class="leaderboard-score">${t.score}</div>
                    </div>`;
                });

                c.innerHTML = html;
            }

            // Sadece skor deƒüi≈ütiƒüinde (performans i√ßin)
            function updateScoresOnly() {
                // Grafiƒüi yeniden √ßiz
                var sorted = teams.slice().sort((a, b) => b.score - a.score);
                renderScoreChart(sorted);

                // Kartlardaki sayƒ±larƒ± g√ºncelle
                teams.forEach(t => {
                    var el = document.getElementById('score_' + t.id);
                    if (el) el.textContent = t.score;
                });
            }

            // Emeƒüi ge√ßenler listesini render et (Admin Paneli)
            function renderCreditsList() {
                var container = document.getElementById('creditsList');
                var countEl = document.getElementById('creditsCount');

                if (!container || !countEl) return;

                countEl.textContent = credits.length + ' ki≈üi';

                if (credits.length === 0) {
                    container.innerHTML = '<div style="color:#666; text-align:center; padding:40px; width:100%;">Hen√ºz kimse eklenmemi≈ü</div>';
                    return;
                }

                var html = '';
                credits.forEach(function(credit) {
                    var safeName = credit.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    var safeNameHTML = htmlEscape(credit.name);
                    html += `
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:15px; transition:0.2s;">
                        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                            <span style="color:var(--gold); font-size:15px; font-weight:600;">${safeNameHTML}</span>
                            <button onclick="ADMIN.removeCredit('${credit.id}', '${safeName}')" style="background:transparent; border:1px solid #500; color:#faa; padding:4px 10px; border-radius:4px; font-size:11px; cursor:pointer; transition:0.2s;" onmouseover="this.style.background='rgba(139,0,0,0.2)'" onmouseout="this.style.background='transparent'">üóëÔ∏è Sil</button>
                        </div>
                        <div style="margin-bottom:8px;">
                            <label style="color:#888; font-size:11px; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; display:block;">Katkƒ±larƒ±</label>
                            <textarea id="creditContent_${credit.id}" placeholder="Bu ki≈üinin katkƒ±larƒ±nƒ± yazƒ±n..." maxlength="1000" style="width:100%; min-height:80px; background:#0a0a0a; border:1px solid #333; border-radius:6px; color:#fff; padding:10px; font-family:inherit; resize:vertical; font-size:13px; line-height:1.6;">${credit.content || ''}</textarea>
                        </div>
                        <button onclick="ADMIN.updateCreditContent('${credit.id}')" class="btn btn-primary" style="width:100%; padding:8px; margin:0; font-size:12px;">üíæ ƒ∞√ßeriƒüi Kaydet</button>
                    </div>`;
                });
                container.innerHTML = html;
            }

            // Ana sayfa emeƒüi ge√ßenler listesini render et
            function renderMainCredits() {
                var nicknameContainer = document.getElementById('nicknameCreditsList');
                var lobbyContainer = document.getElementById('lobbyCreditsList');

                var html = '';
                if (credits.length === 0) {
                    html = '<div class="credit-item">-</div>';
                } else {
                    credits.forEach(function(credit) {
                        html += `<div class="credit-item" onclick="GAME.showCreditDetail('${credit.id}')">${htmlEscape(credit.name)}</div>`;
                    });
                }

                // Her iki listeyi de g√ºncelle
                if (nicknameContainer) nicknameContainer.innerHTML = html;
                if (lobbyContainer) lobbyContainer.innerHTML = html;
            }

            // Socket Listeners
            socket.on('credits-update', function(newCredits) {
                credits = newCredits;
                renderMainCredits();
                renderCreditsList();
            });

            socket.on('teams-update', function(newTeams) {
                var oldLen = teams.length;
                teams = newTeams;
                
                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    // Takƒ±m sayƒ±sƒ± deƒüi≈ütiyse full render, deƒüi≈ümediyse sadece skor g√ºncelle (titremeyi √∂nlemek i√ßin)
                    if (oldLen !== teams.length) renderAdminList();
                    else {
                        // ƒ∞pucu sayƒ±sƒ± deƒüi≈ümi≈ü mi kontrol et
                        // Basitlik i√ßin full render yapabiliriz ama UX i√ßin ayrƒ±≈ütƒ±rmak iyidir.
                        // ≈ûimdilik temiz olmasƒ± i√ßin full render yapalƒ±m, grid yapƒ±sƒ± stabil zaten.
                        renderAdminList(); 
                    }
                }
                
                if (document.getElementById('pgScoreboard').classList.contains('active')) renderScoreboard();
                if (document.getElementById('joinForm').style.display === 'block') renderJoinList();
                
                if (currentTeamId) {
                    var myTeam = teams.find(t => t.id === currentTeamId);
                    if (myTeam) renderTeamPage(myTeam);
                }
            });

            socket.on('users-update', function(newUsers) {
                users = newUsers;

                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    // Admin panelinde users section a√ßƒ±ksa render et
                    if (document.getElementById('adminSectionUsers').style.display !== 'none') {
                        renderUsersList();
                    }
                }
            });

            socket.on('team-deleted', function(id) {
                if (currentTeamId === id) {
                    currentTeamId = null;
                    showPage('pgLobby');
                    toast('Takƒ±m silindi', true);
                }
            });

            socket.on('game-reset', function() {
                // Admin panelindeyse atma
                var isInAdminPanel = document.getElementById('pgAdmin').classList.contains('active');
                if (!isInAdminPanel) {
                    currentTeamId = null;
                    showPage('pgLobby');
                }
            });

            // Bildirim Eventi
            socket.on('notification', function(data) {
                NOTIF.add(data.title, data.message, data.type);
            });

            // Puan deƒüi≈üikliƒüi bildirimi
            socket.on('score-changed', function(data) {
                var msg = data.teamName + ' takƒ±mƒ± ' + (data.amount > 0 ? '+' : '') + data.amount + ' puan aldƒ±. Yeni puan: ' + data.newScore;
                NOTIF.add('Puan Deƒüi≈üikliƒüi', msg, 'score');
            });

            // Y√∂netici ipu√ßlarƒ± listesi g√ºncellendi
            socket.on('general-clues-update', function(clues) {
                generalClues = clues;

                // Takƒ±m sayfasƒ±ndaysa render et
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    renderGeneralClues();
                }
            });

            // Yeni y√∂netici ipucu bildirimi
            socket.on('general-clue-notification', function(data) {
                // Bildirim g√∂ster
                NOTIFICATION.show('Y√∂netici ƒ∞pucu', data.clue, data.time);

                // Takƒ±m sayfasƒ±ndaysa render et (biraz gecikme ile, veritabanƒ±ndan gelmesini bekle)
                setTimeout(function() {
                    if (document.getElementById('pgTeam').classList.contains('active')) {
                        renderGeneralClues();
                    }
                }, 100);
            });

            // Oyun durumu g√ºncellemesi
            socket.on('game-state-update', function(state) {
                gameState.started = state.started;
                gameState.countdown = state.countdown;
                gameState.phaseTitle = state.phaseTitle || '';

                // Admin panelindeyse g√∂r√ºn√ºm√º g√ºncelle
                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    if (gameState.started) {
                        document.getElementById('gameStartSection').style.display = 'none';
                        document.getElementById('gameRunningSection').style.display = 'block';
                        ADMIN.updateCountdownDisplay();
                    } else {
                        document.getElementById('gameStartSection').style.display = 'block';
                        document.getElementById('gameRunningSection').style.display = 'none';
                    }
                }

                // Takƒ±m sayfasƒ±ndaysa countdown'u g√ºncelle
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    renderTeamCountdown();
                }
            });

            // Oyun ba≈ülatƒ±ldƒ±
            socket.on('game-started', function(data) {
                gameState.started = true;
                gameState.countdown = data.countdown;
                gameState.phaseTitle = data.phaseTitle || '';

                // Admin paneli g√ºncelle
                document.getElementById('gameStartSection').style.display = 'none';
                document.getElementById('gameRunningSection').style.display = 'block';
                ADMIN.updateCountdownDisplay();

                // Takƒ±m sayfasƒ± g√ºncelle
                renderTeamCountdown();

                toast('Oyun ba≈üladƒ±!');
            });

            // Countdown g√ºncellendi
            socket.on('countdown-update', function(countdown) {
                gameState.countdown = countdown;

                // Admin countdown g√ºncelle
                ADMIN.updateCountdownDisplay();

                // Takƒ±m countdown g√ºncelle
                var teamDisplay = document.getElementById('teamCountdown');
                if (teamDisplay) {
                    teamDisplay.textContent = formatTime(countdown);
                    if (countdown < 60) {
                        teamDisplay.classList.add('warning');
                    } else {
                        teamDisplay.classList.remove('warning');
                    }
                }
            });

            // Oyun bitti
            socket.on('game-ended', function() {
                gameState.started = false;
                gameState.countdown = 0;
                gameState.phaseTitle = '';

                // Admin paneli g√ºncelle
                document.getElementById('gameStartSection').style.display = 'block';
                document.getElementById('gameRunningSection').style.display = 'none';

                // Takƒ±m sayfasƒ± g√ºncelle
                renderTeamCountdown();

                toast('Oyun bitti!');
            });

            // Kullanƒ±cƒ± silindi (admin tarafƒ±ndan)
            socket.on('user-deleted', function() {
                // G√úVENLƒ∞K: Session temizliƒüi
                currentUser = null;
                currentTeamId = null;

                // Nick giri≈ü sayfasƒ±na y√∂nlendir
                showPage('pgNickname');
                updateCurrentUserDisplay();
                toast('Hesabƒ±nƒ±z y√∂netici tarafƒ±ndan silindi.', true);
            });

            // Server kapatƒ±lƒ±yor (deployment/g√ºncelleme)
            socket.on('server-shutdown', function(data) {
                toast('Sunucu g√ºncelleniyor... Sayfa 3 saniye sonra yenilenecek.', false);
                setTimeout(function() {
                    window.location.reload();
                }, 3000);
            });

            // Init
            window.onload = function() {
                // UX ƒ∞Yƒ∞LE≈ûTƒ∞RME: Her zaman temiz bir ba≈ülangƒ±√ß
                currentUser = null;
                currentTeamId = null;
                pageHistory = [];

                NOTIF.updateBadge(); // Bildirim badge'ini g√ºncelle
                renderMainCredits(); // Ana sayfa emeƒüi ge√ßenler listesini render et
                updateCurrentUserDisplay(); // Kullanƒ±cƒ± bilgisi display'ini g√ºncelle

                // UX ƒ∞Yƒ∞LE≈ûTƒ∞RME: Her zaman nickname sayfasƒ±nda ba≈üla
                showPage('pgNickname', false);
            };
        })();
    </script>
</body>
</html>