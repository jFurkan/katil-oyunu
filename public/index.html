<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Katil Kim? - YÃ¶netici Paneli</title>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/router.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Tema 1: Classic Dark (Default) */
        :root {
            --bg-color: #050505;
            --card-bg: #111111;
            --border-color: #222;
            --accent: #8B0000; /* Kan KÄ±rmÄ±zÄ±sÄ± */
            --gold: #D4AF37;
            --text-main: #e0e0e0;
            --text-muted: #888;
            --success: #2d5a27;
        }

        /* Tema 2: Midnight Detective */
        [data-theme="midnight"] {
            --bg-color: #0a0e1a;
            --card-bg: #141b2d;
            --border-color: #1e2a45;
            --accent: #5b7c99;
            --gold: #ffd700;
            --text-main: #e8eef7;
            --text-muted: #7a8ba3;
            --success: #2d5a27;
        }

        /* Tema 3: Blood Moon */
        [data-theme="blood"] {
            --bg-color: #0d0404;
            --card-bg: #1a0a0a;
            --border-color: #2d0f0f;
            --accent: #b91c1c;
            --gold: #ff6b6b;
            --text-main: #f5e6e6;
            --text-muted: #9a6b6b;
            --success: #2d5a27;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        body { font-family: 'Inter', sans-serif; background: var(--bg-color); color: var(--text-main); min-height: 100vh; font-size: 14px; }
        
        /* Genel YapÄ± */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header & BaÅŸlÄ±klar */
        header {
            text-align: center;
            padding: 40px 0;
            position: relative;
        }
        h1 {
            font-size: 42px;
            letter-spacing: -1px;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #fff, #ccc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 3s ease-in-out infinite;
        }
        @keyframes titleGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.3)); }
            50% { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.5)); }
        }
        h1 span {
            background: linear-gradient(135deg, var(--accent), #c00000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: accentGlow 3s ease-in-out infinite;
        }
        @keyframes accentGlow {
            0%, 100% { filter: drop-shadow(0 0 10px rgba(139, 0, 0, 0.5)); }
            50% { filter: drop-shadow(0 0 20px rgba(139, 0, 0, 0.8)); }
        }
        .subtitle {
            color: var(--text-muted);
            font-style: italic;
            font-size: 14px;
        }

        /* Sayfa GeÃ§iÅŸleri */
        .page { display: none; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Butonlar (Global) */
        .btn {
            width: 100%;
            padding: 16px;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-main);
            font-size: 15px;
            cursor: pointer;
            margin-bottom: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        .btn:hover {
            border-color: var(--accent);
            background: #1a1a1a;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 0, 0, 0.3);
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #a00000);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 2px 8px rgba(139, 0, 0, 0.3);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #a00000, #c00000);
            box-shadow: 0 6px 16px rgba(139, 0, 0, 0.5);
            transform: translateY(-3px);
        }
        
        /* Form AlanlarÄ± */
        .form-box {
            background: linear-gradient(135deg, var(--card-bg), #0a0a0a);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }
        input {
            width: 100%;
            padding: 14px;
            background: #000;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
            outline: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        input:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1), 0 0 15px rgba(212, 175, 55, 0.2);
            transform: translateY(-1px);
        }
        input:hover {
            border-color: #333;
        }

        /* --- YENÄ°LENEN ADMIN PANEL TASARIMI --- */
        
        /* Admin Header */
        .admin-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .back-btn { padding: 8px 16px; background: #222; border: none; border-radius: 6px; color: #fff; cursor: pointer; font-size: 13px; }
        .back-btn:hover { background: #333; }

        /* Admin Grid - YANYANA KUTULAR Ä°Ã‡Ä°N KRÄ°TÄ°K KISIM */
        .admin-list { 
            display: grid; 
            /* En az 320px geniÅŸliÄŸinde, ekrana sÄ±ÄŸdÄ±ÄŸÄ± kadar yan yana dizersin */
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); 
            gap: 20px; 
            margin-bottom: 40px;
        }

        /* Admin KartÄ± (YenilenmiÅŸ UX) */
        .admin-card {
            background: linear-gradient(135deg, var(--card-bg), #0a0a0a);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .admin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .admin-card:hover {
            border-color: #444;
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6), 0 0 20px rgba(212, 175, 55, 0.1);
            transform: translateY(-5px) scale(1.02);
        }
        .admin-card:hover::before {
            opacity: 1;
        }

        /* Kart Ãœst KÄ±sÄ±m */
        .card-header { 
            padding: 15px; 
            background: linear-gradient(to bottom, #1a1a1a, #111); 
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .team-identity { display: flex; align-items: center; gap: 10px; }
        .rank-badge { 
            width: 28px; height: 28px; border-radius: 50%; 
            background: #222; color: #888; 
            display: flex; align-items: center; justify-content: center; 
            font-weight: bold; font-size: 12px;
        }
        .rank-badge.g { background: var(--gold); color: black; box-shadow: 0 0 10px rgba(212, 175, 55, 0.3); }
        .rank-badge.s { background: #C0C0C0; color: black; }
        .rank-badge.b { background: #cd7f32; color: black; }
        
        .team-name { font-weight: 600; font-size: 16px; color: #fff; }
        .team-score { font-size: 24px; font-weight: 700; color: var(--gold); letter-spacing: -1px; }

        /* Kart Ä°Ã§erik */
        .card-body { padding: 15px; flex: 1; display: flex; flex-direction: column; gap: 15px; }

        /* Ä°puÃ§larÄ± AlanÄ± */
        .clues-section { flex: 1; min-height: 100px; max-height: 150px; overflow-y: auto; background: #080808; border-radius: 6px; padding: 8px; border: 1px solid #222; }
        .clues-title { font-size: 11px; text-transform: uppercase; color: #666; margin-bottom: 6px; letter-spacing: 1px; font-weight: 600; }
        .clue-item { font-size: 13px; padding: 6px 8px; border-left: 2px solid var(--gold); background: #111; margin-bottom: 4px; border-radius: 0 4px 4px 0; color: #ccc; }
        .clue-time { float: right; font-size: 10px; color: #555; margin-top: 2px; }
        .no-clues { color: #444; font-style: italic; text-align: center; padding-top: 30px; font-size: 12px; }

        /* Kontrol ButonlarÄ± (Grid Layout) */
        .controls-section { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px; }
        .ctrl-btn { 
            padding: 8px 0; border: none; border-radius: 4px; 
            font-weight: bold; font-size: 13px; cursor: pointer; color: white; transition: opacity 0.2s;
        }
        .ctrl-btn:hover { opacity: 0.8; }
        .btn-p10 { background: #2d5a27; }
        .btn-p5 { background: #3d6b36; }
        .btn-m5 { background: #964B00; }
        .btn-m10 { background: var(--accent); }
        
        .delete-btn { 
            margin-top: 10px; width: 100%; background: transparent; border: 1px dashed #444; color: #666; 
            padding: 8px; font-size: 11px; border-radius: 4px; cursor: pointer; 
        }
        .delete-btn:hover { border-color: var(--accent); color: var(--accent); }

        /* Ä°statistikler GrafiÄŸi */
        .stats-chart { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 25px; }
        .chart-bar { display: flex; align-items: center; gap: 15px; margin-bottom: 12px; }
        .chart-label { width: 100px; font-size: 13px; text-align: right; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #aaa; }
        .chart-track { flex: 1; height: 12px; background: #222; border-radius: 6px; overflow: hidden; }
        .chart-fill { height: 100%; background: linear-gradient(90deg, #c9a227, #f0e6d3); border-radius: 6px; width: 0%; transition: width 0.5s cubic-bezier(0.1, 0.7, 1.0, 0.1); }
        .chart-val { width: 30px; font-weight: bold; color: var(--gold); font-size: 13px; }

        /* DiÄŸer Sayfalar iÃ§in Ufak DÃ¼zeltmeler */
        .team-list { display: flex; flex-direction: column; gap: 8px; }
        .team-opt { padding: 15px; background: #161616; border: 1px solid #333; border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .team-opt:hover, .team-opt.sel { border-color: var(--accent); background: #1f1f1f; }
        
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal.show { display: flex; }
        .modal-box { background: #111; border: 1px solid #333; padding: 30px; border-radius: 16px; width: 90%; max-width: 350px; text-align: center; }

        #toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translate(-50%, 50px);
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            color: #fff;
            padding: 14px 28px;
            border-radius: 50px;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 9999;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6), 0 0 20px rgba(255, 255, 255, 0.05);
            font-weight: 500;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }
        #toast.show {
            transform: translate(-50%, 0);
            opacity: 1;
        }
        #toast.err {
            background: linear-gradient(135deg, var(--accent), #a00000);
            box-shadow: 0 8px 30px rgba(139, 0, 0, 0.6), 0 0 20px rgba(139, 0, 0, 0.3);
            border-color: rgba(255, 100, 100, 0.3);
        }

        /* Bildirim Sistemi - Genel Popup */
        .notification-popup { position: fixed; top: 20px; right: 20px; border-radius: 12px; padding: 20px; min-width: 320px; max-width: 400px; z-index: 10000; transform: translateX(500px); opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .notification-popup.show { transform: translateX(0); opacity: 1; }

        /* Duyuru Popup (KÄ±rmÄ±zÄ±msÄ±) */
        .notification-popup.announcement { background: linear-gradient(135deg, #1a0a0a, #0f0505); border: 2px solid var(--accent); box-shadow: 0 10px 40px rgba(139,0,0,0.5); }
        .notification-popup.announcement .notif-header { border-bottom: 1px solid #300; }
        .notification-popup.announcement .notif-title { color: #ff6666; }
        .notification-popup.announcement .notif-body { color: #ffcccc; }

        /* Ä°pucu Popup (YeÅŸilimsi/AltÄ±n) */
        .notification-popup.clue { background: linear-gradient(135deg, #0a1a0a, #050f05); border: 2px solid var(--gold); box-shadow: 0 10px 40px rgba(212,175,55,0.5); }
        .notification-popup.clue .notif-header { border-bottom: 1px solid #2a4a2a; }
        .notification-popup.clue .notif-title { color: var(--gold); }
        .notification-popup.clue .notif-body { color: #d4e6cc; }

        /* Puan DeÄŸiÅŸikliÄŸi Popup (Mavi tonlarÄ±) */
        .notification-popup.score { background: linear-gradient(135deg, #0a0a1a, #05050f); border: 2px solid #4a90e2; box-shadow: 0 10px 40px rgba(74,144,226,0.4); }
        .notification-popup.score .notif-header { border-bottom: 1px solid #1a2a4a; }
        .notification-popup.score .notif-title { color: #6ab0ff; }
        .notification-popup.score .notif-body { color: #cce0ff; }

        .notif-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; padding-bottom: 10px; }
        .notif-title { font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .notif-close { background: transparent; border: none; color: #666; font-size: 20px; cursor: pointer; padding: 0; width: 24px; height: 24px; }
        .notif-close:hover { color: #fff; }
        .notif-body { font-size: 14px; line-height: 1.6; }
        .notif-time { font-size: 11px; color: #555; margin-top: 10px; text-align: right; }
        .notif-badge { position: fixed; top: 20px; right: 30px; background: var(--accent); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; z-index: 9998; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* Bildirimler SayfasÄ± */
        .notif-list { display: flex; flex-direction: column; gap: 12px; }
        .notif-item { background: var(--card-bg); border: 1px solid var(--border-color); border-left: 4px solid var(--gold); border-radius: 8px; padding: 15px; transition: 0.2s; }
        .notif-item:hover { border-color: var(--gold); background: #161616; }
        .notif-item.unread { background: rgba(212,175,55,0.05); }
        .notif-item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .notif-item-title { font-weight: 600; color: var(--gold); font-size: 13px; }
        .notif-item-time { font-size: 11px; color: #666; }
        .notif-item-body { color: #aaa; font-size: 13px; line-height: 1.5; }

        /* Duyuru Formu */
        .announcement-form { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .announcement-form textarea { width: 100%; min-height: 80px; background: #000; border: 1px solid var(--border-color); border-radius: 6px; color: white; padding: 12px; font-family: inherit; resize: vertical; margin-bottom: 10px; }
        .announcement-form textarea:focus { outline: none; border-color: var(--gold); }

        /* Admin Bildirim Listesi */
        .admin-notif-item { background: #0a0a0a; border: 1px solid #222; border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: flex-start; gap: 12px; transition: 0.2s; }
        .admin-notif-item:hover { border-color: #333; background: #111; }
        .admin-notif-content { flex: 1; }
        .admin-notif-type { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; margin-bottom: 6px; }
        .admin-notif-type.announcement { background: rgba(212,175,55,0.2); color: var(--gold); }
        .admin-notif-type.score { background: rgba(139,0,0,0.2); color: #ff6666; }
        .admin-notif-message { color: #ccc; font-size: 13px; line-height: 1.4; margin-bottom: 4px; }
        .admin-notif-time { color: #555; font-size: 11px; }
        .admin-notif-delete { background: transparent; border: 1px solid #333; color: #666; padding: 6px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: 0.2s; white-space: nowrap; }
        .admin-notif-delete:hover { border-color: var(--accent); color: var(--accent); background: rgba(139,0,0,0.1); }

        /* Oyun Kontrol Paneli */
        .game-control { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .countdown-display { font-size: 48px; font-weight: 700; text-align: center; color: var(--gold); margin: 20px 0; font-family: 'Courier New', monospace; letter-spacing: 3px; }
        .countdown-display.warning { color: #ff6666; animation: pulse-red 1s infinite; }
        @keyframes pulse-red { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .time-controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .time-btn { padding: 10px; font-size: 13px; font-weight: 600; border-radius: 6px; border: 1px solid; cursor: pointer; transition: 0.2s; }
        .time-btn.add { background: rgba(45,90,39,0.3); border-color: #2d5a27; color: #6fb566; }
        .time-btn.add:hover { background: #2d5a27; }
        .time-btn.end { background: rgba(139,0,0,0.3); border-color: var(--accent); color: #ff6666; }
        .time-btn.end:hover { background: var(--accent); color: white; }

        /* TakÄ±m SayfasÄ± Countdown */
        .team-countdown { background: linear-gradient(135deg, #1a1a1a, #0a0a0a); border: 2px solid var(--gold); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center; }
        .team-countdown-phase { font-size: 18px; color: var(--gold); text-transform: uppercase; letter-spacing: 3px; margin-bottom: 15px; font-weight: 600; }
        .team-countdown-label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; }
        .team-countdown-time { font-size: 56px; font-weight: 700; color: var(--gold); font-family: 'Courier New', monospace; letter-spacing: 5px; }
        .team-countdown-time.warning { color: #ff6666; }
        .game-not-started { color: #666; font-size: 14px; padding: 30px; text-align: center; font-style: italic; }

        /* Admin Countdown Phase */
        .admin-phase-title { text-align: center; color: var(--gold); font-size: 16px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px; font-weight: 600; }

        /* EmeÄŸi GeÃ§enler BÃ¶lÃ¼mÃ¼ */
        .credits { margin-top: 60px; padding: 30px 20px; border-top: 1px solid var(--border-color); text-align: center; }
        .credits h3 { font-size: 14px; text-transform: uppercase; letter-spacing: 2px; color: var(--gold); margin-bottom: 15px; font-weight: 600; }
        .credits-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 15px; }
        .credit-item { background: var(--card-bg); border: 1px solid var(--border-color); padding: 8px 16px; border-radius: 8px; font-size: 13px; color: var(--text-main); transition: all 0.2s; cursor: pointer; }
        .credit-item:hover { border-color: var(--gold); transform: translateY(-2px); background: #1a1a1a; }
        .credit-item:active { transform: translateY(0); }
        .credits-note { margin-top: 20px; font-size: 11px; color: var(--text-muted); font-style: italic; }

        /* Liderlik Tablosu Stilleri */
        .leaderboard-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: slideIn 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .leaderboard-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--border-color);
            transition: all 0.3s;
        }
        .leaderboard-item:hover { transform: translateX(8px); border-color: #444; box-shadow: 0 8px 20px rgba(0,0,0,0.4); }
        .leaderboard-item:hover::before { background: var(--gold); }
        .leaderboard-item.rank-1 { border-color: var(--gold); background: linear-gradient(135deg, #1a1410, #111); }
        .leaderboard-item.rank-1::before { background: var(--gold); width: 6px; }
        .leaderboard-item.rank-2 { border-color: #C0C0C0; }
        .leaderboard-item.rank-2::before { background: #C0C0C0; }
        .leaderboard-item.rank-3 { border-color: #cd7f32; }
        .leaderboard-item.rank-3::before { background: #cd7f32; }

        .leaderboard-left { display: flex; align-items: center; gap: 15px; }
        .leaderboard-rank {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1a1a1a;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #666;
            transition: all 0.3s;
        }
        .leaderboard-item.rank-1 .leaderboard-rank {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            animation: pulse-gold 2s infinite;
        }
        .leaderboard-item.rank-2 .leaderboard-rank { background: #C0C0C0; color: #000; border-color: #C0C0C0; }
        .leaderboard-item.rank-3 .leaderboard-rank { background: #cd7f32; color: #000; border-color: #cd7f32; }

        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 20px rgba(212, 175, 55, 0.4); }
            50% { box-shadow: 0 0 30px rgba(212, 175, 55, 0.7); }
        }

        .leaderboard-info { display: flex; flex-direction: column; gap: 4px; }
        .leaderboard-name { font-size: 18px; font-weight: 600; color: #fff; }
        .leaderboard-item.rank-1 .leaderboard-name { color: var(--gold); }
        .leaderboard-stats { font-size: 12px; color: #888; }

        .leaderboard-score {
            font-size: 32px;
            font-weight: 700;
            color: #fff;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }
        .leaderboard-item.rank-1 .leaderboard-score { color: var(--gold); }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MÃ¼zik AyarlarÄ± Butonu */
        .music-settings-btn {
            position: fixed;
            bottom: 95px;
            right: 30px;
            z-index: 1000;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .music-settings-btn:hover {
            transform: scale(1.1);
            border-color: var(--gold);
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        }

        /* DÃ¼rtme ModallarÄ± */
        .poke-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        .poke-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        .poke-modal {
            background: linear-gradient(135deg, #1a1a1a, #0d0d0d);
            border: 3px solid #d44dd4;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 50px rgba(212,77,212,0.4);
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .poke-notification {
            background: linear-gradient(135deg, #4d1a4d, #331033);
            border: 4px solid #d44dd4;
            border-radius: 25px;
            padding: 50px;
            max-width: 600px;
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 60px rgba(212,77,212,0.6);
            animation: shake 0.6s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px) rotate(-2deg); }
            20%, 40%, 60%, 80% { transform: translateX(10px) rotate(2deg); }
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        .poke-team-item {
            background: #0a0a0a;
            border: 2px solid #333;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }
        .poke-team-item:hover {
            border-color: #d44dd4;
            background: rgba(212,77,212,0.1);
            transform: translateX(5px);
        }
        .poke-team-item.disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .poke-team-item.disabled:hover {
            border-color: #333;
            background: #0a0a0a;
            transform: translateX(0);
        }

        /* Tema SeÃ§ici */
        .theme-switcher {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 1000;
        }
        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .theme-btn:hover {
            transform: scale(1.1) rotate(15deg);
            border-color: var(--gold);
            box-shadow: 0 6px 20px rgba(0,0,0,0.5);
        }
        .theme-menu {
            position: absolute;
            bottom: 65px;
            right: 0;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 10px;
            display: none;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            animation: slideUp 0.3s ease;
        }
        .theme-menu.active { display: flex; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .theme-option {
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
            white-space: nowrap;
        }
        .theme-option:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--gold);
            transform: translateX(-5px);
        }
        .theme-option.active {
            background: var(--accent);
            border-color: var(--accent);
        }
        .theme-preview {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #fff;
        }
        .theme-preview.classic { background: linear-gradient(135deg, #050505, #8B0000); }
        .theme-preview.midnight { background: linear-gradient(135deg, #0a0e1a, #5b7c99); }
        .theme-preview.blood { background: linear-gradient(135deg, #0d0404, #b91c1c); }

        /* ===== RESPONSIVE DESIGN ===== */

        /* Tablet - Orta Ekranlar (768px - 1024px) */
        @media (max-width: 1024px) {
            .container {
                max-width: 100%;
                padding: 15px;
            }

            h1 {
                font-size: 36px;
            }

            .admin-list {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 15px;
            }

            .form-box {
                max-width: 100%;
                padding: 20px;
            }
        }

        /* Mobile - KÃ¼Ã§Ã¼k Ekranlar (<768px) */
        @media (max-width: 768px) {
            /* Genel YapÄ± */
            body {
                font-size: 14px;
            }

            .container {
                padding: 10px;
            }

            /* Header */
            header {
                padding: 20px 0;
            }

            h1 {
                font-size: 28px;
                letter-spacing: -0.5px;
            }

            .subtitle {
                font-size: 13px;
            }

            /* Butonlar - Daha bÃ¼yÃ¼k dokunma alanÄ± */
            .btn {
                padding: 14px;
                font-size: 14px;
                margin-bottom: 10px;
            }

            /* Form AlanlarÄ± */
            .form-box {
                padding: 18px;
                margin-top: 15px;
            }

            input {
                padding: 12px;
                font-size: 16px; /* iOS zoom'u Ã¶nlemek iÃ§in minimum 16px */
                margin-bottom: 12px;
            }

            /* Admin Grid - Tek sÃ¼tun */
            .admin-list {
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 30px;
            }

            /* Admin KartÄ± */
            .admin-card {
                padding: 15px;
            }

            .card-head h3 {
                font-size: 16px;
            }

            .card-meta {
                font-size: 11px;
            }

            .team-score {
                font-size: 22px;
            }

            .clues-list {
                gap: 8px;
            }

            .clue-item {
                padding: 10px;
                font-size: 13px;
            }

            /* Admin Header */
            .admin-head {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .back-btn {
                width: 100%;
                padding: 12px;
            }

            /* Liderlik Tablosu */
            .leaderboard-item {
                padding: 15px;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .leaderboard-left {
                width: 100%;
            }

            .leaderboard-rank {
                font-size: 20px;
                width: 35px;
                height: 35px;
            }

            .leaderboard-name {
                font-size: 15px;
            }

            .leaderboard-stats {
                font-size: 11px;
            }

            .leaderboard-score {
                font-size: 24px;
                align-self: flex-end;
                width: 100%;
                text-align: right;
            }

            /* MÃ¼zik AyarlarÄ± Butonu - Mobil iÃ§in optimize */
            .music-settings-btn {
                bottom: 75px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 20px;
            }

            /* Tema SeÃ§ici - Mobil iÃ§in optimize */
            .theme-switcher {
                bottom: 15px;
                right: 15px;
            }

            .theme-btn {
                width: 50px;
                height: 50px;
                font-size: 22px;
            }

            .theme-menu {
                bottom: 60px;
                right: 0;
                min-width: 200px;
            }

            .theme-option {
                padding: 10px 15px;
                font-size: 13px;
            }

            .theme-preview {
                width: 18px;
                height: 18px;
            }

            /* Modal & Popups */
            .error-modal,
            .success-modal {
                max-width: 90%;
                padding: 20px;
            }

            /* Admin MesajlarÄ± - Dropdown geniÅŸliÄŸi */
            #adminMessagesTeamSelector,
            #adminChatTeamSelector {
                max-width: 100% !important;
            }

            /* Chat Ä°zleme - Padding dÃ¼zeltmesi */
            #adminChatViewerContainer > div {
                padding: 15px !important;
            }

            /* TakÄ±m Chatbox - Padding ve boyut dÃ¼zeltmeleri */
            #teamChatMessages {
                max-height: 300px !important;
                min-height: 200px !important;
            }

            /* Mesaj input alanlarÄ± - Mobil optimizasyon */
            #adminReplyMessage,
            #inpClue {
                font-size: 16px !important; /* iOS zoom Ã¶nleme */
            }

            /* Dropdown menÃ¼ler */
            #teamDropdown {
                min-width: 100% !important;
                max-width: 100% !important;
            }

            /* TakÄ±m seÃ§ici button */
            #btnTeamSelector {
                width: 100%;
                max-width: 100%;
            }

            /* MÃ¼zik kontrol butonu - Mobil */
            #musicToggle {
                width: 50px !important;
                height: 50px !important;
                font-size: 20px !important;
                bottom: 70px !important;
                right: 15px !important;
            }
        }

        /* Ã‡ok KÃ¼Ã§Ã¼k Mobil Cihazlar (<480px) */
        @media (max-width: 480px) {
            h1 {
                font-size: 24px;
            }

            .btn {
                padding: 12px;
                font-size: 13px;
            }

            .admin-card {
                padding: 12px;
            }

            .card-head h3 {
                font-size: 15px;
            }

            .team-score {
                font-size: 20px;
            }

            .leaderboard-rank {
                font-size: 18px;
                width: 32px;
                height: 32px;
            }

            .leaderboard-name {
                font-size: 14px;
            }

            .leaderboard-score {
                font-size: 22px;
            }

            .theme-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }

            .theme-menu {
                min-width: 180px;
            }

            /* Chatbox mesaj alanlarÄ± - Daha kÃ¼Ã§Ã¼k */
            #teamChatMessages {
                max-height: 250px !important;
                min-height: 180px !important;
                padding: 12px !important;
            }

            #adminMessagesContainer {
                padding: 12px !important;
            }

            /* Mesaj gÃ¶nderme alanÄ± - Flex dÃ¼zeni */
            #adminMessagesViewerContainer div[style*="display: flex; gap: 10px"] {
                flex-direction: column !important;
            }

            #adminMessagesViewerContainer div[style*="display: flex; gap: 10px"] button {
                width: 100% !important;
                margin-top: 8px !important;
            }
        }

        /* Yatay Mod (Landscape) iÃ§in optimizasyonlar */
        @media (max-height: 600px) and (orientation: landscape) {
            header {
                padding: 15px 0;
            }

            h1 {
                font-size: 24px;
                margin-bottom: 5px;
            }

            .form-box {
                margin-top: 10px;
                padding: 15px;
            }

            input {
                padding: 10px;
                margin-bottom: 10px;
            }

            .btn {
                padding: 10px;
                margin-bottom: 8px;
            }
        }

        /* Mobil Yatay (Landscape) Mod - KapsamlÄ± Optimizasyonlar */
        @media (max-height: 700px) and (orientation: landscape) {
            /* Murder Board Canvas - yatayda daha kÄ±sa yap */
            #murderBoardCanvas {
                min-height: 350px !important;
            }

            /* Murder Board Wrapper - yatayda daha kÄ±sa */
            #murderBoardWrapper {
                max-height: 400px !important;
            }

            /* Modal'lar - yatayda ekrana sÄ±ÄŸsÄ±n */
            #characterSelectorModal > div,
            #editNoteModal > div {
                max-height: 70vh !important;
                padding: 15px !important;
            }

            #characterSelectorModal h3,
            #editNoteModal h3 {
                font-size: 16px !important;
                margin-bottom: 10px !important;
            }

            #characterNote,
            #editNoteTextarea {
                min-height: 60px !important;
            }

            /* Header - daha kompakt */
            header {
                padding: 10px 0 !important;
            }

            h1 {
                font-size: 20px !important;
                margin-bottom: 5px !important;
            }

            h2 {
                font-size: 18px !important;
            }

            h3 {
                font-size: 16px !important;
            }

            /* Form box - daha kompakt */
            .form-box {
                margin-top: 10px !important;
                padding: 12px !important;
            }

            /* Buttons - daha kÃ¼Ã§Ã¼k padding */
            .btn {
                padding: 8px 12px !important;
                font-size: 13px !important;
                margin-bottom: 6px !important;
            }

            /* Input fields - daha kÃ¼Ã§Ã¼k */
            input,
            textarea,
            select {
                padding: 8px !important;
                margin-bottom: 8px !important;
                font-size: 13px !important;
            }

            /* Team sayfasÄ± - daha kompakt */
            .team-info {
                padding: 12px !important;
            }

            .team-info h2 {
                font-size: 18px !important;
            }

            /* TakÄ±m menÃ¼ butonlarÄ± - yatayda daha kÃ¼Ã§Ã¼k */
            .team-menu .btn {
                padding: 8px !important;
                font-size: 12px !important;
            }

            /* Admin panel - daha kompakt */
            .admin-head {
                padding: 12px !important;
            }

            .admin-section {
                padding: 12px !important;
                margin-bottom: 12px !important;
            }

            /* Lider tablosu - daha kompakt */
            .leaderboard-item {
                padding: 8px !important;
            }

            /* Chat container - yatayda daha kÄ±sa */
            #teamChatMessages,
            #interTeamChatMessages {
                max-height: 200px !important;
            }

            /* Zoom controls - daha kÃ¼Ã§Ã¼k */
            #zoomLevel {
                font-size: 11px !important;
            }

            /* Murder board toolbar - yatayda daha kompakt */
            #pgMurderBoard .btn {
                padding: 6px 10px !important;
                font-size: 12px !important;
            }

            /* Board items - karakterler daha kÃ¼Ã§Ã¼k */
            .board-item {
                transform: scale(0.9) !important;
            }

            /* Empty state - daha kÃ¼Ã§Ã¼k */
            #boardEmptyState div:first-child {
                font-size: 48px !important;
            }

            #boardEmptyState div:nth-child(2) {
                font-size: 14px !important;
            }

            #boardEmptyState div:nth-child(3) {
                font-size: 11px !important;
            }
        }

        /* Dokunmatik ekranlar iÃ§in hover devre dÄ±ÅŸÄ± */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover,
            .admin-card:hover,
            .theme-option:hover,
            .leaderboard-item:hover {
                transform: none;
            }

            /* Dokunma iÃ§in aktif efekt */
            .btn:active {
                transform: scale(0.98);
                opacity: 0.8;
            }

            .admin-card:active {
                transform: scale(0.99);
            }
        }

        /* ===== BÄ°LDÄ°RÄ°M SÄ°STEMÄ° ===== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
            pointer-events: none;
        }

        .notification {
            background: linear-gradient(135deg, #1a1a1a, #111);
            border: 2px solid var(--accent);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.8), 0 0 20px rgba(139,0,0,0.4);
            animation: slideInNotification 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            pointer-events: all;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
            animation: notificationGlow 2s ease-in-out infinite;
        }

        .notification.closing {
            animation: slideOutNotification 0.3s ease forwards;
        }

        @keyframes slideInNotification {
            from {
                transform: translateX(120%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutNotification {
            to {
                transform: translateX(120%);
                opacity: 0;
            }
        }

        @keyframes notificationGlow {
            0%, 100% { box-shadow: 0 0 5px var(--accent); }
            50% { box-shadow: 0 0 15px var(--accent); }
        }

        .notification-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .notification-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            color: var(--accent);
            font-size: 14px;
        }

        .notification-close {
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 18px;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .notification-close:hover {
            background: rgba(255,255,255,0.1);
            color: #fff;
        }

        .notification-body {
            color: var(--text-main);
            font-size: 13px;
            line-height: 1.5;
            padding-left: 8px;
        }

        .notification-time {
            color: #666;
            font-size: 11px;
            margin-top: 6px;
            padding-left: 8px;
        }

        /* Mobil iÃ§in bildirimler */
        @media (max-width: 768px) {
            .notification-container {
                top: 10px;
                right: 10px;
                left: 10px;
                max-width: none;
            }

            .notification {
                padding: 14px;
            }

            .notification-title {
                font-size: 13px;
            }

            .notification-body {
                font-size: 12px;
            }
        }

        /* ===== RENK SEÃ‡Ä°CÄ° ===== */
        .color-option {
            width: 100%;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px currentColor;
        }

        .color-option.selected {
            border-color: var(--gold);
            transform: scale(1.05);
            box-shadow: 0 0 20px currentColor;
        }

        /* Rozet CSS */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid;
            margin: 2px;
        }
    </style>
</head>
<body>
    <!-- Arka Plan MÃ¼ziÄŸi -->
    <audio id="bgMusic" loop>
        <source src="/audio/background.mp3" type="audio/mpeg">
    </audio>

    <!-- Bildirim Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <div class="container">
        <!-- Ana GiriÅŸ SayfasÄ± -->
        <div class="page active" id="pgNickname">
            <header>
                <h1>Katil <span>Kim?</span></h1>
                <p class="subtitle">"ÅžÃ¼phe, gerÃ§eÄŸin gÃ¶lgesidir..."</p>
            </header>

            <div style="max-width: 420px; margin: 40px auto;">
                <!-- Oyuncu GiriÅŸi -->
                <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 30px; margin-bottom: 20px;">
                    <h2 style="color: var(--gold); margin-bottom: 10px; font-size: 20px; text-align: center;">ðŸŽ­ Oyuncu GiriÅŸi</h2>
                    <p style="color: #999; margin-bottom: 25px; text-align: center; font-size: 14px;">Oyuna katÄ±lmak iÃ§in bir nick seÃ§in</p>

                    <input
                        type="text"
                        id="inpNickname"
                        placeholder="Nick giriniz..."
                        maxlength="20"
                        style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid var(--border-color); background: #000; color: white; border-radius: 8px; margin-bottom: 15px; transition: border-color 0.2s;"
                        onkeypress="if(event.key==='Enter') USER.registerNickname()"
                        onfocus="this.style.borderColor='var(--gold)'"
                        onblur="this.style.borderColor='var(--border-color)'"
                    />

                    <!-- Profil FotoÄŸrafÄ± YÃ¼kleme (Opsiyonel) -->
                    <div style="margin-bottom: 20px; padding: 15px; background: #1a1a1a; border: 1px solid #333; border-radius: 8px;">
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                            <span style="color: #ccc; font-size: 14px;">ðŸ“¸ Profil FotoÄŸrafÄ± (opsiyonel)</span>
                            <span id="photoOptionalLabel" style="color: #666; font-size: 12px;">Atlayabilirsiniz</span>
                        </div>

                        <!-- FotoÄŸraf Ã–nizleme -->
                        <div id="photoPreview" style="display: none; margin-bottom: 15px; text-align: center;">
                            <img id="photoPreviewImg" src="" alt="Ã–nizleme" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; border: 3px solid var(--gold);">
                            <div style="margin-top: 8px;">
                                <button class="btn" style="padding: 5px 15px; font-size: 12px; background: #ff4444;" onclick="USER.removeProfilePhoto()">âŒ KaldÄ±r</button>
                            </div>
                        </div>

                        <!-- YÃ¼kleme ButonlarÄ± -->
                        <div id="photoUploadButtons" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <button class="btn" style="padding: 10px; font-size: 13px; background: linear-gradient(135deg, #4a5568, #2d3748);" onclick="USER.openCamera()">
                                ðŸ“· Kamera
                            </button>
                            <label style="margin: 0;">
                                <input type="file" id="photoFileInput" accept="image/*" style="display: none;" onchange="USER.handleFileSelect(event)">
                                <button type="button" class="btn" style="width: 100%; padding: 10px; font-size: 13px; background: linear-gradient(135deg, #4a5568, #2d3748);" onclick="document.getElementById('photoFileInput').click()">
                                    ðŸ–¼ï¸ Galeri
                                </button>
                            </label>
                        </div>

                        <!-- Kamera Video (gizli, kamera aÃ§Ä±ldÄ±ÄŸÄ±nda gÃ¶sterilir) -->
                        <div id="cameraContainer" style="display: none; margin-top: 15px;">
                            <video id="cameraVideo" autoplay playsinline style="width: 100%; border-radius: 8px; background: #000;"></video>
                            <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                                <button class="btn" style="padding: 10px; font-size: 13px; background: linear-gradient(135deg, #059669, #047857);" onclick="USER.capturePhoto()">
                                    âœ… Ã‡ek
                                </button>
                                <button class="btn" style="padding: 10px; font-size: 13px; background: #ff4444;" onclick="USER.closeCamera()">
                                    âŒ Ä°ptal
                                </button>
                            </div>
                        </div>

                        <!-- Canvas for photo capture (gizli) -->
                        <canvas id="photoCanvas" style="display: none;"></canvas>
                    </div>

                    <button class="btn btn-primary" style="margin-bottom: 0;" onclick="USER.registerNickname()">ðŸŽ® Oyuna GiriÅŸ Yap</button>
                </div>

                <!-- YÃ¶netici GiriÅŸi -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 25px; text-align: center;">
                    <h3 style="color: #888; margin-bottom: 15px; font-size: 16px;">ðŸ”’ YÃ¶netici GiriÅŸi</h3>
                    <button class="btn" style="margin-bottom: 0; background: #222; border-color: #444; color: #aaa;" onclick="GAME.showAdminLoginForm()">YÃ¶netici Paneline Git</button>
                </div>
            </div>

            <!-- EmeÄŸi GeÃ§enler -->
            <div class="credits">
                <h3>EmeÄŸi GeÃ§enler</h3>
                <div class="credits-list" id="nicknameCreditsList"></div>
                <div class="credits-note">Bu oyun Katil Kim? dedektiflik oyunu iÃ§in geliÅŸtirilmiÅŸtir.</div>
            </div>
        </div>

        <div class="page" id="pgLobby">
            <header>
                <h1>Katil <span>Kim?</span></h1>
                <p class="subtitle">"ÅžÃ¼phe, gerÃ§eÄŸin gÃ¶lgesidir..."</p>
                <!-- Mevcut kullanÄ±cÄ± bilgisi -->
                <div id="currentUserInfo" style="margin-top: 15px;">
                    <div style="background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; display: inline-flex; align-items: center; gap: 10px;">
                        <span style="color: var(--text-muted); font-size: 13px;">GiriÅŸ yapÄ±ldÄ±:</span>
                        <span id="currentUserNick" style="color: var(--gold); font-weight: 600;"></span>
                        <button onclick="USER.logout()" style="background: transparent; border: 1px solid #444; color: #888; padding: 5px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; margin-left: 10px;">
                            Ã‡Ä±kÄ±ÅŸ Yap
                        </button>
                    </div>
                </div>
            </header>

            <!-- Oyuncu MenÃ¼sÃ¼ -->
            <div id="lobbyMenu" style="max-width: 400px; margin: 0 auto;">
                <button class="btn" onclick="GAME.showCreateForm()">ðŸŽ­ Yeni TakÄ±m OluÅŸtur</button>
                <button class="btn" onclick="GAME.showJoinForm()">ðŸ”‘ TakÄ±ma GiriÅŸ Yap</button>
                <button class="btn" onclick="GAME.showScoreboard()">ðŸ† Skor Tablosu</button>
                <button class="btn" onclick="GAME.showNotifications()">
                    ðŸ”” Bildirimler
                    <span id="notifBadgeLobby" style="display:none; background:var(--accent); color:white; border-radius:50%; width:20px; height:20px; font-size:11px; margin-left:auto;"></span>
                </button>
                <button class="btn" style="margin-top: 30px; color: #888; border-color: #333; font-size: 13px;" onclick="GAME.backToMain()">â† Ana Sayfaya DÃ¶n</button>
            </div>

            <!-- EmeÄŸi GeÃ§enler -->
            <div id="lobbyCredits" class="credits">
                <h3>EmeÄŸi GeÃ§enler</h3>
                <div class="credits-list" id="lobbyCreditsList"></div>
                <div class="credits-note">Bu oyun Katil Kim? dedektiflik oyunu iÃ§in geliÅŸtirilmiÅŸtir.</div>
            </div>

            <div class="form-box" id="createForm" style="display:none;">
                <h3 style="margin-bottom:15px; color:white;">Yeni TakÄ±m</h3>
                <input type="text" id="inpNewTeam" placeholder="TakÄ±m adÄ±..." maxlength="20">
                <input type="password" id="inpNewTeamPassword" placeholder="TakÄ±m ÅŸifresi..." maxlength="20">

                <!-- Renk SeÃ§imi -->
                <div style="margin: 15px 0;">
                    <label style="color: #888; font-size: 12px; margin-bottom: 8px; display: block;">TakÄ±m Rengi</label>
                    <div style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 8px;">
                        <div class="color-option" data-color="#3b82f6" style="background: #3b82f6;" onclick="CUSTOMIZE.selectColor('#3b82f6')"></div>
                        <div class="color-option" data-color="#ef4444" style="background: #ef4444;" onclick="CUSTOMIZE.selectColor('#ef4444')"></div>
                        <div class="color-option" data-color="#10b981" style="background: #10b981;" onclick="CUSTOMIZE.selectColor('#10b981')"></div>
                        <div class="color-option" data-color="#f59e0b" style="background: #f59e0b;" onclick="CUSTOMIZE.selectColor('#f59e0b')"></div>
                        <div class="color-option" data-color="#8b5cf6" style="background: #8b5cf6;" onclick="CUSTOMIZE.selectColor('#8b5cf6')"></div>
                        <div class="color-option" data-color="#ec4899" style="background: #ec4899;" onclick="CUSTOMIZE.selectColor('#ec4899')"></div>
                        <div class="color-option" data-color="#06b6d4" style="background: #06b6d4;" onclick="CUSTOMIZE.selectColor('#06b6d4')"></div>
                        <div class="color-option" data-color="#84cc16" style="background: #84cc16;" onclick="CUSTOMIZE.selectColor('#84cc16')"></div>
                    </div>
                </div>

                <div style="display:flex; gap:10px;">
                    <button class="btn" onclick="GAME.hideCreateForm()">Ä°ptal</button>
                    <button class="btn btn-primary" onclick="GAME.createTeam()">OluÅŸtur</button>
                </div>
            </div>

            <div class="form-box" id="joinForm" style="display:none;">
                <h3 style="margin-bottom:15px; color:white;">TakÄ±m SeÃ§</h3>
                <div id="joinTeamList" style="display:block;">
                    <div class="team-list" id="joinList" style="max-height:300px; overflow-y:auto; margin-bottom:15px;"></div>
                    <button class="btn" onclick="GAME.hideJoinForm()">Ä°ptal</button>
                </div>
                <div id="joinPasswordSection" style="display:none;">
                    <div style="margin-bottom:15px; color:#888; font-size:14px;">
                        SeÃ§ilen takÄ±m: <span id="selectedTeamName" style="color:var(--gold); font-weight:600;"></span>
                    </div>
                    <input type="password" id="inpJoinPassword" placeholder="TakÄ±m ÅŸifresi..." maxlength="20">
                    <div style="display:flex; gap:10px;">
                        <button class="btn" onclick="GAME.backToTeamList()">â† Geri</button>
                        <button class="btn btn-primary" onclick="GAME.joinTeam()">GiriÅŸ</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="pgTeam">
            <header style="padding: 20px 0;">
                <div style="color:#666; font-size:12px; letter-spacing: 2px; text-transform: uppercase;">Dedektif Paneli</div>
                <h1 id="dispTeamName" style="font-size:32px; margin-top:5px;">-</h1>
            </header>

            <div style="max-width:500px; margin: 0 auto;">
                <!-- TakÄ±m Bilgileri KartÄ± -->
                <div style="background: linear-gradient(135deg, #1a1a1a, #111); border: 2px solid var(--gold); border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(212,175,55,0.2);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">TakÄ±m AdÄ±</div>
                            <div id="teamInfoName" style="color: #fff; font-size: 20px; font-weight: 600;">-</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">Puan</div>
                            <div id="teamInfoScore" style="color: var(--gold); font-size: 32px; font-weight: 700; font-family: 'Courier New', monospace;">0</div>
                        </div>
                    </div>
                </div>

                <!-- Countdown GÃ¶rÃ¼nÃ¼mÃ¼ -->
                <div id="teamCountdownSection"></div>

                <!-- YÃ¶netici Ä°puÃ§larÄ± - YENÄ° TASARIM -->
                <div id="adminCluesSection" style="display:none; margin-bottom:20px;">
                    <div style="background: linear-gradient(135deg, #1a0a0a, #0d0404); border: 2px solid var(--accent); border-radius: 12px; padding: 20px; box-shadow: 0 8px 25px rgba(139,0,0,0.3); position: relative; overflow: hidden;">
                        <!-- BaÅŸlÄ±k -->
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid var(--accent); padding-bottom: 10px;">
                            <div style="font-size: 24px;">ðŸŽ¯</div>
                            <div>
                                <h3 style="margin: 0; color: var(--accent); font-size: 18px; font-weight: 700;">YÃ¶netici Ä°puÃ§larÄ±</h3>
                                <div style="color: #888; font-size: 11px; margin-top: 2px;">Oyun yÃ¶neticisinden gelen ipuÃ§larÄ±</div>
                            </div>
                            <div id="adminCluesCount" style="margin-left: auto; background: var(--accent); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0</div>
                        </div>

                        <!-- Ä°puÃ§larÄ± Listesi -->
                        <div id="adminCluesList" style="max-height: 300px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px;"></div>

                        <!-- BoÅŸ Durum -->
                        <div id="adminCluesEmpty" style="text-align: center; padding: 30px; color: #666;">
                            <div style="font-size: 32px; margin-bottom: 10px;">ðŸ”</div>
                            <div style="font-size: 13px;">HenÃ¼z yÃ¶netici ipucu yok</div>
                        </div>
                    </div>
                </div>

                <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #222; margin-bottom:20px;">
                    <h3 style="margin-bottom:12px; color:var(--gold);">ðŸ”Ž Yeni Ä°pucu</h3>
                    <div style="display:flex; gap:10px;">
                        <input type="text" id="inpClue" placeholder="BulduÄŸunuz ipucunu yazÄ±n..." maxlength="300" style="margin:0;">
                        <button class="btn btn-primary" style="width:auto; margin:0;" onclick="GAME.addClue()">GÃ¶nder</button>
                    </div>
                </div>

                <!-- TakÄ±mlar ArasÄ± Chat -->
                <div id="interTeamChatContainer" style="background: linear-gradient(135deg, #0a1a1a, #050d0d); border: 2px solid #1a4d4d; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 5px 20px rgba(26,77,77,0.3);">
                    <!-- BaÅŸlÄ±k (TÄ±klanabilir) -->
                    <div id="interTeamChatHeader" onclick="toggleInterTeamChat()" style="display: flex; align-items: center; justify-content: space-between; padding-bottom: 10px; cursor: pointer; user-select: none; border-bottom: 1px solid #1a4d4d; margin-bottom: 15px;" onmouseover="this.style.borderBottomColor='#4dd4d4'" onmouseout="this.style.borderBottomColor='#1a4d4d'">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="font-size: 24px;">ðŸ’¬</div>
                            <div>
                                <h3 style="margin: 0; color: #4dd4d4; font-size: 18px; font-weight: 700;">TakÄ±mlar ArasÄ± Sohbet</h3>
                                <div style="color: #666; font-size: 11px; margin-top: 2px;">TÃ¼m takÄ±mlar gÃ¶rebilir</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <button onclick="event.stopPropagation(); POKE.showPokeModal();" style="background: linear-gradient(135deg, #4d1a4d, #331033); border: 2px solid #d44dd4; color: #d44dd4; padding: 6px 14px; border-radius: 8px; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 6px;" onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 15px rgba(212,77,212,0.4)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                <span>ðŸ‘‹</span>
                                <span>DÃ¼rt</span>
                            </button>
                            <div id="teamChatCount" style="background: #1a4d4d; color: #4dd4d4; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0</div>
                            <div id="interTeamChatToggleIcon" style="color: #4dd4d4; font-size: 20px; transition: transform 0.3s ease;">â–¼</div>
                        </div>
                    </div>

                    <!-- Ä°Ã§erik (AÃ§Ä±lÄ±r/KapanÄ±r) -->
                    <div id="interTeamChatContent" style="max-height: 2000px; overflow: hidden; transition: max-height 0.4s ease-in-out, opacity 0.3s ease; opacity: 1;">

                    <!-- Mesajlar AlanÄ± -->
                    <div id="teamChatMessages" style="background: #000; border: 1px solid #1a4d4d; border-radius: 8px; padding: 15px; max-height: 400px; overflow-y: auto; margin-bottom: 15px; min-height: 300px;">
                        <div style="text-align: center; padding: 60px 20px; color: #555;">
                            <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ðŸ’¬</div>
                            <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            <div style="font-size: 12px; color: #444; margin-top: 5px;">Ä°lk mesajÄ± sen gÃ¶nder!</div>
                        </div>
                    </div>

                    <!-- Pagination Kontrolleri -->
                    <div id="teamChatPagination" style="display: none; text-align: center; margin-bottom: 15px; padding: 10px; background: #0a0a0a; border-radius: 8px; border: 1px solid #1a4d4d;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <button id="btnChatPrevPage" class="btn" style="padding: 8px 16px; margin: 0; font-size: 12px; opacity: 0.5;" onclick="CHAT.loadPreviousPage()" disabled>â† Ã–nceki</button>
                            <div style="color: #666; font-size: 12px;">
                                <span id="chatCurrentPage">1</span> / <span id="chatTotalPages">1</span>
                                <span style="margin-left: 10px;">(<span id="chatTotalMessages">0</span> mesaj)</span>
                            </div>
                            <button id="btnChatNextPage" class="btn" style="padding: 8px 16px; margin: 0; font-size: 12px; opacity: 0.5;" onclick="CHAT.loadNextPage()" disabled>Sonraki â†’</button>
                        </div>
                    </div>

                    <!-- Mesaj GÃ¶nderme AlanÄ± -->
                    <div style="margin-bottom: 10px;">
                        <div style="position: relative; display: inline-block;">
                            <button id="btnTeamSelector" onclick="CHAT.toggleTeamDropdown()" style="background: #0a0a0a; border: 1px solid #1a4d4d; color: #4dd4d4; padding: 10px 40px 10px 16px; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: 600; position: relative;">
                                <span id="selectedTeamText">ðŸ“¢ TÃ¼m TakÄ±mlar</span>
                                <span style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%);">â–¼</span>
                            </button>
                            <div id="teamDropdown" style="display: none; position: absolute; top: 100%; left: 0; margin-top: 5px; background: #0a0a0a; border: 1px solid #1a4d4d; border-radius: 6px; min-width: 200px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); z-index: 1000; max-height: 300px; overflow-y: auto;">
                                <!-- Dropdown iÃ§eriÄŸi JavaScript ile doldurulacak -->
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="inpTeamChat" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." maxlength="500" style="margin: 0; background: #000; border: 1px solid #1a4d4d; color: #fff; flex: 1;" onkeypress="if(event.key==='Enter') CHAT.sendMessage()">
                        <button class="btn btn-primary" style="width: auto; margin: 0; padding: 12px 24px; background: linear-gradient(135deg, #1a4d4d, #0d3333); border-color: #4dd4d4;" onclick="CHAT.sendMessage()">GÃ¶nder</button>
                    </div>

                    </div><!-- Ä°Ã§erik sonu -->
                </div><!-- Container sonu -->

                <div style="background:#111; padding:20px; border-radius:12px; border:1px solid #222;">
                    <h3 style="margin-bottom:12px; display:flex; justify-content:space-between;">
                        ðŸ“‹ KayÄ±tlar <span id="clueCnt" style="color:#666; font-size:14px;">(0)</span>
                    </h3>
                    <div id="myClueList" style="max-height:300px; overflow-y:auto;"></div>
                </div>

                <!-- Murder Board Butonu -->
                <button class="btn btn-primary" style="margin-top:20px; background: linear-gradient(135deg, #4d1a1a, #331010); border: 2px solid #d44d4d; color: #d44d4d;" onclick="MURDERBOARD.openMurderBoard()">
                    ðŸ” Murder Board
                </button>

                <button class="btn" style="margin-top:20px; border-color:#333;" onclick="GAME.exitTeam()">ðŸšª Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
        </div>

        <!-- Murder Board SayfasÄ± -->
        <div class="page" id="pgMurderBoard">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #1a0a0a, #0d0505); border-bottom: 2px solid #4d1a1a; padding: 20px; margin-bottom: 20px; position: sticky; top: 0; z-index: 100;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h2 style="margin: 0; color: #d44d4d; font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 10px;">
                            ðŸ” Murder Board
                        </h2>
                        <div style="color: #888; font-size: 12px; margin-top: 4px;">
                            <span id="mbTeamName">-</span> â€¢ <span id="mbItemCount">0</span> Ã¶ÄŸe
                        </div>
                    </div>
                    <button class="back-btn" onclick="MURDERBOARD.closeMurderBoard()">â† Geri</button>
                </div>
            </div>

            <!-- Toolbar -->
            <div style="background: #111; border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 20px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
                <button id="btnAddCharacter" class="btn btn-primary" style="background: linear-gradient(135deg, #1a4d1a, #0d3310); border-color: #4dd44d; color: #4dd44d;" onclick="MURDERBOARD.showCharacterSelector()">
                    âž• Karakter Ekle
                </button>
                <button id="btnAddConnection" class="btn" style="background: linear-gradient(135deg, #4d4d1a, #333310); border-color: #d4d44d; color: #d4d44d;" onclick="MURDERBOARD.toggleConnectionMode()">
                    ðŸ”— BaÄŸlantÄ± Ekle
                </button>
                <button class="btn" style="background: linear-gradient(135deg, #4d1a4d, #331033); border-color: #d44dd4; color: #d44dd4;" onclick="MURDERBOARD.clearBoard()">
                    ðŸ—‘ï¸ Temizle
                </button>

                <!-- Zoom Kontrolleri -->
                <div style="margin-left: auto; display: flex; gap: 8px; align-items: center; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 4px;">
                    <button class="btn" style="margin: 0; padding: 6px 12px; font-size: 16px; background: #222; border-color: #444;" onclick="MURDERBOARD.zoomOut()">âˆ’</button>
                    <span id="zoomLevel" style="color: #888; font-size: 12px; min-width: 50px; text-align: center;">100%</span>
                    <button class="btn" style="margin: 0; padding: 6px 12px; font-size: 16px; background: #222; border-color: #444;" onclick="MURDERBOARD.zoomIn()">+</button>
                    <button class="btn" style="margin: 0; padding: 6px 12px; font-size: 12px; background: #222; border-color: #444;" onclick="MURDERBOARD.resetZoom()">Reset</button>
                </div>
            </div>

            <!-- Karakter SeÃ§ici Modal -->
            <div id="characterSelectorModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: #1a1a1a; border: 2px solid #4d1a1a; border-radius: 12px; padding: 25px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto;">
                    <h3 style="margin: 0 0 15px 0; color: #d44d4d; font-size: 18px;">Karakter SeÃ§</h3>

                    <select id="characterDropdown" style="width: 100%; padding: 12px; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; margin-bottom: 15px; font-size: 14px;">
                        <option value="">Karakter seÃ§in...</option>
                    </select>

                    <textarea id="characterNote" placeholder="Not ekle (opsiyonel)" maxlength="500" style="width: 100%; min-height: 80px; margin: 0 0 15px 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; resize: vertical;"></textarea>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" style="flex: 1; margin: 0;" onclick="MURDERBOARD.addCharacterToBoard()">âœ… Ekle</button>
                        <button class="btn" style="flex: 1; margin: 0;" onclick="MURDERBOARD.hideCharacterSelector()">âŒ Ä°ptal</button>
                    </div>
                </div>
            </div>

            <!-- Not DÃ¼zenleme Modal -->
            <div id="editNoteModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 1000; align-items: center; justify-content: center;">
                <div style="background: #1a1a1a; border: 2px solid #4d1a1a; border-radius: 12px; padding: 25px; max-width: 500px; width: 90%;">
                    <h3 style="margin: 0 0 15px 0; color: #d44d4d; font-size: 18px;">Not DÃ¼zenle</h3>

                    <div style="margin-bottom: 15px;">
                        <div style="font-weight: 600; color: #4dd4d4; margin-bottom: 8px;">Karakter: <span id="editCharacterName"></span></div>
                    </div>

                    <textarea id="editNoteTextarea" placeholder="Not (opsiyonel)" maxlength="500" style="width: 100%; min-height: 120px; margin: 0 0 15px 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; resize: vertical;"></textarea>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" style="flex: 1; margin: 0;" onclick="MURDERBOARD.saveEditedNote()">âœ… Kaydet</button>
                        <button class="btn" style="flex: 1; margin: 0;" onclick="MURDERBOARD.hideEditNoteModal()">âŒ Ä°ptal</button>
                    </div>
                </div>
            </div>

            <!-- Cork Board Canvas -->
            <div id="murderBoardWrapper" style="background: rgba(139, 90, 43, 0.3); border: 3px solid #6b4423; border-radius: 8px; padding: 20px; position: relative; overflow: auto; max-height: 700px;">
                <!-- Cork Board Texture Overlay -->
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-image: url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22><filter id=%22noise%22><feTurbulence type=%22fractalNoise%22 baseFrequency=%220.9%22 numOctaves=%224%22 stitchTiles=%22stitch%22/></filter><rect width=%22100%22 height=%22100%22 filter=%22url(%23noise)%22 opacity=%220.15%22/></svg>'); pointer-events: none; z-index: 0;"></div>

                <!-- Board Container (zoom olacak) -->
                <div id="murderBoardCanvas" style="position: relative; min-height: 600px; min-width: 800px; background: transparent; transform-origin: top left; transition: transform 0.2s ease; z-index: 2; border: 2px solid rgba(107, 68, 35, 0.5); border-radius: 8px;">
                    <!-- Karakterler ve baÄŸlantÄ±lar buraya dinamik eklenecek -->
                    <svg id="connectionsLayer" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;">
                        <!-- BaÄŸlantÄ± Ã§izgileri buraya eklenecek -->
                    </svg>

                    <!-- Empty state -->
                    <div id="boardEmptyState" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #666; pointer-events: none;">
                        <div style="font-size: 64px; margin-bottom: 10px; opacity: 0.3;">ðŸ“Œ</div>
                        <div style="font-size: 16px;">Murder board boÅŸ</div>
                        <div style="font-size: 12px; margin-top: 5px; opacity: 0.7;">Karakter eklemek iÃ§in yukarÄ±daki butonu kullanÄ±n</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="pgAdmin">
            <div class="admin-head">
                <div>
                    <h2 style="font-size:24px;">ðŸ‘ï¸ YÃ¶netici Paneli</h2>
                    <div style="color:#666; font-size:12px; margin-top:4px;">
                        <span id="statTeams">0</span> TakÄ±m â€¢ <span id="statClues">0</span> Ä°pucu
                    </div>
                </div>
                <button class="back-btn" onclick="GAME.exitAdmin()">Ã‡Ä±kÄ±ÅŸ</button>
            </div>

            <!-- Admin MenÃ¼ ButonlarÄ± - RESPONSIVE -->
            <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-bottom:30px;">
                <button class="btn btn-primary" onclick="ADMIN.showSection('game')">â±ï¸ Oyun KontrolÃ¼</button>
                <button class="btn" onclick="ADMIN.showSection('characters')">ðŸ‘¥ Karakterler</button>
                <button class="btn" onclick="ADMIN.showSection('users')">ðŸ‘¤ KullanÄ±cÄ±lar</button>
                <button class="btn" onclick="ADMIN.showSection('scoring')">ðŸŽ¯ Puanlama</button>
                <button class="btn" onclick="ADMIN.showSection('notifications')">ðŸ“¢ Bildirimler</button>
                <button class="btn" onclick="ADMIN.showSection('chat')">ðŸ’¬ Chat Ä°zleme</button>
                <button class="btn" onclick="ADMIN.showSection('adminmessages')">ðŸ‘‘ Admin MesajlarÄ±</button>
                <button class="btn" onclick="ADMIN.showSection('murderboard')">ðŸ” Murder Board Ä°zleme</button>
                <button class="btn" onclick="ADMIN.showSection('stats')">ðŸ“Š Ä°statistikler</button>
                <button class="btn" onclick="ADMIN.showSection('credits')">ðŸ‘¥ EmeÄŸi GeÃ§enler</button>
                <button class="btn" onclick="ADMIN.showSection('iplogs')">ðŸ” IP LoglarÄ±</button>
                <button class="btn" onclick="ADMIN.showSection('profilephotos')">ðŸ“¸ Profil FotoÄŸraflarÄ±</button>
                <button class="btn" style="background: linear-gradient(135deg, #1a5d1a, #0d300d); border-color: #4CAF50;" onclick="ADMIN.startGameSession()">ðŸŽ® Oyunu BaÅŸlat</button>
                <button class="btn" style="background: linear-gradient(135deg, #d4af37, #8b7500); border-color: #ffd700;" onclick="ADMIN.endGameSession()">ðŸ Oyunu Bitir</button>
                <button class="btn" style="background: linear-gradient(135deg, #8b0000, #450000); border-color: #ff4444;" onclick="ADMIN.showSection('reset')">ðŸ”„ Oyunu SÄ±fÄ±rla</button>
            </div>

            <!-- Oyun Kontrol BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionGame" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">â±ï¸ Oyun KontrolÃ¼</h3>
                <div class="game-control">
                    <!-- Oyun BaÅŸlatma -->
                    <div id="gameStartSection">
                        <input type="text" id="gameTitle" placeholder="Faz BaÅŸlÄ±ÄŸÄ± (Ã¶rn: Faz 1, Ä°lk Tur)" maxlength="30" style="width:100%; margin:0 0 10px 0; padding:12px;">
                        <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px;">
                            <input type="number" id="gameMinutes" placeholder="SÃ¼re (dakika)" min="1" max="180" style="flex:1; margin:0; padding:12px;">
                            <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.startGame()">ðŸŽ® Oyunu BaÅŸlat</button>
                        </div>
                    </div>

                    <!-- Countdown GÃ¶rÃ¼nÃ¼mÃ¼ -->
                    <div id="gameRunningSection" style="display:none;">
                        <div class="admin-phase-title" id="adminPhaseTitle"></div>
                        <div class="countdown-display" id="adminCountdown">00:00</div>
                        <div class="time-controls">
                            <button class="time-btn add" onclick="ADMIN.addTime(300)">+5 Dakika</button>
                            <button class="time-btn add" onclick="ADMIN.addTime(600)">+10 Dakika</button>
                            <button class="time-btn add" onclick="ADMIN.addTime(60)">+1 Dakika</button>
                        </div>
                        <button class="btn" style="width:100%; margin-top:15px; background:#500; color:#faa; border:1px solid var(--accent);" onclick="ADMIN.endGame()">â¹ï¸ Oyunu Bitir</button>
                    </div>

                    <!-- Karakter GÃ¶rÃ¼nÃ¼rlÃ¼k KontrolÃ¼ -->
                    <div style="margin-top: 30px; background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px;">
                        <h4 style="color: #4dd4d4; margin: 0 0 15px 0; font-size: 16px;">ðŸ‘ï¸ Karakter GÃ¶rÃ¼nÃ¼rlÃ¼k KontrolÃ¼</h4>
                        <p style="color: #888; font-size: 12px; margin: 0 0 15px 0;">AÃ§tÄ±ÄŸÄ±nÄ±z karakterler takÄ±mlarÄ±n Murder Board'larÄ±nda gÃ¶rÃ¼nÃ¼r olur.</p>

                        <div id="gameCharactersList">
                            <div style="text-align: center; padding: 40px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ðŸ‘¤</div>
                                <div style="font-size: 14px;">HenÃ¼z karakter eklenmemiÅŸ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Karakterler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionCharacters" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ‘¥ Karakter YÃ¶netimi</h3>

                <!-- Karakter Ekleme Formu -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <h4 style="color: #4dd4d4; margin-bottom: 15px; font-size: 16px;">âž• Yeni Karakter Ekle</h4>

                    <div style="display: grid; gap: 12px;">
                        <input type="text" id="charName" placeholder="Ä°sim *" maxlength="100" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">

                        <!-- FotoÄŸraf URL / Dosyadan SeÃ§ -->
                        <div style="display: flex; gap: 8px; align-items: stretch;">
                            <input type="text" id="charPhotoUrl" placeholder="FotoÄŸraf URL'si" maxlength="500" style="flex: 1; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">
                            <button class="btn" style="margin: 0; padding: 12px 16px; white-space: nowrap; background: #222; border-color: #4dd4d4; color: #4dd4d4;" onclick="CHARACTER.openPhotoSelector()">ðŸ“‚ Dosyadan SeÃ§</button>
                        </div>

                        <textarea id="charDescription" placeholder="AÃ§Ä±klama / Karakter Bilgisi" maxlength="1000" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; min-height: 100px; resize: vertical;"></textarea>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <input type="number" id="charAge" placeholder="YaÅŸ (opsiyonel)" min="0" max="150" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">

                            <input type="text" id="charOccupation" placeholder="Meslek (opsiyonel)" maxlength="100" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff;">
                        </div>

                        <textarea id="charAdditionalInfo" placeholder="Ek Bilgiler (opsiyonel)" maxlength="1000" style="width: 100%; margin: 0; padding: 12px; background: #000; border: 1px solid #333; color: #fff; min-height: 80px; resize: vertical;"></textarea>

                        <div style="padding: 10px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; color: #888; font-size: 12px;">
                            ðŸ’¡ <strong>Not:</strong> Karakter gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ "Oyun KontrolÃ¼" bÃ¶lÃ¼mÃ¼nden yÃ¶netebilirsiniz.
                        </div>

                        <button class="btn btn-primary" style="width: 100%; margin: 0; padding: 12px;" onclick="CHARACTER.addCharacter()">âœ… Karakter Ekle</button>
                    </div>
                </div>

                <!-- Karakter Listesi -->
                <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px; padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h4 style="color: #4dd4d4; font-size: 16px; margin: 0;">ðŸ“‹ KayÄ±tlÄ± Karakterler</h4>
                        <span id="characterCount" style="color: #666; font-size: 12px;">0 karakter</span>
                    </div>

                    <div id="charactersList" style="max-height: 600px; overflow-y: auto;">
                        <div style="text-align: center; padding: 40px 20px; color: #555;">
                            <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ðŸ‘¤</div>
                            <div style="font-size: 14px;">HenÃ¼z karakter eklenmemiÅŸ</div>
                        </div>
                    </div>
                </div>

                <!-- FotoÄŸraf SeÃ§ici Modal -->
                <div id="photoSelectorModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; align-items: center; justify-content: center;">
                    <div style="background: #1a1a1a; border: 2px solid #4d1a1a; border-radius: 12px; padding: 25px; max-width: 800px; width: 90%; max-height: 80vh; overflow-y: auto;">
                        <h3 style="margin: 0 0 15px 0; color: #4dd4d4; font-size: 18px;">ðŸ“‚ YÃ¼klenmiÅŸ FotoÄŸraflar</h3>

                        <div style="color: #888; font-size: 12px; margin-bottom: 15px; padding: 10px; background: #0a0a0a; border: 1px solid #333; border-radius: 6px;">
                            ðŸ’¡ <strong>Bilgi:</strong> FotoÄŸraflarÄ± <code style="background: #222; padding: 2px 6px; border-radius: 3px;">public/uploads/characters/</code> klasÃ¶rÃ¼ne yÃ¼kleyin.<br>
                            Desteklenen formatlar: JPG, JPEG, PNG, GIF, WEBP
                        </div>

                        <div id="photoGallery" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                            <!-- FotoÄŸraflar buraya yÃ¼klenecek -->
                        </div>

                        <button class="btn" style="width: 100%; margin: 0;" onclick="CHARACTER.closePhotoSelector()">âŒ Kapat</button>
                    </div>
                </div>
            </div>

            <!-- KullanÄ±cÄ±lar BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionUsers" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ‘¤ KullanÄ±cÄ±lar</h3>
                <div id="usersList"></div>
            </div>

            <!-- Bildirimler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionNotifications" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ“¢ Bildirimler</h3>

                <!-- Ä°pucu GÃ¶nderme -->
                <div class="announcement-form" style="margin-bottom:20px;">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">ðŸ’¡ Genel Ä°pucu GÃ¶nder</h3>
                    <textarea id="generalClueText" placeholder="TÃ¼m takÄ±mlara gÃ¶nderilecek ipucunu yazÄ±n..." maxlength="500"></textarea>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button class="btn btn-primary" style="width:auto; padding:10px 24px; margin:0;" onclick="ADMIN.sendGeneralClue()">Ä°pucu GÃ¶nder</button>
                        <button class="btn" style="width:auto; padding:10px 24px; margin:0; background:#300; color:#faa; border:1px solid #500;" onclick="ADMIN.clearAllClues()">ðŸ—‘ï¸ TÃ¼m Ä°puÃ§larÄ±nÄ± Sil</button>
                    </div>

                    <!-- GÃ¶nderilen Ä°puÃ§larÄ± Listesi -->
                    <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">GÃ¶nderilen Ä°puÃ§larÄ±</h3>
                            <span id="adminClueCount" style="color:#666; font-size:12px;">0 ipucu</span>
                        </div>
                        <div id="adminClueList" style="max-height:300px; overflow-y:auto;"></div>
                    </div>
                </div>

                <!-- Duyuru GÃ¶nderme -->
                <div class="announcement-form">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">ðŸ“¢ Genel Duyuru GÃ¶nder</h3>
                    <textarea id="announcementText" placeholder="TÃ¼m takÄ±mlara gÃ¶nderilecek duyuruyu yazÄ±n..." maxlength="500"></textarea>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <button class="btn btn-primary" style="width:auto; padding:10px 24px; margin:0;" onclick="ADMIN.sendAnnouncement()">Duyuruyu GÃ¶nder</button>
                        <button class="btn" style="width:auto; padding:10px 24px; margin:0; background:#300; color:#faa; border:1px solid #500;" onclick="ADMIN.clearAllNotifications()">ðŸ—‘ï¸ TÃ¼m Bildirimleri Sil</button>
                    </div>

                    <!-- GÃ¶nderilen Bildirimler Listesi -->
                    <div style="margin-top:25px; padding-top:20px; border-top:1px solid var(--border-color);">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">GÃ¶nderilen Bildirimler</h3>
                            <span id="adminNotifCount" style="color:#666; font-size:12px;">0 bildirim</span>
                        </div>
                        <div id="adminNotifList" style="max-height:300px; overflow-y:auto;"></div>
                    </div>
                </div>
            </div>

            <!-- Puanlama BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionScoring" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸŽ¯ Puanlama</h3>
                <div class="stats-chart" id="statsChart">
                    <h3 style="color:#666; font-size:12px; text-transform:uppercase; margin-bottom:15px;">ðŸ“Š CanlÄ± Puan Durumu</h3>
                    <div id="chartContent"></div>
                </div>

                <div id="adminList" class="admin-list"></div>

                <button class="btn" style="background:#300; color:#faa; border:1px solid #500; margin-top:30px;" onclick="GAME.resetGame()">âš ï¸ OYUNU SIFIRLA (TÃ¼m TakÄ±mlarÄ± Sil)</button>
            </div>

            <!-- Chat Ä°zleme BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionChat" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ’¬ Chat Ä°zleme</h3>

                <!-- TakÄ±m SeÃ§ici -->
                <div style="margin-bottom:20px;">
                    <label style="display:block; color:#888; font-size:13px; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px;">TakÄ±m SeÃ§</label>
                    <select id="adminChatTeamSelector" onchange="ADMIN.selectTeamForChat(this.value)" style="width:100%; max-width:400px; background:#0a0a0a; border:1px solid #1a4d4d; color:#4dd4d4; padding:12px 16px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">
                        <option value="">TakÄ±m seÃ§in...</option>
                    </select>
                </div>

                <!-- Chat GÃ¶rÃ¼ntÃ¼leme AlanÄ± -->
                <div id="adminChatViewerContainer" style="display:none;">
                    <div style="background: linear-gradient(135deg, #0a1a1a, #050d0d); border: 2px solid #1a4d4d; border-radius: 12px; padding: 20px; box-shadow: 0 5px 20px rgba(26,77,77,0.3);">
                        <!-- BaÅŸlÄ±k -->
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #1a4d4d; padding-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 24px;">ðŸ’¬</div>
                                <div>
                                    <h3 id="adminChatTeamName" style="margin: 0; color: #4dd4d4; font-size: 18px; font-weight: 700;">-</h3>
                                    <div style="color: #666; font-size: 11px; margin-top: 2px;">TakÄ±mlar arasÄ± mesajlar (Admin mesajlarÄ± hariÃ§)</div>
                                </div>
                            </div>
                            <div id="adminChatMessageCount" style="background: #1a4d4d; color: #4dd4d4; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700;">0 mesaj</div>
                        </div>

                        <!-- Mesajlar AlanÄ± -->
                        <div id="adminChatMessages" style="background: #000; border: 1px solid #1a4d4d; border-radius: 8px; padding: 15px; max-height: 500px; overflow-y: auto; min-height: 400px;">
                            <div style="text-align: center; padding: 60px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ðŸ’¬</div>
                                <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            </div>
                        </div>

                        <!-- Bilgi Metni -->
                        <div style="margin-top: 15px; padding: 12px; background: rgba(26,77,77,0.2); border: 1px solid #1a4d4d; border-radius: 6px; color: #888; font-size: 12px; text-align: center;">
                            â„¹ï¸ Bu gÃ¶rÃ¼nÃ¼m sadece takÄ±mlar arasÄ± mesajlarÄ± gÃ¶sterir. Admin'e gÃ¶nderilen Ã¶zel mesajlar burada gÃ¶rÃ¼nmez. Admin mesajlarÄ± iÃ§in "ðŸ‘‘ Admin MesajlarÄ±" bÃ¶lÃ¼mÃ¼nÃ¼ kullanÄ±n.
                        </div>
                    </div>
                </div>

                <!-- BoÅŸ Durum -->
                <div id="adminChatEmptyState" style="text-align:center; padding:60px 20px; color:#555;">
                    <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ðŸ”</div>
                    <div style="font-size:16px; margin-bottom:8px;">Bir takÄ±m seÃ§in</div>
                    <div style="font-size:13px; color:#444;">SeÃ§tiÄŸiniz takÄ±mÄ±n chat geÃ§miÅŸini gÃ¶rÃ¼ntÃ¼leyebilirsiniz</div>
                </div>
            </div>

            <!-- Admin MesajlarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionAdminmessages" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>ðŸ‘‘ Admin MesajlarÄ±</span>
                    <button class="btn btn-primary" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN.loadAdminMessages()">ðŸ”„ Yenile</button>
                </h3>

                <!-- TakÄ±m SeÃ§ici -->
                <div style="margin-bottom:20px;">
                    <label style="display:block; color:#888; font-size:13px; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px;">TakÄ±m SeÃ§</label>
                    <select id="adminMessagesTeamSelector" onchange="ADMIN.selectTeamForAdminMessages(this.value)" style="width:100%; max-width:400px; background:#0a0a0a; border:1px solid #1a4d4d; color:#fbbf24; padding:12px 16px; border-radius:6px; font-size:14px; font-weight:600; cursor:pointer;">
                        <option value="">TakÄ±m seÃ§in...</option>
                    </select>
                </div>

                <!-- Mesajlar GÃ¶rÃ¼ntÃ¼leme AlanÄ± -->
                <div id="adminMessagesViewerContainer" style="display:none;">
                    <div style="background: linear-gradient(135deg, #0a1a1a, #050d0d); border: 2px solid #1a4d4d; border-radius: 12px; padding: 20px; box-shadow: 0 5px 20px rgba(26,77,77,0.3);">
                        <!-- BaÅŸlÄ±k -->
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; border-bottom: 1px solid #1a4d4d; padding-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <div style="font-size: 24px;">ðŸ’¬</div>
                                <div>
                                    <h3 id="adminSelectedTeamName" style="margin: 0; color: #fbbf24; font-size: 18px; font-weight: 700;">-</h3>
                                    <div style="color: #666; font-size: 11px; margin-top: 2px;">Admin ile takÄ±m arasÄ±ndaki mesajlar</div>
                                </div>
                            </div>
                            <div id="adminSelectedTeamMessageCount" style="background: rgba(251,191,36,0.2); color: #fbbf24; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; border: 1px solid rgba(251,191,36,0.3);">0 mesaj</div>
                        </div>

                        <!-- Mesajlar AlanÄ± -->
                        <div id="adminMessagesContainer" style="background: #000; border: 1px solid #1a4d4d; border-radius: 8px; padding: 15px; max-height: 500px; overflow-y: auto; margin-bottom: 15px; min-height: 400px;">
                            <div style="text-align: center; padding: 80px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ðŸ“­</div>
                                <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            </div>
                        </div>

                        <!-- Cevap GÃ¶nderme AlanÄ± -->
                        <div style="background: rgba(251,191,36,0.05); border: 1px solid rgba(251,191,36,0.2); border-radius: 8px; padding: 15px;">
                            <div style="color: #fbbf24; font-size: 13px; font-weight: 700; margin-bottom: 10px;">âœ‰ï¸ TakÄ±ma Mesaj GÃ¶nder</div>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="adminReplyMessage" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..." maxlength="500" style="margin: 0; background: #000; border: 1px solid #1a4d4d; color: #fff; flex: 1; padding: 12px 16px; border-radius: 6px;" onkeypress="if(event.key==='Enter') ADMIN.sendReplyMessage()">
                                <button class="btn btn-primary" style="width: auto; margin: 0; padding: 12px 24px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-color: #fbbf24; color: #000; font-weight: 700;" onclick="ADMIN.sendReplyMessage()">GÃ¶nder</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- BoÅŸ Durum -->
                <div id="adminMessagesEmptyState" style="text-align:center; padding:60px 20px; color:#555;">
                    <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ðŸ”</div>
                    <div style="font-size:16px; margin-bottom:8px;">Bir takÄ±m seÃ§in</div>
                    <div style="font-size:13px; color:#444;">SeÃ§tiÄŸiniz takÄ±ma mesaj gÃ¶nderebilir ve gelen mesajlarÄ± gÃ¶rÃ¼ntÃ¼leyebilirsiniz</div>
                </div>
            </div>

            <!-- Murder Board Ä°zleme BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionMurderboard" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>ðŸ” Murder Board Ä°zleme</span>
                    <button class="btn btn-primary" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.refreshBoard()">ðŸ”„ Yenile</button>
                </h3>

                <!-- TakÄ±m SeÃ§imi -->
                <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:20px; margin-bottom:20px;">
                    <label style="display:block; color:#888; font-size:13px; margin-bottom:10px;">ðŸ“‹ TakÄ±m SeÃ§in</label>
                    <select id="adminBoardTeamSelect" onchange="ADMIN_BOARD.selectTeam(this.value)" style="width:100%; padding:12px; background:#000; border:1px solid #333; color:#fff; border-radius:8px; cursor:pointer;">
                        <option value="">-- TakÄ±m SeÃ§in --</option>
                    </select>
                </div>

                <!-- Murder Board GÃ¶rÃ¼nÃ¼mÃ¼ -->
                <div id="adminBoardViewContainer" style="display:none;">
                    <!-- Bilgi KartÄ± -->
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:15px; margin-bottom:20px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:15px;">
                        <div>
                            <div style="color:#4dd4d4; font-weight:600; font-size:16px; margin-bottom:5px;" id="adminBoardTeamName">-</div>
                            <div style="color:#888; font-size:13px;">
                                <span id="adminBoardItemCount">0</span> karakter â€¢ <span id="adminBoardConnectionCount">0</span> baÄŸlantÄ±
                            </div>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.zoomOut()">ðŸ”âˆ’ UzaklaÅŸ</button>
                            <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.resetZoom()">âŠ¡ Normal</button>
                            <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN_BOARD.zoomIn()">ðŸ”+ YakÄ±nlaÅŸ</button>
                        </div>
                    </div>

                    <!-- Murder Board Canvas -->
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:20px; position:relative; overflow:hidden;">
                        <!-- Zoom KontrollÃ¼ Wrapper -->
                        <div style="overflow:auto; max-height:600px; border-radius:8px; position:relative;">
                            <!-- Sabit Arka Plan -->
                            <div style="position:absolute; top:0; left:0; right:0; bottom:0; background:url('https://www.transparenttextures.com/patterns/cork-board.png') repeat; opacity:0.15; z-index:0; pointer-events:none;"></div>

                            <!-- Arka Plan Rengi -->
                            <div style="position:absolute; top:0; left:0; right:0; bottom:0; background:#2d1f1a; z-index:1; pointer-events:none;"></div>

                            <!-- Board Container -->
                            <div id="adminBoardCanvas" style="position:relative; min-height:600px; min-width:800px; background:transparent; transform-origin:top left; transition:transform 0.2s ease; z-index:2;">
                                <!-- SVG BaÄŸlantÄ± KatmanÄ± -->
                                <svg id="adminConnectionsLayer" style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:1;">
                                    <!-- BaÄŸlantÄ± Ã§izgileri -->
                                </svg>

                                <!-- BoÅŸ Durum -->
                                <div id="adminBoardEmptyState" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); text-align:center; color:#555; z-index:5;">
                                    <div style="font-size:64px; margin-bottom:15px; opacity:0.3;">ðŸ•µï¸</div>
                                    <div style="font-size:18px; margin-bottom:8px;">Bu takÄ±mÄ±n henÃ¼z murder board'u boÅŸ</div>
                                    <div style="font-size:13px; color:#444;">TakÄ±m karakterleri eklediÄŸinde buradan izleyebilirsiniz</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- CanlÄ± GÃ¼ncelleme Bildirimi -->
                    <div style="margin-top:15px; padding:12px; background:#0a0a0a; border:1px solid #333; border-radius:8px; color:#888; font-size:12px; text-align:center;">
                        âš¡ CanlÄ± izleme aktif - TakÄ±mÄ±n yaptÄ±ÄŸÄ± deÄŸiÅŸiklikler otomatik olarak burada gÃ¶rÃ¼nÃ¼r
                    </div>
                </div>

                <!-- BoÅŸ Durum (TakÄ±m SeÃ§ilmemiÅŸ) -->
                <div id="adminBoardEmptyStateMain" style="text-align:center; padding:60px 20px; color:#555;">
                    <div style="font-size:48px; margin-bottom:15px; opacity:0.5;">ðŸ”</div>
                    <div style="font-size:16px; margin-bottom:8px;">Bir takÄ±m seÃ§in</div>
                    <div style="font-size:13px; color:#444;">SeÃ§tiÄŸiniz takÄ±mÄ±n murder board'unu canlÄ± olarak izleyebilirsiniz</div>
                </div>
            </div>

            <!-- Ä°statistikler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionStats" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
                    <span>ðŸ“Š Oyun Ä°statistikleri</span>
                    <button class="btn btn-primary" style="width:auto; padding:8px 16px; margin:0; font-size:13px;" onclick="ADMIN.loadStatistics()">ðŸ”„ Yenile</button>
                </h3>

                <!-- Genel Ä°statistikler -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ðŸ“ˆ Genel Ã–zet</h4>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:15px;">
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam TakÄ±m</div>
                            <div id="statTotalTeams" style="color:var(--gold); font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam KullanÄ±cÄ±</div>
                            <div id="statTotalUsers" style="color:#4dd4d4; font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam Mesaj</div>
                            <div id="statTotalMessages" style="color:#ffa500; font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                        <div style="background:#0a0a0a; padding:15px; border-radius:8px; text-align:center;">
                            <div style="color:#888; font-size:11px; text-transform:uppercase;">Toplam Ä°pucu</div>
                            <div id="statTotalClues" style="color:#d4af37; font-size:32px; font-weight:700; margin-top:5px;">0</div>
                        </div>
                    </div>
                </div>

                <!-- MesajlaÅŸma Analizi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ðŸ’¬ MesajlaÅŸma Analizi</h4>
                    <div id="statsMessaging" style="font-size:13px;"></div>
                </div>

                <!-- Ä°pucu Analizi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ðŸ”Ž Ä°pucu Analizi</h4>
                    <div id="statsClues" style="font-size:13px;"></div>
                </div>

                <!-- KullanÄ±cÄ± Aktivitesi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ðŸ‘¥ KullanÄ±cÄ± Aktivitesi</h4>
                    <div id="statsUsers" style="font-size:13px;"></div>
                </div>

                <!-- Puanlama Tablosu -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px; margin-bottom:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ðŸŽ¯ Puan SÄ±ralamasÄ±</h4>
                    <div id="statsScoring" style="font-size:13px;"></div>
                </div>

                <!-- Export ButonlarÄ± -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <h4 style="color:var(--gold); font-size:15px; margin-bottom:15px;">ðŸ“¥ DÄ±ÅŸa Aktar</h4>
                    <div style="display:flex; gap:10px; flex-wrap:wrap;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.exportStats('json')">ðŸ“„ JSON Ä°ndir</button>
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.exportStats('csv')">ðŸ“Š CSV Ä°ndir</button>
                    </div>
                    <div style="margin-top:10px; color:#666; font-size:12px;">TÃ¼m istatistikler ve veri dÄ±ÅŸa aktarÄ±lacaktÄ±r.</div>
                </div>
            </div>

            <!-- EmeÄŸi GeÃ§enler BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionCredits" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ‘¥ EmeÄŸi GeÃ§enler</h3>

                <!-- Ä°sim Ekleme Formu -->
                <div class="announcement-form" style="margin-bottom:20px;">
                    <h3 style="color:var(--gold); font-size:14px; margin-bottom:12px;">âž• Yeni KiÅŸi Ekle</h3>
                    <div style="display:flex; gap:10px; align-items:center;">
                        <input type="text" id="creditNameInput" placeholder="Ä°sim girin..." maxlength="30" style="margin:0; flex:1;" onkeypress="if(event.key==='Enter') ADMIN.addCredit()">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="ADMIN.addCredit()">Ekle</button>
                    </div>
                </div>

                <!-- Ä°simler ve Ä°Ã§erik YÃ¶netimi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">KiÅŸiler ve Ä°Ã§erikleri</h3>
                        <span id="creditsCount" style="color:#666; font-size:12px;">0 kiÅŸi</span>
                    </div>
                    <div id="creditsList" style="display:flex; flex-direction:column; gap:15px; min-height:100px;"></div>
                </div>
            </div>

            <!-- IP LoglarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionIplogs" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ” IP YÃ¶netimi</h3>

                <!-- Tab ButonlarÄ± -->
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button id="ipTabLogs" class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_SECTION.showTab('logs')">ðŸ“Š Aktivite LoglarÄ±</button>
                    <button id="ipTabUsers" class="btn" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_SECTION.showTab('users')">ðŸ‘¥ KullanÄ±cÄ± KayÄ±tlarÄ±</button>
                </div>

                <!-- TAB 1: Aktivite LoglarÄ± -->
                <div id="ipTabContentLogs" style="display:block;">
                    <!-- Bilgilendirme -->
                    <div style="background:#1a1a1a; border-left:4px solid var(--gold); padding:15px; margin-bottom:20px; border-radius:8px;">
                        <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                            Son 24 saat iÃ§inde IP bazlÄ± aktiviteler. Bir IP'den Ã§ok fazla kullanÄ±cÄ±/takÄ±m oluÅŸturulmasÄ±nÄ± engellemek iÃ§in bu limitler vardÄ±r.
                            <br><strong style="color:var(--gold);">KullanÄ±cÄ± KaydÄ±:</strong> AynÄ± IP'den 24 saatte maksimum 3 kayÄ±t
                            <br><strong style="color:var(--gold);">TakÄ±m OluÅŸturma:</strong> AynÄ± IP'den 24 saatte maksimum 2 takÄ±m
                            <br><br><strong style="color:#ff9800;">ðŸ’¡ Not:</strong> Bir IP limiti dolduÄŸunda (Ã¶rn: 3/3), "Limiti SÄ±fÄ±rla" butonuyla o IP'nin hakkÄ±nÄ± yenileyebilirsin.
                        </p>
                    </div>

                    <!-- Yenile ve TÃ¼mÃ¼nÃ¼ SÄ±fÄ±rla ButonlarÄ± -->
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_LOGS.loadLogs()">ðŸ”„ Yenile</button>
                        <button class="btn" style="width:auto; padding:12px 24px; margin:0; background:#500; color:#faa; border:1px solid #700;" onclick="IP_LOGS.clearAll()">ðŸ—‘ï¸ TÃ¼m LoglarÄ± SÄ±fÄ±rla</button>
                    </div>

                    <!-- Loglar Tablosu -->
                    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">Aktivite LoglarÄ±</h3>
                            <span id="ipLogsCount" style="color:#666; font-size:12px;">0 kayÄ±t</span>
                        </div>
                        <div id="ipLogsList" style="display:flex; flex-direction:column; gap:12px; min-height:100px;"></div>
                    </div>
                </div>

                <!-- TAB 2: KullanÄ±cÄ± KayÄ±tlarÄ± -->
                <div id="ipTabContentUsers" style="display:none;">
                    <!-- Bilgilendirme -->
                    <div style="background:#1a1a1a; border-left:4px solid #3b82f6; padding:15px; margin-bottom:20px; border-radius:8px;">
                        <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                            TÃ¼m kayÄ±tlÄ± kullanÄ±cÄ±larÄ± gÃ¶rebilir ve silebilirsiniz.
                            <br><strong style="color:#3b82f6;">KullanÄ±cÄ± Silme:</strong> Bir kullanÄ±cÄ±yÄ± sildiÄŸinizde, baÅŸka biri o nickname ile kaydolabilir.
                            <br><br><strong style="color:#ff9800;">ðŸ’¡ Not:</strong> EÄŸer birisi "furkan1" nickname'ini almak istiyorsa ama kullanÄ±mda ise, eski "furkan1" kullanÄ±cÄ±sÄ±nÄ± buradan silebilirsiniz.
                        </p>
                    </div>

                    <!-- Yenile ve Hepsini Sil ButonlarÄ± -->
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="IP_USERS.loadAllUsers()">ðŸ”„ KullanÄ±cÄ±larÄ± Yenile</button>
                        <button class="btn" style="width:auto; padding:12px 24px; margin:0; background:#dc2626; border-color:#dc2626; color:#fff;" onclick="IP_USERS.deleteAll()">ðŸ—‘ï¸ Hepsini Sil</button>
                    </div>

                    <!-- KullanÄ±cÄ±lar Listesi -->
                    <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">TÃ¼m KullanÄ±cÄ± KayÄ±tlarÄ±</h3>
                            <span id="ipUsersCount" style="color:#666; font-size:12px;">0 kullanÄ±cÄ±</span>
                        </div>
                        <div id="ipUsersList" style="display:flex; flex-direction:column; gap:12px; min-height:100px;">
                            <div style="color:#666; text-align:center; padding:30px;">YÃ¼kleniyor...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Profil FotoÄŸraflarÄ± BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionProfilephotos" class="admin-section" style="display:none;">
                <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">ðŸ“¸ Profil FotoÄŸraflarÄ± YÃ¶netimi</h3>

                <!-- Bilgilendirme -->
                <div style="background:#1a1a1a; border-left:4px solid var(--gold); padding:15px; margin-bottom:20px; border-radius:8px;">
                    <p style="color:#aaa; font-size:13px; line-height:1.6; margin:0;">
                        KullanÄ±cÄ±larÄ±n profil fotoÄŸraflarÄ±nÄ± buradan gÃ¶rÃ¼ntÃ¼leyebilir, silebilir veya deÄŸiÅŸtirebilirsiniz.
                        <br><strong style="color:var(--gold);">FotoÄŸraf Sil:</strong> KullanÄ±cÄ±nÄ±n profil fotoÄŸrafÄ± kaldÄ±rÄ±lÄ±r (varsayÄ±lan avatar gÃ¶sterilir)
                        <br><strong style="color:var(--gold);">FotoÄŸraf DeÄŸiÅŸtir:</strong> KullanÄ±cÄ± iÃ§in yeni bir fotoÄŸraf yÃ¼kleyebilirsiniz
                    </p>
                </div>

                <!-- Yenile Butonu -->
                <div style="margin-bottom:20px;">
                    <button class="btn btn-primary" style="width:auto; padding:12px 24px; margin:0;" onclick="PHOTO_ADMIN.loadUsers()">ðŸ”„ KullanÄ±cÄ±larÄ± Yenile</button>
                </div>

                <!-- KullanÄ±cÄ±lar Listesi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                        <h3 style="color:#888; font-size:13px; text-transform:uppercase; letter-spacing:1px;">KullanÄ±cÄ±lar ve Profil FotoÄŸraflarÄ±</h3>
                        <span id="photoUsersCount" style="color:#666; font-size:12px;">0 kullanÄ±cÄ±</span>
                    </div>
                    <div id="photoUsersList" style="display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:15px; min-height:100px;">
                        <div style="color:#666; text-align:center; padding:30px; grid-column: 1/-1;">YÃ¼kleniyor...</div>
                    </div>
                </div>

                <!-- FotoÄŸraf DeÄŸiÅŸtirme Modal (gizli) -->
                <input type="file" id="adminPhotoInput" accept="image/*" style="display:none;" onchange="PHOTO_ADMIN.handlePhotoSelect(event)">
            </div>

            <!-- Oyunu SÄ±fÄ±rla BÃ¶lÃ¼mÃ¼ -->
            <div id="adminSectionReset" class="admin-section" style="display:none;">
                <h3 style="color:#ff4444; font-size:18px; margin-bottom:20px; border-bottom:1px solid #ff4444; padding-bottom:10px;">ðŸ”„ Oyunu Tamamen SÄ±fÄ±rla</h3>

                <!-- UyarÄ± MesajÄ± -->
                <div style="background:#3d0000; border:2px solid #ff4444; padding:20px; margin-bottom:30px; border-radius:12px;">
                    <h3 style="color:#ff4444; font-size:16px; margin-bottom:15px;">âš ï¸ TEHLÄ°KELÄ° Ä°ÅžLEM - DÄ°KKATLE OKUYUN!</h3>
                    <p style="color:#ffaaaa; font-size:14px; line-height:1.8; margin:0;">
                        Bu iÅŸlem GERÄ° ALINAMAZ ve aÅŸaÄŸÄ±daki <strong>TÃœM VERÄ°LERÄ° SÄ°LER:</strong>
                    </p>
                    <ul style="color:#ffaaaa; font-size:14px; line-height:2; margin:15px 0 0 20px;">
                        <li><strong>TÃ¼m KullanÄ±cÄ±lar</strong> - KayÄ±tlÄ± tÃ¼m oyuncular silinecek</li>
                        <li><strong>TÃ¼m TakÄ±mlar</strong> - OluÅŸturulan tÃ¼m takÄ±mlar silinecek</li>
                        <li><strong>TÃ¼m Karakterler</strong> - Eklenen tÃ¼m karakterler silinecek</li>
                        <li><strong>TÃ¼m Ä°puÃ§larÄ±</strong> - Genel ve takÄ±m ipuÃ§larÄ± silinecek</li>
                        <li><strong>TÃ¼m Murder Board Verileri</strong> - Karakter kartlarÄ± ve baÄŸlantÄ±lar silinecek</li>
                        <li><strong>TÃ¼m Chat MesajlarÄ±</strong> - TakÄ±m mesajlarÄ± silinecek</li>
                        <li><strong>TÃ¼m IP LoglarÄ±</strong> - IP aktivite kayÄ±tlarÄ± silinecek</li>
                        <li><strong>TÃ¼m Rozetler</strong> - OluÅŸturulan rozetler silinecek</li>
                        <li><strong>EmeÄŸi GeÃ§enler</strong> - Credits kayÄ±tlarÄ± silinecek</li>
                    </ul>
                    <p style="color:#ff8888; font-size:15px; font-weight:600; margin:20px 0 0 0;">
                        ðŸ’¡ Bu iÅŸlem sadece yeni bir oyuna baÅŸlamadan Ã¶nce kullanÄ±lmalÄ±dÄ±r.
                    </p>
                </div>

                <!-- SÄ±fÄ±rlama Ä°ÅŸlemi -->
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:30px;">
                    <h3 style="color:#888; font-size:15px; margin-bottom:20px;">SÄ±fÄ±rlama Ä°ÅŸlemi</h3>

                    <p style="color:#aaa; font-size:14px; margin-bottom:20px;">
                        Ä°ÅŸlemi onaylamak iÃ§in aÅŸaÄŸÄ±daki butona basÄ±n. Ä°kinci bir onay ekranÄ± gÃ¶receksiniz.
                    </p>

                    <button class="btn" style="background:linear-gradient(135deg, #8b0000, #450000); border-color:#ff4444; color:#ff4444; font-weight:600; width:100%; padding:16px;" onclick="GAME_RESET.showConfirmModal()">
                        ðŸ”„ Oyunu SÄ±fÄ±rlamak Ä°stiyorum
                    </button>
                </div>
            </div>
        </div>

        <div class="page" id="pgScoreboard">
            <div class="admin-head">
                <h2>ðŸ† Liderlik Tablosu</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div id="scoreboardList" style="max-width:600px; margin:0 auto;"></div>
        </div>

        <div class="page" id="pgNotifications">
            <div class="admin-head">
                <h2>ðŸ”” Bildirimler</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div style="max-width:700px; margin:0 auto;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                    <div style="color:#888; font-size:13px;">
                        Toplam <span id="notifCount">0</span> bildirim
                    </div>
                    <button class="btn" style="width:auto; padding:8px 16px; font-size:12px; margin:0;" onclick="NOTIF.markAllRead()">TÃ¼mÃ¼nÃ¼ Okundu Ä°ÅŸaretle</button>
                </div>
                <div class="notif-list" id="notifList"></div>
            </div>
        </div>

        <div class="page" id="pgCreditDetail">
            <div class="admin-head">
                <h2 id="creditDetailName">-</h2>
                <button class="back-btn" onclick="GAME.goLobby()">Geri</button>
            </div>
            <div style="max-width:800px; margin:0 auto;">
                <div style="background:var(--card-bg); border:1px solid var(--border-color); border-radius:12px; padding:30px; min-height:300px;">
                    <h3 style="color:var(--gold); font-size:18px; margin-bottom:20px; border-bottom:1px solid var(--border-color); padding-bottom:10px;">KatkÄ±larÄ±</h3>
                    <div id="creditDetailContent" style="color:#ccc; font-size:15px; line-height:1.8; white-space:pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="passModal">
        <div class="modal-box">
            <h3 style="margin-bottom:10px; color:white;">YÃ¶netici GiriÅŸi</h3>
            <p style="margin:0 0 15px 0; color:#999; font-size:13px; text-align:center;">Minimum 12 karakter gerekli</p>
            <input type="password" id="inpPass" maxlength="50" placeholder="Admin ÅŸifrenizi girin..." style="text-align:center; font-size:16px; padding:12px;">
            <div style="display:flex; gap:10px;">
                <button class="btn" onclick="GAME.hidePassModal()">Ä°ptal</button>
                <button class="btn btn-primary" onclick="GAME.checkPass()">GiriÅŸ</button>
            </div>
        </div>
    </div>

    <!-- Final Raporu Modal -->
    <div class="modal" id="finalReportModal" style="display:none;">
        <div class="modal-box" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
            <h2 style="text-align:center; color:var(--gold); margin-bottom:20px; font-size:28px;">
                ðŸ† OYUN BÄ°TTÄ°! ðŸ†
            </h2>

            <div id="finalReportContent">
                <!-- Ä°Ã§erik JavaScript ile doldurulacak -->
            </div>

            <div style="text-align:center; margin-top:30px;">
                <button class="btn btn-primary" onclick="GAME.closeFinalReport()">Kapat</button>
            </div>
        </div>
    </div>

    <div id="toast"></div>

    <!-- MÃ¼zik AyarlarÄ± Butonu -->
    <button onclick="openMusicSettings()" class="music-settings-btn" title="MÃ¼zik AyarlarÄ±">
        ðŸŽµ
    </button>

    <!-- Tema SeÃ§ici -->
    <div class="theme-switcher">
        <div class="theme-menu" id="themeMenu">
            <div class="theme-option active" onclick="THEME.setTheme('classic')" data-theme="classic">
                <div class="theme-preview classic"></div>
                <span>Classic Dark</span>
            </div>
            <div class="theme-option" onclick="THEME.setTheme('midnight')" data-theme="midnight">
                <div class="theme-preview midnight"></div>
                <span>Midnight Detective</span>
            </div>
            <div class="theme-option" onclick="THEME.setTheme('blood')" data-theme="blood">
                <div class="theme-preview blood"></div>
                <span>Blood Moon</span>
            </div>
        </div>
        <button class="theme-btn" onclick="THEME.toggleMenu()">ðŸŽ¨</button>
    </div>

    <!-- Bildirim Popup -->
    <div id="notificationPopup" class="notification-popup">
        <div class="notif-header">
            <div class="notif-title" id="popupTitle">Bildirim</div>
            <button class="notif-close" onclick="NOTIF.closePopup()">Ã—</button>
        </div>
        <div class="notif-body" id="popupBody"></div>
        <div class="notif-time" id="popupTime"></div>
    </div>

    <!-- DÃ¼rtme SeÃ§ici ModalÄ± -->
    <div id="pokeSelectOverlay" class="poke-overlay" onclick="if(event.target===this) POKE.hidePokeModal()">
        <div class="poke-modal">
            <div style="text-align: center; margin-bottom: 25px;">
                <div style="font-size: 48px; margin-bottom: 10px;">ðŸ‘‹</div>
                <h2 style="margin: 0; color: #d44dd4; font-size: 24px; font-weight: 700;">Hangi TakÄ±mÄ± DÃ¼rtmek Ä°stersiniz?</h2>
                <p style="color: #888; font-size: 13px; margin-top: 8px;">Bir takÄ±mÄ± 1 dakikada en fazla 1 kere dÃ¼rtebilirsiniz</p>
            </div>
            <div id="pokeTeamList" style="max-height: 400px; overflow-y: auto; margin-bottom: 20px;">
                <!-- TakÄ±mlar buraya eklenecek -->
            </div>
            <button class="btn" style="width: 100%; margin: 0; border-color: #555;" onclick="POKE.hidePokeModal()">Ä°ptal</button>
        </div>
    </div>

    <!-- DÃ¼rtme Bildirimi OverlayÄ± -->
    <div id="pokeNotificationOverlay" class="poke-overlay">
        <div class="poke-notification">
            <div style="font-size: 80px; margin-bottom: 20px; animation: bounce 1s infinite;">ðŸ‘‹</div>
            <h2 id="pokeNotificationText" style="margin: 0; color: #fff; font-size: 32px; font-weight: 700; text-shadow: 0 0 20px rgba(212,77,212,0.8);">
                <!-- DÃ¼rtme mesajÄ± buraya gelecek -->
            </h2>
            <p style="color: #d44dd4; font-size: 18px; margin-top: 15px; font-weight: 600;">sizi dÃ¼rttÃ¼!</p>
        </div>
    </div>

    <!-- Bildirim Sesi -->
    <script>
        // Tema YÃ¶netimi
        var THEME = {
            // GÃœVENLÄ°K: sessionStorage kullan (localStorage yerine) - oturum sonu temizlensin
            current: sessionStorage.getItem('theme') || 'classic',

            init: function() {
                this.applyTheme(this.current);
            },

            setTheme: function(theme) {
                this.current = theme;
                sessionStorage.setItem('theme', theme);
                this.applyTheme(theme);
                this.updateActiveOption(theme);
                this.closeMenu();
            },

            applyTheme: function(theme) {
                if (theme === 'classic') {
                    document.documentElement.removeAttribute('data-theme');
                } else {
                    document.documentElement.setAttribute('data-theme', theme);
                }
            },

            updateActiveOption: function(theme) {
                document.querySelectorAll('.theme-option').forEach(function(opt) {
                    opt.classList.remove('active');
                });
                document.querySelector('.theme-option[data-theme="' + theme + '"]').classList.add('active');
            },

            toggleMenu: function() {
                var menu = document.getElementById('themeMenu');
                menu.classList.toggle('active');
            },

            closeMenu: function() {
                document.getElementById('themeMenu').classList.remove('active');
            }
        };

        // Sayfa yÃ¼klendiÄŸinde temayÄ± uygula
        THEME.init();

        // Bildirim Sistemi
        var NOTIFICATION = {
            container: null,
            nextId: 1,

            init: function() {
                this.container = document.getElementById('notificationContainer');
            },

            show: function(title, message, time) {
                if (!this.container) this.init();

                var id = 'notif-' + this.nextId++;
                var notif = document.createElement('div');
                notif.className = 'notification';
                notif.id = id;

                // GÃœVENLÄ°K: XSS korumasÄ± - innerHTML yerine DOM API kullan
                var header = document.createElement('div');
                header.className = 'notification-header';

                var titleDiv = document.createElement('div');
                titleDiv.className = 'notification-title';

                var icon = document.createElement('span');
                icon.textContent = 'ðŸŽ¯';
                titleDiv.appendChild(icon);

                var titleSpan = document.createElement('span');
                titleSpan.textContent = title;
                titleDiv.appendChild(titleSpan);

                var closeBtn = document.createElement('button');
                closeBtn.className = 'notification-close';
                closeBtn.textContent = 'Ã—';
                closeBtn.addEventListener('click', () => this.close(id));

                header.appendChild(titleDiv);
                header.appendChild(closeBtn);
                notif.appendChild(header);

                var body = document.createElement('div');
                body.className = 'notification-body';
                body.textContent = message;
                notif.appendChild(body);

                if (time) {
                    var timeDiv = document.createElement('div');
                    timeDiv.className = 'notification-time';
                    timeDiv.textContent = time;
                    notif.appendChild(timeDiv);
                }

                this.container.appendChild(notif);

                // 8 saniye sonra otomatik kapat
                setTimeout(() => {
                    this.close(id);
                }, 8000);

                return id;
            },

            close: function(id) {
                var notif = document.getElementById(id);
                if (notif) {
                    notif.classList.add('closing');
                    setTimeout(() => {
                        notif.remove();
                    }, 300);
                }
            }
        };

        NOTIFICATION.init();

        // Renk Ã–zelleÅŸtirme Sistemi
        var CUSTOMIZE = {
            selectedColor: '#3b82f6',

            init: function() {
                this.selectColor(this.selectedColor);
            },

            selectColor: function(color) {
                this.selectedColor = color;

                // TÃ¼m renk seÃ§eneklerini gÃ¼ncelle
                var options = document.querySelectorAll('.color-option');
                options.forEach(function(opt) {
                    opt.classList.remove('selected');
                    if (opt.getAttribute('data-color') === color) {
                        opt.classList.add('selected');
                    }
                });
            }
        };

        // MenÃ¼ dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.theme-switcher')) {
                THEME.closeMenu();
            }

            // Team dropdown dÄ±ÅŸÄ±na tÄ±klandÄ±ÄŸÄ±nda kapat
            var teamDropdown = document.getElementById('teamDropdown');
            var btnTeamSelector = document.getElementById('btnTeamSelector');
            if (teamDropdown && !e.target.closest('#btnTeamSelector') && !e.target.closest('#teamDropdown')) {
                teamDropdown.style.display = 'none';
            }
        });

        (function() {
            // Socket.IO baÄŸlantÄ±sÄ± - Cookie gÃ¶ndermesi iÃ§in withCredentials gerekli
            window.socket = io({
                withCredentials: true,  // Cookie gÃ¶nder (session iÃ§in kritik!)
                transports: ['websocket'],  // WebSocket-only (polling kapalÄ±, daha stabil)
                path: '/socket.io'  // Default path
            });
            var socket = window.socket;
            var socketConnected = false; // BaÄŸlantÄ± durumu
            var teams = [];
            var users = [];
            var currentUser = null; // GÃœVENLÄ°K: localStorage yerine sadece memory'de tut
            var credits = [
                { id: 'credit_1', name: 'Furkan', content: 'Oyunun tasarÄ±mÄ± ve geliÅŸtirmesi' },
                { id: 'credit_2', name: 'Claude', content: 'Kodlama ve teknik destek' }
            ];
            var currentTeamId = null; // GÃœVENLÄ°K: localStorage yerine server'dan al
            var selectedJoinId = null;
            var isProcessing = false;
            var isAdmin = false; // Admin panel eriÅŸimi iÃ§in

            // Navigation history - geri butonlarÄ± iÃ§in
            var pageHistory = [];

            // ========================================
            // CLIENT-SIDE ROUTING
            // ========================================

            // Route 1: Login/Nickname page
            router.register('/', () => {
                showPage('pgNickname');

                return {
                    cleanup: () => {
                        // Cleanup: Form inputlarÄ±nÄ± temizle
                        var nicknameInput = document.getElementById('inpNickname');
                        if (nicknameInput) {
                            nicknameInput.value = '';
                        }
                    }
                };
            });

            // Route 2: Lobby - requires authentication
            router.register('/lobby', () => {
                if (!currentUser) {
                    router.navigate('/');
                    return;
                }
                showPage('pgLobby');

                return {
                    cleanup: () => {
                        // Cleanup: Modal'larÄ± kapat
                        GAME.hideCreateForm();
                        GAME.hideJoinForm();
                    }
                };
            });

            // Route 3: Team page - requires authentication and team ID
            router.register('/team/:teamId', ({ teamId }) => {
                if (!currentUser) {
                    router.navigate('/');
                    return;
                }
                currentTeamId = teamId;

                // TakÄ±m bilgilerini al ve sayfayÄ± render et
                socket.emit('get-team', teamId, (team) => {
                    if (team) {
                        showPage('pgTeam');
                        renderTeamPage(team);
                    } else {
                        // TakÄ±m bulunamadÄ±, lobby'ye dÃ¶n
                        router.navigate('/lobby');
                    }
                });

                return {
                    cleanup: () => {
                        // Cleanup: TakÄ±m ID'sini temizle (sadece baÅŸka bir route'a gidiyorsa)
                        // currentTeamId = null; // exitTeam fonksiyonu bunu yapÄ±yor
                    }
                };
            });

            // Route 4: Admin panel main page
            router.register('/admin', () => {
                if (!isAdmin) {
                    router.navigate('/');
                    toast('Admin yetkisi gereklidir', true);
                    return;
                }
                showPage('pgAdmin');
                renderAdminList();
                ADMIN.showSection('game'); // Default section

                return {
                    cleanup: () => {
                        // Cleanup: Admin panel form'larÄ±nÄ± temizle
                        var generalClueInput = document.getElementById('inpGeneralClue');
                        if (generalClueInput) {
                            generalClueInput.value = '';
                        }
                    }
                };
            });

            // Route 5: Admin panel sections
            router.register('/admin/:section', ({ section }) => {
                if (!isAdmin) {
                    router.navigate('/');
                    toast('Admin yetkisi gereklidir', true);
                    return;
                }
                showPage('pgAdmin');
                renderAdminList();
                ADMIN.showSection(section);

                return {
                    cleanup: () => {
                        // Cleanup: Admin panel form'larÄ±nÄ± temizle
                        var generalClueInput = document.getElementById('inpGeneralClue');
                        if (generalClueInput) {
                            generalClueInput.value = '';
                        }
                    }
                };
            });

            // Route 6: Public scoreboard
            router.register('/scoreboard', () => {
                showPage('pgScoreboard');
                renderScoreboard();

                return {
                    cleanup: () => {
                        // Cleanup: Scoreboard sayfasÄ±nda Ã¶zel temizlik yok
                    }
                };
            });

            // Route 7: Notifications - requires authentication
            router.register('/notifications', () => {
                if (!currentUser) {
                    router.navigate('/');
                    return;
                }
                showPage('pgNotifications');
                NOTIF.render();

                return {
                    cleanup: () => {
                        // Cleanup: Notification sayfasÄ±nda Ã¶zel temizlik yok
                    }
                };
            });

            // Socket baÄŸlantÄ± event'leri
            socket.on('connect', function() {
                socketConnected = true;
                console.log('Socket baÄŸlantÄ±sÄ± kuruldu');
                console.log('ðŸª Browser cookies (JavaScript\'ten gÃ¶rÃ¼nenler):', document.cookie || 'yok');
                console.log('â„¹ï¸  NOT: httpOnly cookie\'ler (session) JavaScript\'ten gÃ¶rÃ¼lmez - bu normal ve gÃ¼venlik iÃ§in iyidir.');
                console.log('   Session cookie\'leri gÃ¶rmek iÃ§in: Browser DevTools â†’ Application â†’ Cookies');

                // SESSION RESTORE: Server'dan session kontrolÃ¼ yap
                socket.emit('reconnect-user', function(response) {
                    console.log('ðŸ”„ Session restore yanÄ±tÄ±:', response);

                    if (response && response.success) {
                        // Admin yetkisini Ã¶nce set et (routing iÃ§in gerekli)
                        isAdmin = response.isAdmin || false;

                        if (response.userId) {
                            // Normal kullanÄ±cÄ± restore et
                            currentUser = {
                                userId: response.userId,
                                nickname: response.nickname,
                                teamId: response.teamId || null
                            };
                            updateCurrentUserDisplay();

                            // TakÄ±m ID'sini restore et
                            if (response.teamId) {
                                currentTeamId = response.teamId;
                            }

                            console.log('âœ… Session restore edildi:', response.nickname, '- Admin:', isAdmin, '- SessionID mevcut');
                        } else if (response.isAdmin) {
                            // Admin-only session (userId yok)
                            currentUser = null;
                            currentTeamId = null;
                            updateCurrentUserDisplay();

                            console.log('âœ… Admin session restore edildi - SessionID mevcut');
                        }
                    } else {
                        // Session yok veya sÃ¼resi dolmuÅŸ
                        currentUser = null;
                        currentTeamId = null;
                        isAdmin = false;
                        updateCurrentUserDisplay();
                        console.log('âš ï¸  Session bulunamadÄ± veya sÃ¼resi dolmuÅŸ - GiriÅŸ yapmanÄ±z gerekebilir');
                    }

                    // ROUTING: Session restore sonrasÄ±, mevcut URL'e gÃ¶re sayfa gÃ¶ster
                    var currentPath = window.location.pathname;

                    // Ana sayfadaysa ve session varsa, uygun sayfaya yÃ¶nlendir
                    if ((currentPath === '/' || currentPath === '') && currentUser) {
                        if (currentTeamId) {
                            router.navigate('/team/' + currentTeamId, false);
                        } else {
                            router.navigate('/lobby', false);
                        }
                    } else {
                        // Mevcut URL'i handle et (route handler'lar auth check yapacak)
                        // Ã–NEMLÄ°: isAdmin zaten yukarÄ±da set edildi, router artÄ±k bunu gÃ¶recek
                        router.handleRoute(currentPath);
                    }
                });
            });

            socket.on('disconnect', function() {
                socketConnected = false;
                console.log('Socket baÄŸlantÄ±sÄ± koptu');
                toast('BaÄŸlantÄ± koptu. Yeniden baÄŸlanÄ±yor...', true);
            });

            socket.on('connect_error', function(err) {
                console.error('Socket baÄŸlantÄ± hatasÄ±:', err);
                toast('BaÄŸlantÄ± hatasÄ±!', true);
            });
            // GÃœVENLÄ°K: sessionStorage kullan (localStorage yerine) - tarayÄ±cÄ± kapatÄ±lÄ±nca temizlensin
            var notifications = JSON.parse(sessionStorage.getItem('notifications') || '[]');
            var generalClues = [];
            var popupTimeout = null;

            // Global timeout tracking - Memory leak Ã¶nleme
            var activeTimeouts = [];
            function trackTimeout(timeoutId) {
                activeTimeouts.push(timeoutId);
                return timeoutId;
            }
            function clearAllTimeouts() {
                activeTimeouts.forEach(function(id) {
                    clearTimeout(id);
                });
                activeTimeouts = [];
                if (popupTimeout) {
                    clearTimeout(popupTimeout);
                    popupTimeout = null;
                }
            }

            // Oyun durumu
            var gameState = {
                started: false,
                countdown: 0,
                phaseTitle: ''
            };

            // Zaman formatlayÄ±cÄ± (saniye -> MM:SS)
            function formatTime(seconds) {
                var mins = Math.floor(seconds / 60);
                var secs = seconds % 60;
                return (mins < 10 ? '0' : '') + mins + ':' + (secs < 10 ? '0' : '') + secs;
            }

            // HTML Escape - XSS korumasÄ±
            function htmlEscape(text) {
                if (!text) return '';
                var div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // UI YardÄ±mcÄ±larÄ±
            function toast(msg, err) {
                var t = document.getElementById('toast');
                if (!t) {
                    console.error('Toast element bulunamadÄ±!');
                    return;
                }
                t.textContent = msg;
                t.className = err ? 'show err' : 'show';
                setTimeout(function() { t.className = ''; }, 2500);
            }

            // Global scope'a ekle (GAME_RESET gibi diÄŸer objelerden eriÅŸim iÃ§in)
            window.toast = toast;

            function showPage(id, addToHistory = true) {
                // Mevcut aktif sayfayÄ± bul
                var currentPage = document.querySelector('.page.active');
                var currentPageId = currentPage ? currentPage.id : null;

                // EÄŸer aynÄ± sayfaya geÃ§iÅŸ yapÄ±lÄ±yorsa, history'ye ekleme
                if (currentPageId === id) {
                    return;
                }

                // History'ye ekle (geri butonlarÄ± iÃ§in)
                if (addToHistory && currentPageId) {
                    pageHistory.push(currentPageId);
                    // Max 10 sayfa tutulur (memory overflow Ã¶nleme)
                    if (pageHistory.length > 10) {
                        pageHistory.shift();
                    }
                }

                // SayfalarÄ± deÄŸiÅŸtir
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById(id).classList.add('active');
            }

            // Geri git fonksiyonu
            function goBack() {
                if (pageHistory.length > 0) {
                    var previousPage = pageHistory.pop();
                    showPage(previousPage, false); // History'ye ekleme
                } else {
                    // History yoksa lobby'ye git
                    if (currentUser) {
                        showPage('pgLobby', false);
                    } else {
                        showPage('pgNickname', false);
                    }
                }
            }

            function updateCurrentUserDisplay() {
                var userInfo = document.getElementById('currentUserInfo');
                var userNick = document.getElementById('currentUserNick');

                if (currentUser && currentUser.nickname) {
                    userNick.textContent = currentUser.nickname;
                    userInfo.style.display = 'block';
                } else {
                    userInfo.style.display = 'none';
                }
            }

            // Global Fonksiyonlar (HTML onclick iÃ§in)
            // HTML Escape fonksiyonu (XSS korumasÄ±)
            function escapeHtml(text) {
                if (!text) return '';
                var map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return String(text).replace(/[&<>"']/g, function(m) { return map[m]; });
            }

            window.adminScore = function(teamId, amount, teamName) {
                if (isProcessing) return;

                // GÃœVENLÄ°K: BÃ¼yÃ¼k puan deÄŸiÅŸiklikleri iÃ§in onay iste (Â±50 ve Ã¼stÃ¼)
                if (Math.abs(amount) >= 50) {
                    var message = teamName + ' takÄ±mÄ±na ' + (amount > 0 ? '+' : '') + amount + ' puan vermek istiyor musunuz?';
                    if (!confirm(message)) {
                        return;
                    }
                }

                isProcessing = true;
                socket.emit('change-score', { teamId: teamId, amount: amount }, function(res) {
                    isProcessing = false;
                    if (!res.success) toast(res.error, true);
                });
            };

            window.adminDel = function(teamId, teamName) {
                if (isProcessing) return;
                if (confirm(teamName + ' takÄ±mÄ±nÄ± silmek istiyor musunuz?')) {
                    isProcessing = true;
                    socket.emit('delete-team', teamId, function(res) {
                        isProcessing = false;
                        if (res.success) toast('TakÄ±m silindi.');
                        else toast(res.error, true);
                    });
                }
            };

            window.adminDeleteUser = function(userId, nickname) {
                if (isProcessing) return;
                if (confirm(nickname + ' kullanÄ±cÄ±sÄ±nÄ± silmek istiyor musunuz? Bu iÅŸlem geri alÄ±namaz.')) {
                    isProcessing = true;
                    socket.emit('delete-user', userId, function(res) {
                        isProcessing = false;
                        if (res.success) toast('KullanÄ±cÄ± silindi.');
                        else toast(res.error, true);
                    });
                }
            };

            // USER objesi - KullanÄ±cÄ± iÅŸlemleri
            window.USER = {
                cameraStream: null, // Aktif kamera stream'i
                selectedPhotoBlob: null, // SeÃ§ilen/Ã§ekilen fotoÄŸraf

                registerNickname: function() {
                    var nickname = document.getElementById('inpNickname').value.trim();
                    if (!nickname) {
                        toast('LÃ¼tfen bir nick girin!', true);
                        return;
                    }

                    // Socket baÄŸlantÄ±sÄ± kontrolÃ¼
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('register-user', nickname, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            // GÃœVENLÄ°K: localStorage'a kaydetme, sadece memory'de tut
                            currentUser = {
                                userId: res.userId,
                                nickname: res.nickname,
                                teamId: null,
                                profilePhotoUrl: res.profilePhotoUrl || null
                            };
                            updateCurrentUserDisplay();
                            console.log('âœ… KayÄ±t baÅŸarÄ±lÄ±! UserId:', res.userId);

                            // Profil fotoÄŸrafÄ± varsa yÃ¼kle
                            if (USER.selectedPhotoBlob) {
                                USER.uploadProfilePhoto(function(uploadSuccess) {
                                    if (uploadSuccess) {
                                        console.log('âœ… Profil fotoÄŸrafÄ± yÃ¼klendi');
                                    }
                                    // BaÅŸarÄ±lÄ± ya da deÄŸil, sayfaya geÃ§
                                    USER.selectedPhotoBlob = null; // Temizle
                                    showPage('pgLobby');
                                    history.pushState(null, null, '/lobby');
                                    toast('HoÅŸgeldin, ' + res.nickname + '!');
                                });
                            } else {
                                // FotoÄŸraf yoksa direkt geÃ§
                                showPage('pgLobby');
                                history.pushState(null, null, '/lobby');
                                toast('HoÅŸgeldin, ' + res.nickname + '!');
                            }
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // Profil fotoÄŸrafÄ± yÃ¼kleme
                uploadProfilePhoto: function(callback) {
                    if (!this.selectedPhotoBlob) {
                        if (callback) callback(false);
                        return;
                    }

                    var formData = new FormData();
                    formData.append('photo', this.selectedPhotoBlob, 'profile.jpg');

                    fetch('/api/upload-profile-photo', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    })
                    .then(function(response) { return response.json(); })
                    .then(function(data) {
                        if (data.success) {
                            console.log('âœ… FotoÄŸraf yÃ¼klendi:', data.photoUrl);
                            if (currentUser) {
                                currentUser.profilePhotoUrl = data.photoUrl;
                            }
                            if (callback) callback(true);
                        } else {
                            console.error('âŒ FotoÄŸraf yÃ¼kleme hatasÄ±:', data.error);
                            toast('FotoÄŸraf yÃ¼klenemedi', true);
                            if (callback) callback(false);
                        }
                    })
                    .catch(function(err) {
                        console.error('âŒ FotoÄŸraf yÃ¼kleme hatasÄ±:', err);
                        if (callback) callback(false);
                    });
                },

                // Kamera aÃ§
                openCamera: function() {
                    var video = document.getElementById('cameraVideo');
                    var container = document.getElementById('cameraContainer');
                    var buttons = document.getElementById('photoUploadButtons');

                    if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                        navigator.mediaDevices.getUserMedia({
                            video: {
                                facingMode: 'user',
                                width: { ideal: 640 },
                                height: { ideal: 640 }
                            }
                        })
                        .then(function(stream) {
                            USER.cameraStream = stream;
                            video.srcObject = stream;
                            container.style.display = 'block';
                            buttons.style.display = 'none';
                        })
                        .catch(function(err) {
                            console.error('Kamera eriÅŸim hatasÄ±:', err);
                            toast('Kamera aÃ§Ä±lamadÄ±. LÃ¼tfen izinleri kontrol edin.', true);
                        });
                    } else {
                        toast('Kamera desteklenmiyor', true);
                    }
                },

                // Kamera kapat
                closeCamera: function() {
                    if (this.cameraStream) {
                        this.cameraStream.getTracks().forEach(function(track) {
                            track.stop();
                        });
                        this.cameraStream = null;
                    }

                    var video = document.getElementById('cameraVideo');
                    var container = document.getElementById('cameraContainer');
                    var buttons = document.getElementById('photoUploadButtons');

                    video.srcObject = null;
                    container.style.display = 'none';
                    buttons.style.display = 'grid';
                },

                // FotoÄŸraf Ã§ek
                capturePhoto: function() {
                    var video = document.getElementById('cameraVideo');
                    var canvas = document.getElementById('photoCanvas');
                    var ctx = canvas.getContext('2d');

                    // Canvas boyutunu video ile eÅŸitle
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;

                    // Video frame'ini canvas'a Ã§iz
                    ctx.drawImage(video, 0, 0);

                    // Canvas'Ä± blob'a Ã§evir
                    canvas.toBlob(function(blob) {
                        USER.selectedPhotoBlob = blob;

                        // Ã–nizlemeyi gÃ¶ster
                        var preview = document.getElementById('photoPreview');
                        var previewImg = document.getElementById('photoPreviewImg');
                        previewImg.src = URL.createObjectURL(blob);
                        preview.style.display = 'block';

                        // KamerayÄ± kapat
                        USER.closeCamera();

                        toast('FotoÄŸraf Ã§ekildi!');
                    }, 'image/jpeg', 0.85);
                },

                // Galeriden dosya seÃ§
                handleFileSelect: function(event) {
                    var file = event.target.files[0];
                    if (!file) return;

                    // Dosya boyutu kontrolÃ¼ (5MB)
                    if (file.size > 5 * 1024 * 1024) {
                        toast('Dosya Ã§ok bÃ¼yÃ¼k! Maksimum 5MB olmalÄ±.', true);
                        event.target.value = '';
                        return;
                    }

                    // Dosya tipi kontrolÃ¼
                    if (!file.type.startsWith('image/')) {
                        toast('LÃ¼tfen bir resim dosyasÄ± seÃ§in!', true);
                        event.target.value = '';
                        return;
                    }

                    this.selectedPhotoBlob = file;

                    // Ã–nizlemeyi gÃ¶ster
                    var preview = document.getElementById('photoPreview');
                    var previewImg = document.getElementById('photoPreviewImg');
                    previewImg.src = URL.createObjectURL(file);
                    preview.style.display = 'block';

                    toast('FotoÄŸraf seÃ§ildi!');
                },

                // FotoÄŸrafÄ± kaldÄ±r
                removeProfilePhoto: function() {
                    this.selectedPhotoBlob = null;

                    var preview = document.getElementById('photoPreview');
                    var previewImg = document.getElementById('photoPreviewImg');
                    var fileInput = document.getElementById('photoFileInput');

                    preview.style.display = 'none';
                    previewImg.src = '';
                    fileInput.value = '';

                    // Kamera aÃ§Ä±ksa kapat
                    if (this.cameraStream) {
                        this.closeCamera();
                    }

                    toast('FotoÄŸraf kaldÄ±rÄ±ldÄ±');
                },

                logout: function() {
                    if (confirm('Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸinize emin misiniz?')) {
                        // Cleanup: TÃ¼m timeout'larÄ± temizle
                        clearAllTimeouts();

                        // FotoÄŸraf verilerini temizle
                        this.selectedPhotoBlob = null;
                        if (this.cameraStream) {
                            this.closeCamera();
                        }

                        // GÃœVENLÄ°K: Session'Ä± temizle
                        currentUser = null;
                        currentTeamId = null;
                        isAdmin = false;

                        // Server'a logout isteÄŸi gÃ¶nder (session'Ä± temizle)
                        socket.emit('logout-user', function() {
                            // Nick giriÅŸ sayfasÄ±na yÃ¶nlendir
                            router.navigate('/');
                            updateCurrentUserDisplay();
                            toast('Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.');
                        });
                    }
                }
            };

            window.GAME = {
                backToMain: function() {
                    // UX Ä°YÄ°LEÅžTÄ°RME: Ana sayfaya dÃ¶n - logout yap
                    if (confirm('Ana sayfaya dÃ¶nmek iÃ§in Ã§Ä±kÄ±ÅŸ yapÄ±lacak. Emin misiniz?')) {
                        // Cleanup: TÃ¼m timeout'larÄ± temizle
                        clearAllTimeouts();

                        currentUser = null;
                        currentTeamId = null;
                        isAdmin = false;

                        // Server'a logout isteÄŸi gÃ¶nder (session'Ä± temizle)
                        socket.emit('logout-user', function() {
                            // Ana sayfaya yÃ¶nlendir (nickname giriÅŸ ekranÄ±)
                            router.navigate('/');
                            updateCurrentUserDisplay();
                            toast('Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.');
                        });
                    }
                },
                showAdminLoginForm: function() {
                    // Admin ÅŸifre modalÄ±nÄ± gÃ¶ster
                    document.getElementById('passModal').classList.add('show');
                    document.getElementById('inpPass').value = '';
                    document.getElementById('inpPass').focus();
                },
                showCreateForm: function() {
                    // UX Ä°YÄ°LEÅžTÄ°RME: Lobby menÃ¼sÃ¼nÃ¼ gizle, sadece formu gÃ¶ster
                    document.getElementById('lobbyMenu').style.display = 'none';
                    document.getElementById('lobbyCredits').style.display = 'none';
                    document.getElementById('createForm').style.display = 'block';
                    document.getElementById('joinForm').style.display = 'none';
                    CUSTOMIZE.init(); // Avatar ve renk seÃ§iciyi baÅŸlat
                    document.getElementById('inpNewTeam').focus();
                },
                hideCreateForm: function() {
                    document.getElementById('createForm').style.display = 'none';
                    // Lobby menÃ¼sÃ¼nÃ¼ geri gÃ¶ster
                    document.getElementById('lobbyMenu').style.display = 'block';
                    document.getElementById('lobbyCredits').style.display = 'block';
                },
                showJoinForm: function() {
                    // UX Ä°YÄ°LEÅžTÄ°RME: Lobby menÃ¼sÃ¼nÃ¼ gizle, sadece takÄ±m listesini gÃ¶ster
                    document.getElementById('lobbyMenu').style.display = 'none';
                    document.getElementById('lobbyCredits').style.display = 'none';
                    document.getElementById('joinForm').style.display = 'block';
                    document.getElementById('createForm').style.display = 'none';
                    // TakÄ±m listesini gÃ¶ster, ÅŸifre kÄ±smÄ±nÄ± gizle
                    document.getElementById('joinTeamList').style.display = 'block';
                    document.getElementById('joinPasswordSection').style.display = 'none';
                    renderJoinList();
                },
                hideJoinForm: function() {
                    document.getElementById('joinForm').style.display = 'none';
                    // Formu sÄ±fÄ±rla
                    document.getElementById('joinTeamList').style.display = 'block';
                    document.getElementById('joinPasswordSection').style.display = 'none';
                    document.getElementById('inpJoinPassword').value = '';
                    selectedJoinId = null;
                    // Lobby menÃ¼sÃ¼nÃ¼ geri gÃ¶ster
                    document.getElementById('lobbyMenu').style.display = 'block';
                    document.getElementById('lobbyCredits').style.display = 'block';
                },
                backToTeamList: function() {
                    document.getElementById('joinTeamList').style.display = 'block';
                    document.getElementById('joinPasswordSection').style.display = 'none';
                    document.getElementById('inpJoinPassword').value = '';
                    selectedJoinId = null;
                },
                
                createTeam: function() {
                    if (!currentUser) {
                        toast('Ã–nce nick girmeniz gerekiyor!', true);
                        return;
                    }

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var name = document.getElementById('inpNewTeam').value.trim();
                    var password = document.getElementById('inpNewTeamPassword').value.trim();
                    if (!name) { toast('Ä°sim giriniz', true); return; }
                    if (!password) { toast('Åžifre giriniz', true); return; }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('create-team', {
                        name: name,
                        password: password,
                        color: CUSTOMIZE.selectedColor,
                        userId: currentUser.userId
                    }, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            // GÃœVENLÄ°K: localStorage yerine sadece memory'de tut
                            currentTeamId = res.team.id;
                            if (currentUser) currentUser.teamId = res.team.id;
                            GAME.hideCreateForm();
                            document.getElementById('inpNewTeam').value = '';
                            document.getElementById('inpNewTeamPassword').value = '';

                            // Ã–NCE sayfayÄ± deÄŸiÅŸtir ve render et
                            showPage('pgTeam');
                            renderTeamPage(res.team);
                            // SONRA URL'i gÃ¼ncelle
                            history.pushState(null, null, '/team/' + res.team.id);
                        } else { toast(res.error, true); }
                    });
                },
                selectJoin: function(el) {
                    selectedJoinId = el.getAttribute('data-id');
                    var teamName = el.getAttribute('data-name');

                    // TakÄ±m listesini gizle, ÅŸifre kÄ±smÄ±nÄ± gÃ¶ster
                    document.getElementById('joinTeamList').style.display = 'none';
                    document.getElementById('joinPasswordSection').style.display = 'block';
                    document.getElementById('selectedTeamName').textContent = teamName;
                    document.getElementById('inpJoinPassword').focus();
                },
                joinTeam: function() {
                    if (!currentUser) {
                        toast('Ã–nce nick girmeniz gerekiyor!', true);
                        return;
                    }

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (!selectedJoinId) { toast('TakÄ±m seÃ§iniz', true); return; }
                    var password = document.getElementById('inpJoinPassword').value.trim();
                    if (!password) { toast('Åžifre giriniz', true); return; }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('join-team', { teamId: selectedJoinId, password: password, userId: currentUser.userId }, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            // GÃœVENLÄ°K: localStorage yerine sadece memory'de tut
                            currentTeamId = selectedJoinId;
                            if (currentUser) currentUser.teamId = selectedJoinId;
                            GAME.hideJoinForm();
                            document.getElementById('inpJoinPassword').value = '';

                            // Ã–NCE sayfayÄ± deÄŸiÅŸtir ve render et
                            showPage('pgTeam');
                            renderTeamPage(res.team);
                            // SONRA URL'i gÃ¼ncelle
                            history.pushState(null, null, '/team/' + selectedJoinId);
                        } else { toast(res.error, true); }
                    });
                },
                addClue: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var inp = document.getElementById('inpClue');
                    var txt = inp.value.trim();
                    if (!txt) { toast('BoÅŸ ipucu gÃ¶nderilemez', true); return; }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('add-clue', { teamId: currentTeamId, clue: txt }, function(res) {
                        isProcessing = false;
                        if (res.success) { inp.value = ''; toast('Ä°pucu iletildi'); }
                        else { toast(res.error, true); }
                    });
                },

                exitTeam: function() {
                    currentTeamId = null;
                    router.navigate('/lobby');
                },
                exitAdmin: function() {
                    // Admin panelinden Ã§Ä±kÄ±ÅŸ - kullanÄ±cÄ± varsa takÄ±m seÃ§im ekranÄ±na, yoksa nickname ekranÄ±na
                    if (currentUser) {
                        router.navigate('/lobby');
                    } else {
                        router.navigate('/');
                    }
                },
                hidePassModal: function() { document.getElementById('passModal').classList.remove('show'); },
                checkPass: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var pass = document.getElementById('inpPass').value;

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('admin-login', pass, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            isAdmin = true; // Admin yetkisini set et
                            GAME.hidePassModal();

                            // Ã–NCE sayfayÄ± deÄŸiÅŸtir
                            showPage('pgAdmin');
                            renderAdminList();
                            ADMIN.showSection('game');
                            // SONRA URL'i gÃ¼ncelle
                            history.pushState(null, null, '/admin');
                        } else { toast('HatalÄ± ÅŸifre', true); }
                    });
                },
                goLobby: function() {
                    // UX Ä°YÄ°LEÅžTÄ°RME: Geri dÃ¶n - kullanÄ±cÄ± varsa takÄ±m seÃ§im ekranÄ±na, yoksa nickname ekranÄ±na
                    if (currentUser) {
                        // KullanÄ±cÄ± giriÅŸ yapmÄ±ÅŸ - takÄ±m seÃ§im ekranÄ±na git (logout yapma)
                        router.navigate('/lobby');
                        updateCurrentUserDisplay();
                    } else {
                        // KullanÄ±cÄ± giriÅŸ yapmamÄ±ÅŸ - nickname ekranÄ±na git
                        router.navigate('/');
                        updateCurrentUserDisplay();
                    }
                },
                exitGame: function() {
                    // Oyundan Ã§Ä±kÄ±ÅŸ - logout yap
                    if (confirm('Oyundan Ã§Ä±kmak istediÄŸinize emin misiniz?')) {
                        // Cleanup: TÃ¼m timeout'larÄ± temizle
                        clearAllTimeouts();

                        currentUser = null;
                        currentTeamId = null;
                        isAdmin = false;

                        // Server'a logout isteÄŸi gÃ¶nder (session'Ä± temizle)
                        socket.emit('logout-user', function() {
                            // Nick giriÅŸ sayfasÄ±na yÃ¶nlendir
                            router.navigate('/');
                            updateCurrentUserDisplay();
                            toast('Ã‡Ä±kÄ±ÅŸ yapÄ±ldÄ±.');
                        });
                    }
                },
                showScoreboard: function() { router.navigate('/scoreboard'); },
                showNotifications: function() { router.navigate('/notifications'); },
                showCreditDetail: function(creditId) {
                    var credit = credits.find(c => c.id === creditId);
                    if (!credit) {
                        toast('KiÅŸi bulunamadÄ±', true);
                        return;
                    }

                    document.getElementById('creditDetailName').textContent = credit.name;
                    var contentEl = document.getElementById('creditDetailContent');

                    if (credit.content && credit.content.trim() !== '') {
                        contentEl.textContent = credit.content;
                    } else {
                        contentEl.innerHTML = '<div style="color:#666; text-align:center; padding:40px; font-style:italic;">Bu kiÅŸi hakkÄ±nda henÃ¼z bilgi eklenmemiÅŸ.</div>';
                    }

                    showPage('pgCreditDetail');
                },
                resetGame: function() {
                    if (confirm('TÃœM veriler silinecek. Emin misiniz?')) {
                        socket.emit('reset-game', function(res) { toast('Oyun sÄ±fÄ±rlandÄ±'); });
                    }
                }
            };

            // BÄ°LDÄ°RÄ°M SÄ°STEMÄ°
            window.NOTIF = {
                add: function(title, message, type) {
                    var notif = {
                        id: Date.now() + Math.random(),
                        title: title,
                        message: message,
                        type: type || 'info', // 'score', 'announcement', 'info'
                        time: new Date().toLocaleString('tr-TR'),
                        unread: true
                    };
                    notifications.unshift(notif);
                    if (notifications.length > 50) notifications = notifications.slice(0, 50); // Max 50 bildirim
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.showPopup(notif, type);
                },

                showPopup: function(notif, type) {
                    document.getElementById('popupTitle').textContent = notif.title;
                    document.getElementById('popupBody').textContent = notif.message;
                    document.getElementById('popupTime').textContent = notif.time;

                    var popup = document.getElementById('notificationPopup');

                    // Ã–nceki tip class'larÄ±nÄ± temizle
                    popup.classList.remove('announcement', 'clue', 'score');

                    // Yeni tip class'Ä±nÄ± ekle
                    if (type) {
                        popup.classList.add(type);
                    }

                    popup.classList.add('show');

                    if (popupTimeout) clearTimeout(popupTimeout);
                    popupTimeout = setTimeout(function() {
                        popup.classList.remove('show');
                    }, 6000);
                },

                closePopup: function() {
                    document.getElementById('notificationPopup').classList.remove('show');
                    if (popupTimeout) clearTimeout(popupTimeout);
                },

                updateBadge: function() {
                    var unreadCount = notifications.filter(n => n.unread).length;
                    var badge = document.getElementById('notifBadgeLobby');
                    if (unreadCount > 0) {
                        badge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                },

                markAllRead: function() {
                    notifications.forEach(n => n.unread = false);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                },

                clearAll: function() {
                    notifications = [];
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                    this.renderAdminList();
                },

                deleteById: function(notifId) {
                    notifications = notifications.filter(n => n.id !== notifId);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();
                    this.render();
                    this.renderAdminList();
                },

                render: function() {
                    var container = document.getElementById('notifList');
                    document.getElementById('notifCount').textContent = notifications.length;

                    if (notifications.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:60px; color:#666;">HenÃ¼z bildirim yok</div>';
                        return;
                    }

                    // Bildirimleri okundu iÅŸaretle (sayfa aÃ§Ä±ldÄ±ÄŸÄ±nda)
                    notifications.forEach(n => n.unread = false);
                    sessionStorage.setItem('notifications', JSON.stringify(notifications));
                    this.updateBadge();

                    var html = '';
                    notifications.forEach(n => {
                        var icon = 'ðŸ“¢';
                        if (n.type === 'score') icon = 'ðŸŽ¯';
                        else if (n.type === 'announcement') icon = 'ðŸ“¢';

                        html += `
                        <div class="notif-item ${n.unread ? 'unread' : ''}">
                            <div class="notif-item-header">
                                <div class="notif-item-title">${icon} ${htmlEscape(n.title)}</div>
                                <div class="notif-item-time">${n.time}</div>
                            </div>
                            <div class="notif-item-body">${htmlEscape(n.message)}</div>
                        </div>`;
                    });
                    container.innerHTML = html;
                },

                renderAdminList: function() {
                    var container = document.getElementById('adminNotifList');
                    var countEl = document.getElementById('adminNotifCount');

                    if (!container) return; // YÃ¶netici panelinde deÄŸilsek Ã§Ä±k

                    countEl.textContent = notifications.length + ' bildirim';

                    if (notifications.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:40px; color:#555; font-size:13px;">HenÃ¼z bildirim yok</div>';
                        return;
                    }

                    var html = '';
                    notifications.forEach(function(n) {
                        var typeClass = n.type === 'announcement' ? 'announcement' : 'score';
                        var typeText = n.type === 'announcement' ? 'Duyuru' : 'Puan';

                        // GÃœVENLÄ°K: XSS korumasÄ± - n.message escape et
                        html += `
                        <div class="admin-notif-item">
                            <div class="admin-notif-content">
                                <span class="admin-notif-type ${typeClass}">${typeText}</span>
                                <div class="admin-notif-message">${htmlEscape(n.message)}</div>
                                <div class="admin-notif-time">${htmlEscape(n.time)}</div>
                            </div>
                            <button class="admin-notif-delete" onclick="ADMIN.deleteNotification(${n.id})">ðŸ—‘ï¸ Sil</button>
                        </div>`;
                    });
                    container.innerHTML = html;
                }
            };

            // CHAT FONKSÄ°YONLARI
            window.CHAT = {
                currentPage: 1,
                totalPages: 1,
                isLoading: false,
                selectedTargetTeamId: null,
                selectedTargetTeamName: null,
                availableTeams: [],

                // TakÄ±m dropdown'Ä±nÄ± aÃ§/kapat
                toggleTeamDropdown: function() {
                    var dropdown = document.getElementById('teamDropdown');
                    if (dropdown.style.display === 'none') {
                        CHAT.loadAvailableTeams();
                        dropdown.style.display = 'block';
                    } else {
                        dropdown.style.display = 'none';
                    }
                },

                // Mevcut takÄ±mlarÄ± yÃ¼kle
                loadAvailableTeams: function() {
                    var dropdown = document.getElementById('teamDropdown');
                    if (!dropdown) return;

                    var html = '';

                    // "TÃ¼m TakÄ±mlar" seÃ§eneÄŸi
                    html += `
                        <div onclick="CHAT.selectTeam(null, 'TÃ¼m TakÄ±mlar')" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #1a4d4d; color: ${!CHAT.selectedTargetTeamId ? '#4dd4d4' : '#999'}; font-weight: ${!CHAT.selectedTargetTeamId ? '700' : '400'}; transition: background 0.2s;" onmouseover="this.style.background='#1a4d4d'" onmouseout="this.style.background='transparent'">
                            ðŸ“¢ TÃ¼m TakÄ±mlar
                        </div>`;

                    // Admin seÃ§eneÄŸi
                    var isAdminSelected = CHAT.selectedTargetTeamId === 'admin';
                    html += `
                        <div onclick="CHAT.selectTeam('admin', 'Admin')" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #1a4d4d; color: ${isAdminSelected ? '#fbbf24' : '#f59e0b'}; font-weight: ${isAdminSelected ? '700' : '600'}; transition: background 0.2s;" onmouseover="this.style.background='#1a4d4d'" onmouseout="this.style.background='transparent'">
                            ðŸ‘‘ Admin (Ã–zel Mesaj)
                        </div>`;

                    // DiÄŸer takÄ±mlar
                    CHAT.availableTeams.forEach(function(team) {
                        var isSelected = CHAT.selectedTargetTeamId === team.id;
                        html += `
                            <div onclick="CHAT.selectTeam('${team.id}', '${htmlEscape(team.name)}')" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #1a4d4d; color: ${isSelected ? '#4dd4d4' : '#ccc'}; font-weight: ${isSelected ? '700' : '400'}; transition: background 0.2s;" onmouseover="this.style.background='#1a4d4d'" onmouseout="this.style.background='transparent'">
                                ðŸ”’ ${htmlEscape(team.name)}
                            </div>`;
                    });

                    dropdown.innerHTML = html;
                },

                // TakÄ±m seÃ§
                selectTeam: function(teamId, teamName) {
                    CHAT.selectedTargetTeamId = teamId;
                    CHAT.selectedTargetTeamName = teamName;

                    var textEl = document.getElementById('selectedTeamText');
                    if (textEl) {
                        if (teamId === 'admin') {
                            textEl.textContent = 'ðŸ‘‘ ' + teamName;
                        } else if (teamId) {
                            textEl.textContent = 'ðŸ”’ ' + teamName;
                        } else {
                            textEl.textContent = 'ðŸ“¢ TÃ¼m TakÄ±mlar';
                        }
                    }

                    // Dropdown'Ä± kapat
                    var dropdown = document.getElementById('teamDropdown');
                    if (dropdown) dropdown.style.display = 'none';

                    // MesajlarÄ± filtrele ve yeniden yÃ¼kle
                    CHAT.loadMessages(1);
                },

                // Mevcut takÄ±mlarÄ± gÃ¼ncelle
                updateAvailableTeams: function(teams) {
                    // Kendi takÄ±mÄ±nÄ± hariÃ§ tut
                    if (currentUser && currentUser.teamId) {
                        CHAT.availableTeams = teams.filter(function(team) {
                            return team.id !== currentUser.teamId;
                        });
                    } else {
                        CHAT.availableTeams = teams;
                    }
                },

                // Mesaj gÃ¶nder
                sendMessage: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var input = document.getElementById('inpTeamChat');
                    var message = input.value.trim();

                    if (!message) {
                        toast('Mesaj boÅŸ olamaz!', true);
                        return;
                    }

                    var data = {
                        message: message,
                        targetTeamId: CHAT.selectedTargetTeamId
                    };

                    socket.emit('send-team-message', data, function(res) {
                        if (res.success) {
                            input.value = '';
                            // Mesaj otomatik olarak 'new-team-message' event'i ile gelecek
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // MesajlarÄ± yÃ¼kle
                loadMessages: function(page) {
                    if (CHAT.isLoading) return;
                    CHAT.isLoading = true;

                    socket.emit('load-team-messages', {
                        page: page,
                        filterTeamId: CHAT.selectedTargetTeamId  // Filtre ekle
                    }, function(res) {
                        CHAT.isLoading = false;
                        if (res.success) {
                            CHAT.currentPage = res.pagination.currentPage;
                            CHAT.totalPages = res.pagination.totalPages;
                            CHAT.renderMessages(res.messages);
                            CHAT.updatePagination(res.pagination);
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // Ã–nceki sayfa
                loadPreviousPage: function() {
                    if (CHAT.currentPage > 1) {
                        CHAT.loadMessages(CHAT.currentPage - 1);
                    }
                },

                // Sonraki sayfa
                loadNextPage: function() {
                    if (CHAT.currentPage < CHAT.totalPages) {
                        CHAT.loadMessages(CHAT.currentPage + 1);
                    }
                },

                // MesajlarÄ± render et
                renderMessages: function(messages) {
                    var container = document.getElementById('teamChatMessages');
                    var countEl = document.getElementById('teamChatCount');

                    if (!container) return;

                    // SayacÄ± gÃ¼ncelle
                    if (countEl) {
                        countEl.textContent = messages.length;
                    }

                    if (messages.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 60px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ðŸ’¬</div>
                                <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                                <div style="font-size: 12px; color: #444; margin-top: 5px;">Ä°lk mesajÄ± sen gÃ¶nder!</div>
                            </div>`;
                        return;
                    }

                    // MesajlarÄ± WhatsApp sÄ±ralamasÄ±na gÃ¶re dÃ¼zenle (eski â†’ yeni)
                    var sortedMessages = messages.slice().reverse();

                    var html = '';
                    sortedMessages.forEach(function(msg) {
                        var time = new Date(msg.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                        var isOwnMessage = currentUser && msg.user_id === currentUser.userId;

                        // Hedef takÄ±m etiketi
                        var targetLabel = '';
                        if (msg.target_team_id === 'admin') {
                            targetLabel = `<span style="color: #fbbf24; font-size: 10px; background: rgba(251,191,36,0.2); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(251,191,36,0.4);">ðŸ‘‘ â†’ Admin (Ã–zel)</span>`;
                        } else if (msg.target_team_name) {
                            targetLabel = `<span style="color: #d4af37; font-size: 10px; background: rgba(212,175,55,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(212,175,55,0.3);">ðŸ”’ â†’ ${htmlEscape(msg.target_team_name)}</span>`;
                        } else {
                            targetLabel = `<span style="color: #4dd4d4; font-size: 10px; background: rgba(77,212,212,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(77,212,212,0.3);">ðŸ“¢ TÃ¼m TakÄ±mlar</span>`;
                        }

                        // TakÄ±m rengi badge
                        var teamColor = msg.team_color || '#3b82f6';
                        var teamBadge = `<span style="background: ${teamColor}; color: #fff; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">${htmlEscape(msg.team_name)}</span>`;

                        // Profil fotoÄŸrafÄ± avatar
                        var avatar = msg.profile_photo_url ?
                            `<img src="${msg.profile_photo_url}" alt="${htmlEscape(msg.nickname)}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 2px solid ${isOwnMessage ? '#4dd4d4' : '#ffa500'};">` :
                            `<div style="width: 32px; height: 32px; border-radius: 50%; background: ${isOwnMessage ? '#0a4040' : '#333'}; display: flex; align-items: center; justify-content: center; font-size: 16px; border: 2px solid ${isOwnMessage ? '#4dd4d4' : '#ffa500'};">ðŸ‘¤</div>`;

                        // WhatsApp tarzÄ± gÃ¶rÃ¼nÃ¼m
                        if (isOwnMessage) {
                            // Kendi mesajÄ±m - SAÄžDA
                            html += `
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 12px; align-items: flex-end; gap: 8px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-end;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; justify-content: flex-end;">
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                        ${targetLabel}
                                        ${teamBadge}
                                        <span style="color: #4dd4d4; font-weight: 700; font-size: 13px;">${htmlEscape(msg.nickname)}</span>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #0d5858, #0a4040); border: 1px solid #1a7070; border-radius: 12px 12px 2px 12px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3); position: relative;">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                                ${avatar}
                            </div>`;
                        } else {
                            // DiÄŸer kiÅŸinin mesajÄ± - SOLDA
                            html += `
                            <div style="display: flex; justify-content: flex-start; margin-bottom: 12px; align-items: flex-end; gap: 8px;">
                                ${avatar}
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                        <span style="color: #ffa500; font-weight: 700; font-size: 13px;">${htmlEscape(msg.nickname)}</span>
                                        ${teamBadge}
                                        ${targetLabel}
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                    </div>
                                    <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                            </div>`;
                        }
                    });

                    container.innerHTML = html;

                    // En alta scroll
                    container.scrollTop = container.scrollHeight;
                },

                // Pagination kontrollerini gÃ¼ncelle
                updatePagination: function(pagination) {
                    var paginationDiv = document.getElementById('teamChatPagination');
                    var prevBtn = document.getElementById('btnChatPrevPage');
                    var nextBtn = document.getElementById('btnChatNextPage');
                    var currentPageEl = document.getElementById('chatCurrentPage');
                    var totalPagesEl = document.getElementById('chatTotalPages');
                    var totalMessagesEl = document.getElementById('chatTotalMessages');

                    if (!paginationDiv) return;

                    // Toplam mesaj sayÄ±sÄ±nÄ± gÃ¼ncelle
                    if (totalMessagesEl) {
                        totalMessagesEl.textContent = pagination.totalMessages;
                        document.getElementById('teamChatCount').textContent = pagination.totalMessages;
                    }

                    // Pagination varsa gÃ¶ster
                    if (pagination.totalPages > 1) {
                        paginationDiv.style.display = 'block';

                        if (currentPageEl) currentPageEl.textContent = pagination.currentPage;
                        if (totalPagesEl) totalPagesEl.textContent = pagination.totalPages;

                        // Ã–nceki buton
                        if (prevBtn) {
                            if (pagination.currentPage > 1) {
                                prevBtn.disabled = false;
                                prevBtn.style.opacity = '1';
                            } else {
                                prevBtn.disabled = true;
                                prevBtn.style.opacity = '0.5';
                            }
                        }

                        // Sonraki buton
                        if (nextBtn) {
                            if (pagination.hasMore) {
                                nextBtn.disabled = false;
                                nextBtn.style.opacity = '1';
                            } else {
                                nextBtn.disabled = true;
                                nextBtn.style.opacity = '0.5';
                            }
                        }
                    } else {
                        paginationDiv.style.display = 'none';
                    }
                },

                // Yeni mesaj geldiÄŸinde
                onNewMessage: function(message) {
                    // EÄŸer son sayfadaysak, mesajÄ± ekle
                    if (CHAT.currentPage === CHAT.totalPages || CHAT.totalPages === 0) {
                        var container = document.getElementById('teamChatMessages');
                        if (!container) return;

                        // BoÅŸ mesaj varsa temizle
                        if (container.querySelector('[style*="HenÃ¼z mesaj yok"]')) {
                            container.innerHTML = '';
                        }

                        var time = new Date(message.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                        var isOwnMessage = currentUser && message.user_id === currentUser.userId;

                        // Hedef takÄ±m etiketi
                        var targetLabel = '';
                        if (message.target_team_name) {
                            targetLabel = `<span style="color: #d4af37; font-size: 10px; background: rgba(212,175,55,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(212,175,55,0.3);">ðŸ”’ â†’ ${htmlEscape(message.target_team_name)}</span>`;
                        } else {
                            targetLabel = `<span style="color: #4dd4d4; font-size: 10px; background: rgba(77,212,212,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(77,212,212,0.3);">ðŸ“¢ TÃ¼m TakÄ±mlar</span>`;
                        }

                        // TakÄ±m badge
                        var teamColor = message.team_color || '#3b82f6';
                        var teamBadge = `<span style="background: ${teamColor}; color: #fff; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">${htmlEscape(message.team_name)}</span>`;

                        // Profil fotoÄŸrafÄ± avatar
                        var avatar = message.profile_photo_url ?
                            `<img src="${message.profile_photo_url}" alt="${htmlEscape(message.nickname)}" style="width: 32px; height: 32px; border-radius: 50%; object-fit: cover; border: 2px solid ${isOwnMessage ? '#4dd4d4' : '#ffa500'};">` :
                            `<div style="width: 32px; height: 32px; border-radius: 50%; background: ${isOwnMessage ? '#0a4040' : '#333'}; display: flex; align-items: center; justify-content: center; font-size: 16px; border: 2px solid ${isOwnMessage ? '#4dd4d4' : '#ffa500'};">ðŸ‘¤</div>`;

                        var html = '';
                        if (isOwnMessage) {
                            html = `
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 12px; align-items: flex-end; gap: 8px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-end;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; justify-content: flex-end;">
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                        ${targetLabel}
                                        ${teamBadge}
                                        <span style="color: #4dd4d4; font-weight: 700; font-size: 13px;">${htmlEscape(message.nickname)}</span>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #0d5858, #0a4040); border: 1px solid #1a7070; border-radius: 12px 12px 2px 12px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(message.message)}
                                    </div>
                                </div>
                                ${avatar}
                            </div>`;
                        } else {
                            html = `
                            <div style="display: flex; justify-content: flex-start; margin-bottom: 12px; align-items: flex-end; gap: 8px;">
                                ${avatar}
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                        <span style="color: #ffa500; font-weight: 700; font-size: 13px;">${htmlEscape(message.nickname)}</span>
                                        ${teamBadge}
                                        ${targetLabel}
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                    </div>
                                    <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(message.message)}
                                    </div>
                                </div>
                            </div>`;
                        }

                        container.insertAdjacentHTML('beforeend', html);
                        container.scrollTop = container.scrollHeight;

                        // SayacÄ± gÃ¼ncelle
                        var countEl = document.getElementById('teamChatCount');
                        if (countEl) {
                            var currentCount = parseInt(countEl.textContent) || 0;
                            countEl.textContent = currentCount + 1;
                        }
                    }
                },

                // FINAL RAPORU GÃ–STER
                showFinalReport: function(report) {
                    var modal = document.getElementById('finalReportModal');
                    var content = document.getElementById('finalReportContent');

                    var html = '';

                    // Ä°statistikler
                    html += '<div style="background:#111; padding:20px; border-radius:8px; margin-bottom:20px; text-align:center;">';
                    html += '<h3 style="color:var(--gold); margin-bottom:15px;">ðŸ“Š Oyun Ä°statistikleri</h3>';
                    html += '<div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:15px;">';
                    html += '<div><div style="font-size:32px; color:var(--gold);">' + report.stats.durationMinutes + '</div><div style="color:#888; font-size:13px;">Dakika</div></div>';
                    html += '<div><div style="font-size:32px; color:#4CAF50;">' + report.stats.totalTeams + '</div><div style="color:#888; font-size:13px;">TakÄ±m</div></div>';
                    html += '<div><div style="font-size:32px; color:#2196F3;">' + report.stats.totalClues + '</div><div style="color:#888; font-size:13px;">Ä°pucu</div></div>';
                    html += '<div><div style="font-size:32px; color:#FF9800;">' + report.stats.totalMessages + '</div><div style="color:#888; font-size:13px;">Mesaj</div></div>';
                    html += '</div></div>';

                    // TakÄ±m SÄ±ralamasÄ±
                    html += '<div style="background:#111; padding:20px; border-radius:8px; margin-bottom:20px;">';
                    html += '<h3 style="color:var(--gold); margin-bottom:15px;">ðŸ… TakÄ±m SÄ±ralamasÄ±</h3>';
                    report.teams.forEach(function(team, index) {
                        var medal = index === 0 ? 'ðŸ¥‡' : (index === 1 ? 'ðŸ¥ˆ' : (index === 2 ? 'ðŸ¥‰' : ''));
                        html += '<div style="background:#0a0a0a; padding:15px; margin-bottom:10px; border-radius:6px; display:flex; align-items:center; gap:15px; border-left:4px solid ' + team.color + ';">';
                        html += '<div style="font-size:32px;">' + medal + '</div>';
                        html += '<div style="flex:1;">';
                        html += '<div style="font-size:18px; color:#fff; font-weight:600;">' + team.name + '</div>';
                        html += '<div style="color:#888; font-size:13px;">' + team.clueCount + ' ipucu â€¢ ' + team.messageCount + ' mesaj</div>';
                        html += '</div>';
                        html += '<div style="font-size:24px; color:var(--gold); font-weight:700;">' + team.score + ' puan</div>';
                        html += '</div>';
                    });
                    html += '</div>';

                    // Rozetler
                    if (report.badges && report.badges.length > 0) {
                        html += '<div style="background:#111; padding:20px; border-radius:8px; margin-bottom:20px;">';
                        html += '<h3 style="color:var(--gold); margin-bottom:15px;">ðŸŽ–ï¸ Rozetler</h3>';
                        report.badges.forEach(function(badge) {
                            html += '<div style="background:#0a0a0a; padding:12px; margin-bottom:8px; border-radius:6px; display:flex; align-items:center; gap:12px;">';
                            html += '<div style="font-size:28px;">' + badge.badge.split(' ')[0] + '</div>';
                            html += '<div style="flex:1;">';
                            html += '<div style="font-size:16px; color:#fff; font-weight:600;">' + badge.badge + '</div>';
                            html += '<div style="color:#888; font-size:13px;">' + badge.teamName + ' - ' + badge.reason + '</div>';
                            html += '</div>';
                            html += '</div>';
                        });
                        html += '</div>';
                    }

                    // Timeline
                    if (report.timeline && report.timeline.length > 0) {
                        html += '<div style="background:#111; padding:20px; border-radius:8px;">';
                        html += '<h3 style="color:var(--gold); margin-bottom:15px;">â±ï¸ Oyun Kronolojisi</h3>';
                        html += '<div style="max-height:300px; overflow-y:auto;">';
                        report.timeline.forEach(function(event) {
                            var eventTime = new Date(event.time).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                            var eventIcon = event.type === 'clue_added' ? 'ðŸ”' : (event.type === 'score_changed' ? 'â­' : 'ðŸ“Œ');
                            html += '<div style="background:#0a0a0a; padding:10px; margin-bottom:6px; border-radius:4px; font-size:13px; display:flex; gap:10px; align-items:center;">';
                            html += '<div style="color:#666; font-size:11px; min-width:45px;">' + eventTime + '</div>';
                            html += '<div style="font-size:16px;">' + eventIcon + '</div>';
                            html += '<div style="color:#ccc;"><strong style="color:#fff;">' + (event.teamName || 'Admin') + '</strong>: ' + event.description + '</div>';
                            html += '</div>';
                        });
                        html += '</div></div>';
                    }

                    content.innerHTML = html;
                    modal.style.display = 'flex';
                },

                // FINAL RAPORU KAPAT
                closeFinalReport: function() {
                    document.getElementById('finalReportModal').style.display = 'none';
                }
            };

            // YÃ–NETÄ°CÄ° FONKSÄ°YONLARI
            window.ADMIN = {
                currentSection: 'game',

                showSection: function(section) {
                    // TÃ¼m bÃ¶lÃ¼mleri gizle
                    document.querySelectorAll('.admin-section').forEach(function(el) {
                        el.style.display = 'none';
                    });

                    // SeÃ§ili bÃ¶lÃ¼mÃ¼ gÃ¶ster
                    document.getElementById('adminSection' + section.charAt(0).toUpperCase() + section.slice(1)).style.display = 'block';

                    // MenÃ¼ butonlarÄ±nÄ± gÃ¼ncelle
                    var buttons = document.querySelectorAll('#pgAdmin > div:nth-child(2) button');
                    buttons.forEach(function(btn) {
                        btn.classList.remove('btn-primary');
                        btn.classList.add('btn');
                    });

                    // SeÃ§ili butonu vurgula
                    if (section === 'game') buttons[0].classList.add('btn-primary');
                    else if (section === 'characters') buttons[1].classList.add('btn-primary');
                    else if (section === 'users') buttons[2].classList.add('btn-primary');
                    else if (section === 'scoring') buttons[3].classList.add('btn-primary');
                    else if (section === 'notifications') buttons[4].classList.add('btn-primary');
                    else if (section === 'chat') buttons[5].classList.add('btn-primary');
                    else if (section === 'adminmessages') buttons[6].classList.add('btn-primary');
                    else if (section === 'murderboard') buttons[7].classList.add('btn-primary');
                    else if (section === 'stats') buttons[8].classList.add('btn-primary');
                    else if (section === 'credits') buttons[9].classList.add('btn-primary');
                    else if (section === 'iplogs') buttons[10].classList.add('btn-primary');
                    else if (section === 'profilephotos') buttons[11].classList.add('btn-primary');

                    this.currentSection = section;

                    // Oyun kontrolÃ¼ bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa karakterleri yÃ¼kle
                    if (section === 'game') {
                        ADMIN.loadGameCharacters();
                    }

                    // Karakterler bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa karakterleri yÃ¼kle
                    if (section === 'characters') {
                        CHARACTER.loadCharacters();
                    }

                    // Admin MesajlarÄ± bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa mesajlarÄ± yÃ¼kle
                    if (section === 'adminmessages') {
                        ADMIN.loadAdminMessages();
                    }

                    // Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa takÄ±mlarÄ± ve board'u yÃ¼kle
                    if (section === 'murderboard') {
                        if (socketConnected) {
                            ADMIN_BOARD.init();
                        } else {
                            console.log('Socket baÄŸlantÄ±sÄ± bekliyor...');
                        }
                    }

                    // KullanÄ±cÄ±lar bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa listeyi render et
                    if (section === 'users') {
                        // Manuel olarak kullanÄ±cÄ±larÄ± server'dan Ã§ek
                        if (socketConnected) {
                            socket.emit('get-users-by-team', function(fetchedUsers) {
                                users = fetchedUsers;
                                renderUsersList();
                            });
                        } else {
                            renderUsersList();
                        }
                    }

                    // Chat Ä°zleme bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa dropdown'Ä± doldur
                    if (section === 'chat') {
                        ADMIN.updateChatTeamSelector();
                    }

                    // EmeÄŸi geÃ§enler bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa listeyi render et
                    if (section === 'credits') {
                        renderCreditsList();
                    }

                    // IP LoglarÄ± bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa varsayÄ±lan tab'Ä± gÃ¶ster
                    if (section === 'iplogs') {
                        IP_SECTION.showTab('logs');
                    }

                    // Profil FotoÄŸraflarÄ± bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa kullanÄ±cÄ±larÄ± yÃ¼kle
                    if (section === 'profilephotos') {
                        PHOTO_ADMIN.loadUsers();
                    }

                    // Ä°statistikler bÃ¶lÃ¼mÃ¼ aÃ§Ä±ldÄ±ysa verileri yÃ¼kle
                    if (section === 'stats') {
                        ADMIN.loadStatistics();
                    }
                },

                loadGameCharacters: function() {
                    console.log('loadGameCharacters Ã§aÄŸrÄ±ldÄ±');
                    if (!socketConnected) {
                        console.error('Socket baÄŸlantÄ±sÄ± yok, karakterler yÃ¼klenemiyor!');
                        return;
                    }

                    socket.emit('get-characters', function(characters) {
                        console.log('Karakterler yÃ¼klendi:', characters);
                        ADMIN.renderGameCharacters(characters);
                    });
                },

                renderGameCharacters: function(characters) {
                    console.log('renderGameCharacters Ã§aÄŸrÄ±ldÄ±, karakter sayÄ±sÄ±:', characters.length);
                    const container = document.getElementById('gameCharactersList');

                    if (!container) {
                        console.error('gameCharactersList container bulunamadÄ±!');
                        return;
                    }

                    if (characters.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ðŸ‘¤</div>
                                <div style="font-size: 14px;">HenÃ¼z karakter eklenmemiÅŸ</div>
                            </div>
                        `;
                        return;
                    }

                    let html = '';
                    characters.forEach(function(char) {
                        const isVisible = char.visible_to_teams;
                        html += `
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: #0a0a0a; border: 1px solid #333; border-radius: 8px; margin-bottom: 10px;">
                                ${char.photo_url ? `
                                    <img src="${char.photo_url}" alt="${char.name}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 6px; border: 2px solid #444;">
                                ` : `
                                    <div style="width: 50px; height: 50px; background: #222; border-radius: 6px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; font-size: 24px;">ðŸ‘¤</div>
                                `}

                                <div style="flex: 1; min-width: 0;">
                                    <div style="color: #4dd4d4; font-weight: 600; font-size: 14px;">${escapeHtml(char.name)}</div>
                                    <div style="color: #666; font-size: 11px; margin-top: 2px;">
                                        ${char.age ? char.age + ' yaÅŸ' : ''} ${char.occupation ? ' â€¢ ' + escapeHtml(char.occupation) : ''}
                                    </div>
                                </div>

                                <label style="position: relative; display: inline-block; width: 50px; height: 26px; cursor: pointer;">
                                    <input type="checkbox" ${isVisible ? 'checked' : ''} onchange="ADMIN.toggleGameCharacterVisibility('${char.id}', this.checked, this)" style="opacity: 0; width: 0; height: 0;">
                                    <span class="toggle-bg" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: ${isVisible ? '#1a4d1a' : '#333'}; border-radius: 26px; transition: 0.3s;"></span>
                                    <span class="toggle-btn" style="position: absolute; height: 18px; width: 18px; left: ${isVisible ? '28px' : '4px'}; bottom: 4px; background: ${isVisible ? '#4dd44d' : '#888'}; border-radius: 50%; transition: 0.3s;"></span>
                                </label>
                            </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                toggleGameCharacterVisibility: function(characterId, visible, checkboxElement) {
                    console.log('toggleGameCharacterVisibility Ã§aÄŸrÄ±ldÄ±:', characterId, visible);

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        console.error('Socket baÄŸlantÄ±sÄ± yok!');
                        return;
                    }

                    // Toggle gÃ¶rselini gÃ¼ncelle
                    const label = checkboxElement.parentElement;
                    const toggleBg = label.querySelector('.toggle-bg');
                    const toggleBtn = label.querySelector('.toggle-btn');

                    if (toggleBg && toggleBtn) {
                        if (visible) {
                            toggleBg.style.background = '#1a4d1a';
                            toggleBtn.style.background = '#4dd44d';
                            toggleBtn.style.left = '28px';
                        } else {
                            toggleBg.style.background = '#333';
                            toggleBtn.style.background = '#888';
                            toggleBtn.style.left = '4px';
                        }
                    }

                    socket.emit('toggle-character-visibility', {
                        characterId: characterId,
                        visible: visible
                    }, function(response) {
                        console.log('Toggle response:', response);
                        if (response.success) {
                            toast(visible ? 'ðŸ‘ï¸ Karakter aÃ§Ä±ldÄ± - TakÄ±mlar gÃ¶rebilir' : 'ðŸ”’ Karakter kapatÄ±ldÄ±');
                        } else {
                            // Hata varsa toggle'Ä± geri al
                            checkboxElement.checked = !visible;
                            if (toggleBg && toggleBtn) {
                                if (!visible) {
                                    toggleBg.style.background = '#1a4d1a';
                                    toggleBtn.style.background = '#4dd44d';
                                    toggleBtn.style.left = '28px';
                                } else {
                                    toggleBg.style.background = '#333';
                                    toggleBtn.style.background = '#888';
                                    toggleBtn.style.left = '4px';
                                }
                            }
                            toast(response.error || 'Ä°ÅŸlem baÅŸarÄ±sÄ±z!', true);
                            ADMIN.loadGameCharacters(); // Hata varsa listeyi yenile
                        }
                    });
                },

                sendGeneralClue: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var text = document.getElementById('generalClueText').value.trim();
                    if (!text) {
                        toast('Ä°pucu metni giriniz', true);
                        return;
                    }
                    if (confirm('Bu ipucu tÃ¼m takÄ±mlara gÃ¶nderilecek. Emin misiniz?')) {
                        if (isProcessing) return;
                        isProcessing = true;

                        socket.emit('send-general-clue', text, function(res) {
                            isProcessing = false;
                            if (res.success) {
                                document.getElementById('generalClueText').value = '';
                                toast('Ä°pucu gÃ¶nderildi');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                sendAnnouncement: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var text = document.getElementById('announcementText').value.trim();
                    if (!text) {
                        toast('Duyuru metni giriniz', true);
                        return;
                    }
                    if (confirm('Bu duyuru tÃ¼m takÄ±mlara gÃ¶nderilecek. Emin misiniz?')) {
                        if (isProcessing) return;
                        isProcessing = true;

                        socket.emit('send-announcement', text, function(res) {
                            isProcessing = false;
                            if (res.success) {
                                document.getElementById('announcementText').value = '';
                                toast('Duyuru gÃ¶nderildi');
                                // Bildirim listesini gÃ¼ncelle
                                setTimeout(function() {
                                    NOTIF.renderAdminList();
                                }, 500);
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                clearAllNotifications: function() {
                    if (confirm('TÃœM bildirimleri silmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz.')) {
                        NOTIF.clearAll();
                        toast('TÃ¼m bildirimler silindi');
                    }
                },

                deleteNotification: function(notifId) {
                    if (confirm('Bu bildirimi silmek istediÄŸinize emin misiniz?')) {
                        NOTIF.deleteById(notifId);
                        toast('Bildirim silindi');
                    }
                },

                // Admin mesajlarÄ± global state
                adminMessagesData: [],
                selectedAdminTeamId: null,

                // Admin mesajlarÄ±nÄ± yÃ¼kle
                loadAdminMessages: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    // TÃ¼m takÄ±mlarÄ± yÃ¼kle ve dropdown'Ä± doldur
                    socket.emit('admin-get-teams', function(res) {
                        if (res.success) {
                            var selector = document.getElementById('adminMessagesTeamSelector');
                            if (!selector) return;

                            selector.innerHTML = '<option value="">TakÄ±m seÃ§in...</option>';
                            res.teams.forEach(function(team) {
                                selector.innerHTML += `<option value="${team.id}">${htmlEscape(team.name)}</option>`;
                            });
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // Dropdown'dan takÄ±m seÃ§
                selectTeamForAdminMessages: function(teamId) {
                    if (!teamId) {
                        // BoÅŸ seÃ§im
                        ADMIN.selectedAdminTeamId = null;
                        document.getElementById('adminMessagesViewerContainer').style.display = 'none';
                        document.getElementById('adminMessagesEmptyState').style.display = 'block';
                        return;
                    }

                    ADMIN.selectedAdminTeamId = teamId;

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    // TakÄ±m bilgisini al
                    socket.emit('admin-get-teams', function(res) {
                        if (res.success) {
                            var team = res.teams.find(function(t) { return t.id === teamId; });
                            if (team) {
                                document.getElementById('adminSelectedTeamName').textContent = team.name;
                            }
                        }
                    });

                    // Admin mesajlarÄ±nÄ± yÃ¼kle (bu takÄ±mla olan mesajlar)
                    socket.emit('load-admin-messages', function(res) {
                        if (res.success) {
                            // SeÃ§ili takÄ±mÄ±n mesajlarÄ±nÄ± filtrele
                            var teamMessages = res.messages.filter(function(msg) {
                                return msg.team_id === teamId || msg.target_team_id === teamId;
                            });

                            // MesajlarÄ± render et
                            ADMIN.renderAdminTeamMessages(teamMessages);

                            // GÃ¶rÃ¼nÃ¼mleri deÄŸiÅŸtir
                            document.getElementById('adminMessagesViewerContainer').style.display = 'block';
                            document.getElementById('adminMessagesEmptyState').style.display = 'none';
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // SeÃ§ili takÄ±mÄ±n mesajlarÄ±nÄ± render et
                renderAdminTeamMessages: function(teamMessages) {
                    var container = document.getElementById('adminMessagesContainer');
                    var countEl = document.getElementById('adminSelectedTeamMessageCount');

                    if (!container) return;

                    // SayacÄ± gÃ¼ncelle
                    if (countEl) {
                        countEl.textContent = teamMessages.length + ' mesaj';
                    }

                    if (teamMessages.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 80px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ðŸ“­</div>
                                <div style="font-size: 14px;">Bu takÄ±mdan mesaj yok</div>
                            </div>`;
                        return;
                    }

                    // MesajlarÄ± WhatsApp sÄ±ralamasÄ±na gÃ¶re dÃ¼zenle (eski â†’ yeni)
                    var sortedMessages = teamMessages.slice().reverse();

                    var html = '';
                    sortedMessages.forEach(function(msg) {
                        var time = new Date(msg.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                        var date = new Date(msg.created_at).toLocaleDateString('tr-TR', { day: '2-digit', month: '2-digit' });
                        var isAdminMessage = msg.team_id === null; // Admin mesajlarÄ± team_id NULL

                        // TakÄ±m rengi badge
                        var teamColor = msg.team_color || '#3b82f6';
                        var teamBadge = `<span style="background: ${teamColor}; color: #fff; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">${htmlEscape(msg.team_name)}</span>`;

                        // WhatsApp tarzÄ± gÃ¶rÃ¼nÃ¼m
                        if (isAdminMessage) {
                            // Admin'in mesajÄ± - SAÄžDA
                            html += `
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 12px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-end;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; justify-content: flex-end;">
                                        <span style="color: #666; font-size: 11px;">ðŸ• ${date} ${time}</span>
                                        <span style="background: #fbbf24; color: #000; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">ðŸ‘‘ Admin</span>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #0d5858, #0a4040); border: 1px solid #1a7070; border-radius: 12px 12px 2px 12px; padding: 12px 16px; color: #fff; font-size: 14px; line-height: 1.6; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                            </div>`;
                        } else {
                            // TakÄ±mÄ±n mesajÄ± - SOLDA
                            html += `
                            <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                        <span style="color: #fbbf24; font-weight: 600; font-size: 13px;">ðŸ‘¤ ${htmlEscape(msg.nickname)}</span>
                                        ${teamBadge}
                                        <span style="color: #666; font-size: 11px;">ðŸ• ${date} ${time}</span>
                                    </div>
                                    <div style="background: linear-gradient(135deg, rgba(251,191,36,0.12), rgba(251,191,36,0.05)); border: 1px solid rgba(251,191,36,0.4); border-radius: 12px 12px 12px 2px; padding: 12px 16px; color: #fff; font-size: 14px; line-height: 1.6; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                            </div>`;
                        }
                    });

                    container.innerHTML = html;
                    container.scrollTop = container.scrollHeight; // En alta kaydÄ±r
                },

                // Admin'den takÄ±ma mesaj gÃ¶nder
                sendReplyMessage: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (!ADMIN.selectedAdminTeamId) {
                        toast('LÃ¼tfen dropdown\'dan bir takÄ±m seÃ§in!', true);
                        return;
                    }

                    var messageInput = document.getElementById('adminReplyMessage');
                    var message = messageInput ? messageInput.value.trim() : '';

                    if (!message) {
                        toast('Mesaj boÅŸ olamaz!', true);
                        return;
                    }

                    socket.emit('admin-send-message', {
                        targetTeamId: ADMIN.selectedAdminTeamId,
                        message: message
                    }, function(res) {
                        if (res.success) {
                            if (messageInput) messageInput.value = '';
                            toast('Mesaj gÃ¶nderildi!');

                            // MesajlarÄ± yeniden yÃ¼kle (gÃ¶nderilen mesaj gÃ¶rÃ¼nsÃ¼n)
                            ADMIN.selectTeamForAdminMessages(ADMIN.selectedAdminTeamId);
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                clearAllClues: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (confirm('TÃœM ipuÃ§larÄ±nÄ± silmek istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz.')) {
                        socket.emit('clear-all-clues', function(res) {
                            if (res.success) {
                                toast('TÃ¼m ipuÃ§larÄ± silindi');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                deleteClue: function(clueId) {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (confirm('Bu ipucunu silmek istediÄŸinize emin misiniz?')) {
                        socket.emit('delete-general-clue', clueId, function(res) {
                            if (res.success) {
                                toast('Ä°pucu silindi');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                renderAdminClues: function() {
                    var container = document.getElementById('adminClueList');
                    var countEl = document.getElementById('adminClueCount');

                    if (!container || !countEl) return;

                    countEl.textContent = generalClues.length + ' ipucu';

                    if (generalClues.length === 0) {
                        container.innerHTML = '<div style="text-align:center; padding:40px; color:#555; font-size:13px;">HenÃ¼z ipucu yok</div>';
                        return;
                    }

                    var html = '';
                    generalClues.forEach(function(clue) {
                        html += `
                        <div class="admin-notif-item">
                            <div class="admin-notif-content">
                                <span class="admin-notif-type clue">Ä°pucu</span>
                                <div class="admin-notif-message">${htmlEscape(clue.text)}</div>
                                <div class="admin-notif-time">${clue.created_at ? new Date(clue.created_at).toLocaleString('tr-TR') : ''}</div>
                            </div>
                            <button class="admin-notif-delete" onclick="ADMIN.deleteClue(${clue.id})">ðŸ—‘ï¸ Sil</button>
                        </div>`;
                    });
                    container.innerHTML = html;
                },

                // Chat Ä°zleme - TakÄ±m seÃ§ici dropdown'Ä± gÃ¼ncelle
                updateChatTeamSelector: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var selector = document.getElementById('adminChatTeamSelector');
                    if (!selector) return;

                    var selectedValue = selector.value;

                    // TakÄ±mlarÄ± server'dan Ã§ek
                    socket.emit('admin-get-teams', function(res) {
                        if (res.success) {
                            var html = '<option value="">TakÄ±m seÃ§in...</option>';
                            res.teams.forEach(function(team) {
                                html += `<option value="${team.id}" ${selectedValue === team.id ? 'selected' : ''}>${htmlEscape(team.name)}</option>`;
                            });
                            selector.innerHTML = html;
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // Chat Ä°zleme - TakÄ±m seÃ§
                selectedChatTeamId: null,
                selectedChatTeamName: null,

                selectTeamForChat: function(teamId) {
                    if (!teamId) {
                        // BoÅŸ seÃ§im
                        ADMIN.selectedChatTeamId = null;
                        ADMIN.selectedChatTeamName = null;
                        document.getElementById('adminChatViewerContainer').style.display = 'none';
                        document.getElementById('adminChatEmptyState').style.display = 'block';
                        return;
                    }

                    ADMIN.selectedChatTeamId = teamId;

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    // TakÄ±m chat'ini yÃ¼kle
                    socket.emit('admin-load-team-chat', teamId, function(res) {
                        if (res.success) {
                            ADMIN.selectedChatTeamName = res.teamName;
                            document.getElementById('adminChatTeamName').textContent = res.teamName;
                            document.getElementById('adminChatMessageCount').textContent = res.totalCount + ' mesaj';

                            // MesajlarÄ± render et
                            ADMIN.renderTeamChat(res.messages);

                            // GÃ¶rÃ¼nÃ¼mleri deÄŸiÅŸtir
                            document.getElementById('adminChatViewerContainer').style.display = 'block';
                            document.getElementById('adminChatEmptyState').style.display = 'none';
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // Chat Ä°zleme - MesajlarÄ± render et
                renderTeamChat: function(messages) {
                    var container = document.getElementById('adminChatMessages');
                    if (!container) return;

                    // SeÃ§ili takÄ±mla ilgili mesajlarÄ± filtrele (takÄ±ma gÃ¶nderilen veya takÄ±mÄ±n gÃ¶nderdiÄŸi + admin mesajlarÄ±)
                    var filteredMessages = messages.filter(function(msg) {
                        // Admin mesajlarÄ±nÄ± hariÃ§ tut (sadece takÄ±mlara Ã¶zel deÄŸil, herkese olanlarÄ±)
                        if (msg.target_team_id === 'admin') return false;

                        // Admin'in bu takÄ±ma gÃ¶nderdiÄŸi mesajlarÄ± dahil et
                        if (msg.team_id === null && msg.target_team_id === ADMIN.selectedChatTeamId) return true;

                        // DiÄŸer mesajlarÄ± olduÄŸu gibi bÄ±rak
                        return true;
                    });

                    if (filteredMessages.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 60px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.5;">ðŸ’¬</div>
                                <div style="font-size: 14px;">HenÃ¼z mesaj yok</div>
                            </div>`;
                        return;
                    }

                    // MesajlarÄ± WhatsApp sÄ±ralamasÄ±na gÃ¶re dÃ¼zenle (eski â†’ yeni)
                    var sortedMessages = filteredMessages.slice().reverse();

                    var html = '';
                    sortedMessages.forEach(function(msg) {
                        var time = new Date(msg.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                        var isFromSelectedTeam = msg.team_id === ADMIN.selectedChatTeamId;
                        var isFromAdmin = msg.team_id === null; // Admin mesajÄ±

                        // TakÄ±m rengi badge
                        var teamColor = msg.team_color || '#3b82f6';
                        var teamBadge = `<span style="background: ${teamColor}; color: #fff; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">${htmlEscape(msg.team_name)}</span>`;

                        // Hedef takÄ±m etiketi
                        var targetLabel = '';
                        if (msg.target_team_name) {
                            targetLabel = `<span style="color: #d4af37; font-size: 10px; background: rgba(212,175,55,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(212,175,55,0.3);">ðŸ”’ â†’ ${htmlEscape(msg.target_team_name)}</span>`;
                        } else {
                            targetLabel = `<span style="color: #4dd4d4; font-size: 10px; background: rgba(77,212,212,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(77,212,212,0.3);">ðŸ“¢ TÃ¼m TakÄ±mlar</span>`;
                        }

                        // WhatsApp tarzÄ± gÃ¶rÃ¼nÃ¼m
                        if (isFromAdmin) {
                            // Admin mesajÄ± - SAÄžDA (Ã¶zel altÄ±n rengi)
                            html += `
                            <div style="display: flex; justify-content: flex-end; margin-bottom: 12px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-end;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; justify-content: flex-end;">
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                        ${targetLabel}
                                        ${teamBadge}
                                        <span style="color: #fbbf24; font-weight: 700; font-size: 13px;">ðŸ‘‘ ${htmlEscape(msg.nickname)}</span>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #4a3800, #2d2200); border: 2px solid #fbbf24; border-radius: 12px 12px 2px 12px; padding: 10px 14px; color: #fbbf24; font-size: 14px; font-weight: 600; word-wrap: break-word; box-shadow: 0 2px 8px rgba(251,191,36,0.3);">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                            </div>`;
                        } else if (isFromSelectedTeam) {
                            // SeÃ§ili takÄ±mÄ±n mesajÄ± - SOLDA
                            html += `
                            <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                        <span style="color: #4dd4d4; font-weight: 700; font-size: 13px;">${htmlEscape(msg.nickname)}</span>
                                        ${teamBadge}
                                        ${targetLabel}
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                    </div>
                                    <div style="background: linear-gradient(135deg, #0d5858, #0a4040); border: 1px solid #1a7070; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                            </div>`;
                        } else {
                            // DiÄŸer takÄ±mÄ±n mesajÄ± - SOLDA
                            html += `
                            <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                    <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                        <span style="color: #ffa500; font-weight: 700; font-size: 13px;">${htmlEscape(msg.nickname)}</span>
                                        ${teamBadge}
                                        ${targetLabel}
                                        <span style="color: #444; font-size: 10px;">${time}</span>
                                    </div>
                                    <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                        ${htmlEscape(msg.message)}
                                    </div>
                                </div>
                            </div>`;
                        }
                    });

                    container.innerHTML = html;

                    // En alta scroll
                    container.scrollTop = container.scrollHeight;
                },

                startGame: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    var minutes = parseInt(document.getElementById('gameMinutes').value);
                    var title = document.getElementById('gameTitle').value.trim();

                    if (!minutes || minutes <= 0) {
                        toast('GeÃ§erli bir sÃ¼re giriniz!', true);
                        return;
                    }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('start-game', { minutes: minutes, title: title }, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            toast('Oyun baÅŸlatÄ±ldÄ±!');
                            document.getElementById('gameMinutes').value = '';
                            document.getElementById('gameTitle').value = '';
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                addTime: function(seconds) {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (isProcessing) return;
                    isProcessing = true;

                    socket.emit('add-time', seconds, function(res) {
                        isProcessing = false;
                        if (res.success) {
                            var mins = Math.floor(seconds / 60);
                            toast(mins + ' dakika eklendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                endGame: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    if (confirm('Oyunu bitirmek istediÄŸinize emin misiniz?')) {
                        if (isProcessing) return;
                        isProcessing = true;

                        socket.emit('end-game', function(res) {
                            isProcessing = false;
                            if (res.success) {
                                toast('Oyun bitirildi!');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                updateCountdownDisplay: function() {
                    var display = document.getElementById('adminCountdown');
                    if (display) {
                        display.textContent = formatTime(gameState.countdown);
                        if (gameState.countdown < 60) {
                            display.classList.add('warning');
                        } else {
                            display.classList.remove('warning');
                        }
                    }

                    var titleDisplay = document.getElementById('adminPhaseTitle');
                    if (titleDisplay && gameState.phaseTitle) {
                        titleDisplay.textContent = gameState.phaseTitle;
                    }
                },

                addCredit: function() {
                    var input = document.getElementById('creditNameInput');
                    var name = input.value.trim();

                    if (!name) {
                        toast('Ä°sim giriniz', true);
                        return;
                    }

                    socket.emit('add-credit', name, function(res) {
                        if (res.success) {
                            input.value = '';
                            toast('Ä°sim eklendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                removeCredit: function(creditId, name) {
                    if (confirm('"' + name + '" isimli kiÅŸiyi listeden silmek istediÄŸinize emin misiniz?')) {
                        socket.emit('remove-credit', creditId, function(res) {
                            if (res.success) {
                                toast('Ä°sim silindi');
                            } else {
                                toast(res.error, true);
                            }
                        });
                    }
                },

                updateCreditContent: function(creditId) {
                    var textarea = document.getElementById('creditContent_' + creditId);
                    if (!textarea) return;

                    var content = textarea.value.trim();

                    socket.emit('update-credit-content', {
                        creditId: creditId,
                        content: content
                    }, function(res) {
                        if (res.success) {
                            toast('Ä°Ã§erik gÃ¼ncellendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                // Ä°STATÄ°STÄ°KLER FONKSÄ°YONLARI
                loadStatistics: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('get-statistics', function(res) {
                        if (res.success) {
                            ADMIN.renderStatsOverview(res.stats.overview);
                            ADMIN.renderStatsMessaging(res.stats.messaging);
                            ADMIN.renderStatsClues(res.stats.clues);
                            ADMIN.renderStatsUsers(res.stats.users);
                            ADMIN.renderStatsScoring(res.stats.scoring);

                            // Export iÃ§in veriyi sakla
                            window.statsData = res.stats;

                            toast('Ä°statistikler yÃ¼klendi');
                        } else {
                            toast(res.error || 'Ä°statistikler yÃ¼klenemedi!', true);
                        }
                    });
                },

                renderStatsOverview: function(overview) {
                    document.getElementById('statTotalTeams').textContent = overview.totalTeams;
                    document.getElementById('statTotalUsers').textContent = overview.totalUsers;
                    document.getElementById('statTotalMessages').textContent = overview.totalMessages;
                    document.getElementById('statTotalClues').textContent = overview.totalClues;
                },

                renderStatsMessaging: function(messaging) {
                    var container = document.getElementById('statMessagingList');
                    if (!container) return;

                    if (messaging.byTeam.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:20px;">HenÃ¼z mesaj yok</div>';
                        return;
                    }

                    var html = '';
                    messaging.byTeam.forEach(function(team) {
                        html += `
                        <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 15px; background:#0a0a0a; border-radius:8px; margin-bottom:8px;">
                            <span style="color:#fff; font-weight:600;">${htmlEscape(team.name)}</span>
                            <span style="color:var(--gold); font-size:20px; font-weight:700;">${team.message_count}</span>
                        </div>`;
                    });

                    html += `
                    <div style="margin-top:15px; padding-top:15px; border-top:1px solid #333; text-align:center;">
                        <span style="color:#888; font-size:12px;">TakÄ±m baÅŸÄ±na ortalama: </span>
                        <span style="color:var(--gold); font-weight:700; font-size:16px;">${messaging.avgPerTeam}</span>
                        <span style="color:#888; font-size:12px;"> mesaj</span>
                    </div>`;

                    container.innerHTML = html;
                },

                renderStatsClues: function(clues) {
                    var container = document.getElementById('statCluesList');
                    if (!container) return;

                    if (clues.byTeam.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:20px;">HenÃ¼z ipucu yok</div>';
                        return;
                    }

                    var html = '';
                    clues.byTeam.forEach(function(team) {
                        html += `
                        <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 15px; background:#0a0a0a; border-radius:8px; margin-bottom:8px;">
                            <span style="color:#fff; font-weight:600;">${htmlEscape(team.name)}</span>
                            <span style="color:var(--gold); font-size:20px; font-weight:700;">${team.clue_count}</span>
                        </div>`;
                    });

                    html += `
                    <div style="margin-top:15px; padding-top:15px; border-top:1px solid #333; text-align:center;">
                        <span style="color:#888; font-size:12px;">TakÄ±m baÅŸÄ±na ortalama: </span>
                        <span style="color:var(--gold); font-weight:700; font-size:16px;">${clues.avgPerTeam}</span>
                        <span style="color:#888; font-size:12px;"> ipucu</span>
                    </div>`;

                    container.innerHTML = html;
                },

                renderStatsUsers: function(users) {
                    var container = document.getElementById('statUsersList');
                    if (!container) return;

                    if (users.mostActive.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:20px;">HenÃ¼z aktif kullanÄ±cÄ± yok</div>';
                        return;
                    }

                    var html = '';
                    users.mostActive.forEach(function(user, index) {
                        var medal = '';
                        if (index === 0) medal = 'ðŸ¥‡';
                        else if (index === 1) medal = 'ðŸ¥ˆ';
                        else if (index === 2) medal = 'ðŸ¥‰';

                        html += `
                        <div style="display:flex; justify-content:space-between; align-items:center; padding:12px 15px; background:#0a0a0a; border-radius:8px; margin-bottom:8px;">
                            <div style="flex:1;">
                                <span style="color:#fff; font-weight:600;">${medal} ${htmlEscape(user.nickname)}</span>
                                <span style="color:#666; font-size:11px; margin-left:10px;">${htmlEscape(user.team_name || 'TakÄ±msÄ±z')}</span>
                            </div>
                            <span style="color:var(--gold); font-size:18px; font-weight:700;">${user.message_count}</span>
                        </div>`;
                    });

                    container.innerHTML = html;
                },

                renderStatsScoring: function(scoring) {
                    var container = document.getElementById('statScoringList');
                    if (!container) return;

                    if (scoring.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:20px;">HenÃ¼z takÄ±m yok</div>';
                        return;
                    }

                    var html = '';
                    scoring.forEach(function(team, index) {
                        var medal = '';
                        if (index === 0) medal = 'ðŸ¥‡';
                        else if (index === 1) medal = 'ðŸ¥ˆ';
                        else if (index === 2) medal = 'ðŸ¥‰';

                        var rank = index + 1;

                        html += `
                        <div style="display:flex; justify-content:space-between; align-items:center; padding:15px; background:#0a0a0a; border-radius:8px; margin-bottom:8px;">
                            <div style="display:flex; align-items:center; gap:15px;">
                                <span style="color:#666; font-size:20px; font-weight:700; width:30px;">${rank}</span>
                                <div style="width:40px; height:40px; border-radius:50%; background:${htmlEscape(team.color)}; display:flex; align-items:center; justify-content:center; font-size:20px;">
                                    ${htmlEscape(team.avatar)}
                                </div>
                                <span style="color:#fff; font-weight:600; font-size:15px;">${htmlEscape(team.name)}</span>
                            </div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                ${medal ? '<span style="font-size:24px;">' + medal + '</span>' : ''}
                                <span style="color:var(--gold); font-size:24px; font-weight:700;">${team.score}</span>
                            </div>
                        </div>`;
                    });

                    container.innerHTML = html;
                },

                exportStats: function(format) {
                    if (!window.statsData) {
                        toast('Ã–nce istatistikleri yÃ¼kleyin', true);
                        return;
                    }

                    if (format === 'json') {
                        var dataStr = JSON.stringify(window.statsData, null, 2);
                        var dataBlob = new Blob([dataStr], { type: 'application/json' });
                        var url = URL.createObjectURL(dataBlob);
                        var link = document.createElement('a');
                        link.href = url;
                        link.download = 'istatistikler_' + new Date().getTime() + '.json';
                        link.click();
                        URL.revokeObjectURL(url);
                        toast('JSON dosyasÄ± indirildi');
                    } else if (format === 'csv') {
                        var csv = 'Kategori,Veri,DeÄŸer\n';

                        // Genel Ã–zet
                        csv += 'Genel Ã–zet,Toplam TakÄ±m,' + window.statsData.overview.totalTeams + '\n';
                        csv += 'Genel Ã–zet,Toplam KullanÄ±cÄ±,' + window.statsData.overview.totalUsers + '\n';
                        csv += 'Genel Ã–zet,Toplam Mesaj,' + window.statsData.overview.totalMessages + '\n';
                        csv += 'Genel Ã–zet,Toplam Ä°pucu,' + window.statsData.overview.totalClues + '\n';
                        csv += '\n';

                        // MesajlaÅŸma
                        csv += 'MesajlaÅŸma,TakÄ±m BaÅŸÄ±na Ortalama,' + window.statsData.messaging.avgPerTeam + '\n';
                        window.statsData.messaging.byTeam.forEach(function(team) {
                            csv += 'MesajlaÅŸma,"' + team.name.replace(/"/g, '""') + '",' + team.message_count + '\n';
                        });
                        csv += '\n';

                        // Ä°puÃ§larÄ±
                        csv += 'Ä°puÃ§larÄ±,TakÄ±m BaÅŸÄ±na Ortalama,' + window.statsData.clues.avgPerTeam + '\n';
                        window.statsData.clues.byTeam.forEach(function(team) {
                            csv += 'Ä°puÃ§larÄ±,"' + team.name.replace(/"/g, '""') + '",' + team.clue_count + '\n';
                        });
                        csv += '\n';

                        // En Aktif KullanÄ±cÄ±lar
                        window.statsData.users.mostActive.forEach(function(user, index) {
                            csv += 'En Aktif KullanÄ±cÄ±lar,"' + user.nickname.replace(/"/g, '""') + ' (' + (user.team_name || 'TakÄ±msÄ±z').replace(/"/g, '""') + ')",' + user.message_count + '\n';
                        });
                        csv += '\n';

                        // Puan SÄ±ralamasÄ±
                        window.statsData.scoring.forEach(function(team, index) {
                            csv += 'Puan SÄ±ralamasÄ±,"' + (index + 1) + '. ' + team.name.replace(/"/g, '""') + '",' + team.score + '\n';
                        });

                        var csvBlob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
                        var url = URL.createObjectURL(csvBlob);
                        var link = document.createElement('a');
                        link.href = url;
                        link.download = 'istatistikler_' + new Date().getTime() + '.csv';
                        link.click();
                        URL.revokeObjectURL(url);
                        toast('CSV dosyasÄ± indirildi');
                    }
                },

                // OYUN OTURUMU BAÅžLAT
                startGameSession: function() {
                    if (!confirm('Yeni bir oyun oturumu baÅŸlatmak istediÄŸinizden emin misiniz?\n\nBu iÅŸlem oyun olaylarÄ±nÄ± kaydetmeye baÅŸlayacak.')) {
                        return;
                    }

                    socket.emit('start-game-session', function(res) {
                        if (res.success) {
                            toast('âœ… Oyun oturumu baÅŸlatÄ±ldÄ±!');
                            console.log('Oyun oturumu ID:', res.sessionId);
                        } else {
                            toast(res.error || 'Oyun baÅŸlatÄ±lamadÄ±!', true);
                        }
                    });
                },

                // OYUN OTURUMUNU BÄ°TÄ°R VE RAPOR OLUÅžTUR
                endGameSession: function() {
                    if (!confirm('Oyunu bitirmek ve final raporunu gÃ¶rmek istediÄŸinizden emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz.')) {
                        return;
                    }

                    socket.emit('end-game-session', function(res) {
                        if (res.success) {
                            toast('âœ… Oyun bitti! Rapor gÃ¶steriliyor...');
                            GAME.showFinalReport(res.report);
                        } else {
                            toast(res.error || 'Oyun bitirilemedi!', true);
                        }
                    });
                }
            };

            // IP SECTION FONKSÄ°YONLARI (Tab YÃ¶netimi)
            window.IP_SECTION = {
                currentTab: 'logs',

                showTab: function(tab) {
                    // Tab iÃ§eriklerini gizle/gÃ¶ster
                    document.getElementById('ipTabContentLogs').style.display = tab === 'logs' ? 'block' : 'none';
                    document.getElementById('ipTabContentUsers').style.display = tab === 'users' ? 'block' : 'none';

                    // Tab butonlarÄ±nÄ± gÃ¼ncelle
                    var logsBtn = document.getElementById('ipTabLogs');
                    var usersBtn = document.getElementById('ipTabUsers');

                    logsBtn.classList.remove('btn-primary');
                    logsBtn.classList.add('btn');
                    usersBtn.classList.remove('btn-primary');
                    usersBtn.classList.add('btn');

                    if (tab === 'logs') {
                        logsBtn.classList.remove('btn');
                        logsBtn.classList.add('btn-primary');
                        IP_LOGS.loadLogs();
                    } else if (tab === 'users') {
                        usersBtn.classList.remove('btn');
                        usersBtn.classList.add('btn-primary');
                        IP_USERS.loadAllUsers();
                    }

                    this.currentTab = tab;
                }
            };

            // IP LOGS FONKSÄ°YONLARI
            window.IP_LOGS = {
                logs: [],

                loadLogs: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('get-ip-logs', function(res) {
                        if (res.success) {
                            IP_LOGS.logs = res.logs;
                            IP_LOGS.render();
                            toast('Loglar yÃ¼klendi');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                render: function() {
                    var container = document.getElementById('ipLogsList');
                    var countEl = document.getElementById('ipLogsCount');

                    if (!container) return;

                    countEl.textContent = this.logs.length + ' kayÄ±t';

                    if (this.logs.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:30px;">Son 24 saatte aktivite yok</div>';
                        return;
                    }

                    var html = '';
                    this.logs.forEach(function(log) {
                        var actionText = log.action === 'register-user' ? 'KullanÄ±cÄ± KaydÄ±' : 'TakÄ±m OluÅŸturma';
                        var actionColor = log.action === 'register-user' ? '#3b82f6' : '#8b5cf6';
                        var maxCount = log.action === 'register-user' ? 3 : 2;
                        var isNearLimit = parseInt(log.count) >= maxCount;
                        var date = new Date(log.last_activity);
                        var timeStr = date.toLocaleString('tr-TR', {
                            day: '2-digit',
                            month: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });

                        // GÃœVENLÄ°K: onclick iÃ§in JavaScript string escape
                        var safeIP = log.ip_address.replace(/'/g, "\\'").replace(/"/g, '\\"');
                        var safeAction = log.action.replace(/'/g, "\\'").replace(/"/g, '\\"');

                        html += `
                        <div style="background:#1a1a1a; border:1px solid ${isNearLimit ? '#ff4444' : '#333'}; border-radius:8px; padding:15px;">
                            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:10px;">
                                <div style="flex:1;">
                                    <div style="color:#fff; font-weight:600; margin-bottom:5px;">
                                        ${htmlEscape(log.ip_address)}
                                    </div>
                                    <div style="display:flex; gap:10px; align-items:center; margin-bottom:5px;">
                                        <span style="background:${actionColor}; color:#fff; padding:4px 8px; border-radius:4px; font-size:11px; font-weight:600;">
                                            ${actionText}
                                        </span>
                                        <span style="color:${isNearLimit ? '#ff4444' : '#888'}; font-size:13px; font-weight:600;">
                                            ${log.count} / ${maxCount} ${isNearLimit ? 'âš ï¸' : ''}
                                        </span>
                                    </div>
                                    <div style="color:#666; font-size:12px;">
                                        Son: ${timeStr}
                                    </div>
                                </div>
                                <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:12px; ${isNearLimit ? 'background:#ff9800; border-color:#ff9800; color:#000; font-weight:600;' : ''}"
                                    onclick="IP_LOGS.clearSpecific('${safeIP}', '${safeAction}')"
                                    title="Bu IP'nin ${actionText} hakkÄ±nÄ± sÄ±fÄ±rla">
                                    ${isNearLimit ? 'ðŸ”„ Limiti SÄ±fÄ±rla' : 'ðŸ—‘ï¸ SÄ±fÄ±rla'}
                                </button>
                            </div>
                        </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                clearSpecific: function(ipAddress, action) {
                    var actionText = action === 'register-user' ? 'KullanÄ±cÄ± KaydÄ±' : 'TakÄ±m OluÅŸturma';
                    if (!confirm(`${ipAddress} IP'sinin "${actionText}" logunu sÄ±fÄ±rlamak istediÄŸinize emin misiniz?`)) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('clear-ip-logs', { ipAddress: ipAddress, action: action }, function(res) {
                        if (res.success) {
                            toast('Log sÄ±fÄ±rlandÄ±: ' + res.deletedCount + ' kayÄ±t silindi');
                            IP_LOGS.loadLogs();
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                clearAll: function() {
                    if (!confirm('TÃœM IP loglarÄ±nÄ± sÄ±fÄ±rlamak istediÄŸinize emin misiniz? Bu iÅŸlem geri alÄ±namaz!')) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('clear-ip-logs', {}, function(res) {
                        if (res.success) {
                            toast('TÃ¼m loglar sÄ±fÄ±rlandÄ±: ' + res.deletedCount + ' kayÄ±t silindi');
                            IP_LOGS.loadLogs();
                        } else {
                            toast(res.error, true);
                        }
                    });
                }
            };

            // IP USERS FONKSÄ°YONLARI (KullanÄ±cÄ± KayÄ±tlarÄ±)
            window.IP_USERS = {
                users: [],

                loadAllUsers: function() {
                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('get-all-users', function(res) {
                        if (res.success) {
                            IP_USERS.users = res.users;
                            IP_USERS.render();
                            toast('KullanÄ±cÄ±lar yÃ¼klendi: ' + res.users.length + ' kayÄ±t');
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                render: function() {
                    var container = document.getElementById('ipUsersList');
                    var countEl = document.getElementById('ipUsersCount');

                    if (!container) return;

                    countEl.textContent = this.users.length + ' kullanÄ±cÄ±';

                    if (this.users.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:30px;">HenÃ¼z kayÄ±tlÄ± kullanÄ±cÄ± yok</div>';
                        return;
                    }

                    var html = '';
                    this.users.forEach(function(user) {
                        var onlineStatus = user.online ? 'ðŸŸ¢ Online' : 'âš« Offline';
                        var onlineColor = user.online ? '#10b981' : '#666';
                        var date = new Date(user.created_at);
                        var timeStr = date.toLocaleString('tr-TR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });

                        var teamInfo = user.team_name ? `<span style="color:#8b5cf6;">ðŸ‘¥ TakÄ±m: ${htmlEscape(user.team_name)}</span>` : '<span style="color:#666;">TakÄ±msÄ±z</span>';

                        // GÃœVENLÄ°K: onclick iÃ§in JavaScript string escape
                        var safeNickname = user.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');

                        html += `
                        <div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:15px;">
                            <div style="display:flex; justify-content:space-between; align-items:start;">
                                <div style="flex:1;">
                                    <div style="color:#fff; font-weight:600; font-size:16px; margin-bottom:8px;">
                                        ${htmlEscape(user.nickname)}
                                    </div>
                                    <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:8px;">
                                        <span style="color:${onlineColor}; font-size:12px;">${onlineStatus}</span>
                                        ${teamInfo}
                                    </div>
                                    <div style="color:#666; font-size:12px;">
                                        ðŸ“… KayÄ±t: ${timeStr}
                                    </div>
                                    <div style="color:#888; font-size:11px; margin-top:5px;">
                                        ðŸŒ IP: ${htmlEscape(user.ip_address)} â€¢ ID: ${user.id}
                                    </div>
                                </div>
                                <button class="btn" style="width:auto; padding:8px 16px; margin:0; font-size:12px; background:#dc2626; border-color:#dc2626; color:#fff;"
                                    onclick="IP_USERS.deleteUser('${user.id}', '${safeNickname}')"
                                    title="Bu kullanÄ±cÄ±yÄ± sil">
                                    ðŸ—‘ï¸ Sil
                                </button>
                            </div>
                        </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                deleteUser: function(userId, nickname) {
                    if (!confirm(`"${nickname}" kullanÄ±cÄ±sÄ±nÄ± silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz ve baÅŸka biri bu nickname ile kaydolabilir.`)) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('delete-user', userId, function(res) {
                        if (res.success) {
                            toast('KullanÄ±cÄ± silindi: ' + res.user.nickname + ' - Nickname artÄ±k kullanÄ±ma aÃ§Ä±k!');

                            // Listeden Ã§Ä±kar
                            IP_USERS.users = IP_USERS.users.filter(u => u.id !== userId);
                            IP_USERS.render();
                        } else {
                            toast(res.error, true);
                        }
                    });
                },

                deleteAll: function() {
                    if (this.users.length === 0) {
                        toast('Silinecek kullanÄ±cÄ± yok', true);
                        return;
                    }

                    if (!confirm(`TÃœM KULLANICILAR SÄ°LÄ°NECEK! (${this.users.length} kullanÄ±cÄ±)\n\nBu iÅŸlem geri alÄ±namaz ve tÃ¼m nickname'ler serbest kalacak.\n\nEmin misiniz?`)) {
                        return;
                    }

                    if (!socketConnected) {
                        toast('BaÄŸlantÄ± kuruluyor, lÃ¼tfen bekleyin...', true);
                        return;
                    }

                    socket.emit('delete-all-users', function(res) {
                        if (res.success) {
                            toast('TÃ¼m kullanÄ±cÄ±lar silindi: ' + res.deletedCount + ' kayÄ±t');
                            IP_USERS.users = [];
                            IP_USERS.render();
                        } else {
                            toast(res.error, true);
                        }
                    });
                }
            };

            // PHOTO_ADMIN - Profil fotoÄŸraflarÄ± yÃ¶netimi
            window.PHOTO_ADMIN = {
                users: [],
                currentUserId: null,

                loadUsers: function() {
                    fetch('/api/admin/users-with-photos', {
                        method: 'GET',
                        credentials: 'include'
                    })
                    .then(function(response) { return response.json(); })
                    .then(function(data) {
                        if (data.success) {
                            PHOTO_ADMIN.users = data.users;
                            PHOTO_ADMIN.render();
                            toast('KullanÄ±cÄ±lar yÃ¼klendi: ' + data.users.length + ' kayÄ±t');
                        } else {
                            toast(data.error, true);
                        }
                    })
                    .catch(function(err) {
                        console.error('KullanÄ±cÄ± yÃ¼kleme hatasÄ±:', err);
                        toast('KullanÄ±cÄ±lar yÃ¼klenemedi', true);
                    });
                },

                render: function() {
                    var container = document.getElementById('photoUsersList');
                    var countEl = document.getElementById('photoUsersCount');

                    if (!container) return;

                    countEl.textContent = this.users.length + ' kullanÄ±cÄ±';

                    if (this.users.length === 0) {
                        container.innerHTML = '<div style="color:#666; text-align:center; padding:30px; grid-column: 1/-1;">HenÃ¼z kayÄ±tlÄ± kullanÄ±cÄ± yok</div>';
                        return;
                    }

                    var html = '';
                    this.users.forEach(function(user) {
                        var onlineStatus = user.online ? 'ðŸŸ¢ Online' : 'âš« Offline';
                        var onlineColor = user.online ? '#10b981' : '#666';

                        var teamInfo = user.team_name ?
                            `<span style="display:inline-block; padding:4px 8px; background:${user.team_color || '#333'}; border-radius:4px; font-size:11px; color:#fff;">ðŸ‘¥ ${htmlEscape(user.team_name)}</span>` :
                            '<span style="color:#666; font-size:11px;">TakÄ±msÄ±z</span>';

                        var photoDisplay = user.profile_photo_url ?
                            `<img src="${user.profile_photo_url}" alt="Profil" style="width:100px; height:100px; border-radius:50%; object-fit:cover; border:3px solid var(--gold);">` :
                            '<div style="width:100px; height:100px; border-radius:50%; background:#333; display:flex; align-items:center; justify-content:center; font-size:40px; color:#666; border:3px solid #444;">ðŸ‘¤</div>';

                        var safeNickname = user.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');

                        html += `
                        <div style="background:#1a1a1a; border:1px solid #333; border-radius:12px; padding:20px; text-align:center;">
                            <div style="margin-bottom:15px;">
                                ${photoDisplay}
                            </div>
                            <div style="color:#fff; font-weight:600; font-size:16px; margin-bottom:8px;">
                                ${htmlEscape(user.nickname)}
                            </div>
                            <div style="display:flex; flex-direction:column; gap:6px; margin-bottom:15px; align-items:center;">
                                <span style="color:${onlineColor}; font-size:12px;">${onlineStatus}</span>
                                ${teamInfo}
                            </div>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                                <button class="btn" style="margin:0; padding:10px; font-size:12px; background:linear-gradient(135deg, #4a5568, #2d3748);"
                                    onclick="PHOTO_ADMIN.changePhoto('${user.id}', '${safeNickname}')">
                                    ðŸ“· DeÄŸiÅŸtir
                                </button>
                                <button class="btn" style="margin:0; padding:10px; font-size:12px; background:#dc2626; border-color:#dc2626;"
                                    onclick="PHOTO_ADMIN.deletePhoto('${user.id}', '${safeNickname}')"
                                    ${user.profile_photo_url ? '' : 'disabled style="opacity:0.5; cursor:not-allowed;"'}>
                                    ðŸ—‘ï¸ Sil
                                </button>
                            </div>
                        </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                changePhoto: function(userId, nickname) {
                    this.currentUserId = userId;
                    document.getElementById('adminPhotoInput').click();
                },

                handlePhotoSelect: function(event) {
                    var file = event.target.files[0];
                    if (!file) return;

                    if (file.size > 5 * 1024 * 1024) {
                        toast('Dosya Ã§ok bÃ¼yÃ¼k! Maksimum 5MB olmalÄ±.', true);
                        event.target.value = '';
                        return;
                    }

                    if (!file.type.startsWith('image/')) {
                        toast('LÃ¼tfen bir resim dosyasÄ± seÃ§in!', true);
                        event.target.value = '';
                        return;
                    }

                    if (!this.currentUserId) {
                        toast('KullanÄ±cÄ± seÃ§ilmedi', true);
                        return;
                    }

                    var formData = new FormData();
                    formData.append('photo', file);
                    formData.append('userId', this.currentUserId);

                    toast('FotoÄŸraf yÃ¼kleniyor...');

                    fetch('/api/admin/update-user-photo', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    })
                    .then(function(response) { return response.json(); })
                    .then(function(data) {
                        if (data.success) {
                            toast('FotoÄŸraf gÃ¼ncellendi!');
                            PHOTO_ADMIN.loadUsers();
                        } else {
                            toast(data.error, true);
                        }
                    })
                    .catch(function(err) {
                        console.error('FotoÄŸraf yÃ¼kleme hatasÄ±:', err);
                        toast('FotoÄŸraf yÃ¼klenemedi', true);
                    })
                    .finally(function() {
                        event.target.value = '';
                        PHOTO_ADMIN.currentUserId = null;
                    });
                },

                deletePhoto: function(userId, nickname) {
                    if (!confirm(`"${nickname}" kullanÄ±cÄ±sÄ±nÄ±n profil fotoÄŸrafÄ±nÄ± silmek istediÄŸinize emin misiniz?`)) {
                        return;
                    }

                    toast('FotoÄŸraf siliniyor...');

                    var formData = new FormData();
                    formData.append('userId', userId);
                    formData.append('action', 'delete');

                    fetch('/api/admin/update-user-photo', {
                        method: 'POST',
                        body: formData,
                        credentials: 'include'
                    })
                    .then(function(response) { return response.json(); })
                    .then(function(data) {
                        if (data.success) {
                            toast('FotoÄŸraf silindi!');
                            PHOTO_ADMIN.loadUsers();
                        } else {
                            toast(data.error, true);
                        }
                    })
                    .catch(function(err) {
                        console.error('FotoÄŸraf silme hatasÄ±:', err);
                        toast('FotoÄŸraf silinemedi', true);
                    });
                }
            };

            // RENDER FONKSÄ°YONLARI

            function renderJoinList() {
                var c = document.getElementById('joinList');
                if (teams.length === 0) { c.innerHTML = '<div style="text-align:center;color:#666;padding:20px;">Aktif takÄ±m yok</div>'; return; }
                var html = '';
                teams.forEach(t => {
                    var safeName = htmlEscape(t.name);
                    html += `<div class="team-opt" data-id="${t.id}" data-name="${safeName}" onclick="GAME.selectJoin(this)">
                        <div style="font-weight:bold;color:#fff;">${safeName}</div>
                        <div style="font-size:12px;color:#666;">Puan: ${t.score}</div>
                    </div>`;
                });
                c.innerHTML = html;
            }

            function renderTeamPage(team) {
                document.getElementById('dispTeamName').textContent = team.name;

                // TakÄ±m bilgileri kartÄ±nÄ± gÃ¼ncelle
                document.getElementById('teamInfoName').textContent = team.name;
                document.getElementById('teamInfoScore').textContent = team.score;

                document.getElementById('clueCnt').textContent = '(' + team.clues.length + ')';
                var list = document.getElementById('myClueList');
                if (team.clues.length === 0) {
                    list.innerHTML = '<div style="color:#444;text-align:center;padding:20px;">HenÃ¼z ipucu girilmedi.</div>';
                } else {
                    var html = '';
                    // Tersten sÄ±rala (en yeni en Ã¼stte)
                    for (var i = team.clues.length - 1; i >= 0; i--) {
                        html += `<div style="padding:10px; border-bottom:1px solid #222; color:#ccc;">${htmlEscape(team.clues[i].text)}</div>`;
                    }
                    list.innerHTML = html;
                }

                // Countdown'u render et
                renderTeamCountdown();

                // Genel ipuÃ§larÄ±nÄ± render et
                renderGeneralClues();

                // Chat mesajlarÄ±nÄ± yÃ¼kle
                CHAT.loadMessages(1);
            }

            function renderGeneralClues() {
                var container = document.getElementById('adminCluesSection');
                var list = document.getElementById('adminCluesList');
                var emptyEl = document.getElementById('adminCluesEmpty');
                var countEl = document.getElementById('adminCluesCount');

                if (!container || !list) return;

                // SayÄ±yÄ± gÃ¼ncelle
                if (countEl) countEl.textContent = generalClues.length;

                if (generalClues.length === 0) {
                    container.style.display = 'none';
                    if (list) list.style.display = 'none';
                    if (emptyEl) emptyEl.style.display = 'block';
                } else {
                    container.style.display = 'block';
                    if (list) list.style.display = 'flex';
                    if (emptyEl) emptyEl.style.display = 'none';

                    var html = '';
                    // Tersten sÄ±rala (en yeni en Ã¼stte)
                    for (var i = generalClues.length - 1; i >= 0; i--) {
                        var clue = generalClues[i];
                        html += `
                            <div style="
                                background: rgba(139,0,0,0.15);
                                border: 1px solid rgba(139,0,0,0.3);
                                border-left: 4px solid var(--accent);
                                border-radius: 8px;
                                padding: 14px;
                                animation: slideIn 0.3s ease;
                            ">
                                <div style="color: var(--text-main); font-size: 14px; line-height: 1.5; margin-bottom: 6px;">
                                    ${htmlEscape(clue.text)}
                                </div>
                                <div style="display: flex; align-items: center; gap: 6px; color: #666; font-size: 11px;">
                                    <span>â°</span>
                                    <span>${clue.time}</span>
                                </div>
                            </div>
                        `;
                    }
                    list.innerHTML = html;
                }
            }

            function renderTeamCountdown() {
                var container = document.getElementById('teamCountdownSection');
                if (!container) return;

                if (!gameState.started) {
                    container.innerHTML = '<div class="game-not-started">â¸ï¸ Oyun henÃ¼z baÅŸlamadÄ±. LÃ¼tfen bekleyiniz...</div>';
                } else {
                    var timeClass = gameState.countdown < 60 ? 'warning' : '';
                    var phaseHtml = gameState.phaseTitle ? `<div class="team-countdown-phase">${gameState.phaseTitle}</div>` : '';
                    container.innerHTML = `
                    <div class="team-countdown">
                        ${phaseHtml}
                        <div class="team-countdown-label">Kalan SÃ¼re</div>
                        <div class="team-countdown-time ${timeClass}" id="teamCountdown">${formatTime(gameState.countdown)}</div>
                    </div>`;
                }
            }

            // --- YENÄ°LENMÄ°Åž ADMIN KART RENDER ---
            function renderAdminList() {
                // Ä°statistikleri gÃ¼ncelle
                document.getElementById('statTeams').textContent = teams.length;
                var totalClues = teams.reduce((acc, t) => acc + t.clues.length, 0);
                document.getElementById('statClues').textContent = totalClues;

                // Bildirim listesini de render et
                NOTIF.renderAdminList();

                var container = document.getElementById('adminList');
                if (teams.length === 0) {
                    container.innerHTML = '<div style="grid-column:1/-1; text-align:center; padding:50px; color:#444;">HenÃ¼z takÄ±m yok.</div>';
                    document.getElementById('chartContent').innerHTML = '';
                    return;
                }

                // SÄ±ralama YAPMA - created_at sÄ±rasÄ±nda kalsÄ±n
                var sorted = teams.slice(); // Orijinal sÄ±rayÄ± koru

                // Grafik iÃ§in puana gÃ¶re sÄ±ralÄ± versiyonu oluÅŸtur
                var sortedForChart = teams.slice().sort((a, b) => b.score - a.score);
                renderScoreChart(sortedForChart);

                var html = '';
                sorted.forEach((t, index) => {
                    var safeName = t.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    var safeNameHTML = htmlEscape(t.name);
                    var rankClass = '';
                    // Rank iÃ§in gerÃ§ek sÄ±rayÄ± hesapla
                    var realRank = sortedForChart.findIndex(st => st.id === t.id) + 1;
                    if (realRank === 1 && t.score > 0) rankClass = 'g';
                    else if (realRank === 2 && t.score > 0) rankClass = 's';
                    else if (realRank === 3 && t.score > 0) rankClass = 'b';

                    // Kart HTML YapÄ±sÄ± - TakÄ±m rengi ile
                    html += `
                    <div class="admin-card" id="card_${t.id}" style="border-left: 4px solid ${t.color || '#3b82f6'}">
                        <div class="card-header" style="background: linear-gradient(135deg, ${t.color || '#3b82f6'}15, transparent)">
                            <div class="team-identity">
                                <div class="rank-badge ${rankClass}">${realRank}</div>
                                <div class="team-name" style="color: ${t.color || '#3b82f6'}">${safeNameHTML}</div>
                            </div>
                            <div class="team-score" id="score_${t.id}">${t.score}</div>
                        </div>
                        <div class="card-body">
                            <div class="controls-section">
                                <button class="ctrl-btn btn-p10" onclick="adminScore('${t.id}', 10, '${safeName}')">+10</button>
                                <button class="ctrl-btn btn-p5" onclick="adminScore('${t.id}', 5, '${safeName}')">+5</button>
                                <button class="ctrl-btn btn-m5" onclick="adminScore('${t.id}', -5, '${safeName}')">-5</button>
                                <button class="ctrl-btn btn-m10" onclick="adminScore('${t.id}', -10, '${safeName}')">-10</button>
                            </div>

                            <div class="clues-section" id="clues_${t.id}">
                                <div class="clues-title">Ä°PUÃ‡LARI (${t.clues.length})</div>
                                ${ t.clues.length === 0
                                    ? '<div class="no-clues">Ä°pucu yok</div>'
                                    : t.clues.map(c =>
                                        `<div class="clue-item">${htmlEscape(c.text)}<div class="clue-time">${c.time}</div><div style="clear:both"></div></div>`
                                      ).join('')
                                }
                            </div>

                            <button class="delete-btn" onclick="adminDel('${t.id}', '${safeName}')">TakÄ±mÄ± Sil</button>
                        </div>
                    </div>`;
                });
                container.innerHTML = html;
            }

            function renderScoreChart(sortedTeams) {
                var maxScore = Math.max(...sortedTeams.map(t => t.score));
                if (maxScore <= 0) maxScore = 1;

                var html = '';
                sortedTeams.forEach(t => {
                    var pct = Math.max(0, (t.score / maxScore) * 100);
                    var teamColor = t.color || '#3b82f6';
                    html += `
                    <div class="chart-bar">
                        <div class="chart-label" style="color: ${teamColor}">${htmlEscape(t.name)}</div>
                        <div class="chart-track">
                            <div class="chart-fill" style="width: ${pct}%; background: ${teamColor}"></div>
                        </div>
                        <div class="chart-val">${t.score}</div>
                    </div>`;
                });
                document.getElementById('chartContent').innerHTML = html;
            }

            function renderUsersList() {
                var container = document.getElementById('usersList');
                if (users.length === 0) {
                    container.innerHTML = '<div style="text-align:center; padding:40px; color:#666;">HenÃ¼z kullanÄ±cÄ± yok.</div>';
                    return;
                }

                // TakÄ±mlara gÃ¶re grupla
                var usersWithTeam = users.filter(u => u.team_id);
                var usersWithoutTeam = users.filter(u => !u.team_id);

                // TakÄ±mlara gÃ¶re grupla
                var teamGroups = {};
                usersWithTeam.forEach(u => {
                    if (!teamGroups[u.team_id]) {
                        teamGroups[u.team_id] = {
                            teamName: u.team_name,
                            teamColor: u.team_color || '#3b82f6',
                            users: []
                        };
                    }
                    teamGroups[u.team_id].users.push(u);
                });

                var html = '';

                // TakÄ±mlÄ± kullanÄ±cÄ±lar
                Object.keys(teamGroups).forEach(teamId => {
                    var group = teamGroups[teamId];
                    html += `
                        <div style="background: #1a1a1a; border-left: 4px solid ${group.teamColor}; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                            <h4 style="color: ${group.teamColor}; margin: 0 0 15px 0; font-size: 18px;">
                                ${htmlEscape(group.teamName)}
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${group.users.map(u => {
                                    // GÃœVENLÄ°K: onclick iÃ§in JavaScript string escape (htmlEscape yetersiz)
                                    var safeNick = u.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');
                                    return `
                                    <div style="background: #222; padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                        ${u.is_captain ? '<span style="font-size: 20px;">ðŸ‘‘</span>' : '<span style="font-size: 20px;">ðŸ‘¤</span>'}
                                        <span style="color: white; font-weight: ${u.is_captain ? 'bold' : 'normal'}; flex: 1;">
                                            ${htmlEscape(u.nickname)}
                                        </span>
                                        ${u.is_captain ? '<span style="color: #fbbf24; font-size: 12px;">(Kaptan)</span>' : ''}
                                        <button onclick="adminDeleteUser('${u.id}', '${safeNick}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; margin-left: 10px;">
                                            ðŸ—‘ï¸ Sil
                                        </button>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    `;
                });

                // TakÄ±msÄ±z kullanÄ±cÄ±lar
                if (usersWithoutTeam.length > 0) {
                    html += `
                        <div style="background: #1a1a1a; border-left: 4px solid #666; border-radius: 8px; padding: 20px;">
                            <h4 style="color: #999; margin: 0 0 15px 0; font-size: 18px;">
                                TakÄ±msÄ±z KullanÄ±cÄ±lar
                            </h4>
                            <div style="display: grid; gap: 10px;">
                                ${usersWithoutTeam.map(u => {
                                    // GÃœVENLÄ°K: onclick iÃ§in JavaScript string escape (htmlEscape yetersiz)
                                    var safeNick = u.nickname.replace(/'/g, "\\'").replace(/"/g, '\\"');
                                    return `
                                    <div style="background: #222; padding: 12px 15px; border-radius: 6px; display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 20px;">ðŸ‘¤</span>
                                        <span style="color: white; flex: 1;">${htmlEscape(u.nickname)}</span>
                                        <button onclick="adminDeleteUser('${u.id}', '${safeNick}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 10px; border-radius: 4px; cursor: pointer; font-size: 11px;">
                                            ðŸ—‘ï¸ Sil
                                        </button>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>
                    `;
                }

                container.innerHTML = html;
            }

            function renderScoreboard() {
                var c = document.getElementById('scoreboardList');
                if (teams.length === 0) {
                    c.innerHTML = '<div style="text-align:center; color:#666; padding:40px;">HenÃ¼z takÄ±m yok</div>';
                    return;
                }

                var sorted = teams.slice().sort((a, b) => b.score - a.score);
                var html = '';

                sorted.forEach((t, i) => {
                    var rankClass = i === 0 ? 'rank-1' : i === 1 ? 'rank-2' : i === 2 ? 'rank-3' : '';
                    var medal = i === 0 ? 'ðŸ¥‡' : i === 1 ? 'ðŸ¥ˆ' : i === 2 ? 'ðŸ¥‰' : (i + 1);
                    var clueCount = Array.isArray(t.clues) ? t.clues.length : 0;

                    html += `
                    <div class="leaderboard-item ${rankClass}" style="animation-delay: ${i * 0.1}s">
                        <div class="leaderboard-left">
                            <div class="leaderboard-rank">${medal}</div>
                            <div class="leaderboard-info">
                                <div class="leaderboard-name">${htmlEscape(t.name)}</div>
                                <div class="leaderboard-stats">${clueCount} ipucu gÃ¶nderildi</div>
                            </div>
                        </div>
                        <div class="leaderboard-score">${t.score}</div>
                    </div>`;
                });

                c.innerHTML = html;
            }

            // Sadece skor deÄŸiÅŸtiÄŸinde (performans iÃ§in)
            function updateScoresOnly() {
                // GrafiÄŸi yeniden Ã§iz
                var sorted = teams.slice().sort((a, b) => b.score - a.score);
                renderScoreChart(sorted);

                // Kartlardaki sayÄ±larÄ± gÃ¼ncelle
                teams.forEach(t => {
                    var el = document.getElementById('score_' + t.id);
                    if (el) el.textContent = t.score;
                });
            }

            // EmeÄŸi geÃ§enler listesini render et (Admin Paneli)
            function renderCreditsList() {
                var container = document.getElementById('creditsList');
                var countEl = document.getElementById('creditsCount');

                if (!container || !countEl) return;

                countEl.textContent = credits.length + ' kiÅŸi';

                if (credits.length === 0) {
                    container.innerHTML = '<div style="color:#666; text-align:center; padding:40px; width:100%;">HenÃ¼z kimse eklenmemiÅŸ</div>';
                    return;
                }

                var html = '';
                credits.forEach(function(credit) {
                    var safeName = credit.name.replace(/'/g, "\\'").replace(/"/g, '\\"');
                    var safeNameHTML = htmlEscape(credit.name);
                    html += `
                    <div style="background:#1a1a1a; border:1px solid #333; border-radius:8px; padding:15px; transition:0.2s;">
                        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
                            <span style="color:var(--gold); font-size:15px; font-weight:600;">${safeNameHTML}</span>
                            <button onclick="ADMIN.removeCredit('${credit.id}', '${safeName}')" style="background:transparent; border:1px solid #500; color:#faa; padding:4px 10px; border-radius:4px; font-size:11px; cursor:pointer; transition:0.2s;" onmouseover="this.style.background='rgba(139,0,0,0.2)'" onmouseout="this.style.background='transparent'">ðŸ—‘ï¸ Sil</button>
                        </div>
                        <div style="margin-bottom:8px;">
                            <label style="color:#888; font-size:11px; text-transform:uppercase; letter-spacing:1px; margin-bottom:6px; display:block;">KatkÄ±larÄ±</label>
                            <textarea id="creditContent_${credit.id}" placeholder="Bu kiÅŸinin katkÄ±larÄ±nÄ± yazÄ±n..." maxlength="1000" style="width:100%; min-height:80px; background:#0a0a0a; border:1px solid #333; border-radius:6px; color:#fff; padding:10px; font-family:inherit; resize:vertical; font-size:13px; line-height:1.6;">${credit.content || ''}</textarea>
                        </div>
                        <button onclick="ADMIN.updateCreditContent('${credit.id}')" class="btn btn-primary" style="width:100%; padding:8px; margin:0; font-size:12px;">ðŸ’¾ Ä°Ã§eriÄŸi Kaydet</button>
                    </div>`;
                });
                container.innerHTML = html;
            }

            // Ana sayfa emeÄŸi geÃ§enler listesini render et
            function renderMainCredits() {
                var nicknameContainer = document.getElementById('nicknameCreditsList');
                var lobbyContainer = document.getElementById('lobbyCreditsList');

                var html = '';
                if (credits.length === 0) {
                    html = '<div class="credit-item">-</div>';
                } else {
                    credits.forEach(function(credit) {
                        html += `<div class="credit-item" onclick="GAME.showCreditDetail('${credit.id}')">${htmlEscape(credit.name)}</div>`;
                    });
                }

                // Her iki listeyi de gÃ¼ncelle
                if (nicknameContainer) nicknameContainer.innerHTML = html;
                if (lobbyContainer) lobbyContainer.innerHTML = html;
            }

            // Socket Listeners
            socket.on('credits-update', function(newCredits) {
                credits = newCredits;
                renderMainCredits();
                renderCreditsList();
            });

            socket.on('teams-update', function(newTeams) {
                var oldLen = teams.length;
                teams = newTeams;

                // Chat dropdown iÃ§in takÄ±m listesini gÃ¼ncelle
                CHAT.updateAvailableTeams(teams);

                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    // TakÄ±m sayÄ±sÄ± deÄŸiÅŸtiyse full render, deÄŸiÅŸmediyse sadece skor gÃ¼ncelle (titremeyi Ã¶nlemek iÃ§in)
                    if (oldLen !== teams.length) renderAdminList();
                    else {
                        // Ä°pucu sayÄ±sÄ± deÄŸiÅŸmiÅŸ mi kontrol et
                        // Basitlik iÃ§in full render yapabiliriz ama UX iÃ§in ayrÄ±ÅŸtÄ±rmak iyidir.
                        // Åžimdilik temiz olmasÄ± iÃ§in full render yapalÄ±m, grid yapÄ±sÄ± stabil zaten.
                        renderAdminList();
                    }

                    // Chat Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse team selector'Ä± gÃ¼ncelle
                    ADMIN.updateChatTeamSelector();
                }
                
                if (document.getElementById('pgScoreboard').classList.contains('active')) renderScoreboard();
                if (document.getElementById('joinForm').style.display === 'block') renderJoinList();
                
                if (currentTeamId) {
                    var myTeam = teams.find(t => t.id === currentTeamId);
                    if (myTeam) renderTeamPage(myTeam);
                }
            });

            socket.on('users-update', function(newUsers) {
                users = newUsers;

                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    // Admin panelinde users section aÃ§Ä±ksa render et
                    if (document.getElementById('adminSectionUsers').style.display !== 'none') {
                        renderUsersList();
                    }
                }
            });

            socket.on('team-deleted', function(id) {
                if (currentTeamId === id) {
                    currentTeamId = null;
                    router.navigate('/lobby');
                    toast('TakÄ±m silindi', true);
                }
            });

            socket.on('game-reset', function() {
                // Admin panelindeyse atma
                var isInAdminPanel = document.getElementById('pgAdmin').classList.contains('active');
                if (!isInAdminPanel) {
                    currentTeamId = null;
                    router.navigate('/lobby');
                }
            });

            // Oyun Bitti - Final Raporu
            socket.on('game-ended', function(report) {
                console.log('Oyun bitti, final raporu alÄ±ndÄ±:', report);
                toast('ðŸ Oyun bitti! Rapor gÃ¶steriliyor...');
                GAME.showFinalReport(report);
            });

            // Bildirim Eventi
            socket.on('notification', function(data) {
                NOTIF.add(data.title, data.message, data.type);
            });

            // Puan deÄŸiÅŸikliÄŸi bildirimi
            socket.on('score-changed', function(data) {
                var msg = data.teamName + ' takÄ±mÄ± ' + (data.amount > 0 ? '+' : '') + data.amount + ' puan aldÄ±. Yeni puan: ' + data.newScore;
                NOTIF.add('Puan DeÄŸiÅŸikliÄŸi', msg, 'score');
            });

            // YÃ¶netici ipuÃ§larÄ± listesi gÃ¼ncellendi
            socket.on('general-clues-update', function(clues) {
                generalClues = clues;

                // TakÄ±m sayfasÄ±ndaysa render et
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    renderGeneralClues();
                }

                // Admin paneldeyse ipuÃ§larÄ± listesini render et
                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    ADMIN.renderAdminClues();
                }
            });

            // Yeni yÃ¶netici ipucu bildirimi
            socket.on('general-clue-notification', function(data) {
                // Bildirim gÃ¶ster
                NOTIFICATION.show('YÃ¶netici Ä°pucu', data.clue, data.time);

                // TakÄ±m sayfasÄ±ndaysa render et (biraz gecikme ile, veritabanÄ±ndan gelmesini bekle)
                setTimeout(function() {
                    if (document.getElementById('pgTeam').classList.contains('active')) {
                        renderGeneralClues();
                    }
                }, 100);
            });

            // Yeni takÄ±m mesajÄ±
            socket.on('new-team-message', function(message) {
                CHAT.onNewMessage(message);

                // Admin panelde Chat Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve seÃ§ili takÄ±m mesajÄ± gÃ¶rebiliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionChat').style.display !== 'none' &&
                    ADMIN.selectedChatTeamId) {

                    // TakÄ±mlara Ã¶zel admin mesajlarÄ±nÄ± hariÃ§ tut (herkese olanlarÄ±)
                    if (message.target_team_id === 'admin') {
                        return;
                    }

                    // MesajÄ±n seÃ§ili takÄ±m tarafÄ±ndan gÃ¶rÃ¼lebilir olup olmadÄ±ÄŸÄ±nÄ± kontrol et
                    var canSeeMessage = false;

                    // Admin'in bu takÄ±ma gÃ¶nderdiÄŸi mesaj
                    if (message.team_id === null && message.target_team_id === ADMIN.selectedChatTeamId) {
                        canSeeMessage = true;
                    }
                    // 1. Genel mesaj (herkese)
                    else if (!message.target_team_id) {
                        canSeeMessage = true;
                    }
                    // 2. SeÃ§ili takÄ±ma gÃ¶nderilen Ã¶zel mesaj
                    else if (message.target_team_id === ADMIN.selectedChatTeamId) {
                        canSeeMessage = true;
                    }
                    // 3. SeÃ§ili takÄ±mÄ±n gÃ¶nderdiÄŸi Ã¶zel mesaj
                    else if (message.team_id === ADMIN.selectedChatTeamId) {
                        canSeeMessage = true;
                    }

                    if (canSeeMessage) {
                        // MesajÄ± ekle
                        var container = document.getElementById('adminChatMessages');
                        if (container) {
                            // BoÅŸ mesaj varsa temizle
                            if (container.querySelector('[style*="HenÃ¼z mesaj yok"]')) {
                                container.innerHTML = '';
                            }

                            var time = new Date(message.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
                            var isFromSelectedTeam = message.team_id === ADMIN.selectedChatTeamId;
                            var isFromAdmin = message.team_id === null; // Admin mesajÄ±

                            // TakÄ±m rengi badge
                            var teamColor = message.team_color || '#3b82f6';
                            var teamBadge = `<span style="background: ${teamColor}; color: #fff; font-size: 10px; font-weight: 700; padding: 3px 8px; border-radius: 6px; box-shadow: 0 2px 4px rgba(0,0,0,0.3);">${htmlEscape(message.team_name)}</span>`;

                            // Hedef takÄ±m etiketi
                            var targetLabel = '';
                            if (message.target_team_name) {
                                targetLabel = `<span style="color: #d4af37; font-size: 10px; background: rgba(212,175,55,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(212,175,55,0.3);">ðŸ”’ â†’ ${htmlEscape(message.target_team_name)}</span>`;
                            } else {
                                targetLabel = `<span style="color: #4dd4d4; font-size: 10px; background: rgba(77,212,212,0.15); padding: 2px 6px; border-radius: 4px; border: 1px solid rgba(77,212,212,0.3);">ðŸ“¢ TÃ¼m TakÄ±mlar</span>`;
                            }

                            // WhatsApp tarzÄ± gÃ¶rÃ¼nÃ¼m
                            var html = '';
                            if (isFromAdmin) {
                                // Admin mesajÄ± - SAÄžDA (Ã¶zel altÄ±n rengi)
                                html = `
                                <div style="display: flex; justify-content: flex-end; margin-bottom: 12px;">
                                    <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-end;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap; justify-content: flex-end;">
                                            <span style="color: #444; font-size: 10px;">${time}</span>
                                            ${targetLabel}
                                            ${teamBadge}
                                            <span style="color: #fbbf24; font-weight: 700; font-size: 13px;">ðŸ‘‘ ${htmlEscape(message.nickname)}</span>
                                        </div>
                                        <div style="background: linear-gradient(135deg, #4a3800, #2d2200); border: 2px solid #fbbf24; border-radius: 12px 12px 2px 12px; padding: 10px 14px; color: #fbbf24; font-size: 14px; font-weight: 600; word-wrap: break-word; box-shadow: 0 2px 8px rgba(251,191,36,0.3);">
                                            ${htmlEscape(message.message)}
                                        </div>
                                    </div>
                                </div>`;
                            } else if (isFromSelectedTeam) {
                                // SeÃ§ili takÄ±mÄ±n mesajÄ± - SOLDA
                                html = `
                                <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                    <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                            <span style="color: #4dd4d4; font-weight: 700; font-size: 13px;">${htmlEscape(message.nickname)}</span>
                                            ${teamBadge}
                                            ${targetLabel}
                                            <span style="color: #444; font-size: 10px;">${time}</span>
                                        </div>
                                        <div style="background: linear-gradient(135deg, #0d5858, #0a4040); border: 1px solid #1a7070; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                            ${htmlEscape(message.message)}
                                        </div>
                                    </div>
                                </div>`;
                            } else {
                                // DiÄŸer takÄ±mÄ±n mesajÄ± - SOLDA
                                html = `
                                <div style="display: flex; justify-content: flex-start; margin-bottom: 12px;">
                                    <div style="max-width: 75%; display: flex; flex-direction: column; align-items: flex-start;">
                                        <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 4px; flex-wrap: wrap;">
                                            <span style="color: #ffa500; font-weight: 700; font-size: 13px;">${htmlEscape(message.nickname)}</span>
                                            ${teamBadge}
                                            ${targetLabel}
                                            <span style="color: #444; font-size: 10px;">${time}</span>
                                        </div>
                                        <div style="background: #1a1a1a; border: 1px solid #333; border-radius: 12px 12px 12px 2px; padding: 10px 14px; color: #fff; font-size: 14px; word-wrap: break-word; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                                            ${htmlEscape(message.message)}
                                        </div>
                                    </div>
                                </div>`;
                            }

                            container.insertAdjacentHTML('beforeend', html);
                            container.scrollTop = container.scrollHeight;

                            // SayacÄ± gÃ¼ncelle
                            var countEl = document.getElementById('adminChatMessageCount');
                            if (countEl) {
                                var currentCount = parseInt(countEl.textContent.split(' ')[0]) || 0;
                                countEl.textContent = (currentCount + 1) + ' mesaj';
                            }
                        }
                    }
                }
            });

            // Yeni admin mesajÄ± (admin'e gÃ¶nderilen Ã¶zel mesaj)
            socket.on('new-admin-message', function(message) {
                // Bildirim gÃ¶ster
                if (currentUser && currentUser.isAdmin) {
                    toast(`ðŸ“© ${message.team_name} takÄ±mÄ±ndan yeni mesaj!`);
                }

                // Admin panelde Admin MesajlarÄ± bÃ¶lÃ¼mÃ¼ndeyse ve seÃ§ili takÄ±mÄ±n mesajÄ±ysa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionAdminmessages').style.display !== 'none' &&
                    ADMIN.selectedAdminTeamId === message.team_id) {

                    // SeÃ§ili takÄ±mÄ±n mesajlarÄ±nÄ± yeniden yÃ¼kle
                    ADMIN.selectTeamForAdminMessages(ADMIN.selectedAdminTeamId);
                }
            });

            // Oyun durumu gÃ¼ncellemesi
            socket.on('game-state-update', function(state) {
                gameState.started = state.started;
                gameState.countdown = state.countdown;
                gameState.phaseTitle = state.phaseTitle || '';

                // Admin panelindeyse gÃ¶rÃ¼nÃ¼mÃ¼ gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active')) {
                    if (gameState.started) {
                        document.getElementById('gameStartSection').style.display = 'none';
                        document.getElementById('gameRunningSection').style.display = 'block';
                        ADMIN.updateCountdownDisplay();
                    } else {
                        document.getElementById('gameStartSection').style.display = 'block';
                        document.getElementById('gameRunningSection').style.display = 'none';
                    }
                }

                // TakÄ±m sayfasÄ±ndaysa countdown'u gÃ¼ncelle
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    renderTeamCountdown();
                }
            });

            // Oyun baÅŸlatÄ±ldÄ±
            socket.on('game-started', function(data) {
                gameState.started = true;
                gameState.countdown = data.countdown;
                gameState.phaseTitle = data.phaseTitle || '';

                // Admin paneli gÃ¼ncelle
                document.getElementById('gameStartSection').style.display = 'none';
                document.getElementById('gameRunningSection').style.display = 'block';
                ADMIN.updateCountdownDisplay();

                // TakÄ±m sayfasÄ± gÃ¼ncelle
                renderTeamCountdown();

                toast('Oyun baÅŸladÄ±!');
            });

            // Countdown gÃ¼ncellendi
            socket.on('countdown-update', function(countdown) {
                gameState.countdown = countdown;

                // Admin countdown gÃ¼ncelle
                ADMIN.updateCountdownDisplay();

                // TakÄ±m countdown gÃ¼ncelle
                var teamDisplay = document.getElementById('teamCountdown');
                if (teamDisplay) {
                    teamDisplay.textContent = formatTime(countdown);
                    if (countdown < 60) {
                        teamDisplay.classList.add('warning');
                    } else {
                        teamDisplay.classList.remove('warning');
                    }
                }
            });

            // Oyun bitti
            socket.on('game-ended', function() {
                gameState.started = false;
                gameState.countdown = 0;
                gameState.phaseTitle = '';

                // Admin paneli gÃ¼ncelle
                document.getElementById('gameStartSection').style.display = 'block';
                document.getElementById('gameRunningSection').style.display = 'none';

                // TakÄ±m sayfasÄ± gÃ¼ncelle
                renderTeamCountdown();

                toast('Oyun bitti!');
            });

            // KullanÄ±cÄ± silindi (admin tarafÄ±ndan)
            socket.on('user-deleted', function() {
                // Cleanup: TÃ¼m timeout'larÄ± temizle
                clearAllTimeouts();

                // GÃœVENLÄ°K: Session temizliÄŸi
                currentUser = null;
                currentTeamId = null;
                isAdmin = false;

                // Nick giriÅŸ sayfasÄ±na yÃ¶nlendir
                router.navigate('/');
                updateCurrentUserDisplay();
                toast('HesabÄ±nÄ±z yÃ¶netici tarafÄ±ndan silindi.', true);
            });

            // Server kapatÄ±lÄ±yor (deployment/gÃ¼ncelleme)
            socket.on('server-shutdown', function(data) {
                toast('Sunucu gÃ¼ncelleniyor... Sayfa 3 saniye sonra yenilenecek.', false);
                setTimeout(function() {
                    window.location.reload();
                }, 3000);
            });

            // DÃ¼rtme (Poke) sistemi
            socket.on('team-poke', function(data) {
                // BÃ¼yÃ¼k bildirim gÃ¶ster
                document.getElementById('pokeNotificationText').textContent = data.fromTeamName;
                var overlay = document.getElementById('pokeNotificationOverlay');
                overlay.classList.add('active');

                // 3 saniye sonra kapat
                setTimeout(function() {
                    overlay.classList.remove('active');
                }, 3000);

                // Toast bildirimi de gÃ¶ster
                toast('ðŸ‘‹ ' + data.fromTeamName + ' sizi dÃ¼rttÃ¼!', false);
            });

            // Murder Board GÃ¼ncellemeleri (Admin iÃ§in canlÄ± izleme)
            socket.on('board-item-added', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-item-deleted', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-item-position-updated', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {

                    // Sadece pozisyonu gÃ¼ncelle (performance iÃ§in tam yenileme yapmÄ±yoruz)
                    const item = ADMIN_BOARD.boardItems.find(function(i) { return i.id === data.itemId; });
                    if (item) {
                        item.x = data.x;
                        item.y = data.y;

                        // Sadece baÄŸlantÄ±larÄ± yeniden Ã§iz
                        ADMIN_BOARD.renderConnections();

                        // Item'Ä±n pozisyonunu DOM'da gÃ¼ncelle
                        const itemEl = document.querySelector('#adminBoardCanvas [style*="left: ' + item.x + 'px"]');
                        if (itemEl) {
                            itemEl.style.left = data.x + 'px';
                            itemEl.style.top = data.y + 'px';
                        }
                    }
                }
            });

            socket.on('board-connection-added', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-connection-deleted', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            socket.on('board-cleared', function(data) {
                // Admin panelde Murder Board Ä°zleme bÃ¶lÃ¼mÃ¼ndeyse ve bu takÄ±mÄ± izliyorsa gÃ¼ncelle
                if (document.getElementById('pgAdmin').classList.contains('active') &&
                    document.getElementById('adminSectionMurderboard').style.display !== 'none' &&
                    ADMIN_BOARD.selectedTeamId === data.teamId) {
                    ADMIN_BOARD.loadBoard();
                }
            });

            // Karakter gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ deÄŸiÅŸti
            socket.on('character-visibility-changed', function(data) {
                console.log('Karakter gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ deÄŸiÅŸti:', data);

                // TakÄ±m sayfasÄ±nda Murder Board karakterlerini yeniden yÃ¼kle
                if (document.getElementById('pgTeam').classList.contains('active')) {
                    MURDERBOARD.loadAvailableCharacters();
                }
            });

            // POKE (DÃ¼rtme) YÃ¶netimi
            var POKE = {
                // Rate limiting cache (client-side, son dÃ¼rtme zamanlarÄ±)
                lastPokeTime: {}, // { targetTeamId: timestamp }

                // Modal gÃ¶ster
                showPokeModal: function() {
                    if (!currentUser || !currentTeamId) {
                        toast('DÃ¼rtme Ã¶zelliÄŸini kullanmak iÃ§in bir takÄ±ma giriÅŸ yapmalÄ±sÄ±nÄ±z!', true);
                        return;
                    }

                    // TakÄ±m listesini yÃ¼kle
                    socket.emit('get-teams', function(teams) {
                        var html = '';
                        var now = Date.now();

                        teams.forEach(function(team) {
                            // Kendi takÄ±mÄ±nÄ± gÃ¶sterme
                            if (team.id === currentTeamId) return;

                            // Rate limiting kontrolÃ¼
                            var lastPoke = POKE.lastPokeTime[team.id] || 0;
                            var timeSinceLastPoke = now - lastPoke;
                            var canPoke = timeSinceLastPoke > 60000; // 60 saniye = 1 dakika
                            var remainingSeconds = canPoke ? 0 : Math.ceil((60000 - timeSinceLastPoke) / 1000);

                            var disabledClass = canPoke ? '' : 'disabled';
                            var disabledAttr = canPoke ? '' : 'disabled';
                            var buttonText = canPoke ? 'DÃ¼rt ðŸ‘‹' : ('Bekleyin (' + remainingSeconds + 's)');

                            html += `
                            <div class="poke-team-item ${disabledClass}">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="width: 12px; height: 12px; background: ${team.color}; border-radius: 50%; box-shadow: 0 0 10px ${team.color};"></div>
                                    <div>
                                        <div style="color: #fff; font-size: 16px; font-weight: 600;">${htmlEscape(team.name)}</div>
                                        <div style="color: #666; font-size: 12px;">${team.score} puan</div>
                                    </div>
                                </div>
                                <button
                                    class="btn btn-primary"
                                    style="padding: 8px 16px; margin: 0; font-size: 13px; ${canPoke ? '' : 'opacity: 0.5; cursor: not-allowed;'}"
                                    onclick="POKE.pokeTeam('${team.id}', '${htmlEscape(team.name)}')"
                                    ${disabledAttr}
                                >
                                    ${buttonText}
                                </button>
                            </div>`;
                        });

                        if (html === '') {
                            html = '<div style="text-align: center; padding: 40px; color: #666;"><div style="font-size: 32px; margin-bottom: 10px;">ðŸ¤·</div><div>DÃ¼rtebileceÄŸiniz baÅŸka takÄ±m yok</div></div>';
                        }

                        document.getElementById('pokeTeamList').innerHTML = html;
                        document.getElementById('pokeSelectOverlay').classList.add('active');
                    });
                },

                // Modal gizle
                hidePokeModal: function() {
                    document.getElementById('pokeSelectOverlay').classList.remove('active');
                },

                // TakÄ±mÄ± dÃ¼rt
                pokeTeam: function(targetTeamId, targetTeamName) {
                    var now = Date.now();
                    var lastPoke = POKE.lastPokeTime[targetTeamId] || 0;
                    var timeSinceLastPoke = now - lastPoke;

                    // Client-side rate limiting
                    if (timeSinceLastPoke < 60000) {
                        var remainingSeconds = Math.ceil((60000 - timeSinceLastPoke) / 1000);
                        toast('Bu takÄ±mÄ± ' + remainingSeconds + ' saniye sonra tekrar dÃ¼rtebilirsiniz!', true);
                        return;
                    }

                    // Server'a dÃ¼rtme isteÄŸi gÃ¶nder
                    socket.emit('poke-team', targetTeamId, function(response) {
                        if (response.success) {
                            // Son dÃ¼rtme zamanÄ±nÄ± kaydet
                            POKE.lastPokeTime[targetTeamId] = now;

                            toast('ðŸ‘‹ ' + targetTeamName + ' takÄ±mÄ±nÄ± dÃ¼rttÃ¼nÃ¼z!', false);
                            POKE.hidePokeModal();
                        } else {
                            toast(response.error || 'DÃ¼rtme gÃ¶nderilemedi!', true);
                        }
                    });
                }
            };

            // KARAKTER YÃ–NETÄ°MÄ° FONKSÄ°YONLARI
            window.CHARACTER = {
                addCharacter: function() {
                    const name = document.getElementById('charName').value.trim();
                    const photoUrl = document.getElementById('charPhotoUrl').value.trim();
                    const description = document.getElementById('charDescription').value.trim();
                    const age = document.getElementById('charAge').value;
                    const occupation = document.getElementById('charOccupation').value.trim();
                    const additionalInfo = document.getElementById('charAdditionalInfo').value.trim();

                    // Validasyon
                    if (!name) {
                        toast('Karakter ismi zorunludur!', true);
                        return;
                    }

                    // Socket'e gÃ¶nder (varsayÄ±lan: gÃ¶rÃ¼nÃ¼r deÄŸil)
                    socket.emit('add-character', {
                        name: name,
                        photoUrl: photoUrl || null,
                        description: description || null,
                        age: age ? parseInt(age) : null,
                        occupation: occupation || null,
                        additionalInfo: additionalInfo || null,
                        visibleToTeams: false
                    }, function(response) {
                        if (response.success) {
                            toast('âœ… Karakter baÅŸarÄ±yla eklendi! GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼nÃ¼ "Oyun KontrolÃ¼" bÃ¶lÃ¼mÃ¼nden ayarlayabilirsiniz.');

                            // Formu temizle
                            document.getElementById('charName').value = '';
                            document.getElementById('charPhotoUrl').value = '';
                            document.getElementById('charDescription').value = '';
                            document.getElementById('charAge').value = '';
                            document.getElementById('charOccupation').value = '';
                            document.getElementById('charAdditionalInfo').value = '';

                            // Listeyi yenile
                            CHARACTER.loadCharacters();
                            ADMIN.loadGameCharacters(); // Oyun kontrolÃ¼ listesini gÃ¼ncelle
                        } else {
                            toast(response.error || 'Karakter eklenemedi!', true);
                        }
                    });
                },

                loadCharacters: function() {
                    socket.emit('get-characters', function(characters) {
                        CHARACTER.renderCharacters(characters);
                    });
                },

                renderCharacters: function(characters) {
                    const container = document.getElementById('charactersList');
                    const countSpan = document.getElementById('characterCount');

                    countSpan.textContent = characters.length + ' karakter';

                    if (characters.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 40px 20px; color: #555;">
                                <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ðŸ‘¤</div>
                                <div style="font-size: 14px;">HenÃ¼z karakter eklenmemiÅŸ</div>
                            </div>
                        `;
                        return;
                    }

                    let html = '';
                    characters.forEach(function(char) {
                        html += `
                            <div style="background: #0a0a0a; border: 1px solid #333; border-radius: 8px; padding: 15px; margin-bottom: 12px;">
                                <div style="display: flex; gap: 15px; align-items: start;">
                                    ${char.photo_url ? `
                                        <img src="${char.photo_url}" alt="${char.name}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid #444;">
                                    ` : `
                                        <div style="width: 80px; height: 80px; background: #222; border-radius: 8px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; font-size: 32px;">ðŸ‘¤</div>
                                    `}

                                    <div style="flex: 1; min-width: 0;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                            <div style="flex: 1;">
                                                <h4 style="color: #4dd4d4; margin: 0; font-size: 16px; font-weight: 600;">${escapeHtml(char.name)}</h4>
                                                <div style="margin-top: 4px;">
                                                    <span style="display: inline-block; padding: 2px 8px; background: ${char.visible_to_teams ? '#1a4d1a' : '#4d4d1a'}; border: 1px solid ${char.visible_to_teams ? '#4dd44d' : '#888'}; color: ${char.visible_to_teams ? '#4dd44d' : '#888'}; border-radius: 4px; font-size: 10px;">
                                                        ${char.visible_to_teams ? 'ðŸ‘ï¸ GÃ¶rÃ¼nÃ¼r' : 'ðŸ”’ Gizli'}
                                                    </span>
                                                </div>
                                            </div>
                                            <button onclick="CHARACTER.deleteCharacter('${char.id}')" style="background: #500; border: 1px solid #800; color: #faa; padding: 4px 12px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: all 0.2s;" onmouseover="this.style.background='#700'" onmouseout="this.style.background='#500'">ðŸ—‘ï¸ Sil</button>
                                        </div>

                                        ${char.age || char.occupation ? `
                                            <div style="display: flex; gap: 12px; margin-bottom: 8px; flex-wrap: wrap;">
                                                ${char.age ? `<span style="color: #888; font-size: 12px;">ðŸ“… ${char.age} yaÅŸÄ±nda</span>` : ''}
                                                ${char.occupation ? `<span style="color: #888; font-size: 12px;">ðŸ’¼ ${escapeHtml(char.occupation)}</span>` : ''}
                                            </div>
                                        ` : ''}

                                        ${char.description ? `
                                            <p style="color: #aaa; font-size: 13px; margin: 0 0 8px 0; line-height: 1.5;">${escapeHtml(char.description)}</p>
                                        ` : ''}

                                        ${char.additional_info ? `
                                            <details style="margin-top: 8px;">
                                                <summary style="color: #666; font-size: 12px; cursor: pointer; user-select: none;">Ek Bilgiler</summary>
                                                <p style="color: #888; font-size: 12px; margin: 8px 0 0 0; padding-left: 12px; border-left: 2px solid #333; line-height: 1.5;">${escapeHtml(char.additional_info)}</p>
                                            </details>
                                        ` : ''}

                                        <div style="color: #555; font-size: 11px; margin-top: 8px;">
                                            Eklendi: ${new Date(char.created_at).toLocaleString('tr-TR')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    });

                    container.innerHTML = html;
                },

                deleteCharacter: function(characterId) {
                    if (!confirm('Bu karakteri silmek istediÄŸinizden emin misiniz?')) {
                        return;
                    }

                    socket.emit('delete-character', characterId, function(response) {
                        if (response.success) {
                            toast('ðŸ—‘ï¸ Karakter silindi');
                            CHARACTER.loadCharacters();
                            ADMIN.loadGameCharacters(); // Oyun kontrolÃ¼ listesini gÃ¼ncelle
                        } else {
                            toast(response.error || 'Karakter silinemedi!', true);
                        }
                    });
                },

                openPhotoSelector: function() {
                    // FotoÄŸraf seÃ§ici modal'Ä± aÃ§
                    document.getElementById('photoSelectorModal').style.display = 'flex';

                    // YÃ¼klenmiÅŸ fotoÄŸraflarÄ± getir
                    socket.emit('get-uploaded-photos', function(response) {
                        const gallery = document.getElementById('photoGallery');

                        if (!response.success || response.photos.length === 0) {
                            gallery.innerHTML = `
                                <div style="grid-column: 1 / -1; text-align: center; padding: 40px 20px; color: #555;">
                                    <div style="font-size: 48px; margin-bottom: 10px; opacity: 0.3;">ðŸ“‚</div>
                                    <div style="font-size: 14px;">HenÃ¼z fotoÄŸraf yÃ¼klenmemiÅŸ</div>
                                    <div style="font-size: 12px; margin-top: 8px; opacity: 0.7;">FotoÄŸraflarÄ± <code style="background: #222; padding: 2px 6px; border-radius: 3px;">public/uploads/characters/</code> klasÃ¶rÃ¼ne yÃ¼kleyin</div>
                                </div>
                            `;
                            return;
                        }

                        // FotoÄŸraflarÄ± listele
                        let html = '';
                        response.photos.forEach(function(photoUrl) {
                            html += `
                                <div onclick="CHARACTER.selectPhoto('${photoUrl}')" style="cursor: pointer; border: 2px solid #333; border-radius: 8px; overflow: hidden; transition: all 0.2s; aspect-ratio: 1;" onmouseover="this.style.borderColor='#4dd4d4'; this.style.transform='scale(1.05)'" onmouseout="this.style.borderColor='#333'; this.style.transform='scale(1)'">
                                    <img src="${photoUrl}" alt="Karakter" style="width: 100%; height: 100%; object-fit: cover; display: block;">
                                </div>
                            `;
                        });

                        gallery.innerHTML = html;
                    });
                },

                closePhotoSelector: function() {
                    document.getElementById('photoSelectorModal').style.display = 'none';
                },

                selectPhoto: function(photoUrl) {
                    // SeÃ§ilen fotoÄŸrafÄ± input'a yaz
                    document.getElementById('charPhotoUrl').value = photoUrl;
                    toast('âœ… FotoÄŸraf seÃ§ildi');

                    // Modal'Ä± kapat
                    CHARACTER.closePhotoSelector();
                }
            };

            // MURDER BOARD FONKSÄ°YONLARI
            window.MURDERBOARD = {
                connectionMode: false,
                connectionStart: null,
                boardItems: [],
                connections: [],
                draggedItem: null,
                dragOffset: { x: 0, y: 0 },
                editingItemId: null,
                allCharacters: [],
                zoomLevel: 1,
                renderScheduled: false, // requestAnimationFrame iÃ§in flag

                loadAvailableCharacters: function() {
                    // Karakter listesini yÃ¼kle
                    socket.emit('get-characters-for-board', function(characters) {
                        console.log('Karakterler yÃ¼klendi (Murder Board):', characters);
                        MURDERBOARD.allCharacters = characters;
                        MURDERBOARD.updateCharacterDropdown();
                    });
                },

                openMurderBoard: function() {
                    // Karakter listesini yÃ¼kle
                    MURDERBOARD.loadAvailableCharacters();

                    // Board verilerini yÃ¼kle
                    MURDERBOARD.loadBoard();

                    // TakÄ±m adÄ±nÄ± gÃ¶ster (UUID deÄŸil, takÄ±m adÄ±)
                    if (currentUser && currentUser.teamId) {
                        socket.emit('get-team', currentUser.teamId, function(team) {
                            if (team) {
                                document.getElementById('mbTeamName').textContent = team.name;
                            }
                        });
                    } else {
                        document.getElementById('mbTeamName').textContent = 'TakÄ±m';
                    }

                    // Zoom sÄ±fÄ±rla
                    MURDERBOARD.zoomLevel = 1;
                    MURDERBOARD.updateZoom();

                    // SayfayÄ± gÃ¶ster
                    showPage('pgMurderBoard', true);
                },

                closeMurderBoard: function() {
                    showPage('pgTeam', false);
                },

                showCharacterSelector: function() {
                    document.getElementById('characterSelectorModal').style.display = 'flex';
                },

                hideCharacterSelector: function() {
                    document.getElementById('characterSelectorModal').style.display = 'none';
                    document.getElementById('characterDropdown').value = '';
                    document.getElementById('characterNote').value = '';
                },

                updateCharacterDropdown: function() {
                    const dropdown = document.getElementById('characterDropdown');
                    dropdown.innerHTML = '<option value="">Karakter seÃ§in...</option>';

                    // Zaten board'a eklenmiÅŸ karakter ID'lerini bul
                    const addedCharacterIds = MURDERBOARD.boardItems.map(function(item) {
                        return item.character_id;
                    });

                    // EklenmemiÅŸ karakterleri dropdown'a ekle
                    MURDERBOARD.allCharacters.forEach(function(char) {
                        if (addedCharacterIds.indexOf(char.id) === -1) {
                            const option = document.createElement('option');
                            option.value = char.id;
                            option.textContent = char.name;
                            option.dataset.photoUrl = char.photo_url || '';
                            option.dataset.name = char.name;
                            dropdown.appendChild(option);
                        }
                    });
                },

                showEditNoteModal: function(itemId) {
                    const item = MURDERBOARD.boardItems.find(function(i) { return i.id === itemId; });
                    if (!item) return;

                    MURDERBOARD.editingItemId = itemId;
                    document.getElementById('editCharacterName').textContent = item.character_name;
                    document.getElementById('editNoteTextarea').value = item.note || '';
                    document.getElementById('editNoteModal').style.display = 'flex';
                },

                hideEditNoteModal: function() {
                    document.getElementById('editNoteModal').style.display = 'none';
                    MURDERBOARD.editingItemId = null;
                    document.getElementById('editNoteTextarea').value = '';
                },

                saveEditedNote: function() {
                    if (!MURDERBOARD.editingItemId) return;

                    const newNote = document.getElementById('editNoteTextarea').value.trim();

                    socket.emit('update-board-item-note', {
                        itemId: MURDERBOARD.editingItemId,
                        note: newNote
                    }, function(response) {
                        if (response.success) {
                            toast('âœ… Not gÃ¼ncellendi');
                            MURDERBOARD.hideEditNoteModal();
                            MURDERBOARD.loadBoard();
                        } else {
                            toast(response.error || 'Not gÃ¼ncellenemedi!', true);
                        }
                    });
                },

                addCharacterToBoard: function() {
                    const dropdown = document.getElementById('characterDropdown');
                    const note = document.getElementById('characterNote').value.trim();

                    if (!dropdown.value) {
                        toast('LÃ¼tfen bir karakter seÃ§in!', true);
                        return;
                    }

                    const selectedOption = dropdown.options[dropdown.selectedIndex];
                    const characterId = dropdown.value;
                    const characterName = selectedOption.dataset.name;
                    const photoUrl = selectedOption.dataset.photoUrl;

                    // Rastgele pozisyon
                    const x = Math.random() * 300 + 50;
                    const y = Math.random() * 200 + 50;

                    const itemData = {
                        characterId: characterId,
                        characterName: characterName,
                        photoUrl: photoUrl,
                        note: note,
                        x: x,
                        y: y
                    };

                    // Server'a kaydet
                    socket.emit('add-board-item', itemData, function(response) {
                        if (response.success) {
                            toast('âœ… Karakter eklendi');
                            MURDERBOARD.hideCharacterSelector();
                            MURDERBOARD.loadBoard();
                        } else {
                            toast(response.error || 'Karakter eklenemedi!', true);
                        }
                    });
                },

                loadBoard: function() {
                    if (!currentUser || !currentUser.teamId) return;

                    socket.emit('get-board-items', function(data) {
                        MURDERBOARD.boardItems = data.items || [];
                        MURDERBOARD.connections = data.connections || [];
                        MURDERBOARD.renderBoard();
                        MURDERBOARD.updateCharacterDropdown();
                    });
                },

                renderBoard: function() {
                    const canvas = document.getElementById('murderBoardCanvas');
                    const emptyState = document.getElementById('boardEmptyState');
                    const itemCount = document.getElementById('mbItemCount');

                    // Ã–ÄŸe sayÄ±sÄ±nÄ± gÃ¼ncelle
                    itemCount.textContent = MURDERBOARD.boardItems.length;

                    // Empty state kontrolÃ¼
                    if (MURDERBOARD.boardItems.length === 0) {
                        emptyState.style.display = 'block';
                    } else {
                        emptyState.style.display = 'none';
                    }

                    // Mevcut Ã¶ÄŸeleri temizle (SVG hariÃ§)
                    Array.from(canvas.children).forEach(function(child) {
                        if (child.id !== 'connectionsLayer' && child.id !== 'boardEmptyState') {
                            canvas.removeChild(child);
                        }
                    });

                    // BaÄŸlantÄ±larÄ± Ã§iz
                    MURDERBOARD.renderConnections();

                    // Karakterleri ekle
                    MURDERBOARD.boardItems.forEach(function(item) {
                        const itemEl = MURDERBOARD.createItemElement(item);
                        canvas.appendChild(itemEl);
                    });
                },

                createItemElement: function(item) {
                    const div = document.createElement('div');
                    div.className = 'board-item';
                    div.dataset.itemId = item.id;
                    div.style.cssText = 'position: absolute; left: ' + item.x + 'px; top: ' + item.y + 'px; width: 120px; background: #fff; border: 2px solid #333; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.5); cursor: move; user-select: none; -webkit-user-select: none; -webkit-user-drag: none; touch-action: none; z-index: 10;';

                    // Pin efekti
                    const pin = document.createElement('div');
                    pin.style.cssText = 'position: absolute; top: -8px; left: 50%; transform: translateX(-50%); width: 16px; height: 16px; background: radial-gradient(circle, #d44d4d, #8b0000); border-radius: 50%; box-shadow: 0 2px 4px rgba(0,0,0,0.5); z-index: 1;';
                    div.appendChild(pin);

                    // FotoÄŸraf veya placeholder
                    if (item.photo_url) {
                        const img = document.createElement('img');
                        img.src = item.photo_url;
                        img.style.cssText = 'width: 100%; height: 100px; object-fit: cover; border-radius: 6px 6px 0 0; display: block;';
                        div.appendChild(img);
                    } else {
                        const placeholder = document.createElement('div');
                        placeholder.style.cssText = 'width: 100%; height: 100px; background: #ddd; border-radius: 6px 6px 0 0; display: flex; align-items: center; justify-content: center; font-size: 48px;';
                        placeholder.textContent = 'ðŸ‘¤';
                        div.appendChild(placeholder);
                    }

                    // Ä°sim
                    const name = document.createElement('div');
                    name.style.cssText = 'padding: 8px; font-size: 12px; font-weight: 600; color: #000; text-align: center; border-bottom: 1px solid #ddd;';
                    name.textContent = item.character_name;
                    div.appendChild(name);

                    // Not
                    if (item.note) {
                        const note = document.createElement('div');
                        note.style.cssText = 'padding: 6px 8px; font-size: 10px; color: #555; max-height: 60px; overflow-y: auto; font-style: italic;';
                        note.textContent = item.note;
                        div.appendChild(note);
                    }

                    // Sil butonu
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'ðŸ—‘ï¸';
                    deleteBtn.style.cssText = 'position: absolute; top: 4px; right: 4px; background: rgba(255,255,255,0.9); border: 1px solid #d44d4d; border-radius: 4px; padding: 2px 6px; font-size: 12px; cursor: pointer; z-index: 2;';
                    deleteBtn.onclick = function(e) {
                        e.stopPropagation();
                        MURDERBOARD.deleteItem(item.id);
                    };
                    div.appendChild(deleteBtn);

                    // Ã‡ift tÄ±klama ile not dÃ¼zenleme
                    div.addEventListener('dblclick', function(e) {
                        e.stopPropagation();
                        MURDERBOARD.showEditNoteModal(item.id);
                    });

                    // Modern pointer-based drag (hem mouse hem touch iÃ§in)
                    var isDragging = false;
                    var startPointerX = 0;
                    var startPointerY = 0;
                    var startItemX = 0;
                    var startItemY = 0;
                    var dragStartTime = 0;
                    var hasMoved = false;
                    var offsetX = 0;
                    var offsetY = 0;
                    var lastPointerEventTime = 0; // Pointer event tekrarÄ±nÄ± Ã¶nle

                    var getPointerCoords = function(e) {
                        // Touch event'ten koordinat al
                        if (e.touches && e.touches.length) {
                            return { x: e.touches[0].clientX, y: e.touches[0].clientY };
                        }
                        // Mouse/pointer event'ten koordinat al
                        return { x: e.clientX, y: e.clientY };
                    };

                    var onPointerDown = function(e) {
                        // Pointer event varsa touch'Ä± 100ms ignore et (Ã§ift tetiklenmeyi Ã¶nle)
                        if (e.type === 'pointerdown') {
                            lastPointerEventTime = Date.now();
                        } else if (e.type.includes('touch') && Date.now() - lastPointerEventTime < 100) {
                            return; // Touch ignore et
                        }

                        if (MURDERBOARD.connectionMode) {
                            // Connection mode'da drag baÅŸlatma, sadece click handle et
                            e.preventDefault();
                            e.stopPropagation();
                            MURDERBOARD.handleConnectionClick(item.id);
                            return;
                        }

                        dragStartTime = Date.now();
                        hasMoved = false;
                        isDragging = true;

                        var coords = getPointerCoords(e);
                        var canvas = document.getElementById('murderBoardCanvas');
                        var canvasRect = canvas.getBoundingClientRect();
                        var zoom = MURDERBOARD.zoomLevel;

                        // Mouse/touch'Ä±n karakter iÃ§indeki offsetini hesapla (senkronizasyon iÃ§in)
                        var canvasX = (coords.x - canvasRect.left) / zoom;
                        var canvasY = (coords.y - canvasRect.top) / zoom;
                        offsetX = canvasX - item.x;
                        offsetY = canvasY - item.y;

                        startPointerX = coords.x;
                        startPointerY = coords.y;
                        startItemX = item.x;
                        startItemY = item.y;

                        div.style.zIndex = '100';
                        div.style.cursor = 'grabbing';

                        e.preventDefault();
                        e.stopPropagation();
                    };

                    var onPointerMove = function(e) {
                        if (!isDragging) return;

                        hasMoved = true;
                        var coords = getPointerCoords(e);
                        var canvas = document.getElementById('murderBoardCanvas');
                        var canvasRect = canvas.getBoundingClientRect();
                        var zoom = MURDERBOARD.zoomLevel;

                        // Mouse/touch pozisyonunu canvas koordinatÄ±na Ã§evir ve offset'i Ã§Ä±kar
                        var canvasX = (coords.x - canvasRect.left) / zoom;
                        var canvasY = (coords.y - canvasRect.top) / zoom;

                        var newX = canvasX - offsetX;
                        var newY = canvasY - offsetY;

                        // Negatif deÄŸerleri engelle
                        newX = Math.max(0, newX);
                        newY = Math.max(0, newY);

                        div.style.left = newX + 'px';
                        div.style.top = newY + 'px';

                        // Board items'Ä± gÃ¼ncelle (baÄŸlantÄ±lar iÃ§in)
                        item.x = newX;
                        item.y = newY;

                        MURDERBOARD.scheduleConnectionRender();

                        e.preventDefault();
                        e.stopPropagation();
                    };

                    var onPointerUp = function(e) {
                        if (!isDragging) return;

                        isDragging = false;
                        div.style.zIndex = '10';
                        div.style.cursor = 'move';

                        var dragDuration = Date.now() - dragStartTime;

                        // Ã‡ok kÄ±sa dokunma ve hareket yoksa (tÄ±klama gibi) - sadece mobilde
                        if (!hasMoved && dragDuration < 200 && e.type.includes('touch')) {
                            MURDERBOARD.showEditNoteModal(item.id);
                        } else if (hasMoved) {
                            // Server'a pozisyonu kaydet
                            socket.emit('update-board-item-position', {
                                itemId: item.id,
                                x: Math.floor(item.x),
                                y: Math.floor(item.y)
                            });
                        }

                        // TÃ¼m document listener'larÄ± temizle
                        document.removeEventListener('pointermove', onPointerMove);
                        document.removeEventListener('pointerup', onPointerUp);
                        document.removeEventListener('pointercancel', onPointerUp);
                        document.removeEventListener('touchmove', onPointerMove);
                        document.removeEventListener('touchend', onPointerUp);
                        document.removeEventListener('touchcancel', onPointerUp);
                        document.removeEventListener('mousemove', onPointerMove);
                        document.removeEventListener('mouseup', onPointerUp);

                        if (e.preventDefault) e.preventDefault();
                    };

                    var onPointerDownHandler = function(e) {
                        // Pointer iÃ§in Ã¶zel handler (document listener'larÄ± ekle)
                        onPointerDown(e);
                        if (isDragging && e.type.includes('pointer')) {
                            // Pointer event iÃ§in document listener'larÄ± ekle
                            document.addEventListener('pointermove', onPointerMove, { passive: false });
                            document.addEventListener('pointerup', onPointerUp);
                            document.addEventListener('pointercancel', onPointerUp);
                        }
                    };

                    var onMouseDown = function(e) {
                        // Mouse iÃ§in Ã¶zel handler (document listener'larÄ± ekle)
                        onPointerDown(e);
                        if (isDragging) {
                            document.addEventListener('mousemove', onPointerMove, { passive: false });
                            document.addEventListener('mouseup', onPointerUp);
                        }
                    };

                    var onTouchStart = function(e) {
                        // Touch iÃ§in Ã¶zel handler (document listener'larÄ± ekle)
                        onPointerDown(e);
                        if (isDragging) {
                            document.addEventListener('touchmove', onPointerMove, { passive: false });
                            document.addEventListener('touchend', onPointerUp, { passive: false });
                            document.addEventListener('touchcancel', onPointerUp, { passive: false });
                        }
                    };

                    // Pointer events (modern, tÃ¼m cihazlarÄ± destekler)
                    div.addEventListener('pointerdown', onPointerDownHandler, { passive: false });

                    // Fallback: Touch events (eski mobil tarayÄ±cÄ±lar iÃ§in)
                    div.addEventListener('touchstart', onTouchStart, { passive: false });

                    // Fallback: Mouse events (eski tarayÄ±cÄ±lar iÃ§in)
                    div.addEventListener('mousedown', onMouseDown, { passive: false });

                    return div;
                },

                startDrag: function(e, itemId) {
                    const item = MURDERBOARD.boardItems.find(function(i) { return i.id === itemId; });
                    if (!item) return;

                    MURDERBOARD.draggedItem = item;

                    const itemEl = document.querySelector('[data-item-id="' + itemId + '"]');
                    const canvasRect = document.getElementById('murderBoardCanvas').getBoundingClientRect();

                    // Zoom'u hesaba katarak offset hesapla
                    const zoom = MURDERBOARD.zoomLevel;
                    const canvasX = (e.clientX - canvasRect.left) / zoom;
                    const canvasY = (e.clientY - canvasRect.top) / zoom;

                    MURDERBOARD.dragOffset = {
                        x: canvasX - item.x,
                        y: canvasY - item.y
                    };

                    itemEl.style.zIndex = '100';

                    document.addEventListener('mousemove', MURDERBOARD.onDrag);
                    document.addEventListener('mouseup', MURDERBOARD.stopDrag);
                    document.addEventListener('touchmove', MURDERBOARD.onDragTouch, { passive: false });
                    document.addEventListener('touchend', MURDERBOARD.stopDrag);
                },

                onDrag: function(e) {
                    if (!MURDERBOARD.draggedItem) return;

                    e.preventDefault(); // Canvas scroll'u engelle

                    const canvasRect = document.getElementById('murderBoardCanvas').getBoundingClientRect();
                    const zoom = MURDERBOARD.zoomLevel;

                    // Zoom'u hesaba katarak pozisyon hesapla
                    const canvasX = (e.clientX - canvasRect.left) / zoom;
                    const canvasY = (e.clientY - canvasRect.top) / zoom;

                    const x = canvasX - MURDERBOARD.dragOffset.x;
                    const y = canvasY - MURDERBOARD.dragOffset.y;

                    const itemEl = document.querySelector('[data-item-id="' + MURDERBOARD.draggedItem.id + '"]');
                    itemEl.style.left = x + 'px';
                    itemEl.style.top = y + 'px';

                    // Drag sÄ±rasÄ±nda boardItems'daki pozisyonu da gÃ¼ncelle (baÄŸlantÄ±lar iÃ§in)
                    MURDERBOARD.draggedItem.x = x;
                    MURDERBOARD.draggedItem.y = y;

                    // requestAnimationFrame ile optimize render (performans iÃ§in)
                    MURDERBOARD.scheduleConnectionRender();
                },

                scheduleConnectionRender: function() {
                    if (MURDERBOARD.renderScheduled) return;

                    MURDERBOARD.renderScheduled = true;
                    requestAnimationFrame(function() {
                        MURDERBOARD.renderConnections();
                        MURDERBOARD.renderScheduled = false;
                    });
                },

                onDragTouch: function(e) {
                    e.preventDefault(); // Touch scroll'u engelle
                    MURDERBOARD.onDrag(e.touches[0]);
                },

                stopDrag: function() {
                    if (!MURDERBOARD.draggedItem) return;

                    const itemEl = document.querySelector('[data-item-id="' + MURDERBOARD.draggedItem.id + '"]');
                    itemEl.style.zIndex = '10';

                    const x = parseInt(itemEl.style.left);
                    const y = parseInt(itemEl.style.top);

                    socket.emit('update-board-item-position', {
                        itemId: MURDERBOARD.draggedItem.id,
                        x: x,
                        y: y
                    });

                    MURDERBOARD.draggedItem.x = x;
                    MURDERBOARD.draggedItem.y = y;
                    MURDERBOARD.draggedItem = null;

                    document.removeEventListener('mousemove', MURDERBOARD.onDrag);
                    document.removeEventListener('mouseup', MURDERBOARD.stopDrag);
                    document.removeEventListener('touchmove', MURDERBOARD.onDragTouch, { passive: false });
                    document.removeEventListener('touchend', MURDERBOARD.stopDrag);
                },

                toggleConnectionMode: function() {
                    MURDERBOARD.connectionMode = !MURDERBOARD.connectionMode;
                    MURDERBOARD.connectionStart = null;

                    const btn = document.getElementById('btnAddConnection');
                    if (MURDERBOARD.connectionMode) {
                        btn.style.background = 'linear-gradient(135deg, #1a4d1a, #0d3310)';
                        btn.style.borderColor = '#4dd44d';
                        btn.style.color = '#4dd44d';
                        toast('ðŸ”— BaÄŸlantÄ± modu aktif - Ä°ki karakter seÃ§in');
                    } else {
                        btn.style.background = 'linear-gradient(135deg, #4d4d1a, #333310)';
                        btn.style.borderColor = '#d4d44d';
                        btn.style.color = '#d4d44d';
                    }
                },

                handleConnectionClick: function(itemId) {
                    if (!MURDERBOARD.connectionStart) {
                        MURDERBOARD.connectionStart = itemId;
                        toast('Ä°kinci karakteri seÃ§in');
                    } else {
                        if (MURDERBOARD.connectionStart === itemId) {
                            toast('AynÄ± karaktere baÄŸlantÄ± eklenemez!', true);
                            MURDERBOARD.connectionStart = null;
                            return;
                        }

                        socket.emit('add-board-connection', {
                            fromItemId: MURDERBOARD.connectionStart,
                            toItemId: itemId
                        }, function(response) {
                            if (response.success) {
                                toast('âœ… BaÄŸlantÄ± eklendi - BaÅŸka bir karakter seÃ§erek devam edebilirsiniz');
                                MURDERBOARD.loadBoard();
                                // BaÄŸlantÄ± modunu kapatma - devam edebilsin
                                MURDERBOARD.connectionStart = null; // Sadece baÅŸlangÄ±Ã§ noktasÄ±nÄ± sÄ±fÄ±rla
                            } else {
                                toast(response.error || 'BaÄŸlantÄ± eklenemedi!', true);
                            }
                        });
                    }
                },

                renderConnections: function() {
                    const svg = document.getElementById('connectionsLayer');
                    const canvas = document.getElementById('murderBoardCanvas');
                    svg.innerHTML = '';

                    // TÃ¼m karakterlerin pozisyonlarÄ±nÄ± kontrol ederek gerekli canvas boyutunu hesapla
                    let maxX = 800; // Minimum geniÅŸlik
                    let maxY = 600; // Minimum yÃ¼kseklik

                    MURDERBOARD.boardItems.forEach(function(item) {
                        const itemRight = item.x + 120; // Karakter geniÅŸliÄŸi
                        const itemBottom = item.y + 100; // Karakter yÃ¼ksekliÄŸi
                        if (itemRight > maxX) maxX = itemRight;
                        if (itemBottom > maxY) maxY = itemBottom;
                    });

                    // Canvas boyutunu gÃ¼ncelle (padding ekle)
                    canvas.style.minWidth = (maxX + 100) + 'px';
                    canvas.style.minHeight = (maxY + 100) + 'px';

                    // SVG boyutunu canvas boyutuna eÅŸitle
                    svg.style.width = (maxX + 100) + 'px';
                    svg.style.height = (maxY + 100) + 'px';

                    MURDERBOARD.connections.forEach(function(conn) {
                        const fromItem = MURDERBOARD.boardItems.find(function(i) { return i.id === conn.from_item_id; });
                        const toItem = MURDERBOARD.boardItems.find(function(i) { return i.id === conn.to_item_id; });

                        if (!fromItem || !toItem) return;

                        const fromX = fromItem.x + 60;
                        const fromY = fromItem.y + 50;
                        const toX = toItem.x + 60;
                        const toY = toItem.y + 50;

                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', fromX);
                        line.setAttribute('y1', fromY);
                        line.setAttribute('x2', toX);
                        line.setAttribute('y2', toY);
                        line.setAttribute('stroke', '#d44d4d');
                        line.setAttribute('stroke-width', '3');
                        line.setAttribute('stroke-dasharray', '5,5');
                        line.style.cursor = 'pointer';

                        line.addEventListener('click', function() {
                            if (confirm('Bu baÄŸlantÄ±yÄ± silmek istiyor musunuz?')) {
                                MURDERBOARD.deleteConnection(conn.id);
                            }
                        });

                        svg.appendChild(line);
                    });
                },

                deleteItem: function(itemId) {
                    if (!confirm('Bu karakteri kaldÄ±rmak istiyor musunuz?')) return;

                    socket.emit('delete-board-item', itemId, function(response) {
                        if (response.success) {
                            toast('ðŸ—‘ï¸ Karakter kaldÄ±rÄ±ldÄ±');
                            MURDERBOARD.loadBoard();
                        } else {
                            toast(response.error || 'Karakter kaldÄ±rÄ±lamadÄ±!', true);
                        }
                    });
                },

                deleteConnection: function(connectionId) {
                    socket.emit('delete-board-connection', connectionId, function(response) {
                        if (response.success) {
                            toast('ðŸ—‘ï¸ BaÄŸlantÄ± silindi');
                            MURDERBOARD.loadBoard();
                        } else {
                            toast(response.error || 'BaÄŸlantÄ± silinemedi!', true);
                        }
                    });
                },

                clearBoard: function() {
                    if (!confirm('TÃ¼m murder board\'u temizlemek istediÄŸinizden emin misiniz?')) return;

                    socket.emit('clear-board', function(response) {
                        if (response.success) {
                            toast('ðŸ—‘ï¸ Murder board temizlendi');
                            MURDERBOARD.loadBoard();
                        } else {
                            toast(response.error || 'Temizlenemedi!', true);
                        }
                    });
                },

                // Zoom fonksiyonlarÄ±
                zoomIn: function() {
                    MURDERBOARD.zoomLevel = Math.min(MURDERBOARD.zoomLevel + 0.1, 2);
                    MURDERBOARD.updateZoom();
                },

                zoomOut: function() {
                    MURDERBOARD.zoomLevel = Math.max(MURDERBOARD.zoomLevel - 0.1, 0.3);
                    MURDERBOARD.updateZoom();
                },

                resetZoom: function() {
                    MURDERBOARD.zoomLevel = 1;
                    MURDERBOARD.updateZoom();
                },

                updateZoom: function() {
                    const canvas = document.getElementById('murderBoardCanvas');
                    if (canvas) {
                        // Transform uygula
                        canvas.style.transform = 'scale(' + MURDERBOARD.zoomLevel + ')';

                        // Canvas boyutunu zoom seviyesine gÃ¶re ayarla (scrollbar iÃ§in)
                        const baseWidth = 800;
                        const baseHeight = 600;
                        canvas.style.minWidth = baseWidth + 'px';
                        canvas.style.minHeight = baseHeight + 'px';
                    }

                    // Zoom yÃ¼zdesini gÃ¼ncelle
                    const zoomDisplay = document.getElementById('zoomLevel');
                    if (zoomDisplay) {
                        zoomDisplay.textContent = Math.round(MURDERBOARD.zoomLevel * 100) + '%';
                    }
                }
            };

            // ADMIN MURDER BOARD Ä°ZLEME FONKSÄ°YONLARI
            window.ADMIN_BOARD = {
                selectedTeamId: null,
                boardItems: [],
                connections: [],
                zoomLevel: 1,

                init: function() {
                    // TakÄ±mlarÄ± yÃ¼kle
                    this.loadTeams();
                },

                loadTeams: function() {
                    const self = this;
                    socket.emit('admin-get-teams', function(res) {
                        const select = document.getElementById('adminBoardTeamSelect');
                        if (!select) {
                            console.error('adminBoardTeamSelect bulunamadÄ±!');
                            return;
                        }

                        select.innerHTML = '<option value="">-- TakÄ±m SeÃ§in --</option>';

                        if (!res.success || !res.teams || res.teams.length === 0) {
                            const option = document.createElement('option');
                            option.value = '';
                            option.textContent = 'HenÃ¼z takÄ±m oluÅŸturulmamÄ±ÅŸ';
                            option.disabled = true;
                            select.appendChild(option);
                            return;
                        }

                        res.teams.forEach(function(team) {
                            const option = document.createElement('option');
                            option.value = team.id;
                            option.textContent = team.name + ' (' + team.score + ' puan)';
                            select.appendChild(option);
                        });
                    });
                },

                selectTeam: function(teamId) {
                    if (!teamId) {
                        // SeÃ§im kaldÄ±rÄ±ldÄ±
                        this.selectedTeamId = null;
                        document.getElementById('adminBoardViewContainer').style.display = 'none';
                        document.getElementById('adminBoardEmptyStateMain').style.display = 'block';
                        return;
                    }

                    this.selectedTeamId = teamId;
                    document.getElementById('adminBoardViewContainer').style.display = 'block';
                    document.getElementById('adminBoardEmptyStateMain').style.display = 'none';

                    // SeÃ§ili takÄ±mÄ±n bilgilerini gÃ¶ster
                    socket.emit('admin-get-teams', function(res) {
                        if (!res.success) return;
                        const team = res.teams.find(function(t) { return t.id === teamId; });
                        if (team) {
                            document.getElementById('adminBoardTeamName').textContent = team.name;
                            document.getElementById('adminBoardTeamName').style.color = team.color || '#4dd4d4';
                        }
                    });

                    // Board'u yÃ¼kle
                    this.loadBoard();
                },

                loadBoard: function() {
                    if (!this.selectedTeamId) return;

                    const self = this;
                    socket.emit('get-team-board', this.selectedTeamId, function(data) {
                        self.boardItems = data.items || [];
                        self.connections = data.connections || [];

                        // SayÄ±larÄ± gÃ¼ncelle
                        document.getElementById('adminBoardItemCount').textContent = self.boardItems.length;
                        document.getElementById('adminBoardConnectionCount').textContent = self.connections.length;

                        // Board'u render et
                        self.renderBoard();
                    });
                },

                renderBoard: function() {
                    const canvas = document.getElementById('adminBoardCanvas');
                    const emptyState = document.getElementById('adminBoardEmptyState');

                    // Mevcut Ã¶ÄŸeleri temizle (SVG ve boÅŸ durum hariÃ§)
                    Array.from(canvas.children).forEach(function(child) {
                        if (child.id !== 'adminConnectionsLayer' && child.id !== 'adminBoardEmptyState') {
                            canvas.removeChild(child);
                        }
                    });

                    // BoÅŸ durum kontrolÃ¼
                    if (this.boardItems.length === 0) {
                        emptyState.style.display = 'block';
                        return;
                    }

                    emptyState.style.display = 'none';

                    // Karakterleri render et
                    this.boardItems.forEach(function(item) {
                        const div = document.createElement('div');
                        div.style.position = 'absolute';
                        div.style.left = item.x + 'px';
                        div.style.top = item.y + 'px';
                        div.style.width = '120px';
                        div.style.background = 'linear-gradient(135deg, #1a1a1a, #0a0a0a)';
                        div.style.border = '2px solid #333';
                        div.style.borderRadius = '12px';
                        div.style.padding = '10px';
                        div.style.boxShadow = '0 4px 15px rgba(0,0,0,0.5)';
                        div.style.zIndex = '10';
                        div.style.cursor = 'default';

                        let html = '';

                        // FotoÄŸraf
                        if (item.photo_url) {
                            html += '<img src="' + item.photo_url + '" alt="' + escapeHtml(item.character_name) + '" style="width:100%; height:80px; object-fit:cover; border-radius:8px; margin-bottom:8px; border:1px solid #444;">';
                        } else {
                            html += '<div style="width:100%; height:80px; background:#222; border-radius:8px; margin-bottom:8px; display:flex; align-items:center; justify-content:center; font-size:32px; border:1px solid #444;">ðŸ‘¤</div>';
                        }

                        // Ä°sim
                        html += '<div style="color:#4dd4d4; font-weight:600; font-size:13px; margin-bottom:5px; text-align:center;">' + escapeHtml(item.character_name) + '</div>';

                        // Not (varsa)
                        if (item.note) {
                            html += '<div style="color:#888; font-size:11px; line-height:1.4; margin-top:5px; padding:6px; background:#000; border-radius:6px; max-height:60px; overflow-y:auto;">' + escapeHtml(item.note) + '</div>';
                        }

                        div.innerHTML = html;
                        canvas.appendChild(div);
                    });

                    // BaÄŸlantÄ±larÄ± Ã§iz
                    this.renderConnections();
                },

                renderConnections: function() {
                    const svg = document.getElementById('adminConnectionsLayer');
                    const canvas = document.getElementById('adminBoardCanvas');
                    svg.innerHTML = '';

                    // Canvas boyutunu hesapla (MURDERBOARD ile aynÄ± mantÄ±k)
                    let maxX = 800;
                    let maxY = 600;

                    this.boardItems.forEach(function(item) {
                        const itemRight = item.x + 120;
                        const itemBottom = item.y + 100;
                        if (itemRight > maxX) maxX = itemRight;
                        if (itemBottom > maxY) maxY = itemBottom;
                    });

                    canvas.style.minWidth = (maxX + 100) + 'px';
                    canvas.style.minHeight = (maxY + 100) + 'px';
                    svg.style.width = (maxX + 100) + 'px';
                    svg.style.height = (maxY + 100) + 'px';

                    const self = this;
                    this.connections.forEach(function(conn) {
                        const fromItem = self.boardItems.find(function(i) { return i.id === conn.from_item_id; });
                        const toItem = self.boardItems.find(function(i) { return i.id === conn.to_item_id; });

                        if (!fromItem || !toItem) return;

                        const fromX = fromItem.x + 60;
                        const fromY = fromItem.y + 50;
                        const toX = toItem.x + 60;
                        const toY = toItem.y + 50;

                        const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                        line.setAttribute('x1', fromX);
                        line.setAttribute('y1', fromY);
                        line.setAttribute('x2', toX);
                        line.setAttribute('y2', toY);
                        line.setAttribute('stroke', '#d44d4d');
                        line.setAttribute('stroke-width', '3');
                        line.setAttribute('stroke-dasharray', '5,5');

                        svg.appendChild(line);
                    });
                },

                refreshBoard: function() {
                    if (this.selectedTeamId) {
                        this.loadBoard();
                        toast('ðŸ”„ Board yenilendi');
                    }
                },

                // Zoom fonksiyonlarÄ±
                zoomIn: function() {
                    this.zoomLevel = Math.min(this.zoomLevel + 0.1, 2);
                    this.updateZoom();
                },

                zoomOut: function() {
                    this.zoomLevel = Math.max(this.zoomLevel - 0.1, 0.3);
                    this.updateZoom();
                },

                resetZoom: function() {
                    this.zoomLevel = 1;
                    this.updateZoom();
                },

                updateZoom: function() {
                    const canvas = document.getElementById('adminBoardCanvas');
                    if (canvas) {
                        canvas.style.transform = 'scale(' + this.zoomLevel + ')';
                    }
                }
            };

            // Init
            window.onload = function() {
                // UX Ä°YÄ°LEÅžTÄ°RME: Her zaman temiz bir baÅŸlangÄ±Ã§
                currentUser = null;
                currentTeamId = null;
                pageHistory = [];

                NOTIF.updateBadge(); // Bildirim badge'ini gÃ¼ncelle
                renderMainCredits(); // Ana sayfa emeÄŸi geÃ§enler listesini render et
                updateCurrentUserDisplay(); // KullanÄ±cÄ± bilgisi display'ini gÃ¼ncelle

                // ROUTING: Socket connect'ten sonra router.handleRoute() Ã§alÄ±ÅŸacak
                // O zamana kadar nickname sayfasÄ± gÃ¶sterilsin (HTML'de zaten default aktif)
                // showPage('pgNickname', false); - KALDIRILDI: Router zaten doÄŸru sayfayÄ± gÃ¶sterecek
            };
        })();

        // ARKA PLAN MÃœZÄ°ÄžÄ° KONTROLÃœ
        var bgMusic = document.getElementById('bgMusic');

        // Sayfa yÃ¼klendiÄŸinde mÃ¼zik ayarlarÄ±nÄ± uygula
        document.addEventListener('DOMContentLoaded', function() {
            var musicEnabled = localStorage.getItem('musicEnabled');
            var musicVolume = localStorage.getItem('musicVolume');

            // Ses seviyesini ayarla
            if (musicVolume) {
                bgMusic.volume = parseInt(musicVolume) / 100;
            } else {
                bgMusic.volume = 0.5; // VarsayÄ±lan %50
            }

            // MÃ¼ziÄŸi sadece aÃ§Ä±ksa baÅŸlat
            if (musicEnabled === 'true') {
                // KullanÄ±cÄ± etkileÅŸimi sonrasÄ± mÃ¼ziÄŸi baÅŸlat (tarayÄ±cÄ± politikasÄ±)
                document.body.addEventListener('click', function startMusic() {
                    bgMusic.play().catch(function(err) {
                        console.log('MÃ¼zik baÅŸlatÄ±lamadÄ±:', err);
                    });
                }, { once: true });
            }
        });

        // MÃ¼zik AyarlarÄ± SayfasÄ±nÄ± AÃ§ (GLOBAL)
        function openMusicSettings() {
            // Mevcut sayfayÄ± URL parametresi olarak gÃ¶nder (en gÃ¼venilir yÃ¶ntem)
            var currentPath = window.location.pathname + window.location.search + window.location.hash;
            var returnUrl = encodeURIComponent(currentPath);
            console.log('MÃ¼zik ayarlarÄ± aÃ§Ä±lÄ±yor, return path:', currentPath);
            // MÃ¼zik ayarlarÄ± sayfasÄ±na git (return parametresi ile)
            window.location.href = '/music-settings.html?return=' + returnUrl;
        }

        // TakÄ±mlar arasÄ± sohbet aÃ§Ä±lÄ±r/kapanÄ±r toggle
        let interTeamChatOpen = true; // BaÅŸlangÄ±Ã§ta aÃ§Ä±k
        function toggleInterTeamChat() {
            const content = document.getElementById('interTeamChatContent');
            const icon = document.getElementById('interTeamChatToggleIcon');

            if (!content || !icon) return;

            interTeamChatOpen = !interTeamChatOpen;

            if (interTeamChatOpen) {
                // AÃ§
                content.style.maxHeight = '2000px';
                content.style.opacity = '1';
                icon.textContent = 'â–¼';
                icon.style.transform = 'rotate(0deg)';
            } else {
                // Kapat
                content.style.maxHeight = '0px';
                content.style.opacity = '0';
                icon.textContent = 'â–²';
                icon.style.transform = 'rotate(180deg)';
            }
        }

        // ============================================
        // GAME RESET SYSTEM
        // ============================================
        const GAME_RESET = {
            showConfirmModal: function() {
                const modal = document.getElementById('resetConfirmModal');
                const input = document.getElementById('resetConfirmInput');

                // Input'u temizle
                input.value = '';

                // Modal'Ä± gÃ¶ster (flex olarak)
                modal.style.display = 'flex';

                // Input'a focus
                setTimeout(function() {
                    input.focus();
                }, 100);
            },

            hideConfirmModal: function() {
                const modal = document.getElementById('resetConfirmModal');
                modal.style.display = 'none';
            },

            confirmReset: function() {
                const input = document.getElementById('resetConfirmInput');
                const confirmText = input.value.trim().toUpperCase();

                if (confirmText !== 'SIFIRLA') {
                    toast('Onaylamak iÃ§in "SIFIRLA" yazmalÄ±sÄ±nÄ±z!', true);
                    input.focus();
                    return;
                }

                // Confirmation geÃ§ti, server'a istek gÃ¶nder
                toast('Oyun sÄ±fÄ±rlanÄ±yor, lÃ¼tfen bekleyin...');

                socket.emit('reset-game', function(response) {
                    if (response.success) {
                        GAME_RESET.hideConfirmModal();
                        toast('âœ… Oyun baÅŸarÄ±yla sÄ±fÄ±rlandÄ±! Sayfa yenileniyor...');

                        // 2 saniye sonra sayfayÄ± yenile
                        setTimeout(function() {
                            window.location.reload();
                        }, 2000);
                    } else {
                        toast(response.error || 'SÄ±fÄ±rlama baÅŸarÄ±sÄ±z!', true);
                    }
                });
            }
        };
    </script>

    <!-- Reset Confirmation Modal -->
    <div id="resetConfirmModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:10000; display:none; align-items:center; justify-content:center;">
        <div style="background:linear-gradient(135deg, #1a0a0a, #0a0000); border:3px solid #ff4444; border-radius:16px; padding:40px; max-width:600px; width:90%; box-shadow:0 0 50px rgba(255,68,68,0.5);">
            <h2 style="color:#ff4444; font-size:24px; margin-bottom:20px; text-align:center;">âš ï¸ SON ONAY</h2>

            <p style="color:#ffaaaa; font-size:16px; line-height:1.8; margin-bottom:30px; text-align:center;">
                Bu iÅŸlem <strong style="color:#ff4444;">GERÄ° ALINAMAZ</strong>.<br>
                TÃ¼m oyun verileri <strong>KALICI OLARAK SÄ°LÄ°NECEK</strong>.<br><br>
                Devam etmek istediÄŸinizden emin misiniz?
            </p>

            <div style="background:#3d0000; border:1px solid #8b0000; border-radius:8px; padding:15px; margin-bottom:30px;">
                <p style="color:#ffcccc; font-size:14px; margin:0; text-align:center;">
                    <strong>Onaylamak iÃ§in aÅŸaÄŸÄ±ya "SIFIRLA" yazÄ±n:</strong>
                </p>
                <input type="text" id="resetConfirmInput" placeholder="SIFIRLA yazÄ±n..." style="width:100%; margin-top:15px; padding:12px; background:#000; border:2px solid #ff4444; color:#fff; text-align:center; font-size:16px; text-transform:uppercase;" maxlength="8">
            </div>

            <div style="display:flex; gap:15px;">
                <button class="btn" style="flex:1; background:#333; border-color:#666; color:#aaa; padding:14px; font-size:16px;" onclick="GAME_RESET.hideConfirmModal()">âŒ Ä°ptal</button>
                <button class="btn" style="flex:1; background:linear-gradient(135deg, #8b0000, #450000); border-color:#ff4444; color:#ff4444; padding:14px; font-size:16px; font-weight:600;" onclick="GAME_RESET.confirmReset()">ðŸ”„ SIFIRLA</button>
            </div>
        </div>
    </div>
</body>
</html>